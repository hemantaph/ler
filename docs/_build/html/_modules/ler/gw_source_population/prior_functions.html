

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ler.gw_source_population.prior_functions &mdash; ler 0.5.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/scalefix.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=776609e1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=8e576371"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="../../../_static/dark_mode_js/default_light.js?v=c2e647ce"></script>
      <script src="../../../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980b9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ler
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_overview.html">Code overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../GW_events.html">Gravitational wave event rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analytical_formulation_unlensed.html">Analytical Formulation for Gravitational Wave Event Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Lensed_events.html">Lensed event rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Lensed_equations.html">Lensed event sampling (Analytical formulation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/rates/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.rates</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/gw_source_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.gw_source_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/lens_galaxy_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.lens_galaxy_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/image_properties/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.image_properties</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.utils</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/LeR_short_examples.html">LeR Short Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/GWRATES_complete_examples.html">GWRATES complete example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/LeR_custom_functions.html">LeR with Custom Functions and Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/LeR_advanced_sampling.html">LeR Advanced Sampling — Generating Detectable Events</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980b9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ler.gw_source_population.prior_functions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ler.gw_source_population.prior_functions</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for JIT-compiled functions used in GW source population simulations.</span>

<span class="sd">This module provides Numba JIT-compiled functions for efficient sampling and</span>
<span class="sd">computation of merger rate densities, star formation rates, and mass distributions for various gravitational wave source populations including BBH, BNS, and NSBH.</span>

<span class="sd">Key Features: \n</span>
<span class="sd">- Merger rate density functions for PopI/II, PopIII, and Primordial BBH \n</span>
<span class="sd">- Star formation rate models (Madau &amp; Dickinson 2014, Madau &amp; Fragos 2017) \n</span>
<span class="sd">- Mass distribution samplers (power-law Gaussian, broken power-law, bimodal) \n</span>
<span class="sd">- JIT-compiled for high performance with Numba \n</span>

<span class="sd">Copyright (C) 2026 Hemanta Ph. Distributed under MIT License.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">CubicSpline</span>
<span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">LambdaCDM</span>

<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">inverse_transform_sampler</span><span class="p">,</span> <span class="n">sample_from_powerlaw_distribution</span>

<span class="c1"># ------------------------------</span>
<span class="c1"># Merger rate density functions</span>
<span class="c1"># ------------------------------</span>
<span class="nd">@njit</span>
<div class="viewcode-block" id="merger_rate_density_bbh_oguri2018_function">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.merger_rate_density_bbh_oguri2018_function">[docs]</a>
<span class="k">def</span> <span class="nf">merger_rate_density_bbh_oguri2018_function</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="mi">19</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="n">b2</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">b3</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">b4</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the merger rate density for PopI/II BBH.</span>

<span class="sd">    Reference: Oguri et al. (2018). The output is in detector frame and is</span>
<span class="sd">    unnormalized.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    R0 : ``float``</span>
<span class="sd">        Local merger rate density at low redshift (Mpc^-3 yr^-1). \n</span>
<span class="sd">        default: 19e-9 (GWTC-4)</span>
<span class="sd">    b2 : ``float``</span>
<span class="sd">        Fitting parameter. \n</span>
<span class="sd">        default: 1.6</span>
<span class="sd">    b3 : ``float``</span>
<span class="sd">        Fitting parameter. \n</span>
<span class="sd">        default: 2.1</span>
<span class="sd">    b4 : ``float``</span>
<span class="sd">        Fitting parameter. \n</span>
<span class="sd">        default: 30</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rate_density : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Merger rate density.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from ler.gw_source_population import merger_rate_density_bbh_oguri2018</span>
<span class="sd">    &gt;&gt;&gt; rate_density = merger_rate_density_bbh_oguri2018(zs=np.array([0.1]))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">R0</span> <span class="o">*</span> <span class="p">(</span><span class="n">b4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b2</span> <span class="o">*</span> <span class="n">zs</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b4</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b3</span> <span class="o">*</span> <span class="n">zs</span><span class="p">))</span></div>


<span class="nd">@njit</span>
<div class="viewcode-block" id="merger_rate_density_bbh_popIII_ken2022_function">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.merger_rate_density_bbh_popIII_ken2022_function">[docs]</a>
<span class="k">def</span> <span class="nf">merger_rate_density_bbh_popIII_ken2022_function</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">n0</span><span class="o">=</span><span class="mf">19.2</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="n">aIII</span><span class="o">=</span><span class="mf">0.66</span><span class="p">,</span> <span class="n">bIII</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">zIII</span><span class="o">=</span><span class="mf">11.6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the unnormalized merger rate density for PopIII BBH.</span>

<span class="sd">    Reference: Ng et al. (2022). The output is in detector frame and is</span>
<span class="sd">    unnormalized.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    n0 : ``float``</span>
<span class="sd">        Normalization constant. \n</span>
<span class="sd">        default: 19.2e-9</span>
<span class="sd">    aIII : ``float``</span>
<span class="sd">        Fitting parameter. \n</span>
<span class="sd">        default: 0.66</span>
<span class="sd">    bIII : ``float``</span>
<span class="sd">        Fitting parameter. \n</span>
<span class="sd">        default: 0.3</span>
<span class="sd">    zIII : ``float``</span>
<span class="sd">        Characteristic redshift. \n</span>
<span class="sd">        default: 11.6</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rate_density : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Merger rate density.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from ler.gw_source_population import merger_rate_density_bbh_popIII_ken2022</span>
<span class="sd">    &gt;&gt;&gt; rate_density = merger_rate_density_bbh_popIII_ken2022(zs=np.array([0.1]))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">n0</span>
        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">aIII</span> <span class="o">*</span> <span class="p">(</span><span class="n">zs</span> <span class="o">-</span> <span class="n">zIII</span><span class="p">))</span>
        <span class="o">/</span> <span class="p">(</span><span class="n">bIII</span> <span class="o">+</span> <span class="n">aIII</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">aIII</span> <span class="o">+</span> <span class="n">bIII</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">zs</span> <span class="o">-</span> <span class="n">zIII</span><span class="p">)))</span>
    <span class="p">)</span></div>


<span class="nd">@njit</span>
<div class="viewcode-block" id="merger_rate_density_madau_dickinson2014_function">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.merger_rate_density_madau_dickinson2014_function">[docs]</a>
<span class="k">def</span> <span class="nf">merger_rate_density_madau_dickinson2014_function</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="mi">19</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">2.7</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">2.9</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">5.6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the merger rate density for BBH using Madau &amp; Dickinson (2014) model.</span>

<span class="sd">    Reference: Eqn. 15 of https://arxiv.org/pdf/1403.0007</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    R0 : ``float``</span>
<span class="sd">        Local merger rate density (Mpc^-3 yr^-1). \n</span>
<span class="sd">        default: 19e-9</span>
<span class="sd">    a : ``float``</span>
<span class="sd">        Normalization parameter. \n</span>
<span class="sd">        default: 0.015</span>
<span class="sd">    b : ``float``</span>
<span class="sd">        Low-redshift power-law slope. \n</span>
<span class="sd">        default: 2.7</span>
<span class="sd">    c : ``float``</span>
<span class="sd">        Turnover redshift parameter. \n</span>
<span class="sd">        default: 2.9</span>
<span class="sd">    d : ``float``</span>
<span class="sd">        High-redshift power-law slope. \n</span>
<span class="sd">        default: 5.6</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rate_density : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Merger rate density (Mpc^-3 yr^-1).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from ler.gw_source_population import merger_rate_density_madau_dickinson2014</span>
<span class="sd">    &gt;&gt;&gt; rate_density = merger_rate_density_madau_dickinson2014(zs=np.array([0.1]))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">density_helper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">zs</span><span class="p">:</span> <span class="n">sfr_madau_dickinson2014</span><span class="p">(</span>  
        <span class="n">zs</span><span class="o">=</span><span class="n">zs</span><span class="p">,</span> 
        <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> 
        <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> 
        <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
        <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">density_zs</span> <span class="o">=</span> <span class="n">R0</span> <span class="o">*</span> <span class="n">density_helper</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span><span class="o">/</span> <span class="n">density_helper</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">density_zs</span></div>


<span class="nd">@njit</span>
<div class="viewcode-block" id="merger_rate_density_madau_dickinson_belczynski_ng_function">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.merger_rate_density_madau_dickinson_belczynski_ng_function">[docs]</a>
<span class="k">def</span> <span class="nf">merger_rate_density_madau_dickinson_belczynski_ng_function</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="mi">19</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="n">alpha_F</span><span class="o">=</span><span class="mf">2.57</span><span class="p">,</span> <span class="n">beta_F</span><span class="o">=</span><span class="mf">5.83</span><span class="p">,</span> <span class="n">c_F</span><span class="o">=</span><span class="mf">3.36</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute BBH merger rate density following Ng et al. (2021).</span>

<span class="sd">    This model uses a Madau-Dickinson-like functional form to fit the </span>
<span class="sd">    merger rate density of field BHs, accounting for time delays and </span>
<span class="sd">    metallicity effects. Coefficients from Madau &amp; Dickinson (2014) are translated as: B-&gt; alpha_F, D-&gt; beta_F, C-&gt; c_F.</span>

<span class="sd">    density(zs) ∝ (1 + zs) ** alpha_F / (1 + ((1 + zs) / c_F) ** beta_F)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    R0 : ``float``</span>
<span class="sd">        Local merger rate density (Mpc^-3 yr^-1). \n</span>
<span class="sd">        default: 19e-9</span>
<span class="sd">    alpha_F : ``float``</span>
<span class="sd">        Low-redshift power-law slope. \n</span>
<span class="sd">        default: 2.57</span>
<span class="sd">    beta_F : ``float``</span>
<span class="sd">        High-redshift power-law slope. \n</span>
<span class="sd">        default: 5.83</span>
<span class="sd">    c_F : ``float``</span>
<span class="sd">        Turnover redshift parameter. \n</span>
<span class="sd">        default: 3.36</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rate_density : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Merger rate density (Mpc^-3 yr^-1).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from ler.gw_source_population import merger_rate_density_madau_dickinson_belczynski_ng</span>
<span class="sd">    &gt;&gt;&gt; rate_density = merger_rate_density_madau_dickinson_belczynski_ng(zs=np.array([0.1]))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">density_helper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">zs</span><span class="p">:</span> <span class="n">sfr_madau_dickinson2014</span><span class="p">(</span>  
        <span class="n">zs</span><span class="o">=</span><span class="n">zs</span><span class="p">,</span> 
        <span class="n">a</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
        <span class="n">b</span><span class="o">=</span><span class="n">alpha_F</span><span class="p">,</span> 
        <span class="n">c</span><span class="o">=</span><span class="n">c_F</span><span class="p">,</span>
        <span class="n">d</span><span class="o">=</span><span class="n">beta_F</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">density_zs</span> <span class="o">=</span> <span class="n">R0</span> <span class="o">*</span> <span class="n">density_helper</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span><span class="o">/</span> <span class="n">density_helper</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">density_zs</span></div>


<div class="viewcode-block" id="merger_rate_density_bbh_primordial_ken2022_function">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.merger_rate_density_bbh_primordial_ken2022_function">[docs]</a>
<span class="k">def</span> <span class="nf">merger_rate_density_bbh_primordial_ken2022_function</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">cosmology</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n0</span><span class="o">=</span><span class="mf">0.044</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="mf">13.786885302009708</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the merger rate density for Primordial BBH.</span>

<span class="sd">    Reference: Ng et al. (2022). The output is in detector frame and is</span>
<span class="sd">    unnormalized.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    cosmology : ``astropy.cosmology`` or ``None``</span>
<span class="sd">        Cosmology object for age calculations. \n</span>
<span class="sd">        default: LambdaCDM(H0=70, Om0=0.3, Ode0=0.7, Tcmb0=0.0, Neff=3.04, m_nu=None, Ob0=0.0)</span>
<span class="sd">    n0 : ``float``</span>
<span class="sd">        Normalization constant. \n</span>
<span class="sd">        default: 0.044e-9</span>
<span class="sd">    t0 : ``float``</span>
<span class="sd">        Present age of the Universe (Gyr). \n</span>
<span class="sd">        default: 13.786885302009708</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rate_density : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Merger rate density.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from ler.gw_source_population import merger_rate_density_bbh_primordial_ken2022</span>
<span class="sd">    &gt;&gt;&gt; rate_density = merger_rate_density_bbh_primordial_ken2022(zs=np.array([0.1]))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cosmology</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cosmology</span> <span class="o">=</span> <span class="n">LambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Ode0</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">Tcmb0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Neff</span><span class="o">=</span><span class="mf">3.04</span><span class="p">,</span> <span class="n">m_nu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ob0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">rate_density</span> <span class="o">=</span> <span class="n">n0</span> <span class="o">*</span> <span class="p">(</span><span class="n">cosmology</span><span class="o">.</span><span class="n">age</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">zs</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">t0</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">34</span> <span class="o">/</span> <span class="mi">37</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rate_density</span></div>



<div class="viewcode-block" id="sfr_madau_fragos2017_with_bbh_td">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.sfr_madau_fragos2017_with_bbh_td">[docs]</a>
<span class="k">def</span> <span class="nf">sfr_madau_fragos2017_with_bbh_td</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="mi">19</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the merger rate density for BBH. This is computed from star formation rate, Madau &amp; Fragos (2017), with an additional time delay. This function is relies on pre-generated data points. </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    R0 : ``float``</span>
<span class="sd">        Local merger rate density (Mpc^-3 yr^-1). \n</span>
<span class="sd">        default: 19e-9</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SFR : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Star formation rate (Mpc^-3 yr^-1).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.00304765</span><span class="p">,</span> <span class="mf">1.00370075</span><span class="p">,</span> <span class="mf">1.00449545</span><span class="p">,</span> <span class="mf">1.00546251</span><span class="p">,</span> <span class="mf">1.00663937</span><span class="p">,</span> <span class="mf">1.00807168</span><span class="p">,</span> <span class="mf">1.00981505</span><span class="p">,</span> <span class="mf">1.01193727</span><span class="p">,</span> <span class="mf">1.01046483</span><span class="p">,</span> <span class="mf">1.01359803</span><span class="p">,</span> <span class="mf">1.01741386</span><span class="p">,</span> <span class="mf">1.02206193</span><span class="p">,</span> <span class="mf">1.02772495</span><span class="p">,</span> <span class="mf">1.03462601</span><span class="p">,</span> <span class="mf">1.04303746</span><span class="p">,</span> <span class="mf">1.05329142</span><span class="p">,</span> <span class="mf">1.07093106</span><span class="p">,</span> <span class="mf">1.08624215</span><span class="p">,</span> <span class="mf">1.10489848</span><span class="p">,</span> <span class="mf">1.12760683</span><span class="p">,</span><span class="mf">1.15519183</span><span class="p">,</span> <span class="mf">1.18858451</span><span class="p">,</span> <span class="mf">1.22878158</span><span class="p">,</span> <span class="mf">1.27676494</span><span class="p">,</span> <span class="mf">1.33727882</span><span class="p">,</span> <span class="mf">1.40335222</span><span class="p">,</span> <span class="mf">1.47956936</span><span class="p">,</span> <span class="mf">1.56759515</span><span class="p">,</span> <span class="mf">1.6711375</span> <span class="p">,</span> <span class="mf">1.79690371</span><span class="p">,</span> <span class="mf">1.95410462</span><span class="p">,</span> <span class="mf">2.15201042</span><span class="p">,</span> <span class="mf">2.36151109</span><span class="p">,</span> <span class="mf">2.66742932</span><span class="p">,</span> <span class="mf">3.04354598</span><span class="p">,</span> <span class="mf">3.49048755</span><span class="p">,</span> <span class="mf">3.98122536</span><span class="p">,</span> <span class="mf">4.42347511</span><span class="p">,</span> <span class="mf">4.61710896</span><span class="p">,</span> <span class="mf">4.30190679</span><span class="p">,</span> <span class="mf">3.50890876</span><span class="p">,</span> <span class="mf">2.37699066</span><span class="p">,</span> <span class="mf">1.41830834</span><span class="p">,</span> <span class="mf">0.77944771</span><span class="p">,</span><span class="mf">0.40667706</span><span class="p">,</span> <span class="mf">0.20463758</span><span class="p">,</span> <span class="mf">0.09975143</span><span class="p">,</span> <span class="mf">0.04745116</span><span class="p">])</span>
    <span class="n">zs_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>

    <span class="n">spline</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">zs_</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">SFR</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span><span class="o">*</span><span class="n">R0</span>
    <span class="k">return</span> <span class="n">SFR</span></div>


<div class="viewcode-block" id="sfr_madau_dickinson2014_with_bbh_td">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.sfr_madau_dickinson2014_with_bbh_td">[docs]</a>
<span class="k">def</span> <span class="nf">sfr_madau_dickinson2014_with_bbh_td</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="mi">19</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the merger rate density for BBH. This is computed from star formation rate, Madau &amp; Dickinson (2014), with an additional time delay. This function is relies on pre-generated data points. </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    R0 : ``float``</span>
<span class="sd">        Local merger rate density (Mpc^-3 yr^-1). \n</span>
<span class="sd">        default: 19e-9</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SFR : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Star formation rate (Mpc^-3 yr^-1).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.00292325</span><span class="p">,</span> <span class="mf">1.0035494</span> <span class="p">,</span> <span class="mf">1.0043112</span> <span class="p">,</span> <span class="mf">1.00523807</span><span class="p">,</span> <span class="mf">1.0063658</span> <span class="p">,</span> <span class="mf">1.00773798</span><span class="p">,</span> <span class="mf">1.00940767</span><span class="p">,</span> <span class="mf">1.01143948</span><span class="p">,</span> <span class="mf">1.00997839</span><span class="p">,</span> <span class="mf">1.01297699</span><span class="p">,</span> <span class="mf">1.01662662</span><span class="p">,</span> <span class="mf">1.02106895</span><span class="p">,</span> <span class="mf">1.02647649</span><span class="p">,</span> <span class="mf">1.03305927</span><span class="p">,</span> <span class="mf">1.04107277</span><span class="p">,</span> <span class="mf">1.05082743</span><span class="p">,</span> <span class="mf">1.06802831</span><span class="p">,</span> <span class="mf">1.08255749</span><span class="p">,</span> <span class="mf">1.10022606</span><span class="p">,</span> <span class="mf">1.12169013</span><span class="p">,</span> <span class="mf">1.14772134</span><span class="p">,</span> <span class="mf">1.1792097</span> <span class="p">,</span> <span class="mf">1.21715406</span><span class="p">,</span> <span class="mf">1.26263694</span><span class="p">,</span> <span class="mf">1.32051095</span><span class="p">,</span> <span class="mf">1.38462461</span><span class="p">,</span> <span class="mf">1.45997648</span><span class="p">,</span> <span class="mf">1.54851567</span><span class="p">,</span> <span class="mf">1.65349288</span><span class="p">,</span> <span class="mf">1.78046645</span><span class="p">,</span> <span class="mf">1.93811129</span><span class="p">,</span> <span class="mf">2.1354612</span> <span class="p">,</span> <span class="mf">2.34086287</span><span class="p">,</span> <span class="mf">2.63664802</span><span class="p">,</span> <span class="mf">2.98892341</span><span class="p">,</span> <span class="mf">3.38353439</span><span class="p">,</span> <span class="mf">3.76990612</span><span class="p">,</span> <span class="mf">4.03489696</span><span class="p">,</span> <span class="mf">4.00806904</span><span class="p">,</span> <span class="mf">3.56766897</span><span class="p">,</span> <span class="mf">2.86966689</span><span class="p">,</span> <span class="mf">2.01282062</span><span class="p">,</span> <span class="mf">1.29696347</span><span class="p">,</span> <span class="mf">0.78913584</span><span class="p">,</span> <span class="mf">0.46166281</span><span class="p">,</span> <span class="mf">0.26226345</span><span class="p">,</span> <span class="mf">0.14509118</span><span class="p">,</span> <span class="mf">0.07854392</span><span class="p">])</span>
    <span class="n">zs_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>

    <span class="n">spline</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">zs_</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">SFR</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span><span class="o">*</span><span class="n">R0</span>
    <span class="k">return</span> <span class="n">SFR</span></div>


<div class="viewcode-block" id="sfr_madau_fragos2017_with_bns_td">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.sfr_madau_fragos2017_with_bns_td">[docs]</a>
<span class="k">def</span> <span class="nf">sfr_madau_fragos2017_with_bns_td</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="mi">89</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the merger rate density for BNS. This is computed from star formation rate, Madau &amp; Fragos (2017), with an additional time delay. This function is relies on pre-generated data points. </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    R0 : ``float``</span>
<span class="sd">        Local merger rate density (Mpc^-3 yr^-1). \n</span>
<span class="sd">        default: 89e-9</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SFR : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Star formation rate (Mpc^-3 yr^-1).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.00309364</span><span class="p">,</span> <span class="mf">1.00375139</span><span class="p">,</span> <span class="mf">1.00455175</span><span class="p">,</span> <span class="mf">1.00552568</span><span class="p">,</span> <span class="mf">1.00671091</span><span class="p">,</span> <span class="mf">1.00815339</span><span class="p">,</span> <span class="mf">1.00990912</span><span class="p">,</span> <span class="mf">1.01204635</span><span class="p">,</span> <span class="mf">1.00757017</span><span class="p">,</span> <span class="mf">1.01071962</span><span class="p">,</span> <span class="mf">1.01455507</span><span class="p">,</span> <span class="mf">1.01922677</span><span class="p">,</span> <span class="mf">1.02491815</span><span class="p">,</span> <span class="mf">1.03185311</span><span class="p">,</span> <span class="mf">1.04030479</span><span class="p">,</span> <span class="mf">1.05060602</span><span class="p">,</span> <span class="mf">1.06970166</span><span class="p">,</span> <span class="mf">1.08508957</span><span class="p">,</span> <span class="mf">1.10382838</span><span class="p">,</span> <span class="mf">1.12661829</span><span class="p">,</span> <span class="mf">1.15427005</span><span class="p">,</span> <span class="mf">1.18768774</span><span class="p">,</span> <span class="mf">1.22781836</span><span class="p">,</span> <span class="mf">1.27555711</span><span class="p">,</span> <span class="mf">1.31791484</span><span class="p">,</span> <span class="mf">1.38209039</span><span class="p">,</span> <span class="mf">1.4555543</span> <span class="p">,</span> <span class="mf">1.5397332</span> <span class="p">,</span> <span class="mf">1.63806934</span><span class="p">,</span> <span class="mf">1.75685668</span><span class="p">,</span> <span class="mf">1.90448546</span><span class="p">,</span> <span class="mf">2.08862044</span><span class="p">,</span> <span class="mf">2.34440211</span><span class="p">,</span> <span class="mf">2.63899295</span><span class="p">,</span> <span class="mf">2.99729389</span><span class="p">,</span> <span class="mf">3.41567274</span><span class="p">,</span> <span class="mf">3.86324106</span><span class="p">,</span> <span class="mf">4.24545603</span><span class="p">,</span> <span class="mf">4.37018218</span><span class="p">,</span> <span class="mf">4.00555831</span><span class="p">,</span> <span class="mf">3.10525751</span><span class="p">,</span> <span class="mf">2.06354992</span><span class="p">,</span> <span class="mf">1.20906304</span><span class="p">,</span> <span class="mf">0.65233811</span><span class="p">,</span> <span class="mf">0.33356891</span><span class="p">,</span> <span class="mf">0.16397688</span><span class="p">,</span> <span class="mf">0.08024945</span><span class="p">,</span> <span class="mf">0.036953</span><span class="p">])</span>
    <span class="n">zs_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>

    <span class="n">spline</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">zs_</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">SFR</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span><span class="o">*</span><span class="n">R0</span>
    <span class="k">return</span> <span class="n">SFR</span></div>


<div class="viewcode-block" id="sfr_madau_dickinson2014_with_bns_td">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.sfr_madau_dickinson2014_with_bns_td">[docs]</a>
<span class="k">def</span> <span class="nf">sfr_madau_dickinson2014_with_bns_td</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">R0</span><span class="o">=</span><span class="mi">89</span> <span class="o">*</span> <span class="mf">1e-9</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the merger rate density for BNS. This is computed from star formation rate, Madau &amp; Dickinson (2014), with an additional time delay. This function is relies on pre-generated data points. </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    R0 : ``float``</span>
<span class="sd">        Local merger rate density (Mpc^-3 yr^-1). \n</span>
<span class="sd">        default: 89e-9</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SFR : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Star formation rate (Mpc^-3 yr^-1).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0029945</span> <span class="p">,</span> <span class="mf">1.00362259</span><span class="p">,</span> <span class="mf">1.00438674</span><span class="p">,</span> <span class="mf">1.00531645</span><span class="p">,</span> <span class="mf">1.00644763</span><span class="p">,</span> <span class="mf">1.00782396</span><span class="p">,</span> <span class="mf">1.00949865</span><span class="p">,</span> <span class="mf">1.01153645</span><span class="p">,</span> <span class="mf">1.00240992</span><span class="p">,</span> <span class="mf">1.00539605</span><span class="p">,</span> <span class="mf">1.00903013</span><span class="p">,</span> <span class="mf">1.01345293</span><span class="p">,</span> <span class="mf">1.01883579</span><span class="p">,</span> <span class="mf">1.02538714</span><span class="p">,</span> <span class="mf">1.03336026</span><span class="p">,</span> <span class="mf">1.04306247</span><span class="p">,</span> <span class="mf">1.05841698</span><span class="p">,</span> <span class="mf">1.07283625</span><span class="p">,</span> <span class="mf">1.09035966</span><span class="p">,</span> <span class="mf">1.11162909</span><span class="p">,</span> <span class="mf">1.1373949</span> <span class="p">,</span> <span class="mf">1.16851509</span><span class="p">,</span> <span class="mf">1.20594024</span><span class="p">,</span> <span class="mf">1.25068092</span><span class="p">,</span> <span class="mf">1.3085267</span> <span class="p">,</span> <span class="mf">1.37111306</span><span class="p">,</span> <span class="mf">1.44421094</span><span class="p">,</span> <span class="mf">1.52948237</span><span class="p">,</span> <span class="mf">1.62985636</span><span class="p">,</span> <span class="mf">1.75058453</span><span class="p">,</span> <span class="mf">1.90010572</span><span class="p">,</span> <span class="mf">2.0870216</span> <span class="p">,</span> <span class="mf">2.33573104</span><span class="p">,</span> <span class="mf">2.6218286</span> <span class="p">,</span> <span class="mf">2.96031682</span><span class="p">,</span> <span class="mf">3.3343522</span> <span class="p">,</span> <span class="mf">3.69149889</span><span class="p">,</span> <span class="mf">3.92099769</span><span class="p">,</span> <span class="mf">3.86227814</span><span class="p">,</span> <span class="mf">3.40811745</span><span class="p">,</span> <span class="mf">2.59314381</span><span class="p">,</span> <span class="mf">1.79588097</span><span class="p">,</span> <span class="mf">1.14260538</span><span class="p">,</span> <span class="mf">0.686002</span>  <span class="p">,</span> <span class="mf">0.3954134</span> <span class="p">,</span> <span class="mf">0.22083291</span><span class="p">,</span> <span class="mf">0.11548455</span><span class="p">,</span> <span class="mf">0.06064368</span><span class="p">])</span>
    <span class="n">zs_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>

    <span class="n">spline</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">zs_</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">SFR</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span><span class="o">*</span><span class="n">R0</span>
    <span class="k">return</span> <span class="n">SFR</span></div>


<span class="c1"># ------------------------------</span>
<span class="c1"># Star formation rate functions</span>
<span class="c1"># ------------------------------</span>
<span class="nd">@njit</span>
<div class="viewcode-block" id="sfr_madau_fragos2017">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.sfr_madau_fragos2017">[docs]</a>
<span class="k">def</span> <span class="nf">sfr_madau_fragos2017</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">2.6</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">3.2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">6.2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute star formation rate using Madau &amp; Fragos (2017) model.</span>

<span class="sd">    Reference: https://arxiv.org/pdf/1606.07887.pdf</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    a : ``float``</span>
<span class="sd">        Normalization parameter. \n</span>
<span class="sd">        default: 0.01</span>
<span class="sd">    b : ``float``</span>
<span class="sd">        Low-redshift power-law slope. \n</span>
<span class="sd">        default: 2.6</span>
<span class="sd">    c : ``float``</span>
<span class="sd">        Turnover redshift parameter. \n</span>
<span class="sd">        default: 3.2</span>
<span class="sd">    d : ``float``</span>
<span class="sd">        High-redshift power-law slope. \n</span>
<span class="sd">        default: 6.2</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SFR : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Star formation rate (Msun yr^-1 Mpc^-3).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">zs</span><span class="p">)</span><span class="o">**</span><span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">zs</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="n">d</span><span class="p">)</span></div>


<span class="nd">@njit</span>
<div class="viewcode-block" id="sfr_madau_dickinson2014">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.sfr_madau_dickinson2014">[docs]</a>
<span class="k">def</span> <span class="nf">sfr_madau_dickinson2014</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">2.7</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">2.9</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">5.6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute star formation rate using Madau &amp; Dickinson (2014) model.</span>

<span class="sd">    Reference: Eqn. 15 of https://arxiv.org/pdf/1403.0007</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zs : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Source redshifts.</span>
<span class="sd">    a : ``float``</span>
<span class="sd">        Normalization parameter. \n</span>
<span class="sd">        default: 0.015</span>
<span class="sd">    b : ``float``</span>
<span class="sd">        Low-redshift power-law slope. \n</span>
<span class="sd">        default: 2.7</span>
<span class="sd">    c : ``float``</span>
<span class="sd">        Turnover redshift parameter. \n</span>
<span class="sd">        default: 2.9</span>
<span class="sd">    d : ``float``</span>
<span class="sd">        High-redshift power-law slope. \n</span>
<span class="sd">        default: 5.6</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SFR : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Star formation rate (Msun yr^-1 Mpc^-3).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from ler.gw_source_population import sfr_madau_dickinson2014</span>
<span class="sd">    &gt;&gt;&gt; sfr = sfr_madau_dickinson2014(zs=np.array([0.1]))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zs</span><span class="p">)</span> <span class="o">**</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zs</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">**</span> <span class="n">d</span><span class="p">)</span></div>


<span class="c1"># ------------------------------</span>
<span class="c1"># Binary mass functions</span>
<span class="c1"># ------------------------------</span>
<span class="nd">@njit</span>
<div class="viewcode-block" id="binary_masses_BBH_popIII_lognormal_rvs">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.binary_masses_BBH_popIII_lognormal_rvs">[docs]</a>
<span class="k">def</span> <span class="nf">binary_masses_BBH_popIII_lognormal_rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">m_min</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">m_max</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">Mc</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample from a lognormal distribution in 2D mass space.</span>

<span class="sd">    Reference: Ng et al. (2022). This is a helper function for PopIII BBH</span>
<span class="sd">    and primordial BBH merger rate density distribution functions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : ``int``</span>
<span class="sd">        Number of samples to draw.</span>
<span class="sd">    m_min : ``float``</span>
<span class="sd">        Minimum mass (Msun). \n</span>
<span class="sd">        default: 1.0</span>
<span class="sd">    m_max : ``float``</span>
<span class="sd">        Maximum mass (Msun). \n</span>
<span class="sd">        default: 100.0</span>
<span class="sd">    Mc : ``float``</span>
<span class="sd">        Characteristic mass scale (Msun). \n</span>
<span class="sd">        default: 20.0</span>
<span class="sd">    sigma : ``float``</span>
<span class="sd">        Width of the distribution. \n</span>
<span class="sd">        default: 0.3</span>
<span class="sd">    chunk_size : ``int``</span>
<span class="sd">        Number of samples per rejection sampling chunk. \n</span>
<span class="sd">        default: 10000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    m1_sample : ``numpy.ndarray``</span>
<span class="sd">        Primary mass samples (Msun).</span>
<span class="sd">    m2_sample : ``numpy.ndarray``</span>
<span class="sd">        Secondary mass samples (Msun).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from ler.gw_source_population import binary_masses_BBH_popIII_lognormal</span>
<span class="sd">    &gt;&gt;&gt; m1, m2 = binary_masses_BBH_popIII_lognormal(size=1000)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># mass function (Eqn. 1 of Ng et al. 2022)</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="n">Mc</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">m</span>
    <span class="p">)</span>
    <span class="c1"># probability density function (Eqn. 4 of Ng et al. 2022)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">:</span> <span class="p">(</span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">36</span> <span class="o">/</span> <span class="mi">37</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">m1</span> <span class="o">*</span> <span class="n">m2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">32</span> <span class="o">/</span> <span class="mi">37</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">psi</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">psi</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># rejection sampling initialization</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">m_min</span><span class="p">,</span> <span class="n">m_max</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">m_min</span><span class="p">,</span> <span class="n">m_max</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">pdf</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
    <span class="n">zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="c1"># rejection sampling in chunks</span>
    <span class="n">m1_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">m2_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">old_num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">m1_try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">m_min</span><span class="p">,</span> <span class="n">m_max</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>
        <span class="n">m2_try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">m_min</span><span class="p">,</span> <span class="n">m_max</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>

        <span class="n">z_try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>
        <span class="n">zmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">zmax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z_try</span><span class="p">))</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">z_try</span> <span class="o">&lt;</span> <span class="n">pdf</span><span class="p">(</span><span class="n">m1_try</span><span class="p">,</span> <span class="n">m2_try</span><span class="p">)</span>
        <span class="n">new_num</span> <span class="o">=</span> <span class="n">old_num</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_num</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">m1_sample</span><span class="p">[</span><span class="n">old_num</span><span class="p">:</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="n">m1_try</span><span class="p">[</span><span class="n">idx</span><span class="p">][:</span> <span class="n">size</span> <span class="o">-</span> <span class="n">old_num</span><span class="p">]</span>
            <span class="n">m2_sample</span><span class="p">[</span><span class="n">old_num</span><span class="p">:</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="n">m2_try</span><span class="p">[</span><span class="n">idx</span><span class="p">][:</span> <span class="n">size</span> <span class="o">-</span> <span class="n">old_num</span><span class="p">]</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m1_sample</span><span class="p">[</span><span class="n">old_num</span><span class="p">:</span><span class="n">new_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">m1_try</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">m2_sample</span><span class="p">[</span><span class="n">old_num</span><span class="p">:</span><span class="n">new_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">m2_try</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">old_num</span> <span class="o">=</span> <span class="n">new_num</span>

    <span class="c1"># swap masses to ensure m1 &gt;= m2</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">m1_sample</span> <span class="o">&lt;</span> <span class="n">m2_sample</span>
    <span class="n">m1_sample</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">m2_sample</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">m2_sample</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">m1_sample</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">m1_sample</span><span class="p">,</span> <span class="n">m2_sample</span></div>


<span class="nd">@njit</span>
<div class="viewcode-block" id="binary_masses_BBH_primordial_lognormal_rvs">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.binary_masses_BBH_primordial_lognormal_rvs">[docs]</a>
<span class="k">def</span> <span class="nf">binary_masses_BBH_primordial_lognormal_rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">m_min</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">m_max</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">Mc</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample from a lognormal distribution in 2D mass space.</span>

<span class="sd">    Based on Eqn. 1 and 4 of Ng et al. 2022 for primordial black holes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : ``int``</span>
<span class="sd">        Number of samples to draw.</span>
<span class="sd">    m_min : ``float``</span>
<span class="sd">        Minimum mass (Msun). \n</span>
<span class="sd">        default: 1.0</span>
<span class="sd">    m_max : ``float``</span>
<span class="sd">        Maximum mass (Msun). \n</span>
<span class="sd">        default: 100.0</span>
<span class="sd">    Mc : ``float``</span>
<span class="sd">        Characteristic mass scale (Msun). \n</span>
<span class="sd">        default: 20.0</span>
<span class="sd">    sigma : ``float``</span>
<span class="sd">        Width of the distribution. \n</span>
<span class="sd">        default: 0.3</span>
<span class="sd">    chunk_size : ``int``</span>
<span class="sd">        Number of samples per rejection sampling chunk. \n</span>
<span class="sd">        default: 10000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    m1_sample : ``numpy.ndarray``</span>
<span class="sd">        Primary mass samples (Msun).</span>
<span class="sd">    m2_sample : ``numpy.ndarray``</span>
<span class="sd">        Secondary mass samples (Msun).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from ler.gw_source_population import binary_masses_BBH_primordial_lognormal</span>
<span class="sd">    &gt;&gt;&gt; m1, m2 = binary_masses_BBH_primordial_lognormal(size=1000)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># mass function (Eqn. 1 of Ng et al. 2022)</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="n">Mc</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>  
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">m</span>
    <span class="p">)</span>
    <span class="c1"># probability density function (Eqn. 4 of Ng et al. 2022)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="p">(</span>  
        <span class="k">lambda</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">:</span> <span class="p">(</span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">36</span> <span class="o">/</span> <span class="mi">37</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">m1</span> <span class="o">*</span> <span class="n">m2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">32</span> <span class="o">/</span> <span class="mi">37</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">psi</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">psi</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># rejection sampling initialization</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">m_min</span><span class="p">,</span> <span class="n">m_max</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">m_min</span><span class="p">,</span> <span class="n">m_max</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">pdf</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
    <span class="n">zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="c1"># rejection sampling in chunks</span>
    <span class="n">m1_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">m2_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">old_num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">m1_try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">m_min</span><span class="p">,</span> <span class="n">m_max</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>
        <span class="n">m2_try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">m_min</span><span class="p">,</span> <span class="n">m_max</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>

        <span class="n">z_try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>
        <span class="n">zmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">zmax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z_try</span><span class="p">))</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">z_try</span> <span class="o">&lt;</span> <span class="n">pdf</span><span class="p">(</span><span class="n">m1_try</span><span class="p">,</span> <span class="n">m2_try</span><span class="p">)</span>
        <span class="n">new_num</span> <span class="o">=</span> <span class="n">old_num</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_num</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">m1_sample</span><span class="p">[</span><span class="n">old_num</span><span class="p">:</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="n">m1_try</span><span class="p">[</span><span class="n">idx</span><span class="p">][:</span> <span class="n">size</span> <span class="o">-</span> <span class="n">old_num</span><span class="p">]</span>
            <span class="n">m2_sample</span><span class="p">[</span><span class="n">old_num</span><span class="p">:</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="n">m2_try</span><span class="p">[</span><span class="n">idx</span><span class="p">][:</span> <span class="n">size</span> <span class="o">-</span> <span class="n">old_num</span><span class="p">]</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m1_sample</span><span class="p">[</span><span class="n">old_num</span><span class="p">:</span><span class="n">new_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">m1_try</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">m2_sample</span><span class="p">[</span><span class="n">old_num</span><span class="p">:</span><span class="n">new_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">m2_try</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">old_num</span> <span class="o">=</span> <span class="n">new_num</span>

    <span class="c1"># swap masses to ensure m1 &gt;= m2</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">m1_sample</span> <span class="o">&lt;</span> <span class="n">m2_sample</span>
    <span class="n">m1_sample</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">m2_sample</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">m2_sample</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">m1_sample</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">m1_sample</span><span class="p">,</span> <span class="n">m2_sample</span></div>


<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_erf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the error function using Abramowitz &amp; Stegun approximation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Input value(s).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Error function value(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># constants for A&amp;S formula 7.1.26</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mf">0.3275911</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="mf">0.254829592</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.284496736</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="mf">1.421413741</span>
    <span class="n">a4</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.453152027</span>
    <span class="n">a5</span> <span class="o">=</span> <span class="mf">1.061405429</span>

    <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(((((</span><span class="n">a5</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">a3</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">a1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">y</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_compute_normalization_factor</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute normalization factor for truncated Gaussian.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mu : ``float``</span>
<span class="sd">        Mean of the Gaussian.</span>
<span class="sd">    sigma : ``float``</span>
<span class="sd">        Standard deviation of the Gaussian.</span>
<span class="sd">    mmin : ``float``</span>
<span class="sd">        Minimum mass bound.</span>
<span class="sd">    mmax : ``float``</span>
<span class="sd">        Maximum mass bound.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    N : ``float``</span>
<span class="sd">        Normalization factor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">part1</span> <span class="o">=</span> <span class="p">(</span><span class="n">mmax</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
    <span class="n">part2</span> <span class="o">=</span> <span class="p">(</span><span class="n">mmin</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">_erf</span><span class="p">(</span><span class="n">part1</span><span class="p">)</span> <span class="o">-</span> <span class="n">_erf</span><span class="p">(</span><span class="n">part2</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">N</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_bns_bimodal_pdf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mf">0.643</span><span class="p">,</span> <span class="n">muL</span><span class="o">=</span><span class="mf">1.352</span><span class="p">,</span> <span class="n">sigmaL</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">muR</span><span class="o">=</span><span class="mf">1.88</span><span class="p">,</span> <span class="n">sigmaR</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mmin</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mmax</span><span class="o">=</span><span class="mf">2.3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the bimodal Gaussian PDF for BNS mass distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Mass values (Msun).</span>
<span class="sd">    w : ``float``</span>
<span class="sd">        Weight of the left (low-mass) peak. \n</span>
<span class="sd">        default: 0.643</span>
<span class="sd">    muL : ``float``</span>
<span class="sd">        Mean of the left peak (Msun). \n</span>
<span class="sd">        default: 1.352</span>
<span class="sd">    sigmaL : ``float``</span>
<span class="sd">        Standard deviation of the left peak (Msun). \n</span>
<span class="sd">        default: 0.08</span>
<span class="sd">    muR : ``float``</span>
<span class="sd">        Mean of the right peak (Msun). \n</span>
<span class="sd">        default: 1.88</span>
<span class="sd">    sigmaR : ``float``</span>
<span class="sd">        Standard deviation of the right peak (Msun). \n</span>
<span class="sd">        default: 0.3</span>
<span class="sd">    mmin : ``float``</span>
<span class="sd">        Minimum mass (Msun). \n</span>
<span class="sd">        default: 1.0</span>
<span class="sd">    mmax : ``float``</span>
<span class="sd">        Maximum mass (Msun). \n</span>
<span class="sd">        default: 2.3</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf : ``float`` or ``numpy.ndarray``</span>
<span class="sd">        Probability density values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># left peak</span>
    <span class="n">pdf_unnormL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">m</span> <span class="o">-</span> <span class="n">muL</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigmaL</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">normL</span> <span class="o">=</span> <span class="n">_compute_normalization_factor</span><span class="p">(</span><span class="n">muL</span><span class="p">,</span> <span class="n">sigmaL</span><span class="p">,</span> <span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">)</span>
    <span class="c1"># right peak</span>
    <span class="n">pdf_unnormR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">m</span> <span class="o">-</span> <span class="n">muR</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigmaR</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">normR</span> <span class="o">=</span> <span class="n">_compute_normalization_factor</span><span class="p">(</span><span class="n">muR</span><span class="p">,</span> <span class="n">sigmaR</span><span class="p">,</span> <span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">)</span>
    <span class="c1"># total pdf</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">pdf_unnormL</span> <span class="o">/</span> <span class="n">normL</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">pdf_unnormR</span> <span class="o">/</span> <span class="n">normR</span>

    <span class="k">return</span> <span class="n">pdf</span>

<span class="nd">@njit</span>
<div class="viewcode-block" id="binary_masses_BNS_bimodal_rvs">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.binary_masses_BNS_bimodal_rvs">[docs]</a>
<span class="k">def</span> <span class="nf">binary_masses_BNS_bimodal_rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mf">0.643</span><span class="p">,</span> <span class="n">muL</span><span class="o">=</span><span class="mf">1.352</span><span class="p">,</span> <span class="n">sigmaL</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">muR</span><span class="o">=</span><span class="mf">1.88</span><span class="p">,</span> <span class="n">sigmaR</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mmin</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mmax</span><span class="o">=</span><span class="mf">2.3</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample BNS masses from bimodal Gaussian distribution.</span>

<span class="sd">    Based on Will M. Farr et al. 2020 Eqn. 6 for neutron star mass</span>
<span class="sd">    distribution combining two Gaussian peaks.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : ``int``</span>
<span class="sd">        Number of samples to draw.</span>
<span class="sd">    w : ``float``</span>
<span class="sd">        Weight of the left (low-mass) peak. \n</span>
<span class="sd">        default: 0.643</span>
<span class="sd">    muL : ``float``</span>
<span class="sd">        Mean of the left peak (Msun). \n</span>
<span class="sd">        default: 1.352</span>
<span class="sd">    sigmaL : ``float``</span>
<span class="sd">        Standard deviation of the left peak (Msun). \n</span>
<span class="sd">        default: 0.08</span>
<span class="sd">    muR : ``float``</span>
<span class="sd">        Mean of the right peak (Msun). \n</span>
<span class="sd">        default: 1.88</span>
<span class="sd">    sigmaR : ``float``</span>
<span class="sd">        Standard deviation of the right peak (Msun). \n</span>
<span class="sd">        default: 0.3</span>
<span class="sd">    mmin : ``float``</span>
<span class="sd">        Minimum mass (Msun). \n</span>
<span class="sd">        default: 1.0</span>
<span class="sd">    mmax : ``float``</span>
<span class="sd">        Maximum mass (Msun). \n</span>
<span class="sd">        default: 2.3</span>
<span class="sd">    resolution : ``int``</span>
<span class="sd">        Number of points to use for the CDF. \n</span>
<span class="sd">        default: 500</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    m1 : ``numpy.ndarray``</span>
<span class="sd">        Primary mass samples (Msun).</span>
<span class="sd">    m2 : ``numpy.ndarray``</span>
<span class="sd">        Secondary mass samples (Msun).</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">_bns_bimodal_pdf</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">muL</span><span class="p">,</span> <span class="n">sigmaL</span><span class="p">,</span> <span class="n">muR</span><span class="p">,</span> <span class="n">sigmaR</span><span class="p">,</span> <span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">)</span>
    <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">_inverse_transform_sampler_m1m2</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span></div>


<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_inverse_transform_sampler_m1m2</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">cdf_values</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample m1 and m2 using inverse transform sampling for BNS.</span>

<span class="sd">    This is a helper function for the BNS Alsing mass distribution function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : ``int``</span>
<span class="sd">        Number of samples to draw.</span>
<span class="sd">    cdf_values : ``numpy.ndarray``</span>
<span class="sd">        Cumulative distribution function values.</span>
<span class="sd">    x : ``numpy.ndarray``</span>
<span class="sd">        Mass values corresponding to the CDF.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    m1 : ``numpy.ndarray``</span>
<span class="sd">        Primary mass samples (Msun).</span>
<span class="sd">    m2 : ``numpy.ndarray``</span>
<span class="sd">        Secondary mass samples (Msun).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from ler.gw_source_population import _inverse_transform_sampler_m1m2</span>
<span class="sd">    &gt;&gt;&gt; m1, m2 = _inverse_transform_sampler_m1m2(size=1000, cdf_values=cdf_values, x=mass_arr)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">inverse_transform_sampler</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">cdf_values</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">inverse_transform_sampler</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">cdf_values</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="c1"># swap m1 and m2 if m1 &lt; m2</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">&lt;</span> <span class="n">m2</span>
    <span class="n">m1</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">m2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">m2</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">m1</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_smoothing_S</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mmin</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">709.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute low-mass smoothing function to avoid sharp cutoffs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : ``numpy.ndarray``</span>
<span class="sd">        Mass values.</span>
<span class="sd">    mmin : ``float``</span>
<span class="sd">        Minimum mass.</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Smoothing width.</span>
<span class="sd">    threshold : ``float``</span>
<span class="sd">        Maximum exponent to avoid overflow. \n</span>
<span class="sd">        default: 709.0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    s : ``numpy.ndarray``</span>
<span class="sd">        Smoothing function values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># region where smoothing is not needed: m &gt;= mmin + delta_m</span>
    <span class="n">idx_2</span> <span class="o">=</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">mmin</span> <span class="o">+</span> <span class="n">delta_m</span>
    <span class="n">s</span><span class="p">[</span><span class="n">idx_2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># region where smoothing is applied: mmin &lt;= m &lt; mmin + delta_m</span>
    <span class="n">idx_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">m</span> <span class="o">&lt;</span> <span class="n">mmin</span> <span class="o">+</span> <span class="n">delta_m</span><span class="p">)</span>
    <span class="n">mprime</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">idx_1</span><span class="p">]</span> <span class="o">-</span> <span class="n">mmin</span>
    <span class="n">exponent</span> <span class="o">=</span> <span class="n">delta_m</span> <span class="o">/</span> <span class="n">mprime</span> <span class="o">+</span> <span class="n">delta_m</span> <span class="o">/</span> <span class="p">(</span><span class="n">mprime</span> <span class="o">-</span> <span class="n">delta_m</span><span class="p">)</span>

    <span class="c1"># safe exponentiation only where exponent is below threshold</span>
    <span class="n">safe_idx</span> <span class="o">=</span> <span class="n">exponent</span> <span class="o">&lt;=</span> <span class="n">threshold</span>
    <span class="n">s_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mprime</span><span class="p">)</span>
    <span class="n">s_vals</span><span class="p">[</span><span class="n">safe_idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">exponent</span><span class="p">[</span><span class="n">safe_idx</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">s</span><span class="p">[</span><span class="n">idx_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_vals</span>

    <span class="k">return</span> <span class="n">s</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_powerlaw_with_smoothing</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mmin</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute power-law distribution with low-mass smoothing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : ``numpy.ndarray``</span>
<span class="sd">        Mass values.</span>
<span class="sd">    mmin : ``float``</span>
<span class="sd">        Minimum mass.</span>
<span class="sd">    alpha : ``float``</span>
<span class="sd">        Power-law spectral index.</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Smoothing width.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf : ``numpy.ndarray``</span>
<span class="sd">        Power-law PDF with smoothing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">_smoothing_S</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mmin</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_broken_powerlaw_cdf</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">mminbh</span><span class="o">=</span><span class="mf">26.</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="o">=</span><span class="mf">125.</span><span class="p">,</span> <span class="n">alpha_1</span><span class="o">=</span><span class="mf">6.75</span><span class="p">,</span> <span class="n">alpha_2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">delta_m</span><span class="o">=</span><span class="mf">5.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute CDF for broken power-law mass distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : ``int``</span>
<span class="sd">        Number of grid points. \n</span>
<span class="sd">        default: 1000</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass (Msun). \n</span>
<span class="sd">        default: 26.0</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum BH mass (Msun). \n</span>
<span class="sd">        default: 125.0</span>
<span class="sd">    alpha_1 : ``float``</span>
<span class="sd">        Power-law index below the break. \n</span>
<span class="sd">        default: 6.75</span>
<span class="sd">    alpha_2 : ``float``</span>
<span class="sd">        Power-law index above the break. \n</span>
<span class="sd">        default: 0.0</span>
<span class="sd">    b : ``float``</span>
<span class="sd">        Break location parameter (0-1). \n</span>
<span class="sd">        default: 0.5</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Smoothing width (Msun). \n</span>
<span class="sd">        default: 5.0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : ``numpy.ndarray``</span>
<span class="sd">        Normalized CDF values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m_try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">pdf_unnormalized</span> <span class="o">=</span> <span class="n">_broken_powerlaw_unnormalized</span><span class="p">(</span><span class="n">m_try</span><span class="p">,</span> <span class="n">mminbh</span><span class="o">=</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="o">=</span><span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha_1</span><span class="o">=</span><span class="n">alpha_1</span><span class="p">,</span> <span class="n">alpha_2</span><span class="o">=</span><span class="n">alpha_2</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">delta_m</span><span class="o">=</span><span class="n">delta_m</span><span class="p">)</span>
    <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">_cumulative_trapezoid</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">pdf_unnormalized</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">m_try</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">normalization</span> <span class="o">=</span> <span class="n">cdf_values</span><span class="p">[</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cdf_values</span> <span class="o">/=</span> <span class="n">normalization</span>

    <span class="k">return</span> <span class="n">cdf_values</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_sample_broken_powerlaw</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">mminbh</span><span class="o">=</span><span class="mf">26.</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="o">=</span><span class="mf">125.</span><span class="p">,</span> <span class="n">alpha_1</span><span class="o">=</span><span class="mf">6.75</span><span class="p">,</span> <span class="n">alpha_2</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">delta_m</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">normalization_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate samples from the broken power-law mass distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : ``int``</span>
<span class="sd">        Number of samples to draw. \n</span>
<span class="sd">        default: 1000</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass (Msun). \n</span>
<span class="sd">        default: 26.0</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum BH mass (Msun). \n</span>
<span class="sd">        default: 125.0</span>
<span class="sd">    alpha_1 : ``float``</span>
<span class="sd">        Power-law index below the break. \n</span>
<span class="sd">        default: 6.75</span>
<span class="sd">    alpha_2 : ``float``</span>
<span class="sd">        Power-law index above the break. \n</span>
<span class="sd">        default: 0.0</span>
<span class="sd">    b : ``float``</span>
<span class="sd">        Break location parameter (0-1). \n</span>
<span class="sd">        default: 0.5</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Smoothing width (Msun). \n</span>
<span class="sd">        default: 5.0</span>
<span class="sd">    normalization_size : ``int``</span>
<span class="sd">        Grid size for CDF computation. \n</span>
<span class="sd">        default: 1000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    samples : ``numpy.ndarray``</span>
<span class="sd">        Mass samples (Msun).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">_broken_powerlaw_cdf</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">normalization_size</span><span class="p">,</span> <span class="n">mminbh</span><span class="o">=</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="o">=</span><span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha_1</span><span class="o">=</span><span class="n">alpha_1</span><span class="p">,</span> <span class="n">alpha_2</span><span class="o">=</span><span class="n">alpha_2</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">delta_m</span><span class="o">=</span><span class="n">delta_m</span><span class="p">)</span>
    <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">cdf_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">normalization_size</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">cdf_values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">cdf_values</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">inverse_transform_sampler</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">cdf_values</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">samples</span>

<span class="nd">@njit</span>
<div class="viewcode-block" id="binary_masses_NSBH_broken_powerlaw_rvs">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.binary_masses_NSBH_broken_powerlaw_rvs">[docs]</a>
<span class="k">def</span> <span class="nf">binary_masses_NSBH_broken_powerlaw_rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">mminbh</span><span class="o">=</span><span class="mf">26.</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="o">=</span><span class="mf">125.</span><span class="p">,</span> <span class="n">alpha_1</span><span class="o">=</span><span class="mf">6.75</span><span class="p">,</span> <span class="n">alpha_2</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">delta_m</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">mminns</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mmaxns</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">alphans</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">normalization_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate NSBH mass samples from broken power-law (BH) and power-law (NS).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : ``int``</span>
<span class="sd">        Number of samples to draw. \n</span>
<span class="sd">        default: 1000</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass (Msun). \n</span>
<span class="sd">        default: 26.0</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum BH mass (Msun). \n</span>
<span class="sd">        default: 125.0</span>
<span class="sd">    alpha_1 : ``float``</span>
<span class="sd">        BH power-law index below break. \n</span>
<span class="sd">        default: 6.75</span>
<span class="sd">    alpha_2 : ``float``</span>
<span class="sd">        BH power-law index above break. \n</span>
<span class="sd">        default: 0.0</span>
<span class="sd">    b : ``float``</span>
<span class="sd">        Break location parameter (0-1). \n</span>
<span class="sd">        default: 0.5</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Smoothing width (Msun). \n</span>
<span class="sd">        default: 5.0</span>
<span class="sd">    mminns : ``float``</span>
<span class="sd">        Minimum NS mass (Msun). \n</span>
<span class="sd">        default: 1.0</span>
<span class="sd">    mmaxns : ``float``</span>
<span class="sd">        Maximum NS mass (Msun). \n</span>
<span class="sd">        default: 3.0</span>
<span class="sd">    alphans : ``float``</span>
<span class="sd">        NS power-law index. \n</span>
<span class="sd">        default: 0.0</span>
<span class="sd">    normalization_size : ``int``</span>
<span class="sd">        Grid size for CDF computation. \n</span>
<span class="sd">        default: 1000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    m1_samples : ``numpy.ndarray``</span>
<span class="sd">        BH mass samples (Msun).</span>
<span class="sd">    m2_samples : ``numpy.ndarray``</span>
<span class="sd">        NS mass samples (Msun).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m1_samples</span> <span class="o">=</span> <span class="n">_sample_broken_powerlaw</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">mminbh</span><span class="o">=</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="o">=</span><span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha_1</span><span class="o">=</span><span class="n">alpha_1</span><span class="p">,</span> <span class="n">alpha_2</span><span class="o">=</span><span class="n">alpha_2</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">delta_m</span><span class="o">=</span><span class="n">delta_m</span><span class="p">,</span> <span class="n">normalization_size</span><span class="o">=</span><span class="n">normalization_size</span><span class="p">)</span>
    <span class="n">m2_samples</span> <span class="o">=</span> <span class="n">sample_from_powerlaw_distribution</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">alphans</span><span class="p">,</span> <span class="n">mminns</span><span class="p">,</span> <span class="n">mmaxns</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m1_samples</span><span class="p">,</span> <span class="n">m2_samples</span></div>


<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_broken_powerlaw_pdf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mminbh</span><span class="o">=</span><span class="mf">26.</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="o">=</span><span class="mf">125.</span><span class="p">,</span> <span class="n">alpha_1</span><span class="o">=</span><span class="mf">6.75</span><span class="p">,</span> <span class="n">alpha_2</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">delta_m</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">normalization_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the normalized PDF for broken power-law mass distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : ``numpy.ndarray``</span>
<span class="sd">        Mass values to evaluate (Msun).</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass (Msun). \n</span>
<span class="sd">        default: 26.0</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum BH mass (Msun). \n</span>
<span class="sd">        default: 125.0</span>
<span class="sd">    alpha_1 : ``float``</span>
<span class="sd">        Power-law index below the break. \n</span>
<span class="sd">        default: 6.75</span>
<span class="sd">    alpha_2 : ``float``</span>
<span class="sd">        Power-law index above the break. \n</span>
<span class="sd">        default: 0.0</span>
<span class="sd">    b : ``float``</span>
<span class="sd">        Break location parameter (0-1). \n</span>
<span class="sd">        default: 0.5</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Smoothing width (Msun). \n</span>
<span class="sd">        default: 5.0</span>
<span class="sd">    normalization_size : ``int``</span>
<span class="sd">        Grid size for normalization. \n</span>
<span class="sd">        default: 1000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf : ``numpy.ndarray``</span>
<span class="sd">        Normalized probability density values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m_try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">normalization_size</span><span class="p">)</span>
    <span class="n">pdf_unnormalized</span> <span class="o">=</span> <span class="n">_broken_powerlaw_unnormalized</span><span class="p">(</span><span class="n">m_try</span><span class="p">,</span> <span class="n">mminbh</span><span class="o">=</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="o">=</span><span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha_1</span><span class="o">=</span><span class="n">alpha_1</span><span class="p">,</span> <span class="n">alpha_2</span><span class="o">=</span><span class="n">alpha_2</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">delta_m</span><span class="o">=</span><span class="n">delta_m</span><span class="p">)</span>
    <span class="n">normalization</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">pdf_unnormalized</span><span class="p">,</span> <span class="n">m_try</span><span class="p">)</span>

    <span class="n">pdf_unnormalized</span> <span class="o">=</span> <span class="n">_broken_powerlaw_unnormalized</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mminbh</span><span class="o">=</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="o">=</span><span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha_1</span><span class="o">=</span><span class="n">alpha_1</span><span class="p">,</span> <span class="n">alpha_2</span><span class="o">=</span><span class="n">alpha_2</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">delta_m</span><span class="o">=</span><span class="n">delta_m</span><span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">pdf_unnormalized</span> <span class="o">/</span> <span class="n">normalization</span>

    <span class="k">return</span> <span class="n">pdf</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_broken_powerlaw_unnormalized</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mminbh</span><span class="o">=</span><span class="mf">26.</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="o">=</span><span class="mf">125.</span><span class="p">,</span> <span class="n">alpha_1</span><span class="o">=</span><span class="mf">6.75</span><span class="p">,</span> <span class="n">alpha_2</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">delta_m</span><span class="o">=</span><span class="mf">5.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute unnormalized PDF for broken power-law distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : ``numpy.ndarray``</span>
<span class="sd">        Mass values.</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass.</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum BH mass.</span>
<span class="sd">    alpha_1 : ``float``</span>
<span class="sd">        Power-law index below break.</span>
<span class="sd">    alpha_2 : ``float``</span>
<span class="sd">        Power-law index above break.</span>
<span class="sd">    b : ``float``</span>
<span class="sd">        Break location parameter.</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Smoothing width.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_unnormalized : ``numpy.ndarray``</span>
<span class="sd">        Unnormalized PDF values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mbreak</span> <span class="o">=</span> <span class="n">mminbh</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">mmaxbh</span> <span class="o">-</span> <span class="n">mminbh</span><span class="p">)</span>
    <span class="n">idx_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="n">mminbh</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">m</span> <span class="o">&lt;</span> <span class="n">mbreak</span><span class="p">)</span>
    <span class="n">idx_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="n">mbreak</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">m</span> <span class="o">&lt;</span> <span class="n">mmaxbh</span><span class="p">)</span>

    <span class="n">pdf_unnormalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">pdf_unnormalized</span><span class="p">[</span><span class="n">idx_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_powerlaw_with_smoothing</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">idx_1</span><span class="p">],</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">alpha_1</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">)</span>
    <span class="n">norm_1</span> <span class="o">=</span> <span class="n">pdf_unnormalized</span><span class="p">[</span><span class="n">idx_1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">idx_1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pdf_unnormalized</span><span class="p">[</span><span class="n">idx_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_powerlaw_with_smoothing</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">idx_2</span><span class="p">],</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">alpha_2</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">)</span>
    <span class="n">norm_2</span> <span class="o">=</span> <span class="n">pdf_unnormalized</span><span class="p">[</span><span class="n">idx_2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pdf_unnormalized</span><span class="p">[</span><span class="n">idx_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdf_unnormalized</span><span class="p">[</span><span class="n">idx_2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">norm_1</span> <span class="o">/</span> <span class="n">norm_2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pdf_unnormalized</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_powerlaw_B</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute normalized power-law distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : ``numpy.ndarray``</span>
<span class="sd">        Mass values.</span>
<span class="sd">    alpha : ``float``</span>
<span class="sd">        Power-law spectral index.</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum mass.</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum mass.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf : ``numpy.ndarray``</span>
<span class="sd">        Normalized power-law PDF.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">normalization</span> <span class="o">=</span> <span class="p">(</span><span class="n">mmaxbh</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">mminbh</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">m</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="n">normalization</span>
    <span class="k">return</span> <span class="n">pdf</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_gaussian_G</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Gaussian distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : ``numpy.ndarray``</span>
<span class="sd">        Mass values.</span>
<span class="sd">    mu_g : ``float``</span>
<span class="sd">        Mean of the Gaussian.</span>
<span class="sd">    sigma_g : ``float``</span>
<span class="sd">        Standard deviation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf : ``numpy.ndarray``</span>
<span class="sd">        Gaussian PDF values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">normalization</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_g</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">exponent</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">m</span> <span class="o">-</span> <span class="n">mu_g</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma_g</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">normalization</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">exponent</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pdf</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_powerlaw_gaussian_pdf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">,</span> <span class="n">lambda_peak</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">,</span> <span class="n">normalization_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the normalized PDF for power-law + Gaussian mass model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : ``numpy.ndarray``</span>
<span class="sd">        Mass values to evaluate (Msun).</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass (Msun).</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum BH mass (Msun).</span>
<span class="sd">    alpha : ``float``</span>
<span class="sd">        Power-law spectral index.</span>
<span class="sd">    mu_g : ``float``</span>
<span class="sd">        Mean of the Gaussian peak (Msun).</span>
<span class="sd">    sigma_g : ``float``</span>
<span class="sd">        Standard deviation of the Gaussian peak (Msun).</span>
<span class="sd">    lambda_peak : ``float``</span>
<span class="sd">        Fraction of sources in the Gaussian component (0-1).</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Low-mass smoothing width (Msun).</span>
<span class="sd">    normalization_size : ``int``</span>
<span class="sd">        Grid size for normalization. \n</span>
<span class="sd">        default: 1000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf : ``numpy.ndarray``</span>
<span class="sd">        Normalized probability density values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m_try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">normalization_size</span><span class="p">)</span>
    <span class="n">pdf_unnormalized</span> <span class="o">=</span> <span class="n">_powerlaw_gaussian_unnormalized</span><span class="p">(</span>
        <span class="n">m_try</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">,</span> <span class="n">lambda_peak</span><span class="p">,</span> <span class="n">delta_m</span>
    <span class="p">)</span>
    <span class="n">normalization</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">pdf_unnormalized</span><span class="p">,</span> <span class="n">m_try</span><span class="p">)</span>

    <span class="n">pdf_unnormalized</span> <span class="o">=</span> <span class="n">_powerlaw_gaussian_unnormalized</span><span class="p">(</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">,</span> <span class="n">lambda_peak</span><span class="p">,</span> <span class="n">delta_m</span>
    <span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">pdf_unnormalized</span> <span class="o">/</span> <span class="n">normalization</span>

    <span class="k">return</span> <span class="n">pdf</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_powerlaw_gaussian_cdf</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">,</span> <span class="n">lambda_peak</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute CDF for power-law + Gaussian mass model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : ``int``</span>
<span class="sd">        Number of grid points.</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass.</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum BH mass.</span>
<span class="sd">    alpha : ``float``</span>
<span class="sd">        Power-law spectral index.</span>
<span class="sd">    mu_g : ``float``</span>
<span class="sd">        Mean of the Gaussian peak.</span>
<span class="sd">    sigma_g : ``float``</span>
<span class="sd">        Standard deviation of the Gaussian peak.</span>
<span class="sd">    lambda_peak : ``float``</span>
<span class="sd">        Fraction in Gaussian component.</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Smoothing width.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : ``numpy.ndarray``</span>
<span class="sd">        Normalized CDF values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m_try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">pdf_unnormalized</span> <span class="o">=</span> <span class="n">_powerlaw_gaussian_unnormalized</span><span class="p">(</span>
        <span class="n">m_try</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">,</span> <span class="n">lambda_peak</span><span class="p">,</span> <span class="n">delta_m</span>
    <span class="p">)</span>
    <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">_cumulative_trapezoid</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">pdf_unnormalized</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">m_try</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">normalization</span> <span class="o">=</span> <span class="n">cdf_values</span><span class="p">[</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cdf_values</span> <span class="o">/=</span> <span class="n">normalization</span>

    <span class="k">return</span> <span class="n">cdf_values</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_sample_powerlaw_gaussian</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">,</span> <span class="n">lambda_peak</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">,</span> <span class="n">normalization_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate samples from the power-law + Gaussian mass model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : ``int``</span>
<span class="sd">        Number of samples to draw.</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass (Msun).</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum BH mass (Msun).</span>
<span class="sd">    alpha : ``float``</span>
<span class="sd">        Power-law spectral index.</span>
<span class="sd">    mu_g : ``float``</span>
<span class="sd">        Mean of the Gaussian peak (Msun).</span>
<span class="sd">    sigma_g : ``float``</span>
<span class="sd">        Standard deviation of the Gaussian peak (Msun).</span>
<span class="sd">    lambda_peak : ``float``</span>
<span class="sd">        Fraction in Gaussian component (0-1).</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Low-mass smoothing width (Msun).</span>
<span class="sd">    normalization_size : ``int``</span>
<span class="sd">        Grid size for CDF computation. \n</span>
<span class="sd">        default: 1000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    samples : ``numpy.ndarray``</span>
<span class="sd">        Mass samples (Msun).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">_powerlaw_gaussian_cdf</span><span class="p">(</span><span class="n">normalization_size</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">,</span> <span class="n">lambda_peak</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">normalization_size</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">cdf_values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">cdf_values</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">inverse_transform_sampler</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">cdf_values</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">samples</span>

<span class="nd">@njit</span>
<div class="viewcode-block" id="binary_masses_BBH_powerlaw_gaussian_rvs">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.binary_masses_BBH_powerlaw_gaussian_rvs">[docs]</a>
<span class="k">def</span> <span class="nf">binary_masses_BBH_powerlaw_gaussian_rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">,</span> <span class="n">lambda_peak</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">normalization_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate BBH mass samples from power-law + Gaussian model with mass ratio.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : ``int``</span>
<span class="sd">        Number of samples to draw.</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass (Msun).</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum BH mass (Msun).</span>
<span class="sd">    alpha : ``float``</span>
<span class="sd">        Power-law spectral index for m1.</span>
<span class="sd">    mu_g : ``float``</span>
<span class="sd">        Mean of the Gaussian peak (Msun).</span>
<span class="sd">    sigma_g : ``float``</span>
<span class="sd">        Standard deviation of the Gaussian peak (Msun).</span>
<span class="sd">    lambda_peak : ``float``</span>
<span class="sd">        Fraction in Gaussian component (0-1).</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Low-mass smoothing width (Msun).</span>
<span class="sd">    beta : ``float``</span>
<span class="sd">        Power-law index for mass ratio distribution.</span>
<span class="sd">    normalization_size : ``int``</span>
<span class="sd">        Grid size for CDF computation. \n</span>
<span class="sd">        default: 1000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    m1 : ``numpy.ndarray``</span>
<span class="sd">        Primary mass samples (Msun).</span>
<span class="sd">    m2 : ``numpy.ndarray``</span>
<span class="sd">        Secondary mass samples (Msun).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">_sample_powerlaw_gaussian</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">,</span> <span class="n">lambda_peak</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">,</span> <span class="n">normalization_size</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_sample_mass_ratio</span><span class="p">(</span><span class="n">m1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">)</span>

    <span class="n">m2</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">q</span>

    <span class="k">return</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span></div>


<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_sample_mass_ratio</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample mass ratio using rejection sampling with smoothing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m1 : ``float``</span>
<span class="sd">        Primary mass.</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass.</span>
<span class="sd">    beta : ``float``</span>
<span class="sd">        Power-law index for mass ratio.</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Smoothing width.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : ``float``</span>
<span class="sd">        Sampled mass ratio.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qmin</span> <span class="o">=</span> <span class="n">mminbh</span> <span class="o">/</span> <span class="n">m1</span>
    <span class="n">pow_beta</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">+</span> <span class="mf">1.0</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">u_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_q</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">**</span><span class="n">pow_beta</span> <span class="o">-</span> <span class="n">qmin</span><span class="o">**</span><span class="n">pow_beta</span><span class="p">)</span> <span class="o">+</span> <span class="n">qmin</span><span class="o">**</span><span class="n">pow_beta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">pow_beta</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">q</span>
        <span class="n">s_m2</span> <span class="o">=</span> <span class="n">_smoothing_S</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m2</span><span class="p">]),</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">u_smooth</span> <span class="o">&lt;</span> <span class="n">s_m2</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">q</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_powerlaw_gaussian_unnormalized</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">,</span> <span class="n">lambda_peak</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute unnormalized PDF for power-law + Gaussian model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : ``numpy.ndarray``</span>
<span class="sd">        Mass values.</span>
<span class="sd">    mminbh : ``float``</span>
<span class="sd">        Minimum BH mass.</span>
<span class="sd">    mmaxbh : ``float``</span>
<span class="sd">        Maximum BH mass.</span>
<span class="sd">    alpha : ``float``</span>
<span class="sd">        Power-law spectral index.</span>
<span class="sd">    mu_g : ``float``</span>
<span class="sd">        Mean of Gaussian peak.</span>
<span class="sd">    sigma_g : ``float``</span>
<span class="sd">        Standard deviation of Gaussian peak.</span>
<span class="sd">    lambda_peak : ``float``</span>
<span class="sd">        Fraction in Gaussian component.</span>
<span class="sd">    delta_m : ``float``</span>
<span class="sd">        Smoothing width.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_unnormalized : ``numpy.ndarray``</span>
<span class="sd">        Unnormalized PDF values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pdf_unnormalized</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">lambda_peak</span><span class="p">)</span><span class="o">*</span><span class="n">_powerlaw_B</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">mmaxbh</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">lambda_peak</span> <span class="o">*</span> <span class="n">_gaussian_G</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mu_g</span><span class="p">,</span> <span class="n">sigma_g</span><span class="p">)))</span><span class="o">*</span> <span class="n">_smoothing_S</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mminbh</span><span class="p">,</span> <span class="n">delta_m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pdf_unnormalized</span>

<div class="viewcode-block" id="available_prior_list">
<a class="viewcode-back" href="../../../autoapi/ler/gw_source_population/prior_functions/index.html#ler.gw_source_population.available_prior_list">[docs]</a>
<span class="k">def</span> <span class="nf">available_prior_list</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of available priors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;merger_rate_density_bbh_oguri2018_function&#39;</span><span class="p">,</span>
        <span class="s1">&#39;merger_rate_density_bbh_popIII_ken2022_function&#39;</span><span class="p">,</span>
        <span class="s1">&#39;merger_rate_density_madau_dickinson2014_function&#39;</span><span class="p">,</span>
        <span class="s1">&#39;merger_rate_density_madau_dickinson_belczynski_ng_function&#39;</span><span class="p">,</span>
        <span class="s1">&#39;merger_rate_density_bbh_primordial_ken2022_function&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sfr_madau_fragos2017_with_bbh_td&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sfr_madau_dickinson2014_with_bbh_td&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sfr_madau_fragos2017_with_bns_td&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sfr_madau_dickinson2014_with_bns_td&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sfr_madau_fragos2017&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sfr_madau_dickinson2014&#39;</span><span class="p">,</span>
        <span class="s1">&#39;binary_masses_BBH_popIII_lognormal_rvs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;binary_masses_BBH_primordial_lognormal_rvs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;binary_masses_BNS_bimodal_rvs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;binary_masses_NSBH_broken_powerlaw_rvs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;binary_masses_BBH_powerlaw_gaussian_rvs&#39;</span><span class="p">,</span>
    <span class="p">]</span></div>


<span class="c1"># ------------------------</span>
<span class="c1"># Other utility functions</span>
<span class="c1"># ------------------------</span>
<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">_cumulative_trapezoid</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the cumulative integral using the trapezoidal rule.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : ``numpy.ndarray``</span>
<span class="sd">        Function values to integrate.</span>
<span class="sd">    x : ``numpy.ndarray`` or ``None``</span>
<span class="sd">        x-coordinates. If None, uses evenly spaced points with spacing dx. \n</span>
<span class="sd">        default: None</span>
<span class="sd">    dx : ``float``</span>
<span class="sd">        Spacing between x-coordinates if x is None. \n</span>
<span class="sd">        default: 1.0</span>
<span class="sd">    initial : ``float``</span>
<span class="sd">        Initial value for the cumulative sum. \n</span>
<span class="sd">        default: 0.0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cumsum : ``numpy.ndarray``</span>
<span class="sd">        Cumulative integral values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">*</span> <span class="n">dx</span>

    <span class="n">cumsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">cumsum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">cumsum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>

    <span class="k">return</span> <span class="n">cumsum</span>



        

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Phurailatpam Hemantakumar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>