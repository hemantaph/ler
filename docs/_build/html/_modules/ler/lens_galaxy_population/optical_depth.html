<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ler.lens_galaxy_population.optical_depth &mdash; ler 0.3.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=776609e1" />


    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../../_static/documentation_options.js?v=4621528c"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/tabs.js?v=3030b3cb"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA="
        src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
</head>

<body class="wy-body-for-nav">
    <div class="wy-grid-for-nav">
        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
            <div class="wy-side-scroll">
                <div class="wy-side-nav-search">



                    <a href="../../../index.html" class="icon icon-home">
                        ler
                    </a>
                    <div role="search">
                        <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
                            <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
                            <input type="hidden" name="check_keywords" value="yes" />
                            <input type="hidden" name="area" value="default" />
                        </form>
                    </div>
                </div>
                <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
                    <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
                    <ul>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../Installation2.html">Installation</a></li>
                        <li class="toctree-l1"><a class="reference internal" href="../../../Summary.html">Summary</a>
                        </li>
                        <li class="toctree-l1"><a class="reference internal" href="../../../code_overview.html">Code
                                overview</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../GW_events.html">Gravitational wave event rates</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../GW_equations.html">Gravitational wave events sampling (Analytical
                                formulation)</a></li>
                        <li class="toctree-l1"><a class="reference internal" href="../../../Lensed_events.html">Lensed
                                event rates</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../Lensed_equations.html">Lensed event sampling (Analytical formulation)</a>
                        </li>
                    </ul>
                    <p class="caption" role="heading"><span class="caption-text">API:</span></p>
                    <ul>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../autoapi/ler/rates/index.html"><code
                                    class="xref py py-mod docutils literal notranslate"><span class="pre">ler.rates</span></code></a>
                        </li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../autoapi/ler/gw_source_population/index.html"><code
                                    class="xref py py-mod docutils literal notranslate"><span class="pre">ler.gw_source_population</span></code></a>
                        </li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../autoapi/ler/lens_galaxy_population/index.html"><code
                                    class="xref py py-mod docutils literal notranslate"><span class="pre">ler.lens_galaxy_population</span></code></a>
                        </li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../autoapi/ler/image_properties/index.html"><code
                                    class="xref py py-mod docutils literal notranslate"><span class="pre">ler.image_properties</span></code></a>
                        </li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../autoapi/ler/utils/index.html"><code
                                    class="xref py py-mod docutils literal notranslate"><span class="pre">ler.utils</span></code></a>
                        </li>
                    </ul>
                    <p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
                    <ul>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/rates/LeR%20complete%20examples.html">LeR complete examples</a>
                        </li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/rates/GWRATES%20complete%20exmaples.html">GWRATES complete
                                exmaples</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/rates/grb%20detection%20rate.html">Calculation of detectable
                                Gamma ray burst (GRB) event rate associated with Binary Neutron Star (BNS) mergers.</a>
                        </li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/rates/ler%20bns%20example.html">LeR complete examples of BNS
                                events (O4 design sensitivity)</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/rates/rates_with_3G_detectors.html">Event Rates with 3G
                                detectors</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/source%20population/merger%20rate%20density%20evolution%20with%20redshift.html">Merger
                                rate density evolution with redshift</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/source%20population/merger%20rate%20density%20model%20comparision.html">Merger
                                rate density model comparision</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/source%20population/merger%20rate%20density%20model%20comparision.html#Primordial-BBH-model,-Ng-et-al.-2022">Primordial
                                BBH model, Ng et al. 2022</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/source%20population/sample%20compact%20binary%20parameters.html">Sampling
                                parameters for a compact binary</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/source%20population/statistical%20study%20of%20changing%20mass%20model%20params.html">Statistical
                                study of changing Mass model paramter(s)</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/source%20population/statistical%20study%20of%20cosmological%20friction.html">Statistical
                                study of cosmological friction and its effect on the redshift vs inferred chirp-mass
                                relation of gravitational waves</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/lens_parameters/sample%20lens%20parameters.html">Lens parameter
                                distributions</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/optical_depth/validation_SIE.html">Optical depth SIE model
                                validation</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/optical_depth/validation_SIS.html">Validation of SIS model
                                (Numerical vs Analytical)</a></li>
                        <li class="toctree-l1"><a class="reference internal"
                                href="../../../examples/image_properties/dt_vs_dmu.html">Study of Time delays and
                                magnification of lensed gravitational waves.</a></li>
                    </ul>

                </div>
            </div>
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
            <nav class="wy-nav-top" aria-label="Mobile navigation menu">
                <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
                <a href="../../../index.html">ler</a>
            </nav>

            <div class="wy-nav-content">
                <div class="rst-content">
                    <div role="navigation" aria-label="Page navigation">
                        <ul class="wy-breadcrumbs">
                            <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
                            <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
                            <li class="breadcrumb-item active">ler.lens_galaxy_population.optical_depth</li>
                            <li class="wy-breadcrumbs-aside">
                            </li>
                        </ul>
                        <hr />
                    </div>
                    <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                        <div itemprop="articleBody">

                            <h1>Source code for ler.lens_galaxy_population.optical_depth</h1>
                            <div class="highlight">
                                <pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gengamma</span><span class="p">,</span> <span class="n">gaussian_kde</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">CubicSpline</span>
<span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">LambdaCDM</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">lenstronomy.LensModel.Solver.epl_shear_solver</span> <span class="kn">import</span> <span class="n">caustics_epl_shear</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>


<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">cubic_spline_interpolator</span><span class="p">,</span> <span class="n">inverse_transform_sampler</span><span class="p">,</span> <span class="n">cubic_spline_interpolator2d_array</span><span class="p">,</span> <span class="n">save_pickle</span><span class="p">,</span> <span class="n">interpolator_json_path</span><span class="p">,</span> <span class="n">FunctionConditioning</span><span class="p">,</span> <span class="n">inverse_transform_sampler2d</span><span class="p">,</span> <span class="n">pdf_cubic_spline_interpolator2d_array</span><span class="p">,</span> <span class="n">normal_pdf</span><span class="p">,</span> <span class="n">normal_pdf_2d</span><span class="p">,</span> <span class="n">load_txt_from_module</span>

<span class="kn">from</span> <span class="nn">.jit_functions</span> <span class="kn">import</span> <span class="n">phi_cut_SIE</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">phi_loc_bernardi</span><span class="p">,</span> <span class="n">phi_q2_ellipticity_hemanta</span><span class="p">,</span> <span class="n">lens_redshift_sis_haris</span><span class="p">,</span> <span class="n">axis_ratio_rayleigh_pdf</span>

<div class="viewcode-block" id="OpticalDepth">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth">[docs]</a>
<span class="k">class</span> <span class="nc">OpticalDepth</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class to calculate the optical depth, velocity dispersion and axis-ratio of a lens galaxy population.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        npool : int, optional</span>
<span class="sd">            Number of processors to use for multiprocessing (default is 4).</span>
<span class="sd">        z_min : float, optional</span>
<span class="sd">            Minimum redshift of the lens galaxy population (default is 0.0).</span>
<span class="sd">        z_max : float, optional</span>
<span class="sd">            Maximum redshift of the lens galaxy population (default is 10.0).</span>
<span class="sd">        cosmology : astropy.cosmology, optional</span>
<span class="sd">            Cosmology object to use (default is FlatLambdaCDM with H0=70, Om0=0.3, Ode0=0.7).</span>
<span class="sd">        lens_type : str, optional</span>
<span class="sd">            Type of the lens galaxy. Must be one of [&#39;sie_galaxy&#39;, &#39;epl_shear_galaxy&#39;, &#39;sis_galaxy&#39;] (default is &#39;epl_shear_galaxy&#39;).</span>
<span class="sd">        lens_functions : dict, optional</span>
<span class="sd">            Dictionary with lens-related functions.</span>
<span class="sd">        lens_functions_params : dict, optional</span>
<span class="sd">            Dictionary with parameters for the lens-related functions.</span>
<span class="sd">        lens_param_samplers : dict, optional</span>
<span class="sd">            Dictionary of sampler functions for velocity dispersion and axis-ratio.</span>
<span class="sd">        lens_param_samplers_params : dict, optional</span>
<span class="sd">            Dictionary with parameters for the priors of the samplers.</span>
<span class="sd">        directory : str, optional</span>
<span class="sd">            Directory where the interpolators are saved (default is &#39;./interpolator_json&#39;).</span>
<span class="sd">            If True, creates a new interpolator (default is False).</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            If True, prints additional information during initialization (default is False).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If `lens_type` is not in [&#39;sie_galaxy&#39;, &#39;epl_shear_galaxy&#39;, &#39;sis_galaxy&#39;].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">npool</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">z_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">z_max</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
        <span class="n">cosmology</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lens_type</span><span class="o">=</span><span class="s2">&quot;epl_shear_galaxy&quot;</span><span class="p">,</span>
        <span class="n">lens_functions</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">lens_functions_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lens_param_samplers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lens_param_samplers_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;./interpolator_json&quot;</span><span class="p">,</span>
        <span class="n">create_new_interpolator</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Initializing OpticalDepth class</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lens_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sie_galaxy&quot;</span><span class="p">,</span> <span class="s2">&quot;epl_shear_galaxy&quot;</span><span class="p">,</span> <span class="s2">&quot;sis_galaxy&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;lens_type not in [&#39;sie_galaxy&#39;, &#39;epl_shear_galaxy&#39;, &#39;sis_galaxy&#39;]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lens_type</span> <span class="o">=</span> <span class="n">lens_type</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">npool</span> <span class="o">=</span> <span class="n">npool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="n">z_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">z_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span> <span class="o">=</span> <span class="n">cosmology</span> <span class="k">if</span> <span class="n">cosmology</span> <span class="k">else</span> <span class="n">LambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Ode0</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

        <span class="c1"># decision dict fot creating interpolator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_decision_dictionary</span><span class="p">(</span><span class="n">create_new_interpolator</span><span class="p">);</span>

        <span class="c1"># default lens functions and samplers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_lens_samplers_and_functions</span><span class="p">(</span><span class="n">lens_type</span><span class="p">)</span>

        <span class="c1"># change default lens functions and samplers if user input is given</span>
        <span class="c1"># if lens functions and samplers are given but not parameters, then use default parameters</span>
        <span class="c1"># it updates self.lens_param_samplers, self.lens_param_samplers_params, self.lens_functions, self.lens_functions_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_and_sampler_categorization</span><span class="p">(</span><span class="n">lens_param_samplers</span><span class="p">,</span> <span class="n">lens_param_samplers_params</span><span class="p">,</span> <span class="n">lens_functions</span><span class="p">,</span> <span class="n">lens_functions_params</span><span class="p">);</span>

        <span class="c1"># setting up astropy cosmology functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_lookup_table_fuction</span><span class="p">();</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s1">&#39;cross_section&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;cross_section_epl_shear_interpolation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_cross_section_function</span><span class="p">();</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;cross_section_epl_shear_interpolation&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s1">&#39;cross_section&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nbrs</span><span class="o">=</span><span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">=</span><span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_spline</span><span class="o">=</span><span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sis_area_array</span><span class="o">=</span><span class="kc">None</span>

        <span class="c1"># lens sampler initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_rotation_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density_profile_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lens_redshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;lens_redshift&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density_profile_slope_sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;density_profile_slope_sl&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">external_shear_sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;external_shear_sl&#39;</span><span class="p">]</span>
        
        <span class="c1"># lens function initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optical_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s1">&#39;optical_depth&#39;</span><span class="p">]</span>

    <span class="c1">##################</span>
    <span class="c1"># Initialization #</span>
    <span class="c1">##################</span>
<div class="viewcode-block" id="OpticalDepth.default_lens_samplers_and_functions">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.default_lens_samplers_and_functions">[docs]</a>
    <span class="k">def</span> <span class="nf">default_lens_samplers_and_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lens_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Function to categorize the lens priors/samplers</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">                lens_type : `str`</span>
<span class="sd">                    lens type</span>
<span class="sd">                    e.g. &#39;epl_shear_galaxy&#39; for elliptical power-law galaxy</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            lens_param_samplers_ : `dict`</span>
<span class="sd">                dictionary of priors</span>
<span class="sd">            lens_param_samplers_params_ : `dict`</span>
<span class="sd">                dictionary of priors parameters</span>
<span class="sd">            lens_sampler_names_ : `dict`</span>
<span class="sd">                dictionary of sampler names</span>
<span class="sd">            lens_functions_ : `dict`</span>
<span class="sd">                dictionary of lens functions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">lens_type</span> <span class="o">==</span> <span class="s2">&quot;epl_shear_galaxy&quot;</span><span class="p">:</span>
            <span class="n">lens_param_samplers_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="s2">&quot;strongly_lensed_source_redshifts&quot;</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="s2">&quot;lens_redshift_strongly_lensed_hemanta&quot;</span><span class="p">,</span> <span class="c1">#&quot;lens_redshift_strongly_lensed_numerical&quot;,</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion_ewoud&quot;</span><span class="p">,</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="s2">&quot;axis_ratio_rayleigh&quot;</span><span class="p">,</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="s2">&quot;axis_rotation_angle_uniform&quot;</span><span class="p">,</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_param_samplers_params_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span> <span class="n">phistar</span><span class="o">=</span><span class="mf">2.099e-2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="mf">0.7</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">sigmastar</span><span class="o">=</span><span class="mf">113.78</span><span class="p">),</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">phi_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_max</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">1.99</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.149</span><span class="p">),</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;external_shear_sl&quot;</span><span class="p">),</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.078</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_sl&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">lens_functions_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="s2">&quot;sample_all_routine_sie_sl&quot;</span><span class="p">,</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="s2">&quot;rejection_sampling_with_cross_section_sie_feixu&quot;</span><span class="p">,</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="s2">&quot;optical_depth_numerical&quot;</span><span class="p">,</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;cross_section_epl_shear_interpolation&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_functions_params_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fast_sampler</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="c1"># not implemented yet</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">lens_type</span> <span class="o">==</span> <span class="s2">&quot;sie_galaxy&quot;</span><span class="p">:</span>
            <span class="n">lens_param_samplers_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="s2">&quot;strongly_lensed_source_redshifts&quot;</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="s2">&quot;lens_redshift_strongly_lensed_hemanta&quot;</span><span class="p">,</span> <span class="c1">#&quot;lens_redshift_strongly_lensed_numerical&quot;,</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion_ewoud&quot;</span><span class="p">,</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="s2">&quot;axis_ratio_rayleigh&quot;</span><span class="p">,</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="s2">&quot;axis_rotation_angle_uniform&quot;</span><span class="p">,</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_param_samplers_params_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span> <span class="n">phistar</span><span class="o">=</span><span class="mf">2.099e-2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="mf">0.7</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">sigmastar</span><span class="o">=</span><span class="mf">113.78</span><span class="p">),</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">phi_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_max</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">lens_functions_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="s2">&quot;rejection_sampling_with_cross_section_sie_feixu&quot;</span><span class="p">,</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="s2">&quot;optical_depth_numerical&quot;</span><span class="p">,</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="s2">&quot;sample_all_routine_sie_sl&quot;</span><span class="p">,</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;cross_section_sie_feixu&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_functions_params_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">interpolated_cross_section</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">lens_type</span> <span class="o">==</span> <span class="s2">&quot;sis_galaxy&quot;</span><span class="p">:</span>
            <span class="n">lens_param_samplers_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="s2">&quot;strongly_lensed_source_redshifts&quot;</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="s2">&quot;lens_redshift_strongly_lensed_numerical&quot;</span><span class="p">,</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion_choi&quot;</span><span class="p">,</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="s2">&quot;axis_ratio_uniform&quot;</span><span class="p">,</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="s2">&quot;axis_rotation_angle_uniform&quot;</span><span class="p">,</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_param_samplers_params_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sigma_min</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">sigma_max</span> <span class="o">=</span> <span class="mf">420.</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">2.32</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">2.67</span><span class="p">,</span> <span class="n">phistar</span> <span class="o">=</span> <span class="mf">8.0e-3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">sigmastar</span> <span class="o">=</span> <span class="mf">161.0</span><span class="p">),</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">phi_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_max</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">lens_functions_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="s2">&quot;rejection_sampling_with_cross_section_sis&quot;</span><span class="p">,</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="s2">&quot;optical_depth_numerical&quot;</span><span class="p">,</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="s2">&quot;sample_all_routine_sis&quot;</span><span class="p">,</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;cross_section_sis&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_functions_params_</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">interpolated_cross_section</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;lens_type not recognized&quot;</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">lens_param_samplers_</span><span class="p">,</span> <span class="n">lens_param_samplers_params_</span><span class="p">,</span> <span class="n">lens_functions_</span><span class="p">,</span> <span class="n">lens_functions_params_</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.initialize_decision_dictionary">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.initialize_decision_dictionary">[docs]</a>
    <span class="k">def</span> <span class="nf">initialize_decision_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">create_new_interpolator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to initialize decision dictionary for creating interpolator</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        create_new_interpolator : `dict` or `bool`</span>
<span class="sd">            dictionary to create new interpolator for velocity dispersion and optical depth.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialize the interpolator&#39;s parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">velocity_dispersion</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
            <span class="n">axis_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
            <span class="n">lens_redshift</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
            <span class="n">optical_depth</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">48</span><span class="p">),</span>
            <span class="n">comoving_distance</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
            <span class="n">angular_diameter_distance</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
            <span class="n">differential_comoving_volume</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
            <span class="n">cross_section</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1000000</span><span class="p">),</span>
            <span class="n">density_profile_slope</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
            <span class="n">lens_parameters_kde_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">5000</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">create_new_interpolator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">create_new_interpolator</span><span class="p">)</span>
        <span class="c1"># if create_new_interpolator is True, create new interpolator for all</span>
        <span class="k">elif</span> <span class="n">create_new_interpolator</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;create_new&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

        
<div class="viewcode-block" id="OpticalDepth.lens_functions_and_sampler_categorization">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_functions_and_sampler_categorization">[docs]</a>
    <span class="k">def</span> <span class="nf">lens_functions_and_sampler_categorization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lens_param_samplers</span><span class="p">,</span> <span class="n">lens_param_samplers_params</span><span class="p">,</span> <span class="n">lens_functions</span><span class="p">,</span> <span class="n">lens_functions_params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to initialize velocity dispersion sampler with it&#39;s settings. The reason I am seperating this from lens_param_samplers_categorization is only a specific parameters needs special attention.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lens_param_samplers : `str` or `function`</span>
<span class="sd">            sampler name or function</span>
<span class="sd">        lens_param_samplers_params : `dict`</span>
<span class="sd">            sampler parameters</span>
<span class="sd">        lens_functions : `str` or `function`</span>
<span class="sd">            lens function name or function</span>
<span class="sd">        lens_functions_params : `dict`</span>
<span class="sd">            lens function parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># update the priors if input is given</span>
        <span class="k">if</span> <span class="n">lens_param_samplers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_param_samplers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lens_param_samplers_params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_param_samplers_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lens_functions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_functions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lens_functions_params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_functions_params</span><span class="p">)</span>

        <span class="n">sampler_prior_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lens_redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">,</span> <span class="s1">&#39;axis_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;external_shear&#39;</span><span class="p">,</span> <span class="s1">&#39;density_profile_slope&#39;</span><span class="p">,</span> <span class="s1">&#39;external_shear_sl&#39;</span><span class="p">,</span> <span class="s1">&#39;density_profile_slope_sl&#39;</span><span class="p">]</span>

        <span class="c1"># if there is user input sampler prior params</span>
        <span class="c1"># you can&#39;t only give lens_param_samplers_params, you have to give lens_param_samplers as well if you want to update the sampler priors</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sampler_prior_names</span><span class="p">:</span>  <span class="c1"># e.g. name=&#39;axis_ratio&#39;</span>
            <span class="c1"># avoid None</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lens_param_samplers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">lens_param_samplers</span><span class="p">):</span>
                <span class="c1"># if there is user input function name, update the sampler priors</span>
                <span class="n">sampler_name</span> <span class="o">=</span> <span class="n">lens_param_samplers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>  <span class="c1"># e.g. &#39;axis_ratio_rayleigh&#39;</span>
                <span class="c1"># check input sampler is string or function</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sampler_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># available lens samplers for name e.g. &#39;axis_ratio&#39;</span>
                    <span class="n">dict_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>  <span class="c1"># e.g. {&#39;axis_ratio_padilla_strauss&#39;: {&#39;q_min&#39;: 0.2, &#39;q_max&#39;: 1.0}, ....}</span>
                    <span class="k">if</span> <span class="n">sampler_name</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">:</span>  <span class="c1"># e.g. &#39;axis_ratio_padilla_strauss&#39;</span>
                        <span class="n">param_dict</span> <span class="o">=</span> <span class="n">dict_</span><span class="p">[</span><span class="n">sampler_name</span><span class="p">]</span>  <span class="c1"># e.g. {&#39;q_min&#39;: 0.2, &#39;q_max&#39;: 1.0}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">lens_param_samplers_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>  <span class="c1"># not a dictionary</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span>
                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if there is user input lens_param_samplers_params</span>
                            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>  <span class="c1"># user inputs will override the default values</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> sampler </span><span class="si">{</span><span class="n">sampler_name</span><span class="si">}</span><span class="s2"> not available.</span><span class="se">\n</span><span class="s2"> Available </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> samplers and its parameters are: </span><span class="si">{</span><span class="n">dict_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="n">name</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Given </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> sampler should be either a string name of available sampler or a function&quot;</span><span class="p">)</span>

                
        <span class="n">lens_function_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;optical_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;cross_section&#39;</span><span class="p">]</span>

        <span class="c1"># if there is user input function, update the sampler priors</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lens_function_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lens_functions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">lens_functions</span><span class="p">):</span>
                <span class="n">function_name</span> <span class="o">=</span> <span class="n">lens_functions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> 
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                     <span class="c1"># available lens functions for name e.g. &#39;optical_depth&#39;</span>
                    <span class="n">dict_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_functions_and_its_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>  
                    <span class="k">if</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">:</span>
                        <span class="n">param_dict</span> <span class="o">=</span> <span class="n">dict_</span><span class="p">[</span><span class="n">function_name</span><span class="p">]</span>  
                        <span class="k">if</span> <span class="p">(</span><span class="n">lens_functions_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>  <span class="c1"># not a dictionary</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span>
                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if there is user input lens_functions_params</span>
                            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>   <span class="c1"># user inputs will override the default values</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> function </span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s2"> not available.</span><span class="se">\n</span><span class="s2"> Available </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> functions and its parameters are: </span><span class="si">{</span><span class="n">dict_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">lens_functions</span><span class="p">[</span><span class="n">name</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Given </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> function should be either a string name of available function or a function&quot;</span><span class="p">)</span>
                
        <span class="c1"># setting up multiprocessor function for lens redshift</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_type</span> <span class="o">==</span> <span class="s1">&#39;epl_shear_galaxy&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;velocity_dispersion_ewoud&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using lens_redshift_strongly_lensed_mp&#39;</span><span class="p">)</span>
                <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">lens_redshift_strongly_lensed_mp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_helper_sl_disribution_mp</span> <span class="o">=</span> <span class="n">lens_redshift_strongly_lensed_mp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using lens_redshift_epl_shear1_mp&#39;</span><span class="p">)</span>
                <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">lens_redshift_epl_shear1_mp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_helper_sl_disribution_mp</span> <span class="o">=</span> <span class="n">lens_redshift_epl_shear1_mp</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_type</span> <span class="o">==</span> <span class="s1">&#39;sie_galaxy&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;velocity_dispersion_ewoud&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s1">&#39;cross_section&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;cross_section_epl_shear_interpolation&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using lens_redshift_sie4_mp&#39;</span><span class="p">)</span>
                    <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">lens_redshift_sie4_mp</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_helper_sl_disribution_mp</span> <span class="o">=</span> <span class="n">lens_redshift_sie4_mp</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using lens_redshift_sie2_mp&#39;</span><span class="p">)</span>
                    <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">lens_redshift_sie2_mp</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_helper_sl_disribution_mp</span> <span class="o">=</span> <span class="n">lens_redshift_sie2_mp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s1">&#39;cross_section&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;cross_section_epl_shear_interpolation&#39;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using lens_redshift_sie3_mp&#39;</span><span class="p">)</span>
                    <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">lens_redshift_sie3_mp</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_helper_sl_disribution_mp</span> <span class="o">=</span> <span class="n">lens_redshift_sie3_mp</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using lens_redshift_sie1_mp&#39;</span><span class="p">)</span>
                    <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">lens_redshift_sie1_mp</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_helper_sl_disribution_mp</span> <span class="o">=</span> <span class="n">lens_redshift_sie1_mp</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_type</span> <span class="o">==</span> <span class="s1">&#39;sis_galaxy&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;velocity_dispersion_ewoud&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using lens_redshift_sis_haris2_mp&#39;</span><span class="p">)</span>
                <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">lens_redshift_sis_haris2_mp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_helper_sl_disribution_mp</span> <span class="o">=</span> <span class="n">lens_redshift_sis_haris2_mp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using lens_redshift_sis_haris1_mp&#39;</span><span class="p">)</span>
                <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">lens_redshift_sis_haris1_mp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_helper_sl_disribution_mp</span> <span class="o">=</span> <span class="n">lens_redshift_sis_haris1_mp</span></div>



    <span class="c1">#####################</span>
    <span class="c1"># Sampler functions #</span>
    <span class="c1">#####################</span>
<div class="viewcode-block" id="OpticalDepth.axis_ratio_rayleigh">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_ratio_rayleigh">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_ratio_rayleigh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample axis ratio from rayleigh distribution with given velocity dispersion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sigma : `float: array`</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>
<span class="sd">        q_min, q_max : `float`</span>
<span class="sd">            minimum and maximum axis ratio</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be used to sample axis ratio</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : `float: array`</span>
<span class="sd">            axis ratio of the lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(axis_ratio=&quot;axis_ratio_rayleigh&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.axis_ratio(sigma=200.))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;axis_ratio_rayleigh&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]:</span> <span class="c1"># if velocity_dispersion is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">])</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;axis_ratio_rayleigh&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">q_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">],</span> 
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">sigma_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">][</span><span class="s2">&quot;sigma_min&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">][</span><span class="s2">&quot;sigma_max&quot;</span><span class="p">],</span>
            <span class="mi">500</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">q_pdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="n">axis_ratio_rayleigh_pdf</span><span class="p">(</span>
            <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span>
            <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
            <span class="n">q_min</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">],</span>
            <span class="n">q_max</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">q_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">q_pdf</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">q_array</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="n">sigma_array</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;axis_ratio_rayleigh&quot;</span><span class="p">,</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">q_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">q_object</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="OpticalDepth.axis_ratio_padilla_strauss">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_ratio_padilla_strauss">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_ratio_padilla_strauss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample axis ratio using Padilla and Strauss 2008 distribution for axis ratio</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            sample size</span>
<span class="sd">        q_min, q_max : `float`</span>
<span class="sd">            minimum and maximum axis ratio</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be used to sample axis ratio</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : `float: array`</span>
<span class="sd">            axis ratio of the lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(axis_ratio=&quot;axis_ratio_padilla_strauss&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.axis_ratio(size=10))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;axis_ratio_padilla_strauss&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;axis_ratio_padilla_strauss&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="c1"># Using Padilla and Strauss 2008 distribution for axis ratio</span>
        <span class="n">q_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.04903276402927845</span><span class="p">,</span> <span class="mf">0.09210526315789469</span><span class="p">,</span> <span class="mf">0.13596491228070173</span><span class="p">,</span> <span class="mf">0.20789473684210524</span><span class="p">,</span> <span class="mf">0.2899703729522482</span><span class="p">,</span> <span class="mf">0.3230132450331126</span><span class="p">,</span> <span class="mf">0.35350877192982455</span><span class="p">,</span> <span class="mf">0.37946148483792264</span><span class="p">,</span> <span class="mf">0.4219298245614036</span><span class="p">,</span> <span class="mf">0.4689525967235971</span><span class="p">,</span> <span class="mf">0.5075026141512723</span><span class="p">,</span> <span class="mf">0.5226472638550018</span><span class="p">,</span> <span class="mf">0.5640350877192983</span><span class="p">,</span> <span class="mf">0.6096491228070177</span><span class="p">,</span> <span class="mf">0.6500000000000001</span><span class="p">,</span> <span class="mf">0.6864848379226213</span><span class="p">,</span> <span class="mf">0.7377192982456142</span><span class="p">,</span> <span class="mf">0.7787295224817011</span><span class="p">,</span> <span class="mf">0.8007581038689441</span><span class="p">,</span> <span class="mf">0.822786685256187</span><span class="p">,</span> <span class="mf">0.8668438480306729</span><span class="p">,</span> <span class="mf">0.8973684210526317</span><span class="p">,</span> <span class="mf">0.9254385964912283</span><span class="p">])</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.04185262687135349</span><span class="p">,</span> <span class="mf">0.06114520695141845</span><span class="p">,</span> <span class="mf">0.096997499638376</span><span class="p">,</span> <span class="mf">0.1932510900336828</span><span class="p">,</span> <span class="mf">0.39547914337673706</span><span class="p">,</span> <span class="mf">0.49569751276216234</span><span class="p">,</span> <span class="mf">0.6154609137685201</span><span class="p">,</span> <span class="mf">0.7182049959882812</span><span class="p">,</span> <span class="mf">0.920153741243567</span><span class="p">,</span> <span class="mf">1.1573982157399754</span><span class="p">,</span> <span class="mf">1.3353263628106684</span><span class="p">,</span> <span class="mf">1.413149656448315</span><span class="p">,</span> <span class="mf">1.5790713532948977</span><span class="p">,</span> <span class="mf">1.7280185150744938</span><span class="p">,</span> <span class="mf">1.8132994441344819</span><span class="p">,</span> <span class="mf">1.8365803753840484</span><span class="p">,</span> <span class="mf">1.8178662203211204</span><span class="p">,</span> <span class="mf">1.748929843583365</span><span class="p">,</span> <span class="mf">1.688182592496342</span><span class="p">,</span> <span class="mf">1.6274353414093188</span><span class="p">,</span> <span class="mf">1.4948487090314488</span><span class="p">,</span> <span class="mf">1.402785526832393</span><span class="p">,</span> <span class="mf">1.321844068356993</span><span class="p">])</span>

        <span class="n">q_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">q_array</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;axis_ratio_padilla_strauss&quot;</span><span class="p">,</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">q_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">q_object</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="OpticalDepth.lens_redshift_strongly_lensed_numerical">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_redshift_strongly_lensed_numerical">[docs]</a>
    <span class="k">def</span> <span class="nf">lens_redshift_strongly_lensed_numerical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample lens redshifts, conditioned on the lens being strongly lensed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            sample size</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            source redshifts</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be used to sample lens redshifts</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        zs : `float: array`</span>
<span class="sd">            lens redshifts</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(lens_redshift=&quot;lens_redshift_strongly_lensed_numerical&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.lens_redshift(size=10, zs=1.0))</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lens_redshift_strongly_lensed_numerical_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_type</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;cosmology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]:</span> <span class="c1"># if velocity_dispersion is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">])</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">]:</span> <span class="c1"># if axis_ratio is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">])</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">]:</span> <span class="c1"># if axis_rotation_angle is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">])</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">]:</span> <span class="c1"># if density_profile_slope is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">])</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">]:</span> <span class="c1"># if external_shear is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">])</span>
        
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;lens_redshift_strongly_lensed_numerical&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numerically solving the lens redshift distribution...&quot;</span><span class="p">)</span>
        <span class="n">zs_resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">zs_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="o">+</span><span class="mf">0.001</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span> <span class="n">zs_resolution</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span> <span class="n">zs_resolution</span><span class="p">)</span>

        <span class="n">zl_scaled2d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">zs_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zs_array</span><span class="p">):</span>
            <span class="n">buffer_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">zs_</span><span class="o">-</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">])</span>
            <span class="n">zl_scaled2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buffer_</span><span class="o">/</span><span class="n">zs_</span><span class="p">)</span>
        <span class="n">zl_scaled2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zl_scaled2d</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">it_exist</span> <span class="o">=</span> <span class="n">interpolator_json_path</span><span class="p">(</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">,</span>
            <span class="n">interpolator_name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">create_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">it_exist</span> <span class="ow">or</span> <span class="n">create_new</span><span class="p">:</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_redshift_multiprocessing</span><span class="p">(</span><span class="n">zl_scaled2d</span><span class="p">,</span> <span class="n">zs_array</span><span class="p">)</span>
            <span class="c1"># number density is zero for zl=0 and infinite for zl=zs</span>
            <span class="c1"># Adding zero at the first element of each row</span>
            <span class="n">zl_scaled2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">zl_scaled2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">zl_scaled2d</span><span class="p">))</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_density</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">number_density</span><span class="p">))</span>
            <span class="c1"># Adding one at the last element of each row of zl_scaled2d</span>
            <span class="n">zl_scaled2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">zl_scaled2d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">zl_scaled2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>
            <span class="c1"># Adding zero at the last element of each row of density</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">number_density</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_density</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number_density</span><span class="o">=</span><span class="kc">None</span>

        <span class="n">zl_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">number_density</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zl_scaled2d</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="n">zs_array</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="n">create_new</span><span class="p">,</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># un-scaled lens redshift</span>
        <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">cdf_values</span>
        <span class="n">x_array</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">x_array</span>
        <span class="n">y_array</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">conditioned_y_array</span>
        <span class="n">function_spline</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">function_spline</span>
        <span class="n">pdf_norm_const</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf_norm_const</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">cubic_spline_interpolator2d_array</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">function_spline</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">))</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pdf_cubic_spline_interpolator2d_array</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pdf_norm_const</span><span class="p">,</span> <span class="n">function_spline</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">))</span> 

        <span class="n">zl_object</span><span class="o">.</span><span class="n">rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">size</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">inverse_transform_sampler2d</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cdf_values</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">zl_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">zl_object</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="OpticalDepth.lens_redshift_strongly_lensed_hemanta">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_redshift_strongly_lensed_hemanta">[docs]</a>
    <span class="k">def</span> <span class="nf">lens_redshift_strongly_lensed_hemanta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample lens redshifts, conditioned on the lens being strongly lensed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            sample size</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            source redshifts</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be used to sample lens redshifts</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        zs : `float: array`</span>
<span class="sd">            lens redshifts</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(lens_redshift=&quot;lens_redshift_strongly_lensed_numerical&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.lens_redshift(size=10, zs=1.0))</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="c1"># default parameters</span>
        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;lens_redshift_strongly_lensed_numerical_epl_shear_galaxy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s1">&#39;z_min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;z_max&#39;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
            <span class="s1">&#39;cosmology&#39;</span><span class="p">:</span> <span class="n">LambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Ode0</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span>
            <span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sigma_min&#39;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>
            <span class="s1">&#39;sigma_max&#39;</span><span class="p">:</span> <span class="mf">400.0</span><span class="p">,</span>
            <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.94</span><span class="p">,</span>
            <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mf">1.85</span><span class="p">,</span>
            <span class="s1">&#39;phistar&#39;</span><span class="p">:</span> <span class="mf">0.02099</span><span class="p">,</span>
            <span class="s1">&#39;sigmastar&#39;</span><span class="p">:</span> <span class="mf">113.78</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;velocity_dispersion_ewoud&#39;</span><span class="p">},</span>
            <span class="s1">&#39;axis_ratio&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;q_min&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;q_max&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;axis_ratio_rayleigh&#39;</span><span class="p">},</span>
            <span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;phi_min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;phi_max&#39;</span><span class="p">:</span> <span class="mf">6.283185307179586</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;axis_rotation_angle_uniform&#39;</span><span class="p">},</span>
            <span class="s1">&#39;density_profile_slope&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">1.99</span><span class="p">,</span>
            <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="mf">0.149</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;density_profile_slope_normal&#39;</span><span class="p">},</span>
            <span class="s1">&#39;external_shear&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;external_shear_normal&#39;</span><span class="p">}</span>
        <span class="p">}</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Getting pre-computed lens redshift distribution...&quot;</span><span class="p">)</span>
        <span class="n">zs_resolution</span> <span class="o">=</span> <span class="mi">48</span>
        <span class="n">zs_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">zs_resolution</span><span class="p">)</span>
        <span class="n">zl_scaled2d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">zs_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zs_array</span><span class="p">):</span>
            <span class="n">buffer_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">zs_</span><span class="o">-</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">])</span>
            <span class="n">zl_scaled2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buffer_</span><span class="o">/</span><span class="n">zs_</span><span class="p">)</span>
        <span class="n">zl_scaled2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zl_scaled2d</span><span class="p">)</span>

        <span class="c1"># get number_density</span>
        <span class="n">number_density</span> <span class="o">=</span> <span class="n">load_txt_from_module</span><span class="p">(</span><span class="s1">&#39;ler&#39;</span><span class="p">,</span> <span class="s1">&#39;lens_galaxy_population.lens_param_data&#39;</span><span class="p">,</span> <span class="s1">&#39;number_density_zl_zs.txt&#39;</span><span class="p">)</span>

        <span class="c1"># number density is zero for zl=0 and infinite for zl=zs</span>
        <span class="c1"># Adding zero at the first element of each row</span>
        <span class="n">zl_scaled2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">zl_scaled2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">zl_scaled2d</span><span class="p">))</span>
        <span class="c1"># number_density = np.hstack((np.zeros((number_density.shape[0], 1)), number_density))</span>
        <span class="c1"># Adding one at the last element of each row of zl_scaled2d</span>
        <span class="n">zl_scaled2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">zl_scaled2d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">zl_scaled2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>
        <span class="c1"># Adding zero at the last element of each row of density</span>
       <span class="c1"># number_density = np.hstack((number_density, np.zeros((number_density.shape[0], 1))))</span>

        <span class="n">zl_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">number_density</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zl_scaled2d</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="n">zs_array</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># un-scaled lens redshift</span>
        <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">cdf_values</span>
        <span class="n">x_array</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">x_array</span>
        <span class="n">y_array</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">conditioned_y_array</span>
        <span class="n">function_spline</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">function_spline</span>
        <span class="n">pdf_norm_const</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf_norm_const</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">cubic_spline_interpolator2d_array</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">function_spline</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">))</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pdf_cubic_spline_interpolator2d_array</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pdf_norm_const</span><span class="p">,</span> <span class="n">function_spline</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">))</span> 

        <span class="n">zl_object</span><span class="o">.</span><span class="n">rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">size</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">inverse_transform_sampler2d</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cdf_values</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">zl_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">zl_object</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="OpticalDepth.lens_redshift_intrinsic">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_redshift_intrinsic">[docs]</a>
    <span class="k">def</span> <span class="nf">lens_redshift_intrinsic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample intrinsic lens redshifts, based on the intrinsic velocity dispersion of the lens galaxy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            sample size</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            source redshifts</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be used to sample lens redshifts</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        zs : `float: array`</span>
<span class="sd">            lens redshifts</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;lens_redshift_intrinsic&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;cosmology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]:</span> <span class="c1"># if velocity_dispersion is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">])</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="c1"># param_dict = self.available_lens_prior_list_and_its_params[&quot;lens_redshift&quot;][&quot;lens_redshift_intrinsic&quot;]</span>
        <span class="c1"># if param_dict:</span>
        <span class="c1">#     param_dict.update(kwargs)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     param_dict = kwargs</span>
        <span class="c1"># identifier_dict.update(param_dict)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">it_exist</span> <span class="o">=</span> <span class="n">interpolator_json_path</span><span class="p">(</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">,</span>
            <span class="n">interpolator_name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">create_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">it_exist</span> <span class="ow">or</span> <span class="n">create_new</span><span class="p">:</span>
            <span class="n">z_min</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
            <span class="n">z_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
            <span class="n">zl_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">])</span> 
            <span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sigma</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># integral = [quad(integrand, 10., 420., args=(z))[0] for z in zl_array]</span>
            <span class="n">integral</span> <span class="o">=</span> <span class="p">[</span><span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">][</span><span class="s1">&#39;sigma_min&#39;</span><span class="p">],</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">][</span><span class="s1">&#39;sigma_max&#39;</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zl_array</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zl_array</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">integral</span><span class="o">=</span><span class="kc">None</span>

        <span class="n">zl_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">integral</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zl_array</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="n">create_new</span><span class="p">,</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">zl_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">zl_object</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="OpticalDepth.lens_redshift_multiprocessing">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_redshift_multiprocessing">[docs]</a>
    <span class="k">def</span> <span class="nf">lens_redshift_multiprocessing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zl_scaled2d</span><span class="p">,</span> <span class="n">zs1d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Compute the lens redshift distribution using multiprocessing.</span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            zl_scaled2d : array_like</span>
<span class="sd">                2D array of lens redshifts, scaled by the source redshift.</span>
<span class="sd">            zs1d : array_like</span>
<span class="sd">                1D array of source redshifts.</span>
<span class="sd">            zl_distribution_name : str</span>
<span class="sd">                Name of the lens redshift distribution to compute.</span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            density_array : array_like</span>
<span class="sd">                2D array of the lens redshift distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
   
        <span class="n">sigma_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span>
        <span class="n">sigma_args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">sigma_args</span><span class="p">[</span><span class="s2">&quot;sigma_min&quot;</span><span class="p">],</span>
            <span class="n">sigma_args</span><span class="p">[</span><span class="s2">&quot;sigma_max&quot;</span><span class="p">],</span>
            <span class="n">sigma_args</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span>
            <span class="n">sigma_args</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
            <span class="n">sigma_args</span><span class="p">[</span><span class="s2">&quot;phistar&quot;</span><span class="p">],</span>
            <span class="n">sigma_args</span><span class="p">[</span><span class="s2">&quot;sigmastar&quot;</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="c1"># 3. q; q_rvs = self.axis_ratio.rvs</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">q_args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">cdf_values</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">x_array</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">conditioned_y_array</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># SIS case</span>
            <span class="n">q_args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">],</span>
            <span class="p">]</span>

        <span class="c1"># 4. Da; Da_function = self.angular_diameter_distance.function</span>
        <span class="n">Da_args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="o">.</span><span class="n">function_spline</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="o">.</span><span class="n">x_array</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># 5. dVcdz; dVcdz_function = self.differential_comoving_volume.function</span>
        <span class="n">dVcdz_args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="o">.</span><span class="n">function_spline</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="o">.</span><span class="n">x_array</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># 6. idx; index to order the results</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zs1d</span><span class="p">))</span>

        <span class="c1"># 7. cross section</span>
        <span class="c1"># cs_fn = self.cross_section_function</span>
        <span class="n">cs_args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nbrs</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_section_spline</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sis_area_array</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># 8. phi; axis_rotation_angle = self.axis_rotation_angle.rvs</span>
        <span class="n">phi_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]</span>
        <span class="n">phi_args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">phi_args</span><span class="p">[</span><span class="s2">&quot;phi_min&quot;</span><span class="p">],</span>
            <span class="n">phi_args</span><span class="p">[</span><span class="s2">&quot;phi_max&quot;</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="c1"># 9. shear; external_shear = self.external_shear.rvs</span>
        <span class="n">shear_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]</span>
        <span class="n">shear_args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">shear_args</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span>
            <span class="n">shear_args</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="c1"># 10. slope; density_profile_slope = self.density_profile_slope.rvs</span>
        <span class="n">slope_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">]</span>
        <span class="n">slope_args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">slope_args</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span>
            <span class="n">slope_args</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="n">input_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">zs1d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zl_scaled2d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma_args</span><span class="p">,</span> <span class="n">q_args</span><span class="p">,</span> <span class="n">Da_args</span><span class="p">,</span> <span class="n">dVcdz_args</span><span class="p">,</span> <span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cs_args</span><span class="p">,</span> <span class="n">phi_args</span><span class="p">,</span> <span class="n">shear_args</span><span class="p">,</span> <span class="n">slope_args</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zs1d</span><span class="p">))],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing lens redshift distribution with multiprocessing...&quot;</span><span class="p">)</span>
        <span class="c1"># with tqdm</span>
        <span class="n">mp_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_helper_sl_disribution_mp</span>
        <span class="n">density_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">zl_scaled2d</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">npool</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>            
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">mp_fn</span><span class="p">,</span> <span class="n">input_params</span><span class="p">),</span>
                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">zs1d</span><span class="p">),</span>
                <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="c1"># print(result)</span>
                <span class="p">(</span>
                    <span class="n">iter_i</span><span class="p">,</span>
                    <span class="n">density_</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">=</span> <span class="n">result</span>

                <span class="n">density_array</span><span class="p">[</span><span class="n">iter_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">density_</span>
                
        <span class="c1"># # without multiprocessing, just for loop with tqdm</span>
        <span class="c1"># density_array = np.zeros_like(zl_scaled2d)</span>
        <span class="c1"># for i in range(len(zs1d)):</span>
        <span class="c1">#     iter_i, density_ = mp_fn(input_params[i])</span>
        <span class="c1">#     density_array[iter_i] = density_</span>
        <span class="c1"># except:</span>
        <span class="c1">#     return input_params</span>

        <span class="k">return</span> <span class="n">density_array</span></div>


<div class="viewcode-block" id="OpticalDepth.axis_rotation_angle_uniform">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_rotation_angle_uniform">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_rotation_angle_uniform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample the axis rotation angle of the elliptical lens galaxy from a uniform distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of lens parameters to sample</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be called with size as input</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        phi : `numpy.ndarray`</span>
<span class="sd">            axis rotation angle of the elliptical lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(axis_rotation_angle=&quot;axis_rotation_angle_uniform&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.axis_rotation_angle_uniform(size=10))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;axis_rotation_angle_uniform&quot;</span><span class="p">}</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">][</span><span class="s2">&quot;axis_rotation_angle_uniform&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">low</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_min&quot;</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_max&quot;</span><span class="p">]</span>
        <span class="n">phi_rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
            <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span>
            <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="p">))</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_max&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_min&quot;</span><span class="p">]:</span>
            <span class="n">phi_pdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">phi</span><span class="p">:</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_min&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">phi_pdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">phi</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_max&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_min&quot;</span><span class="p">])</span>

        <span class="n">phi_object</span> <span class="o">=</span><span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="n">phi_rvs</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="n">phi_pdf</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">phi_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">phi_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="OpticalDepth.axis_ratio_uniform">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_ratio_uniform">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_ratio_uniform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample the axis ratio of the elliptical lens galaxy from a uniform distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of lens parameters to sample</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be called with size as input</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : `numpy.ndarray`</span>
<span class="sd">            axis ratio of the elliptical lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(axis_ratio=&quot;axis_ratio_uniform&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.axis_ratio_uniform(size=10))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;axis_ratio_uniform&quot;</span><span class="p">}</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;axis_ratio_uniform&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">low</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">]</span>
        <span class="n">q_rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
            <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span>
            <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="p">))</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">]:</span>
            <span class="n">q_pdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">q</span> <span class="o">==</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q_pdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">])</span>

        <span class="n">q_object</span> <span class="o">=</span><span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="n">q_rvs</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="n">q_pdf</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">q_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">q_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="OpticalDepth.external_shear_normal">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.external_shear_normal">[docs]</a>
    <span class="k">def</span> <span class="nf">external_shear_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample the external shear parameters from a normal distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of lens parameters to sample</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be called with size as input</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gamma_1 : `numpy.ndarray`</span>
<span class="sd">            shear component in the x-direction</span>
<span class="sd">        gamma_2 : `numpy.ndarray`</span>
<span class="sd">            shear component in the y-direction</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(external_shear=&quot;external_shear_normal&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.external_shear_normal(size=10))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;external_shear_normal&quot;</span><span class="p">}</span>
        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">][</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">param</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
        <span class="n">shear_rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">size</span><span class="p">),</span>
        <span class="p">))</span>
        <span class="n">shear_pdf</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">shear1</span><span class="p">,</span> <span class="n">shear2</span><span class="p">:</span> <span class="n">normal_pdf_2d</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">shear1</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">shear2</span><span class="p">,</span>
            <span class="n">mean_x</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
            <span class="n">mean_y</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
            <span class="n">std_x</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
            <span class="n">std_y</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
        <span class="p">))</span>

        <span class="n">shear_object</span> <span class="o">=</span><span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="n">shear_rvs</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="n">shear_pdf</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">shear_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">shear_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="OpticalDepth.external_shear_numerical_hemanta">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.external_shear_numerical_hemanta">[docs]</a>
    <span class="k">def</span> <span class="nf">external_shear_numerical_hemanta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample the external shear parameters from a normal distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of lens parameters to sample</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be called with size as input</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gamma_1 : `numpy.ndarray`</span>
<span class="sd">            shear component in the x-direction</span>
<span class="sd">        gamma_2 : `numpy.ndarray`</span>
<span class="sd">            shear component in the y-direction</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(external_shear=&quot;external_shear_normal&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.external_shear_normal(size=10))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;external_shear_numerical_hemanta&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;external_shear_normal&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">},</span>
        <span class="p">}</span>

        <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span> <span class="o">=</span> <span class="n">load_txt_from_module</span><span class="p">(</span><span class="s1">&#39;ler&#39;</span><span class="p">,</span> <span class="s1">&#39;lens_galaxy_population.lens_param_data&#39;</span><span class="p">,</span> <span class="s1">&#39;external_shear_sl.txt&#39;</span><span class="p">)</span>

        <span class="n">shear_object</span> <span class="o">=</span><span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">gamma1</span><span class="p">,</span>
            <span class="n">y_array</span><span class="o">=</span><span class="n">gamma2</span><span class="p">,</span>
            <span class="n">gaussian_kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">shear_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">shear_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="OpticalDepth.density_profile_slope_normal">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.density_profile_slope_normal">[docs]</a>
    <span class="k">def</span> <span class="nf">density_profile_slope_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample the lens galaxy density profile slope with normal distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of lens parameters to sample</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be used to sample velocity dispersion</span>
<span class="sd">        **kwargs : `dict`</span>
<span class="sd">            additional parameters to be passed to the function, </span>
<span class="sd">            e.g. `mean` and `std` for the normal distribution</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        slope : `float`</span>
<span class="sd">            density profile slope of the lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(density_profile_slope=&quot;density_profile_slope_normal&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.density_profile_slope_normal(size=10))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">}</span>

        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">][</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param</span><span class="p">:</span>
            <span class="n">param</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
        <span class="n">slope_rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="p">))</span>
        <span class="n">slope_pdf</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">slope</span><span class="p">:</span> <span class="n">normal_pdf</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">slope</span><span class="p">,</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
            <span class="n">std</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
        <span class="p">))</span>

        <span class="n">slope_object</span> <span class="o">=</span><span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="n">slope_rvs</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="n">slope_pdf</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">get_attribute</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">slope_object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">slope_rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="OpticalDepth.density_profile_slope_numerical_hemanta">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.density_profile_slope_numerical_hemanta">[docs]</a>
    <span class="k">def</span> <span class="nf">density_profile_slope_numerical_hemanta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample the lens galaxy density profile slope with normal distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of lens parameters to sample</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be used to sample velocity dispersion</span>
<span class="sd">        **kwargs : `dict`</span>
<span class="sd">            additional parameters to be passed to the function, </span>
<span class="sd">            e.g. `mean` and `std` for the normal distribution</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        slope : `float`</span>
<span class="sd">            density profile slope of the lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(density_profile_slope=&quot;density_profile_slope_normal&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.density_profile_slope_normal(size=10))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;density_profile_slope_numerical_hemanta&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;density_profile_slope_normal&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">1.99</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="mf">0.149</span><span class="p">},</span>
        <span class="p">}</span>

        <span class="n">gamma</span> <span class="o">=</span> <span class="n">load_txt_from_module</span><span class="p">(</span><span class="s1">&#39;ler&#39;</span><span class="p">,</span> <span class="s1">&#39;lens_galaxy_population.lens_param_data&#39;</span><span class="p">,</span> <span class="s1">&#39;density_profile_slope_sl.txt&#39;</span><span class="p">)</span>

        <span class="n">slope_object</span> <span class="o">=</span><span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">gaussian_kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">slope_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">slope_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="OpticalDepth.lens_redshift_sis_haris">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_redshift_sis_haris">[docs]</a>
    <span class="k">def</span> <span class="nf">lens_redshift_sis_haris</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample lens redshifts, conditioned on the lens being strongly lensed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            source redshifts</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            If True, returns a function that can be called with zs as input</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        zl : `float`</span>
<span class="sd">            lens redshifts</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import LensGalaxyParameterDistribution</span>
<span class="sd">        &gt;&gt;&gt; lens = LensGalaxyParameterDistribution()</span>
<span class="sd">        &gt;&gt;&gt; lens.lens_redshift_sis_haris(zs=1.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # Old way</span>
        <span class="c1"># splineDc = self.comoving_distance.function_spline  # spline coefficients for the comoving distance and redshifts</span>
        <span class="c1"># splineDcInv = self.comoving_distance.function_inverse_spline # spline coefficients for the redshifts and comoving distance</span>
        <span class="c1"># u = np.linspace(0, 1, 500)</span>
        <span class="c1"># cdf = (10 * u**3 - 15 * u**4 + 6 * u**5)  # See the integral of Eq. A7 of https://arxiv.org/pdf/1807.07062.pdf (cdf)</span>
        <span class="c1"># zs = np.array([zs]).reshape(-1)</span>

        <span class="c1"># New way</span>
        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;lens_redshift_sis_haris&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;cosmology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Ode0</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sigma_min</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">sigma_max</span> <span class="o">=</span> <span class="mf">420.</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">2.32</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">2.67</span><span class="p">,</span> <span class="n">phistar</span> <span class="o">=</span> <span class="mf">8.0e-3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">sigmastar</span> <span class="o">=</span> <span class="mf">161.0</span><span class="p">)</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;lens_redshift_sis_haris&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">zl_resolution</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span>
        <span class="n">x_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">zl_resolution</span><span class="p">)</span>
        <span class="n">pdf_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">30</span><span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># Haris et al. 2018 (A7)</span>

        <span class="n">zl_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">pdf_</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">x_array</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">cdf_values_zl</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">cdf_values</span>
        <span class="n">function_spline_zl</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">function_spline</span>
        <span class="n">pdf_norm_const</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf_norm_const</span>
        <span class="n">x_array_zl</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">x_array</span>

        <span class="n">spline_Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="n">function_spline</span>
        <span class="n">x_array_Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="n">x_array</span>
        <span class="n">inverse_spline_Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="n">function_inverse_spline</span>
        <span class="n">z_array_Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="n">z_array</span>

        <span class="nd">@njit</span>
        <span class="k">def</span> <span class="nf">zl_rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">inverse_transform_sampler</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">cdf_values_zl</span><span class="p">,</span> <span class="n">x_array_zl</span><span class="p">)</span>
            <span class="n">zs_Dc</span> <span class="o">=</span> <span class="n">cubic_spline_interpolator</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">spline_Dc</span><span class="p">,</span> <span class="n">x_array_Dc</span><span class="p">)</span>
            <span class="n">zl_Dc</span> <span class="o">=</span> <span class="n">zs_Dc</span> <span class="o">*</span> <span class="n">r</span>
            <span class="k">return</span> <span class="n">cubic_spline_interpolator</span><span class="p">(</span><span class="n">zl_Dc</span><span class="p">,</span> <span class="n">inverse_spline_Dc</span><span class="p">,</span> <span class="n">z_array_Dc</span><span class="p">)</span>
        
        <span class="nd">@njit</span>
        <span class="k">def</span> <span class="nf">zl_pdf</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">zl</span> <span class="o">/</span> <span class="n">zs</span>
            <span class="k">return</span> <span class="n">cubic_spline_interpolator</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">function_spline_zl</span><span class="p">,</span> <span class="n">x_array_zl</span><span class="p">)</span><span class="o">/</span><span class="n">pdf_norm_const</span>
        
        <span class="nd">@njit</span>
        <span class="k">def</span> <span class="nf">zl_function</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">zl</span> <span class="o">/</span> <span class="n">zs</span>
            <span class="k">return</span> <span class="n">cubic_spline_interpolator</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">function_spline_zl</span><span class="p">,</span> <span class="n">x_array_zl</span><span class="p">)</span>
        
        <span class="n">zl_object</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">zl_function</span>
        <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">zl_pdf</span>
        <span class="n">zl_object</span><span class="o">.</span><span class="n">rvs</span> <span class="o">=</span> <span class="n">zl_rvs</span>

        <span class="k">return</span> <span class="n">zl_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span></div>

        
         
<div class="viewcode-block" id="OpticalDepth.velocity_dispersion_gengamma">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.velocity_dispersion_gengamma">[docs]</a>
    <span class="k">def</span> <span class="nf">velocity_dispersion_gengamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample velocity dispersion from gengamma distribution</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of lens parameters to sample</span>
<span class="sd">        a,c : `float`</span>
<span class="sd">            parameters of gengamma distribution</span>
<span class="sd">            refer to https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.gengamma.html</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be used to sample velocity dispersion</span>
<span class="sd">        param : `dict`</span>
<span class="sd">            Allows to pass in above parameters as dict.</span>
<span class="sd">            e.g. param = dict(a=2.32 / 2.67, c=2.67)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sigma : `numpy.ndarray` (1D array of floats)</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(velocity_dispersion=&quot;velocity_dispersion_gengamma&quot;), lens_param_samplers_params=dict(velocity_dispersion=dict(a=2.32 / 2.67, c=2.67)))</span>
<span class="sd">        &gt;&gt;&gt; print(od.velocity_dispersion(size=10))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;velocity_dispersion_gengamma&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;cosmology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;velocity_dispersion_gengamma&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="c1"># setting up inputs for the interpolator</span>
        <span class="n">sigma_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;sigma_min&#39;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;sigma_max&#39;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">pdf_func_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma_</span><span class="p">:</span> <span class="n">gengamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span>
            <span class="n">sigma_</span><span class="o">/</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;sigmastar&#39;</span><span class="p">],</span>
            <span class="n">a</span><span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">],</span>
            <span class="n">c</span><span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">],</span>
        <span class="p">)</span>   <span class="c1"># gengamma pdf</span>

        <span class="n">sigma_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">pdf_func_</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">sigma_array</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;create_new&#39;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">sigma_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">sigma_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="OpticalDepth.velocity_dispersion_bernardi">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.velocity_dispersion_bernardi">[docs]</a>
    <span class="k">def</span> <span class="nf">velocity_dispersion_bernardi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample velocity dispersion from Bernardi et al. (2010). This uses inverse transform sampling.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of lens parameters to sample</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be used to sample velocity dispersion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sigma : `numpy.ndarray` (1D array of floats)</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(velocity_dispersion=&quot;velocity_dispersion_bernardi&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.velocity_dispersion(size=10))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;velocity_dispersion_bernardi&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;cosmology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;velocity_dispersion_bernardi&quot;</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;velocity_dispersion_bernardi&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span> 
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="c1"># setting up inputs for the interpolator</span>
        <span class="n">sigma_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;sigma_min&#39;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;sigma_max&#39;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">number_density_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">:</span> <span class="n">phi_loc_bernardi</span><span class="p">(</span>
            <span class="n">sigma</span><span class="p">,</span> 
            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
            <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;beta&#39;</span><span class="p">],</span>
            <span class="n">phistar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;phistar&#39;</span><span class="p">],</span>
            <span class="n">sigmastar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;sigmastar&#39;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">sigma_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">number_density_function</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">sigma_array</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;create_new&#39;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">sigma_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">sigma_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.velocity_dispersion_ewoud">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.velocity_dispersion_ewoud">[docs]</a>
    <span class="k">def</span> <span class="nf">velocity_dispersion_ewoud</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample velocity dispersion (redshift dependent) from Wempe et al. (2022). This uses inverse transform sampling.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of lens parameters to sample</span>
<span class="sd">        zl : `float`</span>
<span class="sd">            redshift of the lens galaxy</span>
<span class="sd">        get_attribute : `bool`</span>
<span class="sd">            if True, returns a function that can be used to sample velocity dispersion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sigma : `numpy.ndarray` (1D array of floats)</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(velocity_dispersion=&quot;velocity_dispersion_ewoud&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(od.velocity_dispersion(size=10, zl=0.5))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;velocity_dispersion_ewoud&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;cosmology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;velocity_dispersion_ewoud&quot;</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;velocity_dispersion_ewoud&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span> 
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="c1"># setting up inputs for the interpolator</span>
        <span class="n">sigma_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;sigma_min&#39;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;sigma_max&#39;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">number_density_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="p">:</span> <span class="n">phi</span><span class="p">(</span>
            <span class="n">sigma</span><span class="p">,</span> 
            <span class="n">zl</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
            <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;beta&#39;</span><span class="p">],</span>
            <span class="n">phistar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;phistar&#39;</span><span class="p">],</span>
            <span class="n">sigmastar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;sigmastar&#39;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">zl_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="o">+</span><span class="mf">0.001</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

        <span class="n">sigma_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">number_density_function</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">sigma_array</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="n">zl_array</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;create_new&#39;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;rvs&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">sigma_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">sigma_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zl</span><span class="p">)</span></div>


    <span class="c1">##################</span>
    <span class="c1"># Lens functions #</span>
    <span class="c1">##################</span>
    <span class="k">def</span> <span class="nf">optical_depth_numerical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;optical_depth_numerical&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;cosmology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">]:</span> <span class="c1"># if velocity_dispersion is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">])</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">]:</span> <span class="c1"># if axis_ratio is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;axis_ratio&#39;</span><span class="p">])</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">]:</span> <span class="c1"># if axis_rotation_angle is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">])</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">]:</span> <span class="c1"># if density_profile_slope is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;density_profile_slope&#39;</span><span class="p">])</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">]:</span> <span class="c1"># if external_shear is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s1">&#39;external_shear&#39;</span><span class="p">])</span>
        
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_functions_and_its_params</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span><span class="s2">&quot;optical_depth_numerical&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">z_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="o">&gt;</span><span class="mf">0.</span> <span class="k">else</span> <span class="mf">0.001</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span>
        <span class="n">zs_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span>
            <span class="n">z_min</span><span class="p">,</span> 
            <span class="n">z_max</span><span class="p">,</span> 
            <span class="n">resolution</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">tau</span><span class="p">(</span><span class="n">zs</span><span class="p">):</span>
            <span class="c1"># self.lens_redshift.function gives cross-section</span>
            <span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">zl_</span><span class="p">,</span> <span class="n">zs_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_redshift</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zl_</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zs_</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">integral</span> <span class="o">=</span> <span class="p">[</span><span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zs</span><span class="p">]</span> 
            <span class="k">return</span> <span class="n">integral</span>
        
        <span class="n">tau_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zs_array</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">tau_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">tau_object</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
        
<div class="viewcode-block" id="OpticalDepth.cross_section_sis">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.cross_section_sis">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_section_sis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the SIS cross-section</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sigma : `float`</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>
<span class="sd">        zl : `float`</span>
<span class="sd">            redshift of the lens galaxy</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            redshift of the source galaxy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cross_section : `float`</span>
<span class="sd">            SIS cross-section</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; print(od.cross_section_sis(sigma=200., zl=0.5, zs=1.0))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">theta_E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_einstein_radii</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">theta_E</span><span class="o">**</span><span class="mi">2</span></div>

    
<div class="viewcode-block" id="OpticalDepth.compute_einstein_radii">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.compute_einstein_radii">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_einstein_radii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the Einstein radii of the lens galaxies</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sigma : `float`</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>
<span class="sd">        zl : `float`</span>
<span class="sd">            lens redshifts</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            source redshifts</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        theta_E : `float`</span>
<span class="sd">            Einstein radii of the lens galaxies in radians. Multiply by </span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import LensGalaxyParameterDistribution</span>
<span class="sd">        &gt;&gt;&gt; lens = LensGalaxyParameterDistribution()</span>
<span class="sd">        &gt;&gt;&gt; sigma = 200.0</span>
<span class="sd">        &gt;&gt;&gt; zl = 0.5</span>
<span class="sd">        &gt;&gt;&gt; zs = 1.0</span>
<span class="sd">        &gt;&gt;&gt; lens.compute_einstein_radii(sigma, zl, zs)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Compute the angular diameter distances</span>
        <span class="n">Ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
        <span class="n">Dls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance_z1z2</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span>
        <span class="c1"># Compute the Einstein radii</span>
        <span class="n">theta_E</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="mf">299792.458</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Dls</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ds</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># Note: km/s for sigma; Dls, Ds are in Mpc</span>

        <span class="k">return</span> <span class="n">theta_E</span></div>


<div class="viewcode-block" id="OpticalDepth.cross_section_sie_feixu">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.cross_section_sie_feixu">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_section_sie_feixu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the SIE cross-section from Fei Xu et al. (2021)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sigma : `float`</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>
<span class="sd">        zl : `float`</span>
<span class="sd">            redshift of the lens galaxy</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            redshift of the source galaxy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cross_section : `float`</span>
<span class="sd">            SIE cross-section</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; print(od.cross_section_sie_feixu(sigma=200., zl=0.5, zs=1.0, q=1.0))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># phi_cut_SIE already includes the factor of pi</span>
        <span class="k">return</span> <span class="n">phi_cut_SIE</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_section_sis</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="o">=</span><span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="n">zs</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="OpticalDepth.optical_depth_epl_shear_hemanta">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.optical_depth_epl_shear_hemanta">[docs]</a>
    <span class="k">def</span> <span class="nf">optical_depth_epl_shear_hemanta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the strong lensing optical depth (EPL with shear). \n</span>
<span class="sd">        LambdaCDM(H0=70, Om0=0.3, Ode0=0.7) was used to derive the following equation. This is the analytic version of optical depth from z=0 to z=zs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            source redshifts</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tau : `float`</span>
<span class="sd">            strong lensing optical depth</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; print(od.optical_depth_epl_shear_lambdacdm(zs=1.0))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># setting up input parameters for interpolation</span>
        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;optical_depth_numerical&#39;</span><span class="p">,</span>
            <span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span>
            <span class="s1">&#39;z_min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;z_max&#39;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
            <span class="s1">&#39;cosmology&#39;</span><span class="p">:</span> <span class="n">LambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Ode0</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span>
            <span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sigma_min&#39;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>
            <span class="s1">&#39;sigma_max&#39;</span><span class="p">:</span> <span class="mf">400.0</span><span class="p">,</span>
            <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.94</span><span class="p">,</span>
            <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mf">1.85</span><span class="p">,</span>
            <span class="s1">&#39;phistar&#39;</span><span class="p">:</span> <span class="mf">0.02099</span><span class="p">,</span>
            <span class="s1">&#39;sigmastar&#39;</span><span class="p">:</span> <span class="mf">113.78</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;velocity_dispersion_ewoud&#39;</span><span class="p">},</span>
            <span class="s1">&#39;axis_ratio&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;q_min&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;q_max&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;axis_ratio_rayleigh&#39;</span><span class="p">},</span>
            <span class="s1">&#39;axis_rotation_angle&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;phi_min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s1">&#39;phi_max&#39;</span><span class="p">:</span> <span class="mf">6.283185307179586</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;axis_rotation_angle_uniform&#39;</span><span class="p">},</span>
            <span class="s1">&#39;density_profile_slope&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">1.99</span><span class="p">,</span>
            <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="mf">0.149</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;density_profile_slope_normal&#39;</span><span class="p">},</span>
            <span class="s1">&#39;external_shear&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;external_shear_normal&#39;</span><span class="p">}</span>
        <span class="p">}</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Getting pre-computed optical depth for EPL+Shear lenses...&quot;</span><span class="p">)</span>

        <span class="n">zs_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span>
            <span class="mf">0.001</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">tau_arr</span> <span class="o">=</span> <span class="n">load_txt_from_module</span><span class="p">(</span><span class="s1">&#39;ler&#39;</span><span class="p">,</span> <span class="s1">&#39;lens_galaxy_population.lens_param_data&#39;</span><span class="p">,</span> <span class="s1">&#39;optical_depth_epl_shear_vd_ewoud.txt&#39;</span><span class="p">)</span>

        <span class="n">tau_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">tau_arr</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zs_arr</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">tau_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">tau_object</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.optical_depth_sis_haris">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.optical_depth_sis_haris">[docs]</a>
    <span class="k">def</span> <span class="nf">optical_depth_sis_haris</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the strong lensing optical depth (SIS). \n</span>
<span class="sd">        LambdaCDM(H0=70, Om0=0.3, Ode0=0.7) was used to derive the following equation. This is the analytic version of optical depth from z=0 to z=zs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            source redshifts</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tau : `float`</span>
<span class="sd">            strong lensing optical depth</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; print(od.optical_depth_sis_haris(zs=1.0))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # z to luminosity_distance (luminosity_distance) conversion</span>
        <span class="c1"># #Dc = self.z_to_Dc(zs) * 1e-3  # 1e-3 converts Mpc to Gpc</span>
        <span class="c1"># splineDc = self.splineDc</span>

        

        <span class="c1"># if get_attribute:</span>
        <span class="c1">#     return tau</span>
        <span class="c1"># else:</span>
        <span class="c1">#     return tau(zs)</span>
        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;optical_depth_sis_haris&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="o">&gt;</span><span class="mf">0.</span> <span class="k">else</span> <span class="mf">0.001</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;cosmology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_functions_and_its_params</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span><span class="s2">&quot;optical_depth_sis_haris&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">zs_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_min&#39;</span><span class="p">],</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;z_max&#39;</span><span class="p">],</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">tau</span><span class="p">(</span><span class="n">zs</span><span class="p">):</span>
            <span class="n">Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">Dc</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">/</span> <span class="mf">62.2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span>
        
        <span class="n">tau_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zs_arr</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">tau_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">tau_object</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span></div>


    <span class="c1">#######################################</span>
    <span class="c1"># interpolated cross section function #</span>
    <span class="c1">#######################################</span>
    <span class="k">def</span> <span class="nf">create_data_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">):</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># inlcude z=0.01 and z=10.0</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>

        <span class="n">zl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">zl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">zs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.001</span><span class="p">)</span>

        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;sigma_min&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;sigma_max&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># inlcude sigma_min and sigma_max</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;sigma_min&#39;</span><span class="p">])</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;sigma_max&#39;</span><span class="p">])</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s1">&#39;q_min&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s1">&#39;q_max&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># inlcude q_min and q_max</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s1">&#39;q_min&#39;</span><span class="p">])</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s1">&#39;q_max&#39;</span><span class="p">])</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">size</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># inlcude 0 and 2 * np.pi</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">phi_q2_ellipticity_hemanta</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="c1"># Da_zs = od_epl_ewoud.angular_diameter_distance(np.array([zs]))[0]</span>
        <span class="c1"># einstein radius </span>
        <span class="n">Ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
        <span class="n">Dls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance_z1z2</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span>
        <span class="n">theta_E</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="mf">299792.458</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Dls</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ds</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># Note: km/s for sigma; Dls, Ds are in Mpc</span>

        <span class="k">return</span> <span class="n">theta_E</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">,</span> <span class="n">q</span>
    
    <span class="k">def</span> <span class="nf">cross_section_epl_shear_numerical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta_E</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">):</span>

        <span class="n">size</span> <span class="o">=</span> <span class="n">theta_E</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">area_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">kwargs_lens</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;theta_E&quot;</span><span class="p">:</span> <span class="n">theta_E</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;e1&quot;</span><span class="p">:</span> <span class="n">e1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;e2&quot;</span><span class="p">:</span> <span class="n">e2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;center_x&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                    <span class="s2">&quot;center_y&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;gamma1&quot;</span><span class="p">:</span> <span class="n">gamma1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;gamma2&quot;</span><span class="p">:</span> <span class="n">gamma2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;ra_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;dec_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">]</span>

            <span class="n">caustic_double_points</span> <span class="o">=</span> <span class="n">caustics_epl_shear</span><span class="p">(</span>
                <span class="n">kwargs_lens</span><span class="p">,</span> <span class="n">return_which</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="n">maginf</span><span class="o">=-</span><span class="mi">100</span>
            <span class="p">)</span>
            <span class="n">caustic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">caustic_double_points</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>

            <span class="c1"># If there is a nan, caustic=False, draw a new gamma</span>
            <span class="k">if</span> <span class="n">caustic</span><span class="p">:</span>
                <span class="n">area_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">caustic_double_points</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">area_list</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">cross_section_epl_shear_numerical_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">):</span>

        <span class="n">size</span> <span class="o">=</span> <span class="n">e1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">area_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">kwargs_lens</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;theta_E&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="s2">&quot;e1&quot;</span><span class="p">:</span> <span class="n">e1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;e2&quot;</span><span class="p">:</span> <span class="n">e2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;center_x&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                    <span class="s2">&quot;center_y&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;gamma1&quot;</span><span class="p">:</span> <span class="n">gamma1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;gamma2&quot;</span><span class="p">:</span> <span class="n">gamma2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;ra_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;dec_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">]</span>

            <span class="n">caustic_double_points</span> <span class="o">=</span> <span class="n">caustics_epl_shear</span><span class="p">(</span>
                <span class="n">kwargs_lens</span><span class="p">,</span> <span class="n">return_which</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="n">maginf</span><span class="o">=-</span><span class="mi">100</span>
            <span class="p">)</span>
            <span class="n">caustic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">caustic_double_points</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>

            <span class="c1"># If there is a nan, caustic=False, draw a new gamma</span>
            <span class="k">if</span> <span class="n">caustic</span><span class="p">:</span>
                <span class="n">area_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">caustic_double_points</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">area_list</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">create_cross_section_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">param_dict_given</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">z_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span>
            <span class="n">z_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span>
            <span class="n">cosmology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span>
            <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span>
            <span class="n">sigma_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;sigma_min&#39;</span><span class="p">],</span>
            <span class="n">sigma_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s1">&#39;sigma_max&#39;</span><span class="p">],</span>
            <span class="n">q_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s1">&#39;q_min&#39;</span><span class="p">],</span>
            <span class="n">q_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s1">&#39;q_max&#39;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">file_path</span><span class="p">,</span> <span class="n">it_exist</span> <span class="o">=</span> <span class="n">interpolator_json_path</span><span class="p">(</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="n">param_dict_given</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;cross_section_function&quot;</span><span class="p">,</span>
            <span class="n">interpolator_name</span><span class="o">=</span><span class="s2">&quot;cross_section_function&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">it_exist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interpolated cross section function will be created at </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating interpolated cross section function with sklearn NearestNeighbors, and this will be use for cross section calculation&quot;</span><span class="p">)</span>

            <span class="n">size_interpolation</span><span class="o">=</span><span class="mi">1000</span>
            <span class="n">theta_E</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data_set</span><span class="p">(</span><span class="n">size_interpolation</span><span class="p">)</span>
            <span class="c1"># sort</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">theta_E</span><span class="p">)</span>
            <span class="n">theta_E</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span> <span class="o">=</span> <span class="n">theta_E</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">e1</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">e2</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">gamma</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">gamma1</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">gamma2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">values1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_epl_shear_numerical</span><span class="p">(</span><span class="n">theta_E</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">)</span>
            <span class="n">values2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_epl_shear_numerical_unit</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">theta_E</span><span class="o">**</span><span class="mi">2</span>

            <span class="n">idx_cs</span> <span class="o">=</span> <span class="p">(</span><span class="n">values2</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">values1</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">value3</span> <span class="o">=</span> <span class="n">values1</span><span class="p">[</span><span class="n">idx_cs</span><span class="p">]</span><span class="o">/</span><span class="n">values2</span><span class="p">[</span><span class="n">idx_cs</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx_cs</span><span class="p">]</span>
            <span class="n">spline_coeff</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">value3</span><span class="p">)</span><span class="o">.</span><span class="n">c</span>
            
            <span class="c1"># K nearest neighbors</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
            <span class="n">iter_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data_set</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">,</span> <span class="n">iter_</span><span class="p">))</span>
            <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">cross_section_unit_mp</span>
            <span class="n">area_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>            
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">cross_section_unit_mp</span><span class="p">,</span> <span class="n">points</span><span class="p">),</span>
                    <span class="n">total</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                    <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="p">(</span>
                        <span class="n">iter_i</span><span class="p">,</span>
                        <span class="n">area</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">result</span>
                    <span class="n">area_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">iter_i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">area</span>

            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">area_list</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>

            <span class="c1"># Fit nearest neighbor model</span>
            <span class="n">nbrs</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
            
            <span class="c1">#print(mean_squared_error(values1, y_pred))</span>
            
            <span class="c1"># save the cross_section_function as pickle</span>
            <span class="n">save_pickle</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="p">[</span><span class="n">nbrs</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">spline_coeff</span><span class="p">,</span><span class="n">x</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nbrs</span> <span class="o">=</span> <span class="n">nbrs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_spline</span> <span class="o">=</span> <span class="n">spline_coeff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sis_area_array</span> <span class="o">=</span> <span class="n">x</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">load_pickle</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interpolated cross section function loaded from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">load_</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nbrs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_spline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sis_area_array</span> <span class="o">=</span> <span class="n">load_</span>

<div class="viewcode-block" id="OpticalDepth.cross_section_epl_shear_interpolation">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.cross_section_epl_shear_interpolation">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_section_epl_shear_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta_E</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the cross-section correction factor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nbrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbrs</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
        
        <span class="n">points_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nbrs</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">points_</span><span class="p">)</span>
        <span class="n">new_values_nn1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">theta_E_correction</span> <span class="o">=</span> <span class="n">cubic_spline_interpolator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">theta_E</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_spline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sis_area_array</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_values_nn1</span><span class="o">*</span><span class="n">theta_E_correction</span></div>


    <span class="c1">##########################</span>
    <span class="c1"># Cosmological functions #</span>
    <span class="c1">##########################</span>
<div class="viewcode-block" id="OpticalDepth.create_lookup_table_fuction">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.create_lookup_table_fuction">[docs]</a>
    <span class="k">def</span> <span class="nf">create_lookup_table_fuction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Functions to create lookup tables</span>
<span class="sd">        1. Redshift to co-moving distance.</span>
<span class="sd">        2. Co-moving distance to redshift.</span>
<span class="sd">        3. Redshift to angular diameter distance.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">z_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">z_min</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">==</span> <span class="mf">0.</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="c1"># for co-moving distance</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;comoving_distance&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">create_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;comoving_distance&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">]</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="n">Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">comoving_distance</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>  <span class="c1"># co-moving distance in Mpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">Dc</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zs</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">z_min</span><span class="o">=</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="n">z_max</span><span class="p">,</span> <span class="n">cosmology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="s2">&quot;comoving_distance from astropy.cosmology&quot;</span><span class="p">),</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;comoving_distance&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;comoving_distance&quot;</span><span class="p">,</span>
            <span class="n">create_new</span><span class="o">=</span><span class="n">create_new</span><span class="p">,</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Redshift to comoving distance conversion.</span>

<span class="s2">        Parameters</span>
<span class="s2">        ----------</span>
<span class="s2">        zs : `numpy.ndarray` or `float`</span>
<span class="s2">            Source redshifts</span>

<span class="s2">        Returns</span>
<span class="s2">        ----------</span>
<span class="s2">        comoving_distance : `numpy.ndarray`</span>
<span class="s2">            comoving distance in Mpc</span>

<span class="s2">        Examples</span>
<span class="s2">        ----------</span>
<span class="s2">        &gt;&gt;&gt; from ler.len_galaxy_population import OpticalDepth</span>
<span class="s2">        &gt;&gt;&gt; ler = OpticalDepth()  # with default LambdaCDM(H0=70, Om0=0.3, Ode0=0.7)</span>
<span class="s2">        &gt;&gt;&gt; comoving_distance = ler.comoving_distance(1.)</span>
<span class="s2">        &gt;&gt;&gt; comoving_distance = ler.comoving_distance.function(np.array([1., 2.]))</span>
<span class="s2">        &gt;&gt;&gt; redshift = ler.comoving_distance.function_inverse(np.array([100., 200.]))</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="c1"># for angular diameter distance</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;angular_diameter_distance&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">create_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;angular_diameter_distance&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">]</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="n">Da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">Da</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zs</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">z_min</span><span class="o">=</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="n">z_max</span><span class="p">,</span> <span class="n">cosmology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="s2">&quot;angular_diameter_distance from astropy.cosmology&quot;</span><span class="p">),</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;angular_diameter_distance&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;angular_diameter_distance&quot;</span><span class="p">,</span>
            <span class="n">create_new</span><span class="o">=</span><span class="n">create_new</span><span class="p">,</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Redshift to angular diameter distance conversion.</span>

<span class="s2">        Parameters</span>
<span class="s2">        ----------</span>
<span class="s2">        zs : `numpy.ndarray` or `float`</span>
<span class="s2">            Source redshifts</span>

<span class="s2">        Returns</span>
<span class="s2">        ----------</span>
<span class="s2">        angular_diameter_distance : `numpy.ndarray`</span>
<span class="s2">            angular diameter distance in Mpc</span>

<span class="s2">        Examples</span>
<span class="s2">        ----------</span>
<span class="s2">        &gt;&gt;&gt; from ler.len_galaxy_population import OpticalDepth</span>
<span class="s2">        &gt;&gt;&gt; ler = OpticalDepth()  # with default LambdaCDM(H0=70, Om0=0.3, Ode0=0.7)</span>
<span class="s2">        &gt;&gt;&gt; angular_diameter_distance = ler.angular_diameter_distance(1.)</span>
<span class="s2">        &gt;&gt;&gt; angular_diameter_distance = ler.angular_diameter_distance.function(np.array([1., 2.]))</span>
<span class="s2">        &gt;&gt;&gt; redshift = ler.angular_diameter_distance.function_inverse(np.array([100., 200.]))</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="c1"># for angular diameter distance between two redshifts</span>
        <span class="n">angular_diameter_distance_z1z2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">zl0</span><span class="p">,</span> <span class="n">zs0</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zs0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zs0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zl0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zl0</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">zs0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance_z1z2</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">z_min</span><span class="o">=</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="n">z_max</span><span class="p">,</span> <span class="n">cosmology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="s2">&quot;angular_diameter_distance_z1z2 from astropy.cosmology&quot;</span><span class="p">),</span>
            <span class="n">create_function</span><span class="o">=</span><span class="n">angular_diameter_distance_z1z2</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance_z1z2</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Redshift to angular diameter distance conversion.</span>

<span class="s2">        Parameters</span>
<span class="s2">        ----------</span>
<span class="s2">        zl0 : `numpy.ndarray` or `float`</span>
<span class="s2">            Lens redshifts</span>
<span class="s2">        zs0 : `numpy.ndarray` or `float`</span>
<span class="s2">            Source redshifts</span>

<span class="s2">        Returns</span>
<span class="s2">        ----------</span>
<span class="s2">        angular_diameter_distance_z1z2 : `numpy.ndarray`</span>
<span class="s2">            angular diameter distance in Mpc</span>

<span class="s2">        Examples</span>
<span class="s2">        ----------</span>
<span class="s2">        &gt;&gt;&gt; from ler.len_galaxy_population import OpticalDepth</span>
<span class="s2">        &gt;&gt;&gt; ler = OpticalDepth()  # with default LambdaCDM(H0=70, Om0=0.3, Ode0=0.7)</span>
<span class="s2">        &gt;&gt;&gt; angular_diameter_distance_z1z2 = ler.angular_diameter_distance_z1z2(1., 2.)</span>
<span class="s2">        &gt;&gt;&gt; angular_diameter_distance_z1z2 = ler.angular_diameter_distance_z1z2.function(np.array([1., 2.]), np.array([1., 2.]))</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="c1"># get differential co-moving volume interpolator</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;differential_comoving_volume&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">create_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;differential_comoving_volume&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">]</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="n">dVcdz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># volume of shell in Mpc^3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">dVcdz</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zs</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">param_dict_given</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">z_min</span><span class="o">=</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="n">z_max</span><span class="p">,</span> <span class="n">cosmology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="s2">&quot;differential_comoving_volume from astropy.cosmology&quot;</span><span class="p">),</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;differential_comoving_volume&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;differential_comoving_volume&quot;</span><span class="p">,</span>
            <span class="n">create_new</span><span class="o">=</span><span class="n">create_new</span><span class="p">,</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Redshift to differential comoving volume conversion.</span>

<span class="s2">        Parameters</span>
<span class="s2">        ----------</span>
<span class="s2">        zs : `numpy.ndarray` or `float`</span>
<span class="s2">            Source redshifts</span>

<span class="s2">        Returns</span>
<span class="s2">        ----------</span>
<span class="s2">        differential_comoving_volume : `numpy.ndarray`</span>
<span class="s2">            differential comoving volume in Mpc^3</span>

<span class="s2">        Examples</span>
<span class="s2">        ----------</span>
<span class="s2">        &gt;&gt;&gt; from ler.len_galaxy_population import OpticalDepth</span>
<span class="s2">        &gt;&gt;&gt; ler = OpticalDepth()  # with default LambdaCDM(H0=70, Om0=0.3, Ode0=0.7)</span>
<span class="s2">        &gt;&gt;&gt; differential_comoving_volume = ler.differential_comoving_volume(1.)</span>
<span class="s2">        &gt;&gt;&gt; differential_comoving_volume = ler.differential_comoving_volume.function(np.array([1., 2.]))</span>
<span class="s2">        &quot;&quot;&quot;</span></div>


    <span class="c1">########################</span>
    <span class="c1"># Attribute properties #</span>
    <span class="c1">########################</span>
    <span class="c1"># @property</span>
    <span class="c1"># def cross_section(self):</span>
    <span class="c1">#     return self._cross_section</span>
    
    <span class="c1"># @cross_section.setter</span>
    <span class="c1"># def cross_section(self, input_function):</span>
    <span class="c1">#     if input_function in self.available_cross_section_list_and_its_params:</span>
    <span class="c1">#         print(f&quot;using ler available cross section function : {input_function}&quot;)</span>
    <span class="c1">#         self._cross_section = getattr(self, input_function)(zs=None, get_attribute=True)</span>
    <span class="c1">#     elif callable(input_function):</span>
    <span class="c1">#         print(f&quot;using user provided custom cross section function&quot;)</span>
    <span class="c1">#         self._cross_section = input_function</span>
    <span class="c1">#     elif isinstance(input_function, object):</span>
    <span class="c1">#         print(f&quot;using user provided custom cross section class/object&quot;)</span>
    <span class="c1">#         self._cross_section = input_function</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         raise ValueError(&quot;input_function not in available_cross_section_list_and_its_params&quot;)</span>


    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.optical_depth">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.optical_depth">[docs]</a>
    <span class="k">def</span> <span class="nf">optical_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the strong lensing optical depth.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zs : `numpy.ndarray` (1D array of floats)</span>
<span class="sd">            source redshifts</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tau : `numpy.ndarray` (1D array of floats)</span>
<span class="sd">            strong lensing optical depth</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; print(od.optical_depth(np.array([0.1,0.2,0.3])))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optical_depth</span></div>


    <span class="nd">@optical_depth</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">optical_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_function</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">input_function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_functions_and_its_params</span><span class="p">[</span><span class="s1">&#39;optical_depth&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available optical depth function : </span><span class="si">{</span><span class="n">input_function</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_optical_depth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_function</span><span class="p">)(</span><span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_optical_depth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_function</span><span class="p">)(</span><span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">input_function</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using user provided custom optical depth function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_optical_depth</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_function</span><span class="o">=</span><span class="n">input_function</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_function</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using user provided custom optical depth class/object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_optical_depth</span> <span class="o">=</span> <span class="n">input_function</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;input_function not in available_lens_functions_and_its_params[&#39;optical_depth&#39;]&quot;</span><span class="p">)</span>
        

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.velocity_dispersion">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.velocity_dispersion">[docs]</a>
    <span class="k">def</span> <span class="nf">velocity_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class object to sample velocity dispersion. `zl` is required only if velocity dispersion sampler is redshift dependent.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of lens parameters to sample</span>
<span class="sd">        zl : `float`</span>
<span class="sd">            redshift of the lens galaxy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sigma : `numpy.ndarray` (1D array of floats)</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; print(od.velocity_dispersion(size=10))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_dispersion</span></div>


    <span class="nd">@velocity_dispersion</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">velocity_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
    
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available velocity dispersion function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">prior</span><span class="o">==</span><span class="s2">&quot;velocity_dispersion_choi&quot;</span><span class="p">:</span>
                <span class="n">prior</span> <span class="o">=</span> <span class="s2">&quot;velocity_dispersion_bernardi&quot;</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_dispersion</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_dispersion</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">prior</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom velocity_dispersion function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_dispersion</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_rvs</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom velocity_dispersion class/object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_dispersion</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;velocity_dispersion prior not in available_lens_prior_list_and_its_params[&#39;velocity_dispersion&#39;]&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.axis_ratio">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_ratio">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to sample axis ratio from rayleigh distribution with given velocity dispersion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sigma : `numpy.ndarray` (1D array of floats)</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : `numpy.ndarray` (1D array of floats)</span>
<span class="sd">            axis ratio of the lens galaxy</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; print(od.axis_ratio(sigma=200.))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_ratio</span></div>


    <span class="nd">@axis_ratio</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">axis_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available axis_ratio function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axis_ratio</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axis_ratio</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">prior</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom axis_ratio function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axis_ratio</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_rvs</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom axis_ratio class/object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axis_ratio</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;prior not in available_lens_prior_list_and_its_params[&#39;axis_ratio&#39;]&quot;</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lens_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift</span>
    
    <span class="nd">@lens_redshift</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">lens_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available lens_redshift function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">prior</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom lens_redshift function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_rvs</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom lens_redshift class/object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;prior not in available_lens_prior_list_and_its_params[&#39;lens_redshift&#39;]&quot;</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axis_rotation_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_rotation_angle</span>
    
    <span class="nd">@axis_rotation_angle</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">axis_rotation_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available axis_rotation_angle function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axis_rotation_angle</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axis_rotation_angle</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">prior</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom axis_rotation_angle function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axis_rotation_angle</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_rvs</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom axis_rotation_angle class/object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axis_rotation_angle</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;prior not in available_lens_prior_list_and_its_params[&#39;axis_rotation_angle&#39;]&quot;</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">external_shear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear</span>
    
    <span class="nd">@external_shear</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">external_shear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available external_shear function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">prior</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom external_shear function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_rvs</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom external_shear class/object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;prior not in available_lens_prior_list_and_its_params[&#39;external_shear&#39;]&quot;</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">external_shear_sl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear_sl</span>
    
    <span class="nd">@external_shear_sl</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">external_shear_sl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;external_shear_sl&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available external_shear_sl function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;external_shear_sl&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear_sl</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear_sl</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">prior</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom external_shear_sl function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear_sl</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_rvs</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom external_shear_sl class/object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear_sl</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;prior not in available_lens_prior_list_and_its_params[&#39;external_shear_sl&#39;]&quot;</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">density_profile_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope</span>
    
    <span class="nd">@density_profile_slope</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">density_profile_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available density_profile_slope function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">prior</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom density_profile_slope function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_rvs</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom density_profile_slope class/object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;prior not in available_lens_prior_list_and_its_params[&#39;density_profile_slope&#39;]&quot;</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">density_profile_slope_sl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope_sl</span>
    
    <span class="nd">@density_profile_slope_sl</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">density_profile_slope_sl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s2">&quot;density_profile_slope_sl&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available density_profile_slope_sl function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;density_profile_slope_sl&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope_sl</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope_sl</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">prior</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom density_profile_slope_sl function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope_sl</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_rvs</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom density_profile_slope_sl class/object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope_sl</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;prior not in available_lens_prior_list_and_its_params[&#39;density_profile_slope_sl&#39;]&quot;</span><span class="p">)</span>
        

    <span class="c1">####################################</span>
    <span class="c1"># Available samplers and functions #</span>
    <span class="c1">####################################</span>
    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.available_lens_prior_list_and_its_params">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.available_lens_prior_list_and_its_params">[docs]</a>
    <span class="k">def</span> <span class="nf">available_lens_prior_list_and_its_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary with list all the available priors and it&#39;s corresponding parameters. This is an immutable instance attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_available_lens_prior_list_and_its_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">source_redshift_sl</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">strongly_lensed_source_redshifts</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">),</span>
            <span class="n">lens_redshift</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">lens_redshift_sis_haris</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lens_redshift_strongly_lensed_numerical</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lens_redshift_strongly_lensed_hemanta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">velocity_dispersion</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">velocity_dispersion_gengamma</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span> <span class="n">phistar</span><span class="o">=</span><span class="mf">2.099e-2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="mf">0.7</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">sigmastar</span><span class="o">=</span><span class="mf">113.78</span>
                <span class="p">),</span>
                <span class="n">velocity_dispersion_choi</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">2.32</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">2.67</span><span class="p">,</span> <span class="n">phistar</span> <span class="o">=</span> <span class="mf">8.0e-3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">sigmastar</span> <span class="o">=</span> <span class="mf">161.0</span>
                <span class="p">),</span>
                <span class="n">velocity_dispersion_bernardi</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span> <span class="n">phistar</span><span class="o">=</span><span class="mf">2.099e-2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="mf">0.7</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">sigmastar</span><span class="o">=</span><span class="mf">113.78</span>
                <span class="p">),</span>
                <span class="n">velocity_dispersion_ewoud</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span> <span class="n">phistar</span><span class="o">=</span><span class="mf">2.099e-2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="mf">0.7</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">sigmastar</span><span class="o">=</span><span class="mf">113.78</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="n">axis_ratio</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">axis_ratio_rayleigh</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">axis_ratio_padilla_strauss</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">axis_ratio_uniform</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">axis_rotation_angle</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">axis_rotation_angle_uniform</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">phi_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_max</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="n">external_shear</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">external_shear_normal</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">external_shear_sl</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">external_shear_normal</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;external_shear_normal_sl&quot;</span><span class="p">),</span>
                <span class="n">external_shear_sl_numerical_hemanta</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">external_shear_normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;external_shear_sl_numerical_hemanta&quot;</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">density_profile_slope</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">density_profile_slope_normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">1.99</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.149</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">density_profile_slope_sl</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">density_profile_slope_normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.091</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.133</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal_sl&quot;</span><span class="p">),</span>
                <span class="n">density_profile_slope_sl_numerical_hemanta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">density_profile_slope_normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">1.99</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.149</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_sl_numerical_hemanta&quot;</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">source_parameters</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">sample_gw_parameters</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_lens_prior_list_and_its_params</span></div>

    
    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.available_lens_functions_and_its_params">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.available_lens_functions_and_its_params">[docs]</a>
    <span class="k">def</span> <span class="nf">available_lens_functions_and_its_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary with list all the available lens functions. This is an immutable instance attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_available_lens_functions_and_its_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">rejection_sampling_with_cross_section_sie_feixu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">rejection_sampling_with_cross_section_sis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">rejection_sampling_with_cross_section</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">optical_depth</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">optical_depth_sis_haris</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">optical_depth_sie_hemanta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">optical_depth_epl_shear_hemanta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">optical_depth_numerical</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">param_sampler_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">sample_all_routine_sie_sl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">sample_all_routine_sis_sl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">sample_all_routine_epl_shear_sl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">cross_section</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">cross_section_sie_feixu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section_sis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section_epl_shear_numerical</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section_epl_shear_interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_lens_functions_and_its_params</span></div>
</div>










</pre>
                            </div>

                        </div>
                    </div>
                    <footer>

                        <hr />

                        <div role="contentinfo">
                            <p>&#169; Copyright 2023, Phurailatpam Hemantakumar.</p>
                        </div>

                        Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
                        <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
                        provided by <a href="https://readthedocs.org">Read the Docs</a>.


                    </footer>
                </div>
            </div>
        </section>
    </div>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>

</html>