

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ler.lens_galaxy_population.optical_depth &mdash; ler 0.4.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/scalefix.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=776609e1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=5bfaad31"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="../../../_static/dark_mode_js/default_light.js?v=c2e647ce"></script>
      <script src="../../../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980b9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ler
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_overview.html">Code overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../GW_events.html">Gravitational wave event rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../GW_equations.html">Gravitational wave events sampling (Analytical formulation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Lensed_events.html">Lensed event rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Lensed_equations.html">Lensed event sampling (Analytical formulation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/rates/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.rates</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/gw_source_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.gw_source_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/lens_galaxy_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.lens_galaxy_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/image_properties/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.image_properties</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.utils</span></code></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980b9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ler.lens_galaxy_population.optical_depth</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ler.lens_galaxy_population.optical_depth</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for optical depth and lens parameter distribution calculations.</span>

<span class="sd">This module provides the ``OpticalDepth`` class for computing strong lensing </span>
<span class="sd">optical depth, cross-section, sampling velocity dispersion, axis ratio, and other lens galaxy </span>
<span class="sd">population parameters. It supports multiple lens models including SIS, SIE, </span>
<span class="sd">and EPL + external shear.</span>

<span class="sd">Key features: \n</span>
<span class="sd">- Optical depth computation for strong gravitational lensing \n</span>
<span class="sd">- Velocity dispersion sampling with multiple models \n</span>
<span class="sd">- Lens redshift distribution sampling \n</span>
<span class="sd">- Cross-section calculations for various lens models \n</span>

<span class="sd">Copyright (C) 2024 Hemantakumar Phurailatpam. Distributed under MIT License.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gengamma</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">CubicSpline</span>
<span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">LambdaCDM</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">cubic_spline_interpolator</span><span class="p">,</span>
    <span class="n">inverse_transform_sampler</span><span class="p">,</span>
    <span class="n">cubic_spline_interpolator2d_array</span><span class="p">,</span>
    <span class="n">save_json</span><span class="p">,</span>
    <span class="n">load_json</span><span class="p">,</span>
    <span class="n">interpolator_json_path</span><span class="p">,</span>
    <span class="n">FunctionConditioning</span><span class="p">,</span>
    <span class="n">inverse_transform_sampler2d</span><span class="p">,</span>
    <span class="n">pdf_cubic_spline_interpolator2d_array</span><span class="p">,</span>
    <span class="n">normal_pdf</span><span class="p">,</span>
    <span class="n">normal_pdf_2d</span><span class="p">,</span>
    <span class="n">comoving_distance</span><span class="p">,</span>
    <span class="n">angular_diameter_distance</span><span class="p">,</span>
    <span class="n">angular_diameter_distance_z1z2</span><span class="p">,</span>
    <span class="n">differential_comoving_volume</span><span class="p">,</span>
    <span class="n">is_njitted</span><span class="p">,</span>
    <span class="n">redshift_optimal_spacing</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.jit_functions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">phi_cut_SIE</span><span class="p">,</span>
    <span class="n">phi</span><span class="p">,</span>
    <span class="n">phi_loc_bernardi</span><span class="p">,</span>
    <span class="n">phi_q2_ellipticity_hemanta</span><span class="p">,</span>
    <span class="n">axis_ratio_rayleigh_pdf</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">_cross_section_mp</span>


<div class="viewcode-block" id="OpticalDepth">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth">[docs]</a>
<span class="k">class</span> <span class="nc">OpticalDepth</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for computing optical depth and lens galaxy population parameters.</span>

<span class="sd">    This class calculates strong lensing optical depth, velocity dispersion, </span>
<span class="sd">    axis ratio, and other parameters for a lens galaxy population. It supports </span>
<span class="sd">    SIS, SIE, and EPL + external shear lens models with customizable samplers </span>
<span class="sd">    and interpolators for efficient computation.</span>

<span class="sd">    Key Features: \n</span>
<span class="sd">    - Multiple lens model support (SIS, SIE, EPL + shear) \n</span>
<span class="sd">    - Configurable velocity dispersion distributions \n</span>
<span class="sd">    - Cached interpolators for fast optical depth computation \n</span>
<span class="sd">    - Flexible parameter sampling with user-defined priors \n</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    npool : ``int``</span>
<span class="sd">        Number of processors for multiprocessing. \n</span>
<span class="sd">        default: 4</span>
<span class="sd">    z_min : ``float``</span>
<span class="sd">        Minimum redshift of the lens galaxy population. \n</span>
<span class="sd">        default: 0.0</span>
<span class="sd">    z_max : ``float``</span>
<span class="sd">        Maximum redshift of the lens galaxy population. \n</span>
<span class="sd">        default: 10.0</span>
<span class="sd">    cosmology : ``astropy.cosmology`` or ``None``</span>
<span class="sd">        Cosmology object for distance calculations. \n</span>
<span class="sd">        default: LambdaCDM(H0=70, Om0=0.3, Ode0=0.7)</span>
<span class="sd">    lens_type : ``str``</span>
<span class="sd">        Type of lens galaxy model. \n</span>
<span class="sd">        Options: \n</span>
<span class="sd">        - &#39;epl_shear_galaxy&#39;: Elliptical power-law with external shear \n</span>
<span class="sd">        - &#39;sie_galaxy&#39;: Singular isothermal ellipsoid \n</span>
<span class="sd">        - &#39;sis_galaxy&#39;: Singular isothermal sphere \n</span>
<span class="sd">        default: &#39;epl_shear_galaxy&#39;</span>
<span class="sd">    lens_functions : ``dict`` or ``None``</span>
<span class="sd">        Dictionary with lens-related functions. \n</span>
<span class="sd">        default: None (uses defaults for lens_type)</span>
<span class="sd">    lens_functions_params : ``dict`` or ``None``</span>
<span class="sd">        Dictionary with parameters for lens-related functions. \n</span>
<span class="sd">        default: None</span>
<span class="sd">    lens_param_samplers : ``dict`` or ``None``</span>
<span class="sd">        Dictionary of sampler functions for lens parameters. \n</span>
<span class="sd">        default: None (uses defaults for lens_type)</span>
<span class="sd">    lens_param_samplers_params : ``dict`` or ``None``</span>
<span class="sd">        Dictionary with parameters for the samplers. \n</span>
<span class="sd">        default: None</span>
<span class="sd">    directory : ``str``</span>
<span class="sd">        Directory where interpolators are saved. \n</span>
<span class="sd">        default: &#39;./interpolator_json&#39;</span>
<span class="sd">    create_new_interpolator : ``bool`` or ``dict``</span>
<span class="sd">        Whether to create new interpolators. \n</span>
<span class="sd">        default: False</span>
<span class="sd">    verbose : ``bool``</span>
<span class="sd">        If True, prints additional information. \n</span>
<span class="sd">        default: False</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Basic usage:</span>

<span class="sd">    &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">    &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">    &gt;&gt;&gt; tau = od.optical_depth(zs=np.array([1.0, 2.0]))</span>


<span class="sd">    Instance Methods</span>
<span class="sd">    ----------</span>
<span class="sd">    OpticalDepth has the following instance methods: \n</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | Method                                              | Description                                              |</span>
<span class="sd">    +=====================================================+==========================================================+</span>
<span class="sd">    | :meth:`~axis_ratio_rayleigh`                        | Sample axis ratio from Rayleigh distribution             |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~axis_ratio_padilla_strauss`                 | Sample axis ratio from Padilla &amp; Strauss 2008            |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~axis_ratio_uniform`                         | Sample axis ratio from uniform distribution              |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~axis_rotation_angle_uniform`                | Sample axis rotation angle from uniform distribution     |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~lens_redshift_strongly_lensed_numerical`    | Sample lens redshift for strong lensing                  |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~lens_redshift_sis_haris`                    | Sample SIS lens redshift (Haris et al. 2018)             |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~velocity_dispersion_gengamma`               | Sample velocity dispersion from gengamma distribution    |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~velocity_dispersion_bernardi`               | Sample velocity dispersion (Bernardi et al. 2010)        |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~velocity_dispersion_ewoud`                  | Sample redshift-dependent velocity dispersion            |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~external_shear_normal`                      | Sample external shear from normal distribution           |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~density_profile_slope_normal`               | Sample density profile slope from normal distribution    |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~optical_depth_sis_analytic`                    | Compute SIS optical depth (Haris et al. 2018)            |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~cross_section_sis`                          | Compute SIS cross-section                                |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~cross_section_sie_feixu`                    | Compute SIE cross-section (Fei Xu et al. 2021)           |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~cross_section_epl_shear_numerical`          | Compute EPL+shear cross-section numerically              |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>
<span class="sd">    | :meth:`~cross_section_epl_shear_interpolation`      | Compute EPL+shear cross-section via interpolation        |</span>
<span class="sd">    +-----------------------------------------------------+----------------------------------------------------------+</span>

<span class="sd">    Instance Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    OpticalDepth has the following instance attributes: \n</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | Attribute                                      | Type                         | Unit  | Description                                              |</span>
<span class="sd">    +================================================+==============================+=======+==========================================================+</span>
<span class="sd">    | :attr:`~npool`                                 | ``int``                      |       | Number of processors for multiprocessing                 |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~z_min`                                 | ``float``                    |       | Minimum redshift                                         |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~z_max`                                 | ``float``                    |       | Maximum redshift                                         |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~cosmo`                                 | ``astropy.cosmology``        |       | Cosmology object                                         |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~lens_type`                             | ``str``                      |       | Type of lens galaxy model                                |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~directory`                             | ``str``                      |       | Directory for interpolator storage                       |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~optical_depth`                         | ``FunctionConditioning``     |       | Optical depth calculator                                 |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~velocity_dispersion`                   | ``FunctionConditioning``     | km/s  | Velocity dispersion sampler                              |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~axis_ratio`                            | ``FunctionConditioning``     |       | Axis ratio sampler                                       |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~axis_rotation_angle`                   | ``FunctionConditioning``     | rad   | Axis rotation angle sampler                              |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~lens_redshift`                         | ``FunctionConditioning``     |       | Lens redshift sampler                                    |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~external_shear`                        | ``FunctionConditioning``     |       | External shear sampler                                   |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~density_profile_slope`                 | ``FunctionConditioning``     |       | Density profile slope sampler                            |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~cross_section`                         | ``callable``                 | radÂ²  | Cross-section calculator                                 |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~available_lens_samplers`               | ``dict``                     |       | Available lens parameter samplers                        |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    | :attr:`~available_lens_functions`              | ``dict``                     |       | Available lens functions                                 |</span>
<span class="sd">    +------------------------------------------------+------------------------------+-------+----------------------------------------------------------+</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">npool</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">z_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">z_max</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
        <span class="n">cosmology</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lens_type</span><span class="o">=</span><span class="s2">&quot;epl_shear_galaxy&quot;</span><span class="p">,</span>
        <span class="n">lens_functions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lens_functions_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lens_param_samplers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lens_param_samplers_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;./interpolator_json&quot;</span><span class="p">,</span>
        <span class="n">create_new_interpolator</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
    
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Initializing OpticalDepth class</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lens_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sie_galaxy&quot;</span><span class="p">,</span> <span class="s2">&quot;epl_shear_galaxy&quot;</span><span class="p">,</span> <span class="s2">&quot;sis_galaxy&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;lens_type not in [&#39;sie_galaxy&#39;, &#39;epl_shear_galaxy&#39;, &#39;sis_galaxy&#39;]&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lens_type</span> <span class="o">=</span> <span class="n">lens_type</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">npool</span> <span class="o">=</span> <span class="n">npool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="n">z_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">z_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span> <span class="o">=</span> <span class="n">cosmology</span> <span class="k">if</span> <span class="n">cosmology</span> <span class="k">else</span> <span class="n">LambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Ode0</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

        <span class="c1"># Initialize decision dictionary for creating interpolators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_decision_dictionary</span><span class="p">(</span><span class="n">create_new_interpolator</span><span class="p">,</span> <span class="n">lens_type</span><span class="p">)</span>
        <span class="c1"># Set default lens functions and samplers</span>
        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_lens_samplers_and_functions</span><span class="p">(</span><span class="n">lens_type</span><span class="p">)</span>

        <span class="c1"># Update lens functions and samplers with user input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lens_functions_and_sampler_categorization</span><span class="p">(</span>
            <span class="n">lens_param_samplers</span><span class="p">,</span>
            <span class="n">lens_param_samplers_params</span><span class="p">,</span>
            <span class="n">lens_functions</span><span class="p">,</span>
            <span class="n">lens_functions_params</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Initialize cosmological functions</span>
<div class="viewcode-block" id="OpticalDepth.comoving_distance">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.comoving_distance">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span> <span class="o">=</span> <span class="n">comoving_distance</span><span class="p">(</span><span class="n">z_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;comoving_distance&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;comoving_distance&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpticalDepth.angular_diameter_distance">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.angular_diameter_distance">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span> <span class="o">=</span> <span class="n">angular_diameter_distance</span><span class="p">(</span><span class="n">z_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;angular_diameter_distance&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;angular_diameter_distance&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpticalDepth.angular_diameter_distance_z1z2">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.angular_diameter_distance_z1z2">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance_z1z2</span> <span class="o">=</span> <span class="n">angular_diameter_distance_z1z2</span><span class="p">(</span><span class="n">z_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;angular_diameter_distance_z1z2&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;angular_diameter_distance_z1z2&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpticalDepth.differential_comoving_volume">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.differential_comoving_volume">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span> <span class="o">=</span> <span class="n">differential_comoving_volume</span><span class="p">(</span><span class="n">z_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;differential_comoving_volume&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;differential_comoving_volume&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


        <span class="c1"># lens sampler initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis_rotation_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density_profile_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]</span>

        <span class="c1"># cross section initialization </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">]</span>
        
        <span class="c1"># lens redshift initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lens_redshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">]</span>
<div class="viewcode-block" id="OpticalDepth.lens_redshift_intrinsic">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_redshift_intrinsic">[docs]</a>
        <span class="bp">self</span><span class="o">.</span><span class="n">lens_redshift_intrinsic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_redshift_intrinsic</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span></div>

        <span class="c1"># lens parameter initialization </span>
        <span class="c1"># density profile slope initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">density_profile_slope_sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span>
            <span class="s2">&quot;density_profile_slope_sl&quot;</span>
        <span class="p">]</span>
        <span class="c1"># external shear initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">external_shear_sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;external_shear_sl&quot;</span><span class="p">]</span>
        <span class="c1"># lens function initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optical_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">]</span>


    <span class="c1">#--------------------</span>
    <span class="c1"># Initialization helpers</span>
    <span class="c1">#--------------------</span>
    <span class="k">def</span> <span class="nf">_default_lens_samplers_and_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lens_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to get default lens samplers and functions based on lens type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lens_type : ``str``</span>
<span class="sd">            Type of lens galaxy model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lens_param_samplers : ``dict``</span>
<span class="sd">            Dictionary of sampler names.</span>
<span class="sd">        lens_param_samplers_params : ``dict``</span>
<span class="sd">            Dictionary of sampler parameters.</span>
<span class="sd">        lens_functions : ``dict``</span>
<span class="sd">            Dictionary of lens function names.</span>
<span class="sd">        lens_functions_params : ``dict``</span>
<span class="sd">            Dictionary of lens function parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">lens_type</span> <span class="o">==</span> <span class="s2">&quot;epl_shear_galaxy&quot;</span><span class="p">:</span>
            <span class="n">lens_param_samplers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="s2">&quot;strongly_lensed_source_redshifts&quot;</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="s2">&quot;lens_redshift_strongly_lensed_numerical&quot;</span><span class="p">,</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion_ewoud&quot;</span><span class="p">,</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="s2">&quot;axis_ratio_rayleigh&quot;</span><span class="p">,</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="s2">&quot;axis_rotation_angle_uniform&quot;</span><span class="p">,</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_param_samplers_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">integration_size</span><span class="o">=</span><span class="mi">20000</span><span class="p">),</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                    <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span>
                    <span class="n">beta</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span>
                    <span class="n">phistar</span><span class="o">=</span><span class="mf">2.099e-2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span> <span class="o">/</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="n">sigmastar</span><span class="o">=</span><span class="mf">113.78</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">phi_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_max</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">1.99</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.149</span><span class="p">),</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.078</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.16</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">lens_functions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="s2">&quot;_sample_all_routine_epl_shear_sl&quot;</span><span class="p">,</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="s2">&quot;importance_sampling_with_cross_section&quot;</span><span class="p">,</span>
                <span class="c1"># cross_section_based_sampler=&quot;rejection_sampling_with_cross_section&quot;,</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="s2">&quot;optical_depth_numerical&quot;</span><span class="p">,</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;cross_section_epl_shear_interpolation&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_functions_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">n_prop</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span>
                <span class="c1"># cross_section_based_sampler=dict(safety_factor=1.2),</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">lens_type</span> <span class="o">==</span> <span class="s2">&quot;sie_galaxy&quot;</span><span class="p">:</span>
            <span class="n">lens_param_samplers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="s2">&quot;strongly_lensed_source_redshifts&quot;</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="s2">&quot;lens_redshift_strongly_lensed_numerical&quot;</span><span class="p">,</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion_ewoud&quot;</span><span class="p">,</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="s2">&quot;axis_ratio_rayleigh&quot;</span><span class="p">,</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="s2">&quot;axis_rotation_angle_uniform&quot;</span><span class="p">,</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_param_samplers_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">integration_size</span><span class="o">=</span><span class="mi">20000</span><span class="p">),</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                    <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span>
                    <span class="n">beta</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span>
                    <span class="n">phistar</span><span class="o">=</span><span class="mf">2.099e-2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span> <span class="o">/</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="n">sigmastar</span><span class="o">=</span><span class="mf">113.78</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">phi_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_max</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">lens_functions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="s2">&quot;_sample_all_routine_epl_shear_sl&quot;</span><span class="p">,</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="s2">&quot;importance_sampling_with_cross_section&quot;</span><span class="p">,</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="s2">&quot;optical_depth_numerical&quot;</span><span class="p">,</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;cross_section_sie_feixu&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_functions_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">n_prop</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">interpolated_cross_section</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">lens_type</span> <span class="o">==</span> <span class="s2">&quot;sis_galaxy&quot;</span><span class="p">:</span>
            <span class="n">lens_param_samplers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="s2">&quot;strongly_lensed_source_redshifts&quot;</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="s2">&quot;lens_redshift_sis_haris&quot;</span><span class="p">,</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion_choi&quot;</span><span class="p">,</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="s2">&quot;axis_ratio_uniform&quot;</span><span class="p">,</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="s2">&quot;axis_rotation_angle_uniform&quot;</span><span class="p">,</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="s2">&quot;external_shear_normal&quot;</span><span class="p">,</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_param_samplers_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">source_redshift_sl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lens_redshift</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">integration_size</span><span class="o">=</span><span class="mi">20000</span><span class="p">),</span>
                <span class="n">velocity_dispersion</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                    <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">2.32</span><span class="p">,</span>
                    <span class="n">beta</span><span class="o">=</span><span class="mf">2.67</span><span class="p">,</span>
                    <span class="n">phistar</span><span class="o">=</span><span class="mf">8.0e-3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">sigmastar</span><span class="o">=</span><span class="mf">161.0</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">axis_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">phi_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_max</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
                <span class="n">external_shear</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
                <span class="n">density_profile_slope</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
                <span class="n">external_shear_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
                <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">lens_functions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="s2">&quot;_sample_all_routine_epl_shear_sl&quot;</span><span class="p">,</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="s2">&quot;importance_sampling_with_cross_section&quot;</span><span class="p">,</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="s2">&quot;optical_depth_sis_analytic&quot;</span><span class="p">,</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="s2">&quot;cross_section_sis&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">lens_functions_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">param_sampler_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">n_prop</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span>
                <span class="n">optical_depth</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">interpolated_cross_section</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;lens_type should be &#39;epl_shear_galaxy&#39; or &#39;sie_galaxy&#39; or &#39;sis_galaxy&#39;&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">lens_param_samplers</span><span class="p">,</span>
            <span class="n">lens_param_samplers_params</span><span class="p">,</span>
            <span class="n">lens_functions</span><span class="p">,</span>
            <span class="n">lens_functions_params</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initialize_decision_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">create_new_interpolator</span><span class="p">,</span> <span class="n">lens_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to initialize decision dictionary for creating interpolators.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        create_new_interpolator : ``dict`` or ``bool``</span>
<span class="sd">            Configuration for creating new interpolators.</span>
<span class="sd">        lens_type : ``str``</span>
<span class="sd">            Type of lens galaxy model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialize the interpolator&#39;s parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">velocity_dispersion</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">zl_resolution</span><span class="o">=</span><span class="mi">48</span><span class="p">),</span>
            <span class="n">axis_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">sigma_resolution</span><span class="o">=</span><span class="mi">48</span><span class="p">),</span>
            <span class="n">lens_redshift</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">zl_resolution</span><span class="o">=</span><span class="mi">48</span><span class="p">),</span>
            <span class="n">lens_redshift_intrinsic</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
            <span class="n">optical_depth</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">48</span><span class="p">),</span>
            <span class="n">comoving_distance</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
            <span class="n">angular_diameter_distance</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
            <span class="n">angular_diameter_distance_z1z2</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
            <span class="n">differential_comoving_volume</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
            <span class="n">density_profile_slope</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
            <span class="n">lens_parameters_kde_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">5000</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">lens_type</span> <span class="o">==</span> <span class="s2">&quot;sis_galaxy&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">lens_type</span> <span class="o">==</span> <span class="s2">&quot;sie_galaxy&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">lens_type</span> <span class="o">==</span> <span class="s2">&quot;epl_shear_galaxy&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">cross_section</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">create_new</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">]),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">create_new_interpolator</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">create_new_interpolator</span><span class="p">)</span>
        <span class="c1"># if create_new_interpolator is True, create new interpolator for all</span>
        <span class="k">elif</span> <span class="n">create_new_interpolator</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_lens_functions_and_sampler_categorization</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lens_param_samplers</span><span class="p">,</span>
        <span class="n">lens_param_samplers_params</span><span class="p">,</span>
        <span class="n">lens_functions</span><span class="p">,</span>
        <span class="n">lens_functions_params</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to categorize and update lens functions and samplers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lens_param_samplers : ``dict`` or ``None``</span>
<span class="sd">            User-provided sampler names or functions.</span>
<span class="sd">        lens_param_samplers_params : ``dict`` or ``None``</span>
<span class="sd">            User-provided sampler parameters.</span>
<span class="sd">        lens_functions : ``dict`` or ``None``</span>
<span class="sd">            User-provided lens function names or functions.</span>
<span class="sd">        lens_functions_params : ``dict`` or ``None``</span>
<span class="sd">            User-provided lens function parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># update the priors if input is given</span>
        <span class="k">if</span> <span class="n">lens_param_samplers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_param_samplers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lens_param_samplers_params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_param_samplers_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lens_functions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_functions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lens_functions_params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_functions_params</span><span class="p">)</span>

        <span class="n">sampler_prior_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;lens_redshift&quot;</span><span class="p">,</span>
            <span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis_ratio&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;external_shear&quot;</span><span class="p">,</span>
            <span class="s2">&quot;density_profile_slope&quot;</span><span class="p">,</span>
            <span class="s2">&quot;external_shear_sl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;density_profile_slope_sl&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># if there is user input sampler prior params</span>
        <span class="c1"># you can&#39;t only give lens_param_samplers_params, you have to give lens_param_samplers as well if you want to update the sampler priors</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sampler_prior_names</span><span class="p">:</span>  <span class="c1"># e.g. name=&#39;axis_ratio&#39;</span>
            <span class="c1"># avoid None</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lens_param_samplers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">lens_param_samplers</span><span class="p">):</span>
                <span class="c1"># if there is user input function name, update the sampler priors</span>
                <span class="n">sampler_name</span> <span class="o">=</span> <span class="n">lens_param_samplers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>  <span class="c1"># e.g. &#39;axis_ratio_rayleigh&#39;</span>
                <span class="c1"># check input sampler is string or function</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sampler_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># available lens samplers for name e.g. &#39;axis_ratio&#39;</span>
                    <span class="n">dict_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span>
                        <span class="n">name</span>
                    <span class="p">]</span>  <span class="c1"># e.g. {&#39;axis_ratio_padilla_strauss&#39;: {&#39;q_min&#39;: 0.2, &#39;q_max&#39;: 1.0}, ....}</span>
                    <span class="k">if</span> <span class="n">sampler_name</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">:</span>  <span class="c1"># e.g. &#39;axis_ratio_padilla_strauss&#39;</span>
                        <span class="n">param_dict</span> <span class="o">=</span> <span class="n">dict_</span><span class="p">[</span>
                            <span class="n">sampler_name</span>
                        <span class="p">]</span>  <span class="c1"># e.g. {&#39;q_min&#39;: 0.2, &#39;q_max&#39;: 1.0}</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">lens_param_samplers_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                            <span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                        <span class="p">):</span>  <span class="c1"># not a dictionary</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span>
                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if there is user input lens_param_samplers_params</span>
                            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                                <span class="n">param_dict</span>
                            <span class="p">)</span>  <span class="c1"># user inputs will override the default values</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> sampler </span><span class="si">{</span><span class="n">sampler_name</span><span class="si">}</span><span class="s2"> not available.</span><span class="se">\n</span><span class="s2"> Available </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> samplers and its parameters are: </span><span class="si">{</span><span class="n">dict_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="n">name</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Given </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> sampler should be either a string name of available sampler or a function&quot;</span>
                    <span class="p">)</span>

        <span class="n">lens_function_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">,</span> <span class="s2">&quot;cross_section&quot;</span><span class="p">]</span>

        <span class="c1"># if there is user input function, update the sampler priors</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lens_function_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lens_functions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">lens_functions</span><span class="p">):</span>
                <span class="n">function_name</span> <span class="o">=</span> <span class="n">lens_functions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># available lens functions for name e.g. &#39;optical_depth&#39;</span>
                    <span class="n">dict_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_functions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="n">dict_</span><span class="p">:</span>
                        <span class="n">param_dict</span> <span class="o">=</span> <span class="n">dict_</span><span class="p">[</span><span class="n">function_name</span><span class="p">]</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">lens_functions_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                            <span class="n">lens_functions_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                        <span class="p">):</span>  <span class="c1"># not a dictionary</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span>
                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if there is user input lens_functions_params</span>
                            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                                <span class="n">param_dict</span>
                            <span class="p">)</span>  <span class="c1"># user inputs will override the default values</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> function </span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s2"> not available.</span><span class="se">\n</span><span class="s2"> Available </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> functions and its parameters are: </span><span class="si">{</span><span class="n">dict_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">lens_functions</span><span class="p">[</span><span class="n">name</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Given </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> function should be either a string name of available function or a function&quot;</span>
                    <span class="p">)</span>

    <span class="c1">#--------------------</span>
    <span class="c1"># Sampler functions </span>
    <span class="c1">#--------------------</span>
<div class="viewcode-block" id="OpticalDepth.axis_ratio_rayleigh">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_ratio_rayleigh">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_ratio_rayleigh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample axis ratio from Rayleigh distribution conditioned on velocity dispersion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate.</span>
<span class="sd">        sigma : ``numpy.ndarray``</span>
<span class="sd">            Velocity dispersion of the lens galaxy (km/s).</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters (q_min, q_max).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Axis ratio samples or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(axis_ratio=&quot;axis_ratio_rayleigh&quot;))</span>
<span class="sd">        &gt;&gt;&gt; q = od.axis_ratio(size=100, sigma=np.ones(100)*200.)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;axis_ratio_rayleigh&quot;</span><span class="p">}</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>  <span class="c1"># if velocity_dispersion is not None</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span>
            <span class="s2">&quot;resolution&quot;</span>
        <span class="p">]</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;sigma_resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span>
            <span class="s2">&quot;sigma_resolution&quot;</span>
        <span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span>
            <span class="s2">&quot;axis_ratio_rayleigh&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">q_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">sigma_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;sigma_min&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;sigma_max&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;sigma_resolution&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">q_pdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="n">axis_ratio_rayleigh_pdf</span><span class="p">(</span>  <span class="c1"># noqa: E731</span>
            <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span>
            <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
            <span class="n">q_min</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">],</span>
            <span class="n">q_max</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">q_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">q_pdf</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">q_array</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="n">sigma_array</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;axis_ratio_rayleigh&quot;</span><span class="p">,</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">q_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">q_object</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.axis_ratio_padilla_strauss">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_ratio_padilla_strauss">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_ratio_padilla_strauss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample axis ratio from Padilla &amp; Strauss (2008) distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate. \n</span>
<span class="sd">            default: 1000</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters (q_min, q_max).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Axis ratio samples or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(axis_ratio=&quot;axis_ratio_padilla_strauss&quot;))</span>
<span class="sd">        &gt;&gt;&gt; q = od.axis_ratio(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;axis_ratio_padilla_strauss&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span>
            <span class="s2">&quot;resolution&quot;</span>
        <span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span>
            <span class="s2">&quot;axis_ratio_padilla_strauss&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="c1"># Using Padilla and Strauss 2008 distribution for axis ratio</span>
        <span class="n">q_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="mf">0.04903276402927845</span><span class="p">,</span> <span class="mf">0.09210526315789469</span><span class="p">,</span> <span class="mf">0.13596491228070173</span><span class="p">,</span> <span class="mf">0.20789473684210524</span><span class="p">,</span> <span class="mf">0.2899703729522482</span><span class="p">,</span> <span class="mf">0.3230132450331126</span><span class="p">,</span> <span class="mf">0.35350877192982455</span><span class="p">,</span> <span class="mf">0.37946148483792264</span><span class="p">,</span> <span class="mf">0.4219298245614036</span><span class="p">,</span> <span class="mf">0.4689525967235971</span><span class="p">,</span> <span class="mf">0.5075026141512723</span><span class="p">,</span> <span class="mf">0.5226472638550018</span><span class="p">,</span> <span class="mf">0.5640350877192983</span><span class="p">,</span> <span class="mf">0.6096491228070177</span><span class="p">,</span> <span class="mf">0.6500000000000001</span><span class="p">,</span> <span class="mf">0.6864848379226213</span><span class="p">,</span> <span class="mf">0.7377192982456142</span><span class="p">,</span> <span class="mf">0.7787295224817011</span><span class="p">,</span> <span class="mf">0.8007581038689441</span><span class="p">,</span> <span class="mf">0.822786685256187</span><span class="p">,</span> <span class="mf">0.8668438480306729</span><span class="p">,</span> <span class="mf">0.8973684210526317</span><span class="p">,</span> <span class="mf">0.9254385964912283</span><span class="p">,]</span>
        <span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="mf">0.04185262687135349</span><span class="p">,</span> <span class="mf">0.06114520695141845</span><span class="p">,</span> <span class="mf">0.096997499638376</span><span class="p">,</span> <span class="mf">0.1932510900336828</span><span class="p">,</span> <span class="mf">0.39547914337673706</span><span class="p">,</span> <span class="mf">0.49569751276216234</span><span class="p">,</span> <span class="mf">0.6154609137685201</span><span class="p">,</span> <span class="mf">0.7182049959882812</span><span class="p">,</span> <span class="mf">0.920153741243567</span><span class="p">,</span> <span class="mf">1.1573982157399754</span><span class="p">,</span> <span class="mf">1.3353263628106684</span><span class="p">,</span> <span class="mf">1.413149656448315</span><span class="p">,</span> <span class="mf">1.5790713532948977</span><span class="p">,</span> <span class="mf">1.7280185150744938</span><span class="p">,</span> <span class="mf">1.8132994441344819</span><span class="p">,</span> <span class="mf">1.8365803753840484</span><span class="p">,</span> <span class="mf">1.8178662203211204</span><span class="p">,</span> <span class="mf">1.748929843583365</span><span class="p">,</span> <span class="mf">1.688182592496342</span><span class="p">,</span> <span class="mf">1.6274353414093188</span><span class="p">,</span> <span class="mf">1.4948487090314488</span><span class="p">,</span> <span class="mf">1.402785526832393</span><span class="p">,</span> <span class="mf">1.321844068356993</span><span class="p">,]</span>
        <span class="p">)</span>

        <span class="n">q_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">pdf</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">q_array</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;axis_ratio_padilla_strauss&quot;</span><span class="p">,</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">q_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">q_object</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.lens_redshift_strongly_lensed_numerical">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_redshift_strongly_lensed_numerical">[docs]</a>
    <span class="k">def</span> <span class="nf">lens_redshift_strongly_lensed_numerical</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample lens redshifts conditioned on strong lensing (numerical method).</span>

<span class="sd">        This method computes the lens redshift distribution by numerically</span>
<span class="sd">        integrating over the velocity dispersion distribution (galaxy density distribution wrt), cross-section and differential comoving volume.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate. \\n</span>
<span class="sd">            default: 1000</span>
<span class="sd">        zs : ``numpy.ndarray``</span>
<span class="sd">            Source redshifts.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \\n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        zl : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Lens redshift samples or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; zl = od.lens_redshift(size=100, zs=np.ones(100)*2.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;lens_redshift_strongly_lensed_numerical_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_type</span>
        <span class="p">)</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span>
            <span class="s2">&quot;resolution&quot;</span>
        <span class="p">]</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;zl_resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span>
            <span class="s2">&quot;zl_resolution&quot;</span>
        <span class="p">]</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;integration_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span>
            <span class="s2">&quot;lens_redshift&quot;</span>
        <span class="p">][</span><span class="s2">&quot;integration_size&quot;</span><span class="p">]</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cosmology&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>

        <span class="n">name_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;z_min&quot;</span><span class="p">,</span>
            <span class="s2">&quot;z_max&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cosmology&quot;</span><span class="p">,</span>
            <span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis_ratio&quot;</span><span class="p">,</span>
            <span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;density_profile_slope&quot;</span><span class="p">,</span>
            <span class="s2">&quot;external_shear&quot;</span><span class="p">,</span>
            <span class="c1"># &quot;resolution&quot;,</span>
        <span class="p">]</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_list</span><span class="p">:</span>
                    <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>  <span class="c1"># if velocity_dispersion is not None</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_list</span><span class="p">:</span>
                    <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if axis_ratio is not None</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_list</span><span class="p">:</span>
                    <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis_rotation_angle</span><span class="o">.</span><span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>  <span class="c1"># if axis_rotation_angle is not None</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_rotation_angle</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_list</span><span class="p">:</span>
                    <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">density_profile_slope</span><span class="o">.</span><span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>  <span class="c1"># if density_profile_slope is not None</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_profile_slope</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_list</span><span class="p">:</span>
                    <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span><span class="o">.</span><span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if external_shear is not None</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_list</span><span class="p">:</span>
                    <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span>
            <span class="s2">&quot;lens_redshift_strongly_lensed_numerical&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numerically solving the lens redshift distribution...&quot;</span><span class="p">)</span>
        <span class="n">zs_resolution</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">zs_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">+</span> <span class="mf">0.001</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">zs_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">zs_array</span> <span class="o">=</span> <span class="n">redshift_optimal_spacing</span><span class="p">(</span><span class="n">zs_min</span><span class="p">,</span> <span class="n">zs_max</span><span class="p">,</span> <span class="n">zs_resolution</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">it_exist</span> <span class="o">=</span> <span class="n">interpolator_json_path</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">,</span>
            <span class="n">interpolator_name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># zl dependent velocity dispersion distribution</span>
        <span class="n">zl_scaled</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">zl_min</span> <span class="o">=</span> <span class="mf">0.0001</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">zs_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zs_array</span><span class="p">):</span>
            <span class="n">zl_resolution</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;zl_resolution&quot;</span><span class="p">]</span>
            <span class="n">buffer_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zl_min</span><span class="p">,</span> <span class="n">zs_</span> <span class="o">-</span> <span class="n">zl_min</span><span class="p">,</span> <span class="n">zl_resolution</span><span class="p">)</span>
            <span class="n">zl_scaled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buffer_</span> <span class="o">/</span> <span class="n">zs_</span><span class="p">)</span>
        <span class="n">zl_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zl_scaled</span><span class="p">)</span>

        <span class="n">create_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">it_exist</span> <span class="ow">or</span> <span class="n">create_new</span><span class="p">:</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_helper_number_density_calculation</span><span class="p">(</span><span class="n">zl_scaled</span><span class="p">,</span> <span class="n">zs_array</span><span class="p">)</span>
            <span class="c1"># number density is zero for zl=0 and infinite for zl=zs</span>
            <span class="c1"># Adding zero at the first element of each row</span>
            <span class="n">zl_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">zl_scaled</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">zl_scaled</span><span class="p">))</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_density</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">number_density</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># Adding one at the last element of each row of zl_scaled</span>
            <span class="n">zl_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">zl_scaled</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">zl_scaled</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>
            <span class="c1"># Adding zero at the last element of each row of density</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                <span class="p">(</span><span class="n">number_density</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_density</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if it_exist, it will use the saved interpolator</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">zl_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">number_density</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zl_scaled</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="n">zs_array</span><span class="p">,</span>
            <span class="n">non_zero_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="n">create_new</span><span class="p">,</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># un-scaled lens redshift</span>
        <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">cdf_values</span>
        <span class="n">x_array</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">x_array</span>
        <span class="n">y_array</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">conditioned_y_array</span>
        <span class="n">function_spline</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">function_spline</span>
        <span class="n">pdf_norm_const</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf_norm_const</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">cubic_spline_interpolator2d_array</span><span class="p">(</span>
                <span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">function_spline</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pdf_cubic_spline_interpolator2d_array</span><span class="p">(</span>
                <span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pdf_norm_const</span><span class="p">,</span> <span class="n">function_spline</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="n">y</span>
        <span class="p">)</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">size</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">inverse_transform_sampler2d</span><span class="p">(</span>
                <span class="n">size</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cdf_values</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="n">y</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">zl_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">zl_object</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_helper_number_density_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zl_scaled</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to compute lens redshift distribution using njitted functions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zl_scaled : ``numpy.ndarray``</span>
<span class="sd">            2D array of lens redshifts scaled by source redshift.</span>
<span class="sd">        zs : ``numpy.ndarray``</span>
<span class="sd">            1D array of source redshifts.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        density_array : ``numpy.ndarray``</span>
<span class="sd">            2D array of the lens redshift distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check if the function can be JIT compiled</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking if the function can be JIT compiled&quot;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">use_njit_sampler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift_multithreaded_njit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zl_scaled</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>

        <span class="n">cross_section_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cross_section_epl_shear_interpolation&#39;</span><span class="p">,</span> <span class="s1">&#39;cross_section_sie_feixu&#39;</span><span class="p">,</span> <span class="s1">&#39;cross_section_sis&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">use_njit_sampler</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s1">&#39;cross_section&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cross_section_list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using multithreaded njit&quot;</span><span class="p">)</span>
            <span class="n">density_array</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift_multithreaded_njit</span><span class="p">(</span><span class="n">zl_scaled</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">use_njit_sampler</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s1">&#39;cross_section&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;cross_section_epl_shear_numerical&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using multiprocessing&quot;</span><span class="p">)</span>
            <span class="n">density_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift_multiprocessing</span><span class="p">(</span><span class="n">zl_scaled</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">use_njit_sampler</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;one of the lens parameter sampler is not njitted&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cross section function not supported&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">density_array</span>

    <span class="k">def</span> <span class="nf">_lens_redshift_multithreaded_njit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zl_scaled</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>

        <span class="c1"># Get random variable samplers from the initialized objects</span>
        <span class="n">sigma_rvs_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">rvs</span>
        <span class="n">q_rvs_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">rvs</span>
        <span class="n">phi_rvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_rotation_angle</span><span class="o">.</span><span class="n">rvs</span>
        <span class="n">gamma_rvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_profile_slope</span><span class="o">.</span><span class="n">rvs</span>
        <span class="n">shear_rvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span><span class="o">.</span><span class="n">rvs</span>

        <span class="n">number_density_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">function</span>

        <span class="n">cross_section_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span>
        <span class="c1"># check the number of inputs for cross_section function</span>
        <span class="c1"># and JIT compile the wrapper function if necessary</span>
        <span class="k">if</span> <span class="n">cross_section_</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">cross_section</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">zs</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">:</span> <span class="n">cross_section_</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">cross_section_</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">cross_section</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">zs</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">:</span> <span class="n">cross_section_</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cross_section</span> <span class="o">=</span> <span class="n">cross_section_</span>
        
        <span class="c1"># JIT compile the random variable samplers and PDFs if they are not already JIT compiled</span>
        <span class="c1"># This is required for compatibility with the JIT compiled cross_section_based_sampler</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">conditioned_y_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_njitted</span><span class="p">(</span><span class="n">sigma_rvs_</span><span class="p">):</span>
                <span class="n">sigma_rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">size</span><span class="p">,</span> <span class="n">zl</span><span class="p">:</span> <span class="n">sigma_rvs_</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
                <span class="n">number_density</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="p">:</span> <span class="n">number_density_</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigma_rvs</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">size</span><span class="p">,</span> <span class="n">zl</span><span class="p">:</span> <span class="n">sigma_rvs_</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>  <span class="c1"># noqa: E731</span>
                <span class="n">number_density</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="p">:</span> <span class="n">number_density_</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>  <span class="c1"># noqa: E731</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sigma_rvs</span> <span class="o">=</span> <span class="n">sigma_rvs_</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="n">number_density_</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">conditioned_y_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_njitted</span><span class="p">(</span><span class="n">q_rvs_</span><span class="p">):</span>
                <span class="n">q_rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">size</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="n">q_rvs_</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q_rvs</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">size</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="n">q_rvs_</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>  <span class="c1"># noqa: E731</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q_rvs</span> <span class="o">=</span> <span class="n">q_rvs_</span>

        <span class="c1"># List of functions to check if they are JIT compiled</span>
        <span class="n">dict_</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;sigma_rvs&#39;</span><span class="p">:</span> <span class="n">sigma_rvs</span><span class="p">,</span>
            <span class="s1">&#39;q_rvs&#39;</span><span class="p">:</span> <span class="n">q_rvs</span><span class="p">,</span>
            <span class="s1">&#39;phi_rvs&#39;</span><span class="p">:</span> <span class="n">phi_rvs</span><span class="p">,</span>
            <span class="s1">&#39;gamma_rvs&#39;</span><span class="p">:</span> <span class="n">gamma_rvs</span><span class="p">,</span>
            <span class="s1">&#39;shear_rvs&#39;</span><span class="p">:</span> <span class="n">shear_rvs</span><span class="p">,</span>
            <span class="s1">&#39;number_density&#39;</span><span class="p">:</span> <span class="n">number_density</span><span class="p">,</span>
            <span class="s1">&#39;cross_section&#39;</span><span class="p">:</span> <span class="n">cross_section</span>
        <span class="p">}</span>

        <span class="c1"># Check if all functions are JIT compiled</span>
        <span class="n">use_njit_sampler</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_njitted</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is not njitted.&quot;</span><span class="p">)</span>
                <span class="n">use_njit_sampler</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="n">sigma_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">][</span><span class="s1">&#39;sigma_min&#39;</span><span class="p">]</span>
        <span class="n">sigma_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">][</span><span class="s1">&#39;sigma_max&#39;</span><span class="p">]</span>

        <span class="c1"># integration_size</span>
        <span class="n">integration_size</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;integration_size&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;integration_size&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">]</span>
            <span class="k">else</span> <span class="mi">20000</span>
        <span class="p">)</span>

        <span class="c1"># dVcdz_function</span>
        <span class="n">dVcdz_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="o">.</span><span class="n">function</span>

        <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">_lens_redshift_strongly_lensed_njit</span>

        <span class="n">density_array</span> <span class="o">=</span> <span class="n">_lens_redshift_strongly_lensed_njit</span><span class="p">(</span>
            <span class="n">zs</span><span class="p">,</span> <span class="c1"># 1D</span>
            <span class="n">zl_scaled</span><span class="p">,</span> <span class="c1"># 2D</span>
            <span class="n">sigma_min</span><span class="p">,</span>
            <span class="n">sigma_max</span><span class="p">,</span>
            <span class="n">q_rvs</span><span class="p">,</span>
            <span class="n">phi_rvs</span><span class="p">,</span>
            <span class="n">gamma_rvs</span><span class="p">,</span>
            <span class="n">shear_rvs</span><span class="p">,</span>
            <span class="n">number_density</span><span class="p">,</span>
            <span class="n">cross_section</span><span class="p">,</span>
            <span class="n">dVcdz_function</span><span class="p">,</span>
            <span class="n">integration_size</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">density_array</span><span class="p">,</span> <span class="n">use_njit_sampler</span>

    <span class="k">def</span> <span class="nf">_lens_redshift_multiprocessing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zl_scaled</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the lens redshift distribution using multiprocessing.</span>
<span class="sd">            </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zl_scaled : ``numpy.ndarray``</span>
<span class="sd">            2D array of lens redshifts scaled by source redshift.</span>
<span class="sd">        zs : ``numpy.ndarray``</span>
<span class="sd">            1D array of source redshifts.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        density_array : ``numpy.ndarray``</span>
<span class="sd">            2D array of the lens redshift distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
   
        <span class="c1"># 0. zs</span>
        <span class="c1"># 1. zl_scaled</span>

        <span class="c1"># 2. sigma_args; velocity_dispersion = self.velocity_dispersion.rvs and density_function = self.velocity_dispersion.function</span>
        <span class="n">sigma_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span>
        <span class="c1"># importance sampling in the backend requires sampling from a uniform distribution within the range</span>
        <span class="n">sigma_args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">sigma_args</span><span class="p">[</span><span class="s2">&quot;sigma_min&quot;</span><span class="p">],</span>
            <span class="n">sigma_args</span><span class="p">[</span><span class="s2">&quot;sigma_max&quot;</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="c1"># The following is used for prior reweighting in the backend</span>
        <span class="n">sigma_args</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="c1"># if zl dependent vd: 2d np.ndarray, shape=(n_sigma, n_zl)</span>
            <span class="c1"># if zl independent vd: 1d np.ndarray, shape=(n_sigma)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">x_array</span><span class="p">),</span>
            <span class="c1"># if zl dependent vd: 2d np.ndarray, shape=(n_sigma, n_zl)</span>
            <span class="c1"># if zl independent vd: None</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">conditioned_y_array</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">conditioned_y_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">function_spline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if zl dependent vd: 3d np.ndarray, shape=(n_sigma, n_zl, n_spline_coeff)</span>
            <span class="c1"># if zl independent vd: 2d np.ndarray, shape=(n_sigma, n_spline_coeff)</span>
            <span class="n">sigma_args</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">function_spline</span><span class="p">)]</span>

        <span class="c1"># 3. q_args; axis_ratio = self.axis_ratio.rvs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;axis_ratio_uniform&quot;</span><span class="p">:</span>
            <span class="n">q_args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;q_min&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;q_max&quot;</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q_args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">cdf_values</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">x_array</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">conditioned_y_array</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">conditioned_y_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="c1"># 4. Da_args; angular_diameter_distance = self.angular_diameter_distance.function</span>
        <span class="n">Da_args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="o">.</span><span class="n">function_spline</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="o">.</span><span class="n">x_array</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># 5. dVcdz_args; differential_comoving_volume = self.differential_comoving_volume.function</span>
        <span class="n">dVcdz_args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="o">.</span><span class="n">function_spline</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="o">.</span><span class="n">x_array</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="c1"># 7. cross section</span>
        <span class="c1"># cs_fn = self.cross_section_function</span>
        <span class="n">cs_args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;cross_section_epl_shear_interpolation&quot;</span><span class="p">:</span>
            <span class="n">cs_args</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cs_data_points_path</span><span class="p">]</span>

        <span class="c1"># 8. phi; axis_rotation_angle = self.axis_rotation_angle.rvs</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]</span>
            <span class="o">==</span> <span class="s2">&quot;axis_rotation_angle_uniform&quot;</span>
        <span class="p">):</span>
            <span class="n">phi_args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">][</span><span class="s2">&quot;phi_min&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">][</span><span class="s2">&quot;phi_max&quot;</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">phi_args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_rotation_angle</span><span class="o">.</span><span class="n">cdf_values</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_rotation_angle</span><span class="o">.</span><span class="n">x_array</span><span class="p">),</span>
            <span class="p">]</span>

        <span class="c1"># 9. shear; external_shear = self.external_shear.rvs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;external_shear_normal&quot;</span><span class="p">:</span>
            <span class="n">shear_args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shear_args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span><span class="o">.</span><span class="n">cdf_values</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span><span class="o">.</span><span class="n">x_array</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span><span class="o">.</span><span class="n">conditioned_y_array</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span><span class="o">.</span><span class="n">conditioned_y_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="c1"># 10. slope; density_profile_slope = self.density_profile_slope.rvs</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">]</span>
            <span class="o">==</span> <span class="s2">&quot;density_profile_slope_normal&quot;</span>
        <span class="p">):</span>
            <span class="n">slope_args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">],</span>
            <span class="p">]</span>

        <span class="c1"># 11. integration_size</span>
        <span class="n">integration_size</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;integration_size&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;integration_size&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">]</span>
            <span class="k">else</span> <span class="mi">20000</span>
        <span class="p">)</span>

        <span class="n">input_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">zs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">zl_scaled</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">sigma_args</span><span class="p">,</span>
                    <span class="n">q_args</span><span class="p">,</span>
                    <span class="n">Da_args</span><span class="p">,</span>
                    <span class="n">dVcdz_args</span><span class="p">,</span>
                    <span class="n">i</span><span class="p">,</span>  <span class="c1"># index to order the results</span>
                    <span class="n">cs_args</span><span class="p">,</span>
                    <span class="n">phi_args</span><span class="p">,</span>
                    <span class="n">shear_args</span><span class="p">,</span>
                    <span class="n">slope_args</span><span class="p">,</span>
                    <span class="n">integration_size</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zs</span><span class="p">))</span>
            <span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing lens redshift distribution with multiprocessing...&quot;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">.mp</span> <span class="kn">import</span> <span class="n">_lens_redshift_strongly_lensed_mp</span>
        <span class="n">density_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">zl_scaled</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zs</span><span class="p">)),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">_lens_redshift_strongly_lensed_mp</span><span class="p">(</span><span class="n">input_params</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">iter_i</span><span class="p">,</span> <span class="n">density_</span> <span class="o">=</span> <span class="n">result</span>
            <span class="n">density_array</span><span class="p">[</span><span class="n">iter_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">density_</span>

        <span class="k">return</span> <span class="n">density_array</span>

    <span class="k">def</span> <span class="nf">lens_redshift_intrinsic</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Sample intrinsic lens redshifts (numerical method).</span>

<span class="sd">        This method computes the lens redshift distribution by numerically</span>
<span class="sd">        integrating over the velocity dispersion distribution (galaxy density distribution wrt) and differential comoving volume.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate. \n</span>
<span class="sd">            default: 1000</span>
<span class="sd">        zs : ``numpy.ndarray`` or ``None``</span>
<span class="sd">            Source redshifts (not used, kept for API compatibility).</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        zl : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Lens redshift samples or sampler object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lens_redshift_intrinsic&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cosmology&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>

        <span class="n">name_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">,</span> <span class="s2">&quot;z_max&quot;</span><span class="p">,</span> <span class="s2">&quot;cosmology&quot;</span><span class="p">,</span> <span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">,</span> <span class="s2">&quot;resolution&quot;</span><span class="p">]</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>  <span class="c1"># if velocity_dispersion is not None</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_list</span><span class="p">:</span>
                    <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span>
            <span class="s2">&quot;lens_redshift_intrinsic&quot;</span>
        <span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">it_exist</span> <span class="o">=</span> <span class="n">interpolator_json_path</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift_intrinsic&quot;</span><span class="p">,</span>
            <span class="n">interpolator_name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">create_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift_intrinsic&quot;</span><span class="p">][</span>
            <span class="s2">&quot;create_new&quot;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">it_exist</span> <span class="ow">or</span> <span class="n">create_new</span><span class="p">:</span>
            <span class="n">z_min</span> <span class="o">=</span> <span class="mf">0.0001</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
            <span class="n">z_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
            <span class="n">zl_array</span> <span class="o">=</span> <span class="n">redshift_optimal_spacing</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>

            <span class="c1"># create number density</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">conditioned_y_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">integrand</span> <span class="o">=</span> <span class="p">(</span>  <span class="c1"># noqa: E731</span>
                    <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">function</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sigma</span><span class="p">])</span>
                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">integrand</span> <span class="o">=</span> <span class="p">(</span>  <span class="c1"># noqa: E731</span>
                    <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">function</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sigma</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">])</span>
                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">differential_comoving_volume</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="c1"># fix zl and integrate over sigma</span>
            <span class="n">integral</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">quad</span><span class="p">(</span>
                    <span class="n">integrand</span><span class="p">,</span>
                    <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;sigma_min&quot;</span><span class="p">],</span>
                    <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;sigma_max&quot;</span><span class="p">],</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">zl</span><span class="p">),</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">zl</span> <span class="ow">in</span> <span class="n">zl_array</span>
            <span class="p">]</span>
            <span class="c1"># create spline fit for lens redshift</span>
            <span class="n">number_density_spline</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">zl_array</span><span class="p">,</span> <span class="n">integral</span><span class="p">)</span>

            <span class="c1"># zl dependent velocity dispersion distribution</span>
            <span class="n">zl_scaled</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">zl_min</span> <span class="o">=</span> <span class="mf">0.0001</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">zl_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zl_array</span><span class="p">):</span>
                <span class="n">zl_size</span> <span class="o">=</span> <span class="mi">48</span>  <span class="c1"># number of points for each zl</span>
                <span class="n">buffer_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zl_min</span><span class="p">,</span> <span class="n">zl_</span> <span class="o">-</span> <span class="n">zl_min</span><span class="p">,</span> <span class="n">zl_size</span><span class="p">)</span>
                <span class="n">zl_scaled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buffer_</span> <span class="o">/</span> <span class="n">zl_</span><span class="p">)</span>
                <span class="n">number_density</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number_density_spline</span><span class="p">(</span><span class="n">buffer_</span><span class="p">))</span>
            <span class="n">zl_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zl_scaled</span><span class="p">)</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">number_density</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">zl_array</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">number_density</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">zl_scaled</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">zl_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">number_density</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zl_scaled</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="n">zl_array</span><span class="p">,</span>
            <span class="n">non_zero_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift_intrinsic&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="n">create_new</span><span class="p">,</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># un-scaled lens redshift</span>
        <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">cdf_values</span>
        <span class="n">x_array</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">x_array</span>
        <span class="n">y_array</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">conditioned_y_array</span>
        <span class="n">function_spline</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">function_spline</span>
        <span class="n">pdf_norm_const</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf_norm_const</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">cubic_spline_interpolator2d_array</span><span class="p">(</span>
                <span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">function_spline</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pdf_cubic_spline_interpolator2d_array</span><span class="p">(</span>
                <span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pdf_norm_const</span><span class="p">,</span> <span class="n">function_spline</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="n">y</span>
        <span class="p">)</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">size</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">inverse_transform_sampler2d</span><span class="p">(</span>
                <span class="n">size</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cdf_values</span><span class="p">,</span> <span class="n">x_array</span><span class="p">,</span> <span class="n">y_array</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="n">y</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">zl_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">zl_object</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span>

<div class="viewcode-block" id="OpticalDepth.axis_rotation_angle_uniform">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_rotation_angle_uniform">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_rotation_angle_uniform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample axis rotation angle from uniform distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters (phi_min, phi_max).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        phi : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Axis rotation angle samples (rad) or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; phi = od.axis_rotation_angle(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;axis_rotation_angle_uniform&quot;</span><span class="p">}</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span>
            <span class="s2">&quot;axis_rotation_angle&quot;</span>
        <span class="p">][</span><span class="s2">&quot;axis_rotation_angle_uniform&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">low</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_min&quot;</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_max&quot;</span><span class="p">]</span>
        <span class="n">phi_rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
                <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span>
                <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_max&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_min&quot;</span><span class="p">]:</span>
            <span class="n">phi_pdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">phi</span><span class="p">:</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_min&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">phi_pdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">phi</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_max&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;phi_min&quot;</span><span class="p">])</span>

        <span class="n">phi_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="n">phi_rvs</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="n">phi_pdf</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">phi_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">phi_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.axis_ratio_uniform">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_ratio_uniform">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_ratio_uniform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample axis ratio from uniform distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters (q_min, q_max).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Axis ratio samples or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(axis_ratio=&quot;axis_ratio_uniform&quot;))</span>
<span class="sd">        &gt;&gt;&gt; q = od.axis_ratio(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;axis_ratio_uniform&quot;</span><span class="p">}</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span>
            <span class="s2">&quot;axis_ratio_uniform&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">low</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">]</span>
        <span class="n">q_rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
                <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span>
                <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">]:</span>
            <span class="n">q_pdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">q</span> <span class="o">==</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q_pdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_max&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;q_min&quot;</span><span class="p">])</span>

        <span class="n">q_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="n">q_rvs</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="n">q_pdf</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">q_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">q_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.external_shear_normal">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.external_shear_normal">[docs]</a>
    <span class="k">def</span> <span class="nf">external_shear_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample external shear parameters from 2D normal distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters (mean, std).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        shear : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Array of shape (2, size) with gamma1, gamma2 or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; gamma1, gamma2 = od.external_shear(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;external_shear_normal&quot;</span><span class="p">}</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">][</span>
            <span class="s2">&quot;external_shear_normal&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
        <span class="n">shear_rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
                <span class="n">loc</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">shear_pdf</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">shear1</span><span class="p">,</span> <span class="n">shear2</span><span class="p">:</span> <span class="n">normal_pdf_2d</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">shear1</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">shear2</span><span class="p">,</span>
                <span class="n">mean_x</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
                <span class="n">mean_y</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
                <span class="n">std_x</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
                <span class="n">std_y</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">shear_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="n">shear_rvs</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="n">shear_pdf</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">shear_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">shear_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.density_profile_slope_normal">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.density_profile_slope_normal">[docs]</a>
    <span class="k">def</span> <span class="nf">density_profile_slope_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample density profile slope from normal distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters (mean, std).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gamma : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Density profile slope samples or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; gamma = od.density_profile_slope(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;density_profile_slope_normal&quot;</span><span class="p">}</span>

        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">][</span>
            <span class="s2">&quot;density_profile_slope_normal&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
        <span class="n">slope_rvs</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
                <span class="n">loc</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">slope_pdf</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">slope</span><span class="p">:</span> <span class="n">normal_pdf</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">slope</span><span class="p">,</span>
                <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
                <span class="n">std</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">slope_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="n">slope_rvs</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="n">slope_pdf</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">slope_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">slope_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.lens_redshift_sis_haris">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_redshift_sis_haris">[docs]</a>
    <span class="k">def</span> <span class="nf">lens_redshift_sis_haris</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample SIS lens redshifts using Haris et al. (2018) distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate.</span>
<span class="sd">        zs : ``numpy.ndarray``</span>
<span class="sd">            Source redshifts.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        zl : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Lens redshift samples or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_type=&#39;sis_galaxy&#39;)</span>
<span class="sd">        &gt;&gt;&gt; zl = od.lens_redshift(size=100, zs=np.ones(100)*2.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># # Old way</span>
        <span class="c1"># splineDc = self.comoving_distance.function_spline  # spline coefficients for the comoving distance and redshifts</span>
        <span class="c1"># splineDcInv = self.comoving_distance.function_inverse_spline # spline coefficients for the redshifts and comoving distance</span>
        <span class="c1"># u = np.linspace(0, 1, 500)</span>
        <span class="c1"># cdf = (10 * u**3 - 15 * u**4 + 6 * u**5)  # See the integral of Eq. A7 of https://arxiv.org/pdf/1807.07062.pdf (cdf)</span>
        <span class="c1"># zs = np.array([zs]).reshape(-1)</span>

        <span class="c1"># New way</span>
        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lens_redshift_sis_haris&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cosmology&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Ode0</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
            <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">2.32</span><span class="p">,</span>
            <span class="n">beta</span><span class="o">=</span><span class="mf">2.67</span><span class="p">,</span>
            <span class="n">phistar</span><span class="o">=</span><span class="mf">8.0e-3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">sigmastar</span><span class="o">=</span><span class="mf">161.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span>
            <span class="s2">&quot;resolution&quot;</span>
        <span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span>
            <span class="s2">&quot;lens_redshift_sis_haris&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">zl_resolution</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">x_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">zl_resolution</span><span class="p">)</span>
        <span class="n">pdf_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># Haris et al. 2018 (A7)</span>

        <span class="n">zl_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">pdf_</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">x_array</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">cdf_values_zl</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">cdf_values</span>
        <span class="n">function_spline_zl</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">function_spline</span>
        <span class="n">pdf_norm_const</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf_norm_const</span>
        <span class="n">x_array_zl</span> <span class="o">=</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">x_array</span>

        <span class="n">spline_Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="n">function_spline</span>
        <span class="n">x_array_Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="n">x_array</span>
        <span class="n">inverse_spline_Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="n">function_inverse_spline</span>
        <span class="n">z_array_Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="n">z_array</span>

        <span class="nd">@njit</span>
        <span class="k">def</span> <span class="nf">zl_rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">inverse_transform_sampler</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">cdf_values_zl</span><span class="p">,</span> <span class="n">x_array_zl</span><span class="p">)</span>
            <span class="n">zs_Dc</span> <span class="o">=</span> <span class="n">cubic_spline_interpolator</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">spline_Dc</span><span class="p">,</span> <span class="n">x_array_Dc</span><span class="p">)</span>
            <span class="n">zl_Dc</span> <span class="o">=</span> <span class="n">zs_Dc</span> <span class="o">*</span> <span class="n">r</span>
            <span class="k">return</span> <span class="n">cubic_spline_interpolator</span><span class="p">(</span><span class="n">zl_Dc</span><span class="p">,</span> <span class="n">inverse_spline_Dc</span><span class="p">,</span> <span class="n">z_array_Dc</span><span class="p">)</span>

        <span class="nd">@njit</span>
        <span class="k">def</span> <span class="nf">zl_pdf</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">zl</span> <span class="o">/</span> <span class="n">zs</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">cubic_spline_interpolator</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">function_spline_zl</span><span class="p">,</span> <span class="n">x_array_zl</span><span class="p">)</span>
                <span class="o">/</span> <span class="n">pdf_norm_const</span>
            <span class="p">)</span>

        <span class="nd">@njit</span>
        <span class="k">def</span> <span class="nf">zl_function</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">zl</span> <span class="o">/</span> <span class="n">zs</span>
            <span class="k">return</span> <span class="n">cubic_spline_interpolator</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">function_spline_zl</span><span class="p">,</span> <span class="n">x_array_zl</span><span class="p">)</span>

        <span class="n">zl_object</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">zl_function</span>
        <span class="n">zl_object</span><span class="o">.</span><span class="n">pdf</span> <span class="o">=</span> <span class="n">zl_pdf</span>
        <span class="n">zl_object</span><span class="o">.</span><span class="n">rvs</span> <span class="o">=</span> <span class="n">zl_rvs</span>

        <span class="k">return</span> <span class="n">zl_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">zl_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.velocity_dispersion_gengamma">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.velocity_dispersion_gengamma">[docs]</a>
    <span class="k">def</span> <span class="nf">velocity_dispersion_gengamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample velocity dispersion from generalized gamma distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters (a, c for gengamma distribution). \n</span>
<span class="sd">            See scipy.stats.gengamma for details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sigma : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Velocity dispersion samples (km/s) or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(</span>
<span class="sd">        ...     velocity_dispersion=&quot;velocity_dispersion_gengamma&quot;))</span>
<span class="sd">        &gt;&gt;&gt; sigma = od.velocity_dispersion(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;velocity_dispersion_gengamma&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cosmology&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span>
            <span class="s2">&quot;velocity_dispersion&quot;</span>
        <span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span>
            <span class="s2">&quot;velocity_dispersion&quot;</span>
        <span class="p">][</span><span class="s2">&quot;velocity_dispersion_gengamma&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="c1"># setting up inputs for the interpolator</span>
        <span class="n">sigma_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;sigma_min&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;sigma_max&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">pdf_func_</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma_</span><span class="p">:</span> <span class="n">gengamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span>
            <span class="n">sigma_</span> <span class="o">/</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;sigmastar&quot;</span><span class="p">],</span>
            <span class="n">a</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
            <span class="n">c</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
        <span class="p">)</span>  <span class="c1"># gengamma pdf</span>

        <span class="n">sigma_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">pdf_func_</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">sigma_array</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span>
                <span class="s2">&quot;create_new&quot;</span>
            <span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">sigma_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">sigma_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.velocity_dispersion_bernardi">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.velocity_dispersion_bernardi">[docs]</a>
    <span class="k">def</span> <span class="nf">velocity_dispersion_bernardi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample velocity dispersion from Bernardi et al. (2010) distribution.</span>

<span class="sd">        Uses inverse transform sampling on the velocity dispersion function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sigma : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Velocity dispersion samples (km/s) or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth(lens_param_samplers=dict(</span>
<span class="sd">        ...     velocity_dispersion=&quot;velocity_dispersion_bernardi&quot;))</span>
<span class="sd">        &gt;&gt;&gt; sigma = od.velocity_dispersion(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;velocity_dispersion_bernardi&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cosmology&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span>
            <span class="s2">&quot;velocity_dispersion&quot;</span>
        <span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span>
            <span class="s2">&quot;velocity_dispersion&quot;</span>
        <span class="p">][</span><span class="s2">&quot;velocity_dispersion_bernardi&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="c1"># setting up inputs for the interpolator</span>
        <span class="n">sigma_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;sigma_min&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;sigma_max&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">number_density_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">:</span> <span class="n">phi_loc_bernardi</span><span class="p">(</span>
            <span class="n">sigma</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span>
            <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
            <span class="n">phistar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;phistar&quot;</span><span class="p">],</span>
            <span class="n">sigmastar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span>
                <span class="s2">&quot;sigmastar&quot;</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="n">sigma_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">number_density_function</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">sigma_array</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span>
                <span class="s2">&quot;create_new&quot;</span>
            <span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">sigma_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">sigma_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.velocity_dispersion_ewoud">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.velocity_dispersion_ewoud">[docs]</a>
    <span class="k">def</span> <span class="nf">velocity_dispersion_ewoud</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample redshift-dependent velocity dispersion from Wempe et al. (2022).</span>

<span class="sd">        Uses inverse transform sampling with redshift-dependent velocity</span>
<span class="sd">        dispersion function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : ``int``</span>
<span class="sd">            Number of samples to generate.</span>
<span class="sd">        zl : ``numpy.ndarray``</span>
<span class="sd">            Lens redshifts.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the sampler object instead of samples. \n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sigma : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Velocity dispersion samples (km/s) or sampler object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; sigma = od.velocity_dispersion(size=100, zl=np.ones(100)*0.5)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;velocity_dispersion_ewoud&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cosmology&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span>
            <span class="s2">&quot;velocity_dispersion&quot;</span>
        <span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;zl_resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span>
            <span class="s2">&quot;velocity_dispersion&quot;</span>
        <span class="p">][</span><span class="s2">&quot;zl_resolution&quot;</span><span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span>
            <span class="s2">&quot;velocity_dispersion&quot;</span>
        <span class="p">][</span><span class="s2">&quot;velocity_dispersion_ewoud&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="c1"># setting up inputs for the interpolator</span>
        <span class="n">sigma_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;sigma_min&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;sigma_max&quot;</span><span class="p">],</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">number_density_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="p">:</span> <span class="n">phi</span><span class="p">(</span>  <span class="c1"># noqa: E731</span>
            <span class="n">sigma</span><span class="p">,</span>
            <span class="n">zl</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span>
            <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
            <span class="n">phistar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;phistar&quot;</span><span class="p">],</span>
            <span class="n">sigmastar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span>
                <span class="s2">&quot;sigmastar&quot;</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="n">z_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">+</span> <span class="mf">0.001</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">z_resolution</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;zl_resolution&quot;</span><span class="p">]</span>
        <span class="n">zl_array</span> <span class="o">=</span> <span class="n">redshift_optimal_spacing</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">z_resolution</span><span class="p">)</span>

        <span class="n">sigma_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">number_density_function</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">sigma_array</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="n">zl_array</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span>
                <span class="s2">&quot;create_new&quot;</span>
            <span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;rvs&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">sigma_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">sigma_object</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zl</span><span class="p">)</span></div>


    <span class="c1">#--------------------</span>
    <span class="c1"># Lens functions</span>
    <span class="c1">#--------------------</span>
<div class="viewcode-block" id="OpticalDepth.optical_depth_numerical">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.optical_depth_numerical">[docs]</a>
    <span class="k">def</span> <span class="nf">optical_depth_numerical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to compute optical depth numerically by integrating lens redshift. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zs : ``numpy.ndarray``</span>
<span class="sd">            Source redshifts.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the function object instead of values. \\n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tau : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Optical depth values or function object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;optical_depth_numerical&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span>
            <span class="s2">&quot;resolution&quot;</span>
        <span class="p">]</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cosmology&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span>
            <span class="s2">&quot;velocity_dispersion&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]:</span>  <span class="c1"># if velocity_dispersion is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]:</span>  <span class="c1"># if axis_ratio is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span>
            <span class="s2">&quot;axis_rotation_angle&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]:</span>  <span class="c1"># if axis_rotation_angle is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span>
            <span class="s2">&quot;density_profile_slope&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span>
            <span class="s2">&quot;density_profile_slope&quot;</span>
        <span class="p">]:</span>  <span class="c1"># if density_profile_slope is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span>
            <span class="s2">&quot;external_shear&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]:</span>  <span class="c1"># if external_shear is not None</span>
            <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_functions</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span>
            <span class="s2">&quot;optical_depth_numerical&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">z_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="o">&gt;</span><span class="mf">0.</span> <span class="k">else</span> <span class="mf">0.0001</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span>
        <span class="n">zs_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span>
            <span class="n">z_min</span><span class="p">,</span>
            <span class="n">z_max</span><span class="p">,</span>
            <span class="n">resolution</span>
        <span class="p">)</span>
        <span class="c1"># z_min = self.z_min + 0.001 if self.z_min == 0.0 else self.z_min</span>
        <span class="c1"># z_max = self.z_max</span>
        <span class="c1"># z_resolution = identifier_dict[&quot;resolution&quot;]</span>
        <span class="c1"># zs_array = redshift_optimal_spacing(z_min, z_max, z_resolution)</span>

        <span class="k">def</span> <span class="nf">tau</span><span class="p">(</span><span class="n">zs</span><span class="p">):</span>
            <span class="c1"># self.lens_redshift.function gives cross-section</span>
            <span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">zl_</span><span class="p">,</span> <span class="n">zs_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_redshift</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zl_</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zs_</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># noqa: E731</span>
            <span class="n">integral</span> <span class="o">=</span> <span class="p">[</span><span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zs</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">integral</span>

        <span class="n">tau_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zs_array</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">tau_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">tau_object</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.compute_einstein_radii">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.compute_einstein_radii">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_einstein_radii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the Einstein radii of the lens galaxies</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sigma : `float`</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>
<span class="sd">        zl : `float`</span>
<span class="sd">            lens redshifts</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            source redshifts</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        theta_E : `float`</span>
<span class="sd">            Einstein radii of the lens galaxies in radians. Multiply by</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import LensGalaxyParameterDistribution</span>
<span class="sd">        &gt;&gt;&gt; lens = LensGalaxyParameterDistribution()</span>
<span class="sd">        &gt;&gt;&gt; sigma = 200.0</span>
<span class="sd">        &gt;&gt;&gt; zl = 0.5</span>
<span class="sd">        &gt;&gt;&gt; zs = 1.0</span>
<span class="sd">        &gt;&gt;&gt; lens.compute_einstein_radii(sigma, zl, zs)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Compute the angular diameter distances</span>
        <span class="n">Ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
        <span class="n">Dls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance_z1z2</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span>
        <span class="c1"># Compute the Einstein radii</span>
        <span class="n">theta_E</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="mf">299792.458</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Dls</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ds</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># Note: km/s for sigma; Dls, Ds are in Mpc</span>

        <span class="k">return</span> <span class="n">theta_E</span></div>


<div class="viewcode-block" id="OpticalDepth.optical_depth_sis_analytic">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.optical_depth_sis_analytic">[docs]</a>
    <span class="k">def</span> <span class="nf">optical_depth_sis_analytic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the strong lensing optical depth (SIS). </span>
<span class="sd">        LambdaCDM(H0=70, Om0=0.3, Ode0=0.7) was used to derive the following equation. This is the analytic version of optical depth from z=0 to z=zs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zs : ``numpy.ndarray``</span>
<span class="sd">            Source redshifts.</span>
<span class="sd">        get_attribute : ``bool``</span>
<span class="sd">            If True, returns the function object instead of values. \\n</span>
<span class="sd">            default: False</span>
<span class="sd">        **kwargs : ``dict``</span>
<span class="sd">            Additional parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tau : ``numpy.ndarray`` or ``FunctionConditioning``</span>
<span class="sd">            Optical depth values or function object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">identifier_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;optical_depth_sis_analytic&quot;</span><span class="p">}</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="mf">0.0001</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;cosmology&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span>
        <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span>
            <span class="s2">&quot;resolution&quot;</span>
        <span class="p">]</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_functions</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span>
            <span class="s2">&quot;optical_depth_sis_analytic&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">param_dict</span><span class="p">:</span>
            <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_dict</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">identifier_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>

        <span class="n">z_min</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span>
        <span class="n">z_resolution</span> <span class="o">=</span> <span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
        <span class="n">zs_arr</span> <span class="o">=</span> <span class="n">redshift_optimal_spacing</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">z_resolution</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">tau</span><span class="p">(</span><span class="n">zs</span><span class="p">):</span>
            <span class="n">Dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comoving_distance</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
            <span class="k">return</span> <span class="mf">4.192e-15</span> <span class="o">*</span> <span class="n">Dc</span><span class="o">**</span><span class="mi">3</span>

        <span class="n">tau_object</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
            <span class="n">function</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span>
            <span class="n">x_array</span><span class="o">=</span><span class="n">zs_arr</span><span class="p">,</span>
            <span class="n">conditioned_y_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">identifier_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">create_new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">],</span>
            <span class="n">create_function_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">create_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">create_rvs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">tau_object</span> <span class="k">if</span> <span class="n">get_attribute</span> <span class="k">else</span> <span class="n">tau_object</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span></div>


    <span class="c1">###########################</span>
    <span class="c1"># cross section functions #</span>
    <span class="c1">###########################</span>
<div class="viewcode-block" id="OpticalDepth.cross_section_sis">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.cross_section_sis">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_section_sis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the SIS cross-section</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sigma : `float`</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>
<span class="sd">        zl : `float`</span>
<span class="sd">            redshift of the lens galaxy</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            redshift of the source galaxy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cross_section : `float`</span>
<span class="sd">            SIS cross-section</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; print(self.cross_section_sis(sigma=200., zl=0.5, zs=1.0))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># theta_E = self.compute_einstein_radii(sigma, zl, zs)</span>
        <span class="c1"># Compute the angular diameter distances</span>
        <span class="n">_Da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="o">.</span><span class="n">function</span>
        <span class="n">_Da_z1z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance_z1z2</span><span class="o">.</span><span class="n">function</span>

        <span class="c1"># Compute the Einstein radii</span>
        <span class="k">if</span> <span class="n">get_attribute</span><span class="p">:</span>
            <span class="nd">@njit</span>
            <span class="k">def</span> <span class="nf">_cross_section_sis</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
                <span class="n">Ds</span> <span class="o">=</span> <span class="n">_Da</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
                <span class="n">Dls</span> <span class="o">=</span> <span class="n">_Da_z1z2</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span>
                <span class="n">theta_E</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="mf">299792.458</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Dls</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ds</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">theta_E</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">return</span> <span class="n">_cross_section_sis</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ds</span> <span class="o">=</span> <span class="n">_Da</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
            <span class="n">Dls</span> <span class="o">=</span> <span class="n">_Da_z1z2</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span>
            <span class="n">theta_E</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="mf">299792.458</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Dls</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ds</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">theta_E</span><span class="o">**</span><span class="mi">2</span>   </div>


<div class="viewcode-block" id="OpticalDepth.cross_section_sie_feixu">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.cross_section_sie_feixu">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_section_sie_feixu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the SIE cross-section from Fei Xu et al. (2021)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sigma : `float`</span>
<span class="sd">            velocity dispersion of the lens galaxy</span>
<span class="sd">        zl : `float`</span>
<span class="sd">            redshift of the lens galaxy</span>
<span class="sd">        zs : `float`</span>
<span class="sd">            redshift of the source galaxy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cross_section : `float`</span>
<span class="sd">            SIE cross-section</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; print(self.cross_section_sie_feixu(sigma=200., zl=0.5, zs=1.0, q=1.0))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">get_attribute</span><span class="p">:</span>
            <span class="n">_cross_section_sis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_sis</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nd">@njit</span>
            <span class="k">def</span> <span class="nf">_cross_section_sie_feixu</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">phi_cut_SIE</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">_cross_section_sis</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_cross_section_sie_feixu</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_cross_section_sis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_sis</span><span class="p">(</span><span class="n">zs</span><span class="o">=</span><span class="n">zs</span><span class="p">,</span> <span class="n">zl</span><span class="o">=</span><span class="n">zl</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">phi_cut_SIE</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">_cross_section_sis</span></div>


<div class="viewcode-block" id="OpticalDepth.cross_section_epl_shear_numerical">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.cross_section_epl_shear_numerical">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_section_epl_shear_numerical</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">theta_E</span><span class="p">,</span>
        <span class="n">gamma</span><span class="p">,</span>
        <span class="n">gamma1</span><span class="p">,</span>
        <span class="n">gamma2</span><span class="p">,</span>
        <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">phi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">e1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">e2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the strong lensing cross-section numerically for EPL + external shear lenses.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        theta_E : `numpy.ndarray`</span>
<span class="sd">            Einstein radii of the lens galaxies in radians</span>
<span class="sd">        gamma : `numpy.ndarray`</span>
<span class="sd">            external shear magnitudes of the lens galaxies</span>
<span class="sd">        gamma1 : `numpy.ndarray`</span>
<span class="sd">            external shear component 1 of the lens galaxies</span>
<span class="sd">        gamma2 : `numpy.ndarray`</span>
<span class="sd">            external shear component 2 of the lens galaxies</span>
<span class="sd">        q : `numpy.ndarray`</span>
<span class="sd">            axis ratios of the lens galaxies</span>
<span class="sd">        phi : `numpy.ndarray`</span>
<span class="sd">            axis rotation angles of the lens galaxies in radians</span>
<span class="sd">        e1 : `numpy.ndarray`</span>
<span class="sd">            ellipticity component 1 of the lens galaxies</span>
<span class="sd">        e2 : `numpy.ndarray`</span>
<span class="sd">            ellipticity component 2 of the lens galaxies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cross_section : `numpy.ndarray`</span>
<span class="sd">            strong lensing cross-section of the lens galaxies in square radians</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Transform the axis ratio and the axis rotation angle, to ellipticities e1, e2, using lenstronomy</span>
        <span class="k">if</span> <span class="n">e1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">e2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">phi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either (e1, e2) or (q, phi) must be provided.&quot;</span><span class="p">)</span>
            <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">phi_q2_ellipticity_hemanta</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta_E</span><span class="p">)</span>
        <span class="n">iter_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">theta_E</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">,</span> <span class="n">iter_</span><span class="p">))</span>

        <span class="n">area_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">npool</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">_cross_section_mp</span><span class="p">,</span> <span class="n">points</span><span class="p">),</span>
                    <span class="n">total</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                    <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">disable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="p">(</span>
                        <span class="n">iter_i</span><span class="p">,</span>
                        <span class="n">area</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">result</span>
                    <span class="n">area_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">iter_i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">area</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_cross_section_mp</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
                    <span class="p">(</span>
                        <span class="n">iter_i</span><span class="p">,</span>
                        <span class="n">area</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">result</span>
                    <span class="n">area_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">iter_i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">area</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">area_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpticalDepth.create_parameter_grid">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.create_parameter_grid">[docs]</a>
    <span class="k">def</span> <span class="nf">create_parameter_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size_list</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">]):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">1000000</span>
        <span class="n">zl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">conditioned_y_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">zl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">conditioned_y_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">q_min</span><span class="p">,</span> <span class="n">q_max</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">q</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">del_q</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">q_max</span> <span class="o">-</span> <span class="n">q_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">size_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">q_min</span> <span class="o">-</span> <span class="n">del_q</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">q_min</span> <span class="o">=</span> <span class="n">q_min</span> <span class="o">-</span> <span class="n">del_q</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">q_max</span> <span class="o">+</span> <span class="n">del_q</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">q_max</span> <span class="o">=</span> <span class="n">q_max</span> <span class="o">+</span> <span class="n">del_q</span>
        <span class="k">if</span> <span class="n">del_q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">q_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_min</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">)</span>
            <span class="n">q_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">q_max</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">)</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_rotation_angle</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">phi_min</span><span class="p">,</span> <span class="n">phi_max</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">phi</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">del_phi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi_max</span> <span class="o">-</span> <span class="n">phi_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">size_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">del_phi</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">phi_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_min</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">)</span>
            <span class="n">phi_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">phi_max</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">)</span>

        <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">phi_q2_ellipticity_hemanta</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

        <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_profile_slope</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">gamma_min</span><span class="p">,</span> <span class="n">gamma_max</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">gamma</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">del_gamma</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma_max</span> <span class="o">-</span> <span class="n">gamma_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">size_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">gamma_min</span> <span class="o">=</span> <span class="n">gamma_min</span> <span class="o">-</span> <span class="n">del_gamma</span>
        <span class="n">gamma_max</span> <span class="o">=</span> <span class="n">gamma_max</span> <span class="o">+</span> <span class="n">del_gamma</span>
        <span class="k">if</span> <span class="n">del_gamma</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gamma_min</span> <span class="o">=</span> <span class="n">gamma_min</span> <span class="o">-</span> <span class="mf">0.01</span>
            <span class="n">gamma_max</span> <span class="o">=</span> <span class="n">gamma_max</span> <span class="o">+</span> <span class="mf">0.01</span>

        <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">gamma1_min</span><span class="p">,</span> <span class="n">gamma1_max</span> <span class="o">=</span> <span class="n">gamma1</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">gamma1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">gamma2_min</span><span class="p">,</span> <span class="n">gamma2_max</span> <span class="o">=</span> <span class="n">gamma2</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">gamma2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">del_gamma1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma1_max</span> <span class="o">-</span> <span class="n">gamma1_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">size_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">del_gamma2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma2_max</span> <span class="o">-</span> <span class="n">gamma2_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">size_list</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">gamma1_min</span> <span class="o">=</span> <span class="n">gamma1_min</span> <span class="o">-</span> <span class="n">del_gamma1</span>
        <span class="n">gamma1_max</span> <span class="o">=</span> <span class="n">gamma1_max</span> <span class="o">+</span> <span class="n">del_gamma1</span>
        <span class="n">gamma2_min</span> <span class="o">=</span> <span class="n">gamma2_min</span> <span class="o">-</span> <span class="n">del_gamma2</span>
        <span class="n">gamma2_max</span> <span class="o">=</span> <span class="n">gamma2_max</span> <span class="o">+</span> <span class="n">del_gamma2</span>
        <span class="k">if</span> <span class="n">del_gamma1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gamma1_min</span> <span class="o">=</span> <span class="n">gamma1_min</span> <span class="o">-</span> <span class="mf">0.0001</span>
            <span class="n">gamma1_max</span> <span class="o">=</span> <span class="n">gamma1_max</span> <span class="o">+</span> <span class="mf">0.0001</span>
        <span class="k">if</span> <span class="n">del_gamma2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gamma2_min</span> <span class="o">=</span> <span class="n">gamma2_min</span> <span class="o">-</span> <span class="mf">0.0001</span>
            <span class="n">gamma2_max</span> <span class="o">=</span> <span class="n">gamma2_max</span> <span class="o">+</span> <span class="mf">0.0001</span>

        <span class="c1">###########################</span>
        <span class="c1"># sampling the parameters #</span>
        <span class="c1">###########################</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">q_min</span><span class="p">,</span> <span class="n">q_max</span><span class="p">,</span> <span class="n">size_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">phi_min</span><span class="p">,</span> <span class="n">phi_max</span><span class="p">,</span> <span class="n">size_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">phi_q2_ellipticity_hemanta</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>

        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">gamma_min</span><span class="p">,</span> <span class="n">gamma_max</span><span class="p">,</span> <span class="n">size_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">gamma1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">gamma1_min</span><span class="p">,</span> <span class="n">gamma1_max</span><span class="p">,</span> <span class="n">size_list</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">gamma2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">gamma2_min</span><span class="p">,</span> <span class="n">gamma2_max</span><span class="p">,</span> <span class="n">size_list</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">q</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span></div>


<div class="viewcode-block" id="OpticalDepth.cross_section_epl_shear_interpolation_init">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.cross_section_epl_shear_interpolation_init">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_section_epl_shear_interpolation_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">size_list</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cross section interpolation data points will be created at </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1">#----------------------------------</span>
        <span class="c1"># cross section unit to cross section ratio fitting </span>
        <span class="c1">#----------------------------------</span>
        <span class="c1"># if self.lens_type == &quot;epl_shear_galaxy&quot;:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">zl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">zl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">zs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.001</span><span class="p">)</span>

        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;sigma_min&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">][</span><span class="s2">&quot;sigma_max&quot;</span><span class="p">],</span>
            <span class="n">size</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">theta_E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_einstein_radii</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">zs</span><span class="p">)</span>
        <span class="n">theta_E_unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta_E</span><span class="p">)</span>

        <span class="c1"># Sample individual parameter values (not grid)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_ratio</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_rotation_angle</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">phi_q2_ellipticity_hemanta</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_profile_slope</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_shear</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

        <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_epl_shear_numerical</span><span class="p">(</span>
            <span class="n">theta_E</span><span class="o">=</span><span class="n">theta_E</span><span class="p">,</span> <span class="n">e1</span><span class="o">=</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="o">=</span><span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="o">=</span><span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="o">=</span><span class="n">gamma2</span>
        <span class="p">)</span>
        <span class="n">cs_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_epl_shear_numerical</span><span class="p">(</span>
            <span class="n">theta_E</span><span class="o">=</span><span class="n">theta_E_unit</span><span class="p">,</span>
            <span class="n">e1</span><span class="o">=</span><span class="n">e1</span><span class="p">,</span>
            <span class="n">e2</span><span class="o">=</span><span class="n">e2</span><span class="p">,</span>
            <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">gamma1</span><span class="o">=</span><span class="n">gamma1</span><span class="p">,</span>
            <span class="n">gamma2</span><span class="o">=</span><span class="n">gamma2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">theta_E</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">idx_cs</span> <span class="o">=</span> <span class="p">(</span><span class="n">cs_unit</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cs</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">cs</span><span class="p">[</span><span class="n">idx_cs</span><span class="p">]</span> <span class="o">/</span> <span class="n">cs_unit</span><span class="p">[</span><span class="n">idx_cs</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx_cs</span><span class="p">]</span>

        <span class="c1"># linear fitting</span>
        <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>

        <span class="n">cs_csunit_slope</span><span class="p">,</span> <span class="n">cs_csunit_intercept</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ratio</span><span class="p">)</span>

        <span class="c1"># cs data points for interpolation</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size_list</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_parameter_grid</span><span class="p">(</span>
            <span class="n">size_list</span><span class="o">=</span><span class="n">size_list</span>
        <span class="p">)</span>

        <span class="n">e1_arr</span><span class="p">,</span> <span class="n">e2_arr</span><span class="p">,</span> <span class="n">gamma_arr</span><span class="p">,</span> <span class="n">gamma1_arr</span><span class="p">,</span> <span class="n">gamma2_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
            <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span>
        <span class="p">)</span>
        <span class="n">e1_arr</span> <span class="o">=</span> <span class="n">e1_arr</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">e2_arr</span> <span class="o">=</span> <span class="n">e2_arr</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">gamma_arr</span> <span class="o">=</span> <span class="n">gamma_arr</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">gamma1_arr</span> <span class="o">=</span> <span class="n">gamma1_arr</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">gamma2_arr</span> <span class="o">=</span> <span class="n">gamma2_arr</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_epl_shear_numerical</span><span class="p">(</span>
            <span class="n">theta_E</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">),</span>
            <span class="n">gamma</span><span class="o">=</span><span class="n">gamma_arr</span><span class="p">,</span>
            <span class="n">gamma1</span><span class="o">=</span><span class="n">gamma1_arr</span><span class="p">,</span>
            <span class="n">gamma2</span><span class="o">=</span><span class="n">gamma2_arr</span><span class="p">,</span>
            <span class="n">e1</span><span class="o">=</span><span class="n">e1_arr</span><span class="p">,</span>
            <span class="n">e2</span><span class="o">=</span><span class="n">e2_arr</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">cs</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size_list</span><span class="p">)</span>

        <span class="c1"># save cs data</span>
        <span class="n">save_json</span><span class="p">(</span>
            <span class="n">file_path</span><span class="p">,</span>
            <span class="p">[</span>
            <span class="n">e1</span><span class="p">,</span>
            <span class="n">e2</span><span class="p">,</span>
            <span class="n">gamma</span><span class="p">,</span>
            <span class="n">gamma1</span><span class="p">,</span>
            <span class="n">gamma2</span><span class="p">,</span>
            <span class="n">cs</span><span class="p">,</span>
            <span class="n">cs_csunit_slope</span><span class="p">,</span>
            <span class="n">cs_csunit_intercept</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gamma1</span><span class="p">,</span> <span class="n">gamma2</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">cs_csunit_slope</span><span class="p">,</span> <span class="n">cs_csunit_intercept</span></div>


<div class="viewcode-block" id="OpticalDepth.cross_section_epl_shear_interpolation">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.cross_section_epl_shear_interpolation">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_section_epl_shear_interpolation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">zs</span><span class="p">,</span>
        <span class="n">zl</span><span class="p">,</span>
        <span class="n">sigma</span><span class="p">,</span>
        <span class="n">q</span><span class="p">,</span>
        <span class="n">phi</span><span class="p">,</span>
        <span class="n">gamma</span><span class="p">,</span>
        <span class="n">gamma1</span><span class="p">,</span>
        <span class="n">gamma2</span><span class="p">,</span>
        <span class="n">get_attribute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">size_list</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compute the cross-section correction factor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.cross_section_interpolator</span> <span class="kn">import</span> <span class="n">make_cross_section_reinit</span>

        <span class="n">param_dict_given</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">z_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span>
            <span class="n">z_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span>
            <span class="n">cosmology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span>
            <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span>
            <span class="n">size_list</span><span class="o">=</span><span class="n">size_list</span><span class="p">,</span>
            <span class="n">velocity_dispersion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">],</span>
            <span class="n">axis_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">],</span>
            <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">],</span>
            <span class="n">density_profile_slope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span>
                <span class="s2">&quot;density_profile_slope&quot;</span>
            <span class="p">],</span>
            <span class="n">external_shear</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">file_path</span><span class="p">,</span> <span class="n">it_exist</span> <span class="o">=</span> <span class="n">interpolator_json_path</span><span class="p">(</span>
            <span class="n">identifier_dict</span><span class="o">=</span><span class="n">param_dict_given</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">sub_directory</span><span class="o">=</span><span class="s2">&quot;cross_section_function&quot;</span><span class="p">,</span>
            <span class="n">interpolator_name</span><span class="o">=</span><span class="s2">&quot;cross_section_function&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">][</span><span class="s2">&quot;create_new&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">it_exist</span> <span class="ow">is</span> <span class="kc">False</span>
        <span class="p">):</span>
            <span class="p">(</span>
                <span class="n">e1_grid</span><span class="p">,</span>
                <span class="n">e2_grid</span><span class="p">,</span>
                <span class="n">gamma_grid</span><span class="p">,</span>
                <span class="n">gamma1_grid</span><span class="p">,</span>
                <span class="n">gamma2_grid</span><span class="p">,</span>
                <span class="n">cs_spline_coeff_grid</span><span class="p">,</span>
                <span class="n">_</span><span class="p">,</span> <span class="c1"># cs_csunit_slope</span>
                <span class="n">_</span><span class="p">,</span> <span class="c1"># cs_csunit_intercept</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_epl_shear_interpolation_init</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">size_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cross section interpolation data points loaded from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="n">e1_grid</span><span class="p">,</span>
                <span class="n">e2_grid</span><span class="p">,</span>
                <span class="n">gamma_grid</span><span class="p">,</span>
                <span class="n">gamma1_grid</span><span class="p">,</span>
                <span class="n">gamma2_grid</span><span class="p">,</span>
                <span class="n">cs_spline_coeff_grid</span><span class="p">,</span>
                <span class="n">_</span><span class="p">,</span> <span class="c1"># cs_csunit_slope</span>
                <span class="n">_</span><span class="p">,</span> <span class="c1"># cs_csunit_intercept</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cs_data_points_path</span> <span class="o">=</span> <span class="n">file_path</span>

        <span class="c1"># Create the interpolator instance</span>
        <span class="n">cs_caculator</span> <span class="o">=</span> <span class="n">make_cross_section_reinit</span><span class="p">(</span>
            <span class="n">e1_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">e1_grid</span><span class="p">),</span>
            <span class="n">e2_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">e2_grid</span><span class="p">),</span>
            <span class="n">gamma_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma_grid</span><span class="p">),</span>
            <span class="n">gamma1_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma1_grid</span><span class="p">),</span>
            <span class="n">gamma2_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma2_grid</span><span class="p">),</span>
            <span class="n">cs_spline_coeff_grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cs_spline_coeff_grid</span><span class="p">),</span>
            <span class="n">Da_instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">angular_diameter_distance</span><span class="o">.</span><span class="n">function</span><span class="p">,</span>
            <span class="n">csunit_to_cs_slope</span><span class="o">=</span><span class="mf">0.31830988618379075</span><span class="p">,</span>
            <span class="n">csunit_to_cs_intercept</span><span class="o">=-</span><span class="mf">3.2311742677852644e-27</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># # define conversion function: cs_unit to cs</span>
        <span class="c1"># self.cs_unit_to_cs = lambda area_sis: cs_csunit_slope * area_sis + cs_csunit_intercept</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">cs_caculator</span>
            <span class="k">if</span> <span class="n">get_attribute</span>
            <span class="k">else</span> <span class="n">cs_caculator</span><span class="p">(</span>
                <span class="n">zs</span><span class="o">=</span><span class="n">zs</span><span class="p">,</span>
                <span class="n">zl</span><span class="o">=</span><span class="n">zl</span><span class="p">,</span>
                <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
                <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">phi</span><span class="p">,</span>
                <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                <span class="n">gamma1</span><span class="o">=</span><span class="n">gamma1</span><span class="p">,</span>
                <span class="n">gamma2</span><span class="o">=</span><span class="n">gamma2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.optical_depth">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.optical_depth">[docs]</a>
    <span class="k">def</span> <span class="nf">optical_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Strong lensing optical depth calculator.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        optical_depth : ``FunctionConditioning``</span>
<span class="sd">            Function object with `.function(zs)` method that returns \\n</span>
<span class="sd">            optical depth for given source redshifts.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; tau = od.optical_depth.function(np.array([1.0, 2.0]))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optical_depth</span></div>


    <span class="nd">@optical_depth</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">optical_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_function</span><span class="p">):</span>
        <span class="c1"># Handle available lens functions (need to map to private method)</span>
        <span class="n">available_functions_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;optical_depth_numerical&quot;</span><span class="p">:</span> <span class="s2">&quot;optical_depth_numerical&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="n">input_function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_functions</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available optical depth function : </span><span class="si">{</span><span class="n">input_function</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Map to private method if it exists</span>
            <span class="n">method_name</span> <span class="o">=</span> <span class="n">available_functions_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">input_function</span><span class="p">,</span> <span class="n">input_function</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions_params</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_optical_depth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)(</span>
                    <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_optical_depth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)(</span>
                    <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_function</span><span class="p">,</span> <span class="n">FunctionConditioning</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom optical depth class/object of type ler.utils.FunctionConditioning&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_optical_depth</span> <span class="o">=</span> <span class="n">input_function</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">input_function</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom optical depth function&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_optical_depth</span> <span class="o">=</span> <span class="n">FunctionConditioning</span><span class="p">(</span>
                <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_function</span><span class="o">=</span><span class="n">input_function</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;optical depth function should be string in available_lens_functions[&#39;optical_depth&#39;] or callable or class object of &#39;ler.utils.FunctionConditioning&#39;&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.velocity_dispersion">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.velocity_dispersion">[docs]</a>
    <span class="k">def</span> <span class="nf">velocity_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Velocity dispersion sampler object.</span>

<span class="sd">        Returns a ``FunctionConditioning`` object with methods: \n</span>
<span class="sd">        - ``rvs(size, zl)``: Sample velocity dispersion values \n</span>
<span class="sd">        - ``pdf(sigma, zl)``: Get probability density \n</span>
<span class="sd">        - ``function(sigma, zl)``: Get number density function \n</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        velocity_dispersion : ``FunctionConditioning``</span>
<span class="sd">            Sampler object for velocity dispersion (km/s).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; sigma = od.velocity_dispersion(size=100, zl=np.ones(100)*0.5)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_dispersion</span></div>


    <span class="nd">@velocity_dispersion</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">velocity_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">prior</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available velocity dispersion function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">prior</span> <span class="o">==</span> <span class="s2">&quot;velocity_dispersion_choi&quot;</span><span class="p">:</span>
                <span class="n">prior</span> <span class="o">=</span> <span class="s2">&quot;velocity_dispersion_bernardi&quot;</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_dispersion</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_dispersion</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">FunctionConditioning</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom velocity_dispersion class/object of type ler.utils.FunctionConditioning&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_dispersion</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;velocity_dispersion should be sampler name from available_lens_samplers[&#39;velocity_dispersion&#39;] or class object of &#39;ler.utils.FunctionConditioning&#39;&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.axis_ratio">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_ratio">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Axis ratio sampler object.</span>

<span class="sd">        Returns a ``FunctionConditioning`` object with methods: \n</span>
<span class="sd">        - ``rvs(size, sigma)``: Sample axis ratio values \n</span>
<span class="sd">        - ``pdf(q, sigma)``: Get probability density \n</span>
<span class="sd">        - ``function(q, sigma)``: Get distribution function \n</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        axis_ratio : ``FunctionConditioning``</span>
<span class="sd">            Sampler object for axis ratio.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; q = od.axis_ratio(size=100, sigma=np.ones(100)*200.)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_ratio</span></div>


    <span class="nd">@axis_ratio</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">axis_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available axis_ratio function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axis_ratio</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axis_ratio</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">FunctionConditioning</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom axis_ratio class/object of type ler.utils.FunctionConditioning&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axis_ratio</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;axis_ratio should be string in available_lens_samplers[&#39;axis_ratio&#39;] or class object of &#39;ler.utils.FunctionConditioning&#39;&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.lens_redshift">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_redshift">[docs]</a>
    <span class="k">def</span> <span class="nf">lens_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lens redshift sampler object.</span>

<span class="sd">        Returns a ``FunctionConditioning`` object with methods: \n</span>
<span class="sd">        - ``rvs(size, zs)``: Sample lens redshifts given source redshifts \n</span>
<span class="sd">        - ``pdf(zl, zs)``: Get probability density \n</span>
<span class="sd">        - ``function(zl, zs)``: Get effective lensing cross-section \n</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lens_redshift : ``FunctionConditioning``</span>
<span class="sd">            Sampler object for lens redshift.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; zl = od.lens_redshift(size=100, zs=np.ones(100)*2.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift</span></div>


    <span class="nd">@lens_redshift</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">lens_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available lens_redshift function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">FunctionConditioning</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom lens_redshift class/object of type ler.utils.FunctionConditioning&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lens_redshift</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;lens_redshift should be string in available_lens_samplers[&#39;lens_redshift&#39;] or class object of &#39;ler.utils.FunctionConditioning&#39;&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.axis_rotation_angle">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.axis_rotation_angle">[docs]</a>
    <span class="k">def</span> <span class="nf">axis_rotation_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Axis rotation angle sampler object.</span>

<span class="sd">        Returns a ``FunctionConditioning`` object with methods: \n</span>
<span class="sd">        - ``rvs(size)``: Sample axis rotation angles \n</span>
<span class="sd">        - ``pdf(phi)``: Get probability density \n</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        axis_rotation_angle : ``FunctionConditioning``</span>
<span class="sd">            Sampler object for axis rotation angle (rad).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; phi = od.axis_rotation_angle(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_rotation_angle</span></div>


    <span class="nd">@axis_rotation_angle</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">axis_rotation_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">prior</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available axis_rotation_angle function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axis_rotation_angle</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axis_rotation_angle</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">FunctionConditioning</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom axis_rotation_angle class/object of type ler.utils.FunctionConditioning&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axis_rotation_angle</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;axis_rotation_angle should be string in available_lens_samplers[&#39;axis_rotation_angle&#39;] or class object of &#39;ler.utils.FunctionConditioning&#39;&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.external_shear">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.external_shear">[docs]</a>
    <span class="k">def</span> <span class="nf">external_shear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        External shear sampler object.</span>

<span class="sd">        Returns a ``FunctionConditioning`` object with methods: \n</span>
<span class="sd">        - ``rvs(size)``: Sample shear components (gamma1, gamma2) \n</span>
<span class="sd">        - ``pdf(gamma1, gamma2)``: Get probability density \n</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        external_shear : ``FunctionConditioning``</span>
<span class="sd">            Sampler object for external shear.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; gamma1, gamma2 = od.external_shear(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear</span></div>


    <span class="nd">@external_shear</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">external_shear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available external_shear function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;external_shear&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">FunctionConditioning</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom external_shear class/object of type ler.utils.FunctionConditioning&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;external_shear should be string in available_lens_samplers[&#39;external_shear&#39;] or class object of &#39;ler.utils.FunctionConditioning&#39;&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.external_shear_sl">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.external_shear_sl">[docs]</a>
    <span class="k">def</span> <span class="nf">external_shear_sl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        External shear sampler object (strong lensing conditioned).</span>

<span class="sd">        Returns a ``FunctionConditioning`` object with methods: \n</span>
<span class="sd">        - ``rvs(size)``: Sample shear components (gamma1, gamma2) \n</span>
<span class="sd">        - ``pdf(gamma1, gamma2)``: Get probability density \n</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        external_shear_sl : ``FunctionConditioning``</span>
<span class="sd">            Sampler object for external shear (strong lensing).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; gamma1, gamma2 = od.external_shear_sl(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear_sl</span></div>


    <span class="nd">@external_shear_sl</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">external_shear_sl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;external_shear_sl&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available external_shear_sl function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;external_shear_sl&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear_sl</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear_sl</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">FunctionConditioning</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom external_shear_sl class/object of type ler.utils.FunctionConditioning&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_external_shear_sl</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;external_shear_sl should be string in available_lens_samplers[&#39;external_shear_sl&#39;] or class object of &#39;ler.utils.FunctionConditioning&#39;&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.density_profile_slope">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.density_profile_slope">[docs]</a>
    <span class="k">def</span> <span class="nf">density_profile_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Density profile slope sampler object.</span>

<span class="sd">        Returns a ``FunctionConditioning`` object with methods: \n</span>
<span class="sd">        - ``rvs(size)``: Sample density profile slope values \n</span>
<span class="sd">        - ``pdf(gamma)``: Get probability density \n</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        density_profile_slope : ``FunctionConditioning``</span>
<span class="sd">            Sampler object for density profile slope.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; gamma = od.density_profile_slope(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope</span></div>


    <span class="nd">@density_profile_slope</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">density_profile_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">prior</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available density_profile_slope function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;density_profile_slope&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">FunctionConditioning</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom density_profile_slope class/object of type ler.utils.FunctionConditioning&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;density_profile_slope should be string in available_lens_samplers[&#39;density_profile_slope&#39;] or class object of &#39;ler.utils.FunctionConditioning&#39;&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.density_profile_slope_sl">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.density_profile_slope_sl">[docs]</a>
    <span class="k">def</span> <span class="nf">density_profile_slope_sl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Density profile slope sampler object (strong lensing conditioned).</span>

<span class="sd">        Returns a ``FunctionConditioning`` object with methods: \n</span>
<span class="sd">        - ``rvs(size)``: Sample density profile slope values \n</span>
<span class="sd">        - ``pdf(gamma)``: Get probability density \n</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        density_profile_slope_sl : ``FunctionConditioning``</span>
<span class="sd">            Sampler object for density profile slope (strong lensing).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; gamma = od.density_profile_slope_sl(size=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope_sl</span></div>


    <span class="nd">@density_profile_slope_sl</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">density_profile_slope_sl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">prior</span>
            <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_lens_samplers</span><span class="p">[</span><span class="s2">&quot;density_profile_slope_sl&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using ler available density_profile_slope_sl function : </span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;density_profile_slope_sl&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope_sl</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope_sl</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">)(</span>
                    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">FunctionConditioning</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using user provided custom density_profile_slope_sl class/object of type ler.utils.FunctionConditioning&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_density_profile_slope_sl</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;density_profile_slope_sl should be string in available_lens_samplers[&#39;density_profile_slope_sl&#39;] or class object of &#39;ler.utils.FunctionConditioning&#39;&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.cross_section">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.cross_section">[docs]</a>
    <span class="k">def</span> <span class="nf">cross_section</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lensing cross-section calculator.</span>

<span class="sd">        Returns a callable that computes lensing cross-section for individual \n</span>
<span class="sd">        lensing events. Input parameters depend on lens type: \n</span>
<span class="sd">        - EPL+shear: zs, zl, sigma, q, phi, gamma, gamma1, gamma2 \n</span>
<span class="sd">        - SIE: zs, zl, sigma, q \n</span>
<span class="sd">        - SIS: zs, zl, sigma \n</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cross_section : ``callable``</span>
<span class="sd">            Cross-section function (radÂ² units).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from ler.lens_galaxy_population import OpticalDepth</span>
<span class="sd">        &gt;&gt;&gt; od = OpticalDepth()</span>
<span class="sd">        &gt;&gt;&gt; cs = od.cross_section(zs=zs, zl=zl, sigma=sigma, ...)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cross_section</span></div>


    <span class="nd">@cross_section</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cross_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cross_section</span> <span class="o">==</span> <span class="s2">&quot;cross_section_epl_shear_interpolation&quot;</span><span class="p">:</span>
            <span class="c1"># this will initialize the cross section interpolator</span>
            <span class="n">size_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_interpolator</span><span class="p">[</span><span class="s2">&quot;cross_section&quot;</span><span class="p">][</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cross_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_section_epl_shear_interpolation</span><span class="p">(</span>
                <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">zl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">phi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">gamma1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">gamma2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">size_list</span><span class="o">=</span><span class="n">size_list</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">cross_section</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cross_section_sie_feixu&quot;</span><span class="p">,</span> <span class="s2">&quot;cross_section_sis&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cross_section</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">)(</span><span class="n">get_attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">cross_section</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cross_section</span> <span class="o">=</span> <span class="n">cross_section</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cross_section</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cross_section</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;cross_section should be a string, callable, or an instance of a class&quot;</span>
            <span class="p">)</span>

    <span class="c1">#--------------------</span>
    <span class="c1"># Available samplers and functions</span>
    <span class="c1">#--------------------</span>
    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.available_lens_samplers">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.available_lens_samplers">[docs]</a>
    <span class="k">def</span> <span class="nf">available_lens_samplers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary of available lens parameter samplers and their default parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        available_lens_samplers : ``dict``</span>
<span class="sd">            Dictionary with sampler names and default parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_available_lens_samplers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">source_redshift_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">strongly_lensed_source_redshifts</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="n">lens_redshift</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">lens_redshift_sis_haris</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">lens_redshift_strongly_lensed_numerical</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">integration_size</span><span class="o">=</span><span class="mi">25000</span><span class="p">),</span>
                <span class="n">lens_redshift_strongly_lensed_hemanta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">velocity_dispersion</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">velocity_dispersion_gengamma</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                    <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span>
                    <span class="n">beta</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span>
                    <span class="n">phistar</span><span class="o">=</span><span class="mf">2.099e-2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span> <span class="o">/</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="n">sigmastar</span><span class="o">=</span><span class="mf">113.78</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">velocity_dispersion_choi</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                    <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">2.32</span><span class="p">,</span>
                    <span class="n">beta</span><span class="o">=</span><span class="mf">2.67</span><span class="p">,</span>
                    <span class="n">phistar</span><span class="o">=</span><span class="mf">8.0e-3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">sigmastar</span><span class="o">=</span><span class="mf">161.0</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">velocity_dispersion_bernardi</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                    <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span>
                    <span class="n">beta</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span>
                    <span class="n">phistar</span><span class="o">=</span><span class="mf">2.099e-2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span> <span class="o">/</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="n">sigmastar</span><span class="o">=</span><span class="mf">113.78</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">velocity_dispersion_ewoud</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">sigma_min</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                    <span class="n">sigma_max</span><span class="o">=</span><span class="mf">400.0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span>
                    <span class="n">beta</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span>
                    <span class="n">phistar</span><span class="o">=</span><span class="mf">2.099e-2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="o">.</span><span class="n">h</span> <span class="o">/</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="n">sigmastar</span><span class="o">=</span><span class="mf">113.78</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="n">axis_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">axis_ratio_rayleigh</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">axis_ratio_padilla_strauss</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">axis_ratio_uniform</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">q_min</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">axis_rotation_angle</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">axis_rotation_angle_uniform</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">phi_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">phi_max</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">external_shear</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">external_shear_normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">external_shear_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">external_shear_normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span>
                <span class="p">),</span>
                <span class="n">external_shear_sl_numerical_hemanta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">external_shear_normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="n">density_profile_slope</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">density_profile_slope_normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">1.99</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.149</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">density_profile_slope_sl</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">density_profile_slope_normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">mean</span><span class="o">=</span><span class="mf">2.091</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.133</span>
                <span class="p">),</span>
                <span class="n">density_profile_slope_sl_numerical_hemanta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">density_profile_slope_normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">1.99</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.149</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="n">source_parameters</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sample_gw_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_lens_samplers</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.available_lens_functions">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.available_lens_functions">[docs]</a>
    <span class="k">def</span> <span class="nf">available_lens_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary of available lens functions and their default parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        available_lens_functions : ``dict``</span>
<span class="sd">            Dictionary with function names and default parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_available_lens_functions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">cross_section_based_sampler</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="c1"># rejection_sampling_with_cross_section_sie_feixu=None,</span>
                <span class="c1"># rejection_sampling_with_cross_section_sis=None,</span>
                <span class="n">rejection_sampling_with_cross_section</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">safety_factor</span><span class="o">=</span><span class="mf">1.2</span><span class="p">),</span>
                <span class="n">importance_sampling_with_cross_section</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">n_prop</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">optical_depth</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">optical_depth_sis_analytic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">optical_depth_epl_shear_hemanta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">optical_depth_numerical</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">param_sampler_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">_sample_all_routine_epl_shear_sl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">cross_section</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">cross_section_sie_feixu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section_sis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section_epl_shear_numerical</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">cross_section_epl_shear_interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_lens_functions</span></div>


    <span class="c1">#--------------------</span>
    <span class="c1"># Simple instance attribute properties</span>
    <span class="c1">#--------------------</span>
    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.npool">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.npool">[docs]</a>
    <span class="k">def</span> <span class="nf">npool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of processors for multiprocessing.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        npool : ``int``</span>
<span class="sd">            Number of parallel processors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_npool</span></div>


    <span class="nd">@npool</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">npool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_npool</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.z_min">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.z_min">[docs]</a>
    <span class="k">def</span> <span class="nf">z_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Minimum redshift of the lens galaxy population.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        z_min : ``float``</span>
<span class="sd">            Minimum redshift.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_min</span></div>


    <span class="nd">@z_min</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">z_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_min</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.z_max">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.z_max">[docs]</a>
    <span class="k">def</span> <span class="nf">z_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maximum redshift of the lens galaxy population.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        z_max : ``float``</span>
<span class="sd">            Maximum redshift.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_max</span></div>


    <span class="nd">@z_max</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">z_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_max</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.cosmo">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.cosmo">[docs]</a>
    <span class="k">def</span> <span class="nf">cosmo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cosmology object for distance calculations.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cosmo : ``astropy.cosmology``</span>
<span class="sd">            Cosmology object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cosmo</span></div>


    <span class="nd">@cosmo</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cosmo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cosmo</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.lens_type">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.lens_type">[docs]</a>
    <span class="k">def</span> <span class="nf">lens_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Type of lens galaxy model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lens_type : ``str``</span>
<span class="sd">            Lens type (&#39;epl_shear_galaxy&#39;, &#39;sie_galaxy&#39;, or &#39;sis_galaxy&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lens_type</span></div>


    <span class="nd">@lens_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">lens_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lens_type</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="OpticalDepth.directory">
<a class="viewcode-back" href="../../../autoapi/ler/lens_galaxy_population/optical_depth/index.html#ler.lens_galaxy_population.OpticalDepth.directory">[docs]</a>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Directory for interpolator storage.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        directory : ``str``</span>
<span class="sd">            Path to interpolator JSON files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span></div>


    <span class="nd">@directory</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="n">value</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Phurailatpam Hemantakumar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>