<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ler.rates.ler &mdash; ler 0.3.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=4621528c"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=f281be69"></script>
        <script src="../../../_static/tabs.js?v=3030b3cb"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ler
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Unlensed%20events.html">Unlensed events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Lensed%20events.html">Lensed events</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/rates/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.rates</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/gw_source_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.gw_source_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/lens_galaxy_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.lens_galaxy_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/image_properties/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.image_properties</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/ler/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.utils</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../rates/LeR%20complete%20examples.html">LeR complete examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rates/GWRATES%20complete%20exmaples.html">GWRATES complete exmaples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ler.rates.ler</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ler.rates.ler</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains the main class for calculating the rates of detectable gravitational waves events. The class inherits the :class:`~ler.lens_galaxy_population.LensGalaxyParameterDistribution` class for source parameters and lens parameters sampling. It also finds the image properties. :class:`~ler.lens_galaxy_population.LensGalaxyParameterDistribution` inherits the :class:`~ler.gw_source_population.CBCSourceParameterDistribution`, :class:`~ler.image_properties.ImageProperties` and uses `gwsnr` package for SNR calculation. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">LambdaCDM</span>
<span class="kn">from</span> <span class="nn">..lens_galaxy_population</span> <span class="kn">import</span> <span class="n">LensGalaxyParameterDistribution</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">load_json</span><span class="p">,</span> <span class="n">append_json</span><span class="p">,</span> <span class="n">get_param_from_json</span><span class="p">,</span> <span class="n">batch_handler</span>


<div class="viewcode-block" id="LeR">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR">[docs]</a>
<span class="k">class</span> <span class="nc">LeR</span><span class="p">(</span><span class="n">LensGalaxyParameterDistribution</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to calculate both the rates of lensed and unlensed events. Please note that parameters of the simulated events are stored in json file but not as an attribute of the class. This saves RAM memory. </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    npool : `int`</span>
<span class="sd">        number of cores to use.</span>
<span class="sd">        default npool = 4.</span>
<span class="sd">    z_min : `float`</span>
<span class="sd">        minimum redshift.</span>
<span class="sd">        default z_min = 0.</span>
<span class="sd">        for popI_II, popIII, primordial, BNS z_min = 0., 5., 5., 0. respectively.</span>
<span class="sd">    z_max : `float`</span>
<span class="sd">        maximum redshift.</span>
<span class="sd">        default z_max = 10.</span>
<span class="sd">        for popI_II, popIII, primordial, BNS z_max = 10., 40., 40., 2. respectively.</span>
<span class="sd">    size : `int`</span>
<span class="sd">        number of samples for sampling.</span>
<span class="sd">        default size = 100000.</span>
<span class="sd">    batch_size : `int`</span>
<span class="sd">        batch size for SNR calculation.</span>
<span class="sd">        default batch_size = 25000.</span>
<span class="sd">        reduce the batch size if you are getting memory error.</span>
<span class="sd">        recommended batch_size = 50000, if size = 1000000.</span>
<span class="sd">    snr_finder : `str`</span>
<span class="sd">        default snr_finder = &#39;gwsnr&#39;.</span>
<span class="sd">        if &#39;gwsnr&#39;, the SNR will be calculated using the gwsnr package.</span>
<span class="sd">        if &#39;custom&#39;, the SNR will be calculated using a custom function.</span>
<span class="sd">        The custom function should have input and output as given in GWSNR.snr method.</span>
<span class="sd">    json_file_names: `dict`</span>
<span class="sd">        names of the json files to strore the necessary parameters.</span>
<span class="sd">        default json_file_names = {&#39;ler_param&#39;: &#39;./LeR_params.json&#39;, &#39;unlensed_param&#39;: &#39;./unlensed_param.json&#39;, &#39;unlensed_param_detectable&#39;: &#39;./unlensed_param_detectable.json&#39;}.\n</span>
<span class="sd">    kwargs : `keyword arguments`</span>
<span class="sd">        Note : kwargs takes input for initializing the :class:`~ler.lens_galaxy_population.LensGalaxyParameterDistribution`, :meth:`~gwsnr_intialization`.</span>

<span class="sd">    Examples</span>
<span class="sd">    ----------</span>
<span class="sd">    &gt;&gt;&gt; from ler.rates import LeR</span>
<span class="sd">    &gt;&gt;&gt; ler = LeR()</span>
<span class="sd">    &gt;&gt;&gt; ler.unlensed_cbc_statistics();</span>
<span class="sd">    &gt;&gt;&gt; ler.unlensed_rate();</span>
<span class="sd">        </span>
<span class="sd">    Instance Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    LeR class has the following attributes, \n</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    | Atrributes                          | Type                             |</span>
<span class="sd">    +=====================================+==================================+</span>
<span class="sd">    |:attr:`~z_min`                       | `float`                          |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~z_max`                       | `float`                          |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~event_type`                  | `str`                            |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~cosmo`                       | `astropy.cosmology`              |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~size`                        | `int`                            |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~batch_size`                  | `int`                            |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~json_file_names`             | `dict`                           |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~directory`                   | `str`                            |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~gw_param_sampler_dict`       | `dict`                           |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~snr_calculator_dict`         | `dict`                           |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~list_of_detectors`           | `list`                           |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~unlensed_param`              | `dict`                           |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~unlensed_param_detectable`   | `dict`                           |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~lensed_param`                | `dict`                           |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:attr:`~lensed_param_detectable`     | `dict`                           |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>

<span class="sd">    Instance Methods</span>
<span class="sd">    ----------</span>
<span class="sd">    LeR class has the following methods, \n</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    | Methods                             | Description                      |</span>
<span class="sd">    +=====================================+==================================+</span>
<span class="sd">    |:meth:`~class_initialization`        | Function to initialize the       |</span>
<span class="sd">    |                                     | parent classes                   |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~gwsnr_intialization`         | Function to initialize the       |</span>
<span class="sd">    |                                     | gwsnr class                      |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~snr`                         | Function to get the snr with the |</span>
<span class="sd">    |                                     | given parameters.                |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~store_ler_params`            | Function to store the all the    |</span>
<span class="sd">    |                                     | necessary parameters.            |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~unlensed_cbc_statistics`     | Function to generate unlensed    |</span>
<span class="sd">    |                                     | GW source parameters.            |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~unlensed_sampling_routine`   | Function to generate unlensed    |</span>
<span class="sd">    |                                     | GW source parameters.            |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~unlensed_rate`               | Function to calculate the        |</span>
<span class="sd">    |                                     | unlensed rate.                   |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~selecting_n_unlensed_detectable_events`                         |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |                                     | Function to select n unlensed    |</span>
<span class="sd">    |                                     | detectable events.               |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~lensed_cbc_statistics`       | Function to generate lensed      |</span>
<span class="sd">    |                                     | GW source parameters.            |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~lensed_sampling_routine`     | Function to generate lensed      |</span>
<span class="sd">    |                                     | GW source parameters.            |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~lensed_rate`                 | Function to calculate the        |</span>
<span class="sd">    |                                     | lensed rate.                     |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~rate_ratio`                  | Function to calculate the rate   |</span>
<span class="sd">    |                                     | ratio.                           |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~rate_comparision_with_rate_calculation                          |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |                                     | Function to compare the rates    |</span>
<span class="sd">    |                                     | calculated using LeR between     |</span>
<span class="sd">    |                                     | unlensed and lensed events.      |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~param_plot`                  | Function to plot the             |</span>
<span class="sd">    |                                     | distribution of various          |</span>
<span class="sd">    |                                     | parameters.                      |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~relative_mu_dt_lensed`       | Function to calculate the        |</span>
<span class="sd">    |                                     | relative magnification and       |</span>
<span class="sd">    |                                     | relative time-delay of lensed    |</span>
<span class="sd">    |                                     | events.                          |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~relative_mu_dt_unlensed`     | Function to calculate the        |</span>
<span class="sd">    |                                     | relative magnification and       |</span>
<span class="sd">    |                                     | relative time-delay of unlensed  |</span>
<span class="sd">    |                                     | events.                          |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    |:meth:`~ mu_vs_dt_plot`              | Function to plot the             |</span>
<span class="sd">    |                                     | relative magnification vs        |</span>
<span class="sd">    |                                     | relative time-delay.             |</span>
<span class="sd">    +-------------------------------------+----------------------------------+</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Attributes</span>
<div class="viewcode-block" id="LeR.z_min">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.z_min">[docs]</a>
    <span class="n">z_min</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``float`` \n</span>
<span class="sd">    Minimum redshift of the source population</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.z_max">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.z_max">[docs]</a>
    <span class="n">z_max</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``float`` \n</span>
<span class="sd">    Maximum redshift of the source population</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.event_type">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.event_type">[docs]</a>
    <span class="n">event_type</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``str`` \n</span>
<span class="sd">    Type of event to generate. \n</span>
<span class="sd">    e.g. &#39;BBH&#39;, &#39;BNS&#39;, &#39;NSBH&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.cosmo">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.cosmo">[docs]</a>
    <span class="n">cosmo</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``astropy.cosmology`` \n</span>
<span class="sd">    Cosmology to use for the calculation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.size">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.size">[docs]</a>
    <span class="n">size</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``int`` \n</span>
<span class="sd">    Number of samples for sampling.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.batch_size">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.batch_size">[docs]</a>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``int`` \n</span>
<span class="sd">    Batch size for sampling.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.json_file_names">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.json_file_names">[docs]</a>
    <span class="n">json_file_names</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``dict`` \n</span>
<span class="sd">    Names of the json files to strore the necessary parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.directory">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.directory">[docs]</a>
    <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``str`` \n</span>
<span class="sd">    Directory to store the interpolators.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.gw_param_sampler_dict">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.gw_param_sampler_dict">[docs]</a>
    <span class="n">gw_param_sampler_dict</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``dict`` \n</span>
<span class="sd">    Dictionary of parameters to initialize the ``CBCSourceParameterDistribution`` class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.lens_param_sampler_dict">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.lens_param_sampler_dict">[docs]</a>
    <span class="n">lens_param_sampler_dict</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``dict`` \n</span>
<span class="sd">    Dictionary of parameters to initialize the ``LensGalaxyParameterDistribution`` class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.snr_calculator_dict">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.snr_calculator_dict">[docs]</a>
    <span class="n">snr_calculator_dict</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``dict`` \n</span>
<span class="sd">    Dictionary of parameters to initialize the ``GWSNR`` class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LeR.list_of_detectors">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.list_of_detectors">[docs]</a>
    <span class="n">list_of_detectors</span> <span class="o">=</span> <span class="kc">None</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;``list`` \n</span>
<span class="sd">    List of detectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">npool</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
        <span class="n">z_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">z_max</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
        <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;BBH&quot;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">25000</span><span class="p">,</span>
        <span class="n">cosmology</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">snr_finder</span><span class="o">=</span><span class="s2">&quot;gwsnr&quot;</span><span class="p">,</span>
        <span class="n">json_file_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;./interpolator_pickle&quot;</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">npool</span> <span class="o">=</span> <span class="n">npool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span> <span class="o">=</span> <span class="n">z_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span> <span class="o">=</span> <span class="n">z_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">=</span> <span class="n">event_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span> <span class="o">=</span> <span class="n">cosmology</span> <span class="k">if</span> <span class="n">cosmology</span> <span class="k">else</span> <span class="n">LambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Ode0</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ler_param</span><span class="o">=</span><span class="s2">&quot;./ler_params.json&quot;</span><span class="p">,</span> <span class="n">unlensed_param</span><span class="o">=</span><span class="s2">&quot;./unlensed_param.json&quot;</span><span class="p">,</span> <span class="n">unlensed_param_detectable</span><span class="o">=</span><span class="s2">&quot;./unlensed_param_detectable.json&quot;</span><span class="p">,</span> <span class="n">lensed_param</span><span class="o">=</span><span class="s2">&quot;./lensed_param.json&quot;</span><span class="p">,</span> <span class="n">lensed_param_detectable</span><span class="o">=</span><span class="s2">&quot;./lensed_param_detectable.json&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">json_file_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">json_file_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

        <span class="k">def</span> <span class="nf">initialization</span><span class="p">():</span>
            <span class="c1"># initialization of parent class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_initialization</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">snr_finder</span> <span class="o">==</span> <span class="s2">&quot;gwsnr&quot;</span><span class="p">:</span>
                <span class="c1"># initialization self.snr and self.pdet from GWSNR class</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gwsnr_intialization</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">snr</span> <span class="o">=</span> <span class="n">snr_finder</span>
            <span class="c1"># store all the ler input parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">store_ler_params</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;ler_param&quot;</span><span class="p">])</span>

        <span class="c1"># if verbose, prevent anything from printing</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">initialization</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_all_params</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">initialization</span><span class="p">()</span>
            
<div class="viewcode-block" id="LeR.print_all_params">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.print_all_params">[docs]</a>
    <span class="k">def</span> <span class="nf">print_all_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to print all the parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># print all relevant functions and sampler priors</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> LeR set up params:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;npool = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npool</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;z_min = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;z_max = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;event_type = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;size = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;batch_size = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cosmology = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;snr_finder = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;json_file_names = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;directory = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> LeR also takes CBCSourceParameterDistribution params as kwargs, as follows:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;source_priors=&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;source_priors&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;source_priors_params=&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;source_priors_params&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;spin_zero=&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;spin_zero&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;spin_precession=&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;spin_precession&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;create_new_interpolator=&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;create_new_interpolator&quot;</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> LeR also takes LensGalaxyParameterDistribution params as kwargs, as follows:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lens_type = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;lens_type&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lens_functions = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;lens_functions&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lens_priors = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;lens_priors&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lens_priors_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;lens_priors_params&quot;</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Image properties:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n_min_images = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_min_images</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n_max_images = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_max_images</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;geocent_time_min = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geocent_time_min</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;geocent_time_max = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geocent_time_max</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lens_model_list = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_model_list</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> LeR also takes gwsnr.GWSNR params as kwargs, as follows:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mtot_min = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;mtot_min&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mtot_max = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;mtot_max&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ratio_min = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;ratio_min&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ratio_max = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;ratio_max&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mtot_resolution = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;mtot_resolution&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ratio_resolution = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;ratio_resolution&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sampling_frequency = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;sampling_frequency&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;waveform_approximant = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;waveform_approximant&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum_frequency = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;minimum_frequency&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;snr_type = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;snr_type&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;psds = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;psds&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ifos = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;ifos&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;interpolator_dir = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;interpolator_dir&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;create_new_interpolator = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;create_new_interpolator&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gwsnr_verbose = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;gwsnr_verbose&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;multiprocessing_verbose = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;multiprocessing_verbose&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mtot_cut = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="p">[</span><span class="s2">&quot;mtot_cut&quot;</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> For reference, the chosen source parameters are listed below:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;merger_rate_density = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;merger_rate_density&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;merger_rate_density_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;merger_rate_density&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;source_frame_masses = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;source_frame_masses&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;source_frame_masses_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;source_frame_masses&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;geocent_time = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;geocent_time_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;geocent_time&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ra = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ra_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dec = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dec_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phase = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;phase&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phase_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;phase&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;psi = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;psi&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;psi_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;psi&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;theta_jn = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;theta_jn&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;theta_jn_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;theta_jn&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_zero</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a_1 = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;a_1&quot;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a_1_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;a_1&quot;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a_2 = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;a_2&quot;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a_2_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;a_2&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_precession</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tilt_1 = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;tilt_1&quot;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tilt_1_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;tilt_1&quot;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tilt_2 = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;tilt_2&quot;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tilt_2_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;tilt_2&quot;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phi_12 = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;phi_12&quot;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phi_12_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;phi_12&quot;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phi_jl = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">[</span><span class="s2">&quot;phi_jl&quot;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phi_jl_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;phi_jl&quot;</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> For reference, the chosen lens related parameters and functions are listed below:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lens_redshift = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lens_redshift_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;lens_redshift&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;velocity_dispersion = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;velocity_dispersion_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;velocity_dispersion&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;axis_ratio = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;axis_ratio_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_ratio&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;axis_rotation_angle = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;axis_rotation_angle_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;axis_rotation_angle&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shear = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;shear&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shear_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;shear&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mass_density_spectral_index = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">[</span><span class="s2">&quot;mass_density_spectral_index&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mass_density_spectral_index_params = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">[</span><span class="s2">&quot;mass_density_spectral_index&quot;</span><span class="p">])</span>
        <span class="c1"># lens functions</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lens functions:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;strong_lensing_condition = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s2">&quot;strong_lensing_condition&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;optical_depth = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="p">[</span><span class="s2">&quot;optical_depth&quot;</span><span class="p">])</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="LeR.snr">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.snr">[docs]</a>
    <span class="k">def</span> <span class="nf">snr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to get the snr with the given parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gw_param_dict : `dict`</span>
<span class="sd">            dictionary of GW source parameters.</span>
<span class="sd">            mass_1 : `numpy.ndarray` or `float`</span>
<span class="sd">                mass_1 of the compact binary (detector frame) (Msun).</span>
<span class="sd">            mass_2 : `numpy.ndarray` or `float`</span>
<span class="sd">                mass_2 of the compact binary (detector frame) (Msun).</span>
<span class="sd">            luminosity_distance : `numpy.ndarray` or `float`</span>
<span class="sd">                luminosity distance of the source (Mpc).</span>
<span class="sd">            theta_jn : `numpy.ndarray` or `float`</span>
<span class="sd">                inclination angle of the source (rad).</span>
<span class="sd">            psi : `numpy.ndarray` or `float`</span>
<span class="sd">                polarization angle of the source (rad).</span>
<span class="sd">            phase : `numpy.ndarray` or `float`</span>
<span class="sd">                phase of GW at reference frequency  (rad).</span>
<span class="sd">            geocent_time : `numpy.ndarray` or `float`</span>
<span class="sd">                GPS time of coalescence (s).</span>
<span class="sd">            ra : `numpy.ndarray` or `float`</span>
<span class="sd">                right ascension of the source (rad).</span>
<span class="sd">            dec : `numpy.ndarray` or `float`</span>
<span class="sd">                declination of the source (rad).</span>
<span class="sd">            a_1 : `numpy.ndarray` or `float`</span>
<span class="sd">                dimensionless spin magnitude of the more massive object.</span>
<span class="sd">            a_2 : `numpy.ndarray` or `float`</span>
<span class="sd">                dimensionless spin magnitude of the less massive object.</span>
<span class="sd">            tilt_1 : `numpy.ndarray` or `float`</span>
<span class="sd">                tilt angle of the more massive object spin.</span>
<span class="sd">            tilt_2 : `numpy.ndarray` or `float`</span>
<span class="sd">                tilt angle of the less massive object spin.</span>
<span class="sd">            phi_12 : `numpy.ndarray` or `float`</span>
<span class="sd">                azimuthal angle between the two spin vectors.</span>
<span class="sd">            phi_jl : `numpy.ndarray` or `float`</span>
<span class="sd">                azimuthal angle between total angular momentum and the orbital angular momentum.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        optimal_snr_list : `list`</span>
<span class="sd">            e.g. [optimal_snr_net, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;]</span>
<span class="sd">            optimal_snr_net : `numpy.ndarray` or `float`</span>
<span class="sd">                optimal snr of the network.</span>
<span class="sd">            &#39;H1&#39; : `numpy.ndarray` or `float`</span>
<span class="sd">                optimal snr of H1.</span>
<span class="sd">            &#39;L1&#39; : `numpy.ndarray` or `float`</span>
<span class="sd">                optimal snr of L1.</span>
<span class="sd">            &#39;V1&#39; : `numpy.ndarray` or `float`</span>
<span class="sd">                optimal snr of V1.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_snr</span></div>

    
    <span class="nd">@snr</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snr_finder</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_snr</span> <span class="o">=</span> <span class="n">snr_finder</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="LeR.unlensed_param">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.unlensed_param">[docs]</a>
    <span class="k">def</span> <span class="nf">unlensed_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to get data from the json file self.json_file_names[&quot;unlensed_param&quot;].</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        unlensed_param : `dict`</span>
<span class="sd">            dictionary of unlensed GW source parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;unlensed_param&quot;</span><span class="p">])</span></div>

    
    <span class="nd">@property</span>
<div class="viewcode-block" id="LeR.unlensed_param_detectable">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.unlensed_param_detectable">[docs]</a>
    <span class="k">def</span> <span class="nf">unlensed_param_detectable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to get data from the json file self.json_file_names[&quot;unlensed_param_detectable&quot;].</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        unlensed_param_detectable : `dict`</span>
<span class="sd">            dictionary of unlensed GW source parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;unlensed_param_detectable&quot;</span><span class="p">])</span></div>

    
    <span class="nd">@property</span>
<div class="viewcode-block" id="LeR.lensed_param">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.lensed_param">[docs]</a>
    <span class="k">def</span> <span class="nf">lensed_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to get data from the json file self.json_file_names[&quot;lensed_param&quot;].</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        lensed_param : `dict`</span>
<span class="sd">            dictionary of lensed GW source parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;lensed_param&quot;</span><span class="p">])</span></div>

    
    <span class="nd">@property</span>
<div class="viewcode-block" id="LeR.lensed_param_detectable">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.lensed_param_detectable">[docs]</a>
    <span class="k">def</span> <span class="nf">lensed_param_detectable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to get data from the json file self.json_file_names[&quot;lensed_param_detectable&quot;].</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        lensed_param_detectable : `dict`</span>
<span class="sd">            dictionary of lensed GW source parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;lensed_param_detectable&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="LeR.class_initialization">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.class_initialization">[docs]</a>
    <span class="k">def</span> <span class="nf">class_initialization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to initialize the parent classes. List of relevant initialized instances, \n</span>
<span class="sd">        1. self.sample_source_redshift</span>
<span class="sd">        2. self.sample_unlensed_parameters</span>
<span class="sd">        3. self.normalization_pdf_z</span>
<span class="sd">        4. self.sample_lens_parameters</span>
<span class="sd">        5. self.normalization_pdf_z_lensed</span>
<span class="sd">        6. self.image_properties</span>
<span class="sd">        7. self.get_lensed_snrs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : `dict`</span>
<span class="sd">            dictionary of parameters to initialize the parent classes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialization of LensGalaxyParameterDistribution class</span>
        <span class="c1"># it also initializes the CBCSourceParameterDistribution and ImageProperties classes</span>
        <span class="n">input_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">z_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">,</span>
            <span class="n">z_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">,</span>
            <span class="n">cosmology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
            <span class="n">lens_type</span><span class="o">=</span><span class="s2">&quot;epl_galaxy&quot;</span><span class="p">,</span>
            <span class="n">lens_functions</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">lens_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">lens_priors_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">source_priors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">source_priors_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">spin_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">spin_precession</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">create_new_interpolator</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">input_params</span><span class="p">:</span>
                    <span class="n">input_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span> <span class="o">=</span> <span class="n">input_params</span>
        <span class="c1"># initialization of clasess</span>
        <span class="n">LensGalaxyParameterDistribution</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">z_min</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">],</span>
            <span class="n">z_max</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">],</span>
            <span class="n">cosmology</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;cosmology&quot;</span><span class="p">],</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;event_type&quot;</span><span class="p">],</span>
            <span class="n">lens_type</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;lens_type&quot;</span><span class="p">],</span>
            <span class="n">lens_functions</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;lens_functions&quot;</span><span class="p">],</span>
            <span class="n">lens_priors</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;lens_priors&quot;</span><span class="p">],</span>
            <span class="n">lens_priors_params</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;lens_priors_params&quot;</span><span class="p">],</span>
            <span class="n">source_priors</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;source_priors&quot;</span><span class="p">],</span>
            <span class="n">source_priors_params</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;source_priors_params&quot;</span><span class="p">],</span>
            <span class="n">spin_zero</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;spin_zero&quot;</span><span class="p">],</span>
            <span class="n">spin_precession</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;spin_precession&quot;</span><span class="p">],</span>
            <span class="n">directory</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span>
            <span class="n">create_new_interpolator</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;create_new_interpolator&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;source_priors&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;source_priors_params&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;lens_priors&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;lens_priors_params&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="p">[</span><span class="s2">&quot;lens_functions&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lens_functions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="LeR.gwsnr_intialization">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.gwsnr_intialization">[docs]</a>
    <span class="k">def</span> <span class="nf">gwsnr_intialization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to initialize the gwsnr class</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : `dict`</span>
<span class="sd">            dictionary of parameters to initialize the gwsnr class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">gwsnr</span> <span class="kn">import</span> <span class="n">GWSNR</span>

        <span class="c1"># initialization of GWSNR class</span>
        <span class="n">input_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">npool</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">npool</span><span class="p">,</span>
            <span class="n">mtot_min</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
            <span class="n">mtot_max</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
            <span class="n">ratio_min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">ratio_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">mtot_resolution</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">ratio_resolution</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">sampling_frequency</span><span class="o">=</span><span class="mf">2048.0</span><span class="p">,</span>
            <span class="n">waveform_approximant</span><span class="o">=</span><span class="s2">&quot;IMRPhenomD&quot;</span><span class="p">,</span>
            <span class="n">minimum_frequency</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
            <span class="n">snr_type</span><span class="o">=</span><span class="s2">&quot;interpolation&quot;</span><span class="p">,</span>
            <span class="n">psds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">ifos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">interpolator_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">create_new_interpolator</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">gwsnr_verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">multiprocessing_verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">mtot_cut</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># if self.event_type == &quot;BNS&quot;:</span>
        <span class="c1">#     input_params[&quot;mtot_max&quot;]= 18.</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">input_params</span><span class="p">:</span>
                    <span class="n">input_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span> <span class="o">=</span> <span class="n">input_params</span>
        <span class="n">gwsnr</span> <span class="o">=</span> <span class="n">GWSNR</span><span class="p">(</span>
                    <span class="n">npool</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;npool&quot;</span><span class="p">],</span>
                    <span class="n">mtot_min</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;mtot_min&quot;</span><span class="p">],</span>
                    <span class="n">mtot_max</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;mtot_max&quot;</span><span class="p">],</span>
                    <span class="n">ratio_min</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;ratio_min&quot;</span><span class="p">],</span>
                    <span class="n">ratio_max</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;ratio_max&quot;</span><span class="p">],</span>
                    <span class="n">mtot_resolution</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;mtot_resolution&quot;</span><span class="p">],</span>
                    <span class="n">ratio_resolution</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;ratio_resolution&quot;</span><span class="p">],</span>
                    <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;sampling_frequency&quot;</span><span class="p">],</span>
                    <span class="n">waveform_approximant</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;waveform_approximant&quot;</span><span class="p">],</span>
                    <span class="n">minimum_frequency</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;minimum_frequency&quot;</span><span class="p">],</span>
                    <span class="n">snr_type</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;snr_type&quot;</span><span class="p">],</span>
                    <span class="n">psds</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;psds&quot;</span><span class="p">],</span>
                    <span class="n">ifos</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;ifos&quot;</span><span class="p">],</span>
                    <span class="n">interpolator_dir</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;interpolator_dir&quot;</span><span class="p">],</span>
                    <span class="c1"># create_new_interpolator=input_params[&quot;create_new_interpolator&quot;],</span>
                    <span class="n">gwsnr_verbose</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;gwsnr_verbose&quot;</span><span class="p">],</span>
                    <span class="n">multiprocessing_verbose</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;multiprocessing_verbose&quot;</span><span class="p">],</span>
                    <span class="n">mtot_cut</span><span class="o">=</span><span class="n">input_params</span><span class="p">[</span><span class="s2">&quot;mtot_cut&quot;</span><span class="p">],</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">snr</span> <span class="o">=</span> <span class="n">gwsnr</span><span class="o">.</span><span class="n">snr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span> <span class="o">=</span> <span class="n">gwsnr</span><span class="o">.</span><span class="n">detector_list</span></div>

        <span class="c1">#self.pdet = gwsnr.pdet</span>

<div class="viewcode-block" id="LeR.store_ler_params">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.store_ler_params">[docs]</a>
    <span class="k">def</span> <span class="nf">store_ler_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_jsonfile</span><span class="o">=</span><span class="s2">&quot;./ler_params.json&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to store the all the necessary parameters. This is useful for reproducing the results. All the parameters stored are in string format to make it json compatible.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_jsonfile : `str`</span>
<span class="sd">            name of the json file to store the parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># store param_sampler_dict, lensed_param_sampler_dict and snr_calculator_dict</span>
        <span class="n">parameters_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">npool</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npool</span><span class="p">),</span>
            <span class="n">z_min</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_min</span><span class="p">),</span>
            <span class="n">z_max</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_max</span><span class="p">),</span>
            <span class="n">size</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">),</span>
            <span class="n">cosmology</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosmo</span><span class="p">),</span>
            <span class="n">snr_finder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="p">),</span>
            <span class="n">json_file_names</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">),</span>
            <span class="n">directory</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># cbc params</span>
        <span class="n">param_sampler_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_param_sampler_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># convert all dict values to str</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">param_sampler_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">param_sampler_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">parameters_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;gw_param_sampler_dict&quot;</span><span class="p">:</span> <span class="n">param_sampler_dict</span><span class="p">})</span>

        <span class="c1"># snr calculator params</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">snr_calculator_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr_calculator_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">snr_calculator_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">snr_calculator_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">parameters_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;snr_calculator_dict&quot;</span><span class="p">:</span> <span class="n">snr_calculator_dict</span><span class="p">})</span>

            <span class="n">file_name</span> <span class="o">=</span> <span class="n">output_jsonfile</span>
            <span class="n">append_json</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">parameters_dict</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># if snr_calculator is custom function</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="LeR.unlensed_cbc_statistics">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.unlensed_cbc_statistics">[docs]</a>
    <span class="k">def</span> <span class="nf">unlensed_cbc_statistics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_jsonfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to generate unlensed GW source parameters. This function also stores the parameters in json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of samples.</span>
<span class="sd">            default size = 100000.</span>
<span class="sd">        resume : `bool`</span>
<span class="sd">            resume = False (default) or True.</span>
<span class="sd">            if True, the function will resume from the last batch.</span>
<span class="sd">        output_jsonfile : `str`</span>
<span class="sd">            json file name for storing the parameters.</span>
<span class="sd">            default output_jsonfile = &#39;./unlensed_params.json&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        unlensed_param : `dict`</span>
<span class="sd">            dictionary of unlensed GW source parameters.</span>
<span class="sd">            unlensed_param.keys() = [&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;optimal_snr_net&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;]</span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; from ler.rates import LeR</span>
<span class="sd">        &gt;&gt;&gt; ler = LeR()</span>
<span class="sd">        &gt;&gt;&gt; unlensed_param = ler.unlensed_cbc_statistics()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># gw parameter sampling</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># get json file name</span>
        <span class="k">if</span> <span class="n">output_jsonfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_jsonfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;unlensed_param&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;unlensed_param&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_jsonfile</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unlensed params will be store in </span><span class="si">{</span><span class="n">output_jsonfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># sampling in batches</span>
        <span class="n">batch_handler</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">sampling_routine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unlensed_sampling_routine</span><span class="p">,</span>
            <span class="n">output_jsonfile</span><span class="o">=</span><span class="n">output_jsonfile</span><span class="p">,</span>
            <span class="n">resume</span><span class="o">=</span><span class="n">resume</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">unlensed_param</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unlensed_param</span></div>

    
<div class="viewcode-block" id="LeR.unlensed_sampling_routine">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.unlensed_sampling_routine">[docs]</a>
    <span class="k">def</span> <span class="nf">unlensed_sampling_routine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to generate unlensed GW source parameters. This function also stores the parameters in json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of samples.</span>
<span class="sd">            default size = 100000.</span>
<span class="sd">        resume : `bool`</span>
<span class="sd">            resume = False (default) or True.</span>
<span class="sd">            if True, the function will resume from the last batch.</span>
<span class="sd">        output_jsonfile : `str`</span>
<span class="sd">            json file name for storing the parameters.</span>
<span class="sd">            default output_jsonfile = &#39;./unlensed_params.json&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        unlensed_param : `dict`</span>
<span class="sd">            dictionary of unlensed GW source parameters.</span>
<span class="sd">            unlensed_param.keys() = [&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;optimal_snr_net&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get gw params</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sampling gw source params...&quot;</span><span class="p">)</span>
        <span class="n">unlensed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_gw_parameters</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="c1"># Get all of the signal to noise ratios</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculating snrs...&quot;</span><span class="p">)</span>
        <span class="n">snrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="p">(</span><span class="n">gw_param_dict</span><span class="o">=</span><span class="n">unlensed_param</span><span class="p">)</span>
        <span class="n">unlensed_param</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">snrs</span><span class="p">)</span>

        <span class="c1"># store all params in json file</span>
        <span class="n">append_json</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">=</span><span class="n">unlensed_param</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="ow">not</span> <span class="p">(</span><span class="n">resume</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">unlensed_param</span></div>


<div class="viewcode-block" id="LeR.unlensed_rate">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.unlensed_rate">[docs]</a>
    <span class="k">def</span> <span class="nf">unlensed_rate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">unlensed_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">snr_threshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
        <span class="n">output_jsonfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">detectability_condition</span><span class="o">=</span><span class="s2">&quot;step_function&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to calculate the unlensed rate. This function also stores the parameters of the detectable events in json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unlensed_param : `dict` or `str`</span>
<span class="sd">            dictionary of GW source parameters or json file name.</span>
<span class="sd">            default unlensed_param = &#39;./unlensed_params.json&#39;.</span>
<span class="sd">        snr_threshold : `float`</span>
<span class="sd">            threshold for detection signal to noise ratio.</span>
<span class="sd">            e.g. snr_threshold = 8.</span>
<span class="sd">        output_jsonfile : `str`</span>
<span class="sd">            json file name for storing the parameters of the detectable events.</span>
<span class="sd">            default output_jsonfile = &#39;./unlensed_params_detectable.json&#39;.</span>
<span class="sd">        detectability_condition : `str`</span>
<span class="sd">            detectability condition. </span>
<span class="sd">            default detectability_condition = &#39;step_function&#39;.</span>
<span class="sd">            other options are &#39;pdet&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        total_rate : `float`</span>
<span class="sd">            total unlensed rate (Mpc^-3 yr^-1).</span>
<span class="sd">        unlensed_param : `dict`</span>
<span class="sd">            dictionary of unlensed GW source parameters of the detectable events.</span>
<span class="sd">            unlensed_param.keys() = [&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;optimal_snr_net&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;]</span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; from ler.rates import LeR</span>
<span class="sd">        &gt;&gt;&gt; ler = LeR()</span>
<span class="sd">        &gt;&gt;&gt; ler.unlensed_cbc_statistics();</span>
<span class="sd">        &gt;&gt;&gt; total_rate, unlensed_param_detectable = ler.unlensed_rate()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># call self.json_file_names[&quot;ler_param&quot;] and for adding the final results</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;ler_param&quot;</span><span class="p">])</span>
        
        <span class="c1"># get gw params from json file if not provided</span>
        <span class="k">if</span> <span class="n">unlensed_param</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unlensed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;unlensed_param&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">unlensed_param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;unlensed_param&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unlensed_param</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;getting unlensed_params from json file </span><span class="si">{</span><span class="n">unlensed_param</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="n">unlensed_param</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">unlensed_param</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using provided unlensed_param dict...&quot;</span><span class="p">)</span>
            <span class="n">unlensed_param</span> <span class="o">=</span> <span class="n">unlensed_param</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="n">detectability_condition</span> <span class="o">==</span> <span class="s2">&quot;step_function&quot;</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">unlensed_param</span><span class="p">[</span><span class="s2">&quot;optimal_snr_net&quot;</span><span class="p">]</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="n">snr_threshold</span>

        <span class="k">elif</span> <span class="n">detectability_condition</span> <span class="o">==</span> <span class="s2">&quot;pdet&quot;</span><span class="p">:</span>
            <span class="c1"># check if pdet is provided in unlensed_param dict</span>
            <span class="k">if</span> <span class="s2">&quot;pdet_net&quot;</span> <span class="ow">in</span> <span class="n">unlensed_param</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">unlensed_param</span><span class="p">[</span><span class="s2">&quot;pdet_net&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;optimal_snr_net&quot;</span> <span class="ow">in</span> <span class="n">unlensed_param</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">param</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">snr_threshold</span> <span class="o">-</span> <span class="n">unlensed_param</span><span class="p">[</span><span class="s2">&quot;optimal_snr_net&quot;</span><span class="p">])</span>
                    <span class="n">unlensed_param</span><span class="p">[</span><span class="s2">&quot;pdet_net&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pdet or optimal_snr_net not provided in unlensed_param dict. Exiting...&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="n">idx_detectable</span> <span class="o">=</span> <span class="n">param</span> <span class="o">&gt;</span> <span class="n">threshold</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;number of simulated unlensed detectable events: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">idx_detectable</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;number of all simulated unlensed events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">idx_detectable</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># montecarlo integration</span>
        <span class="c1"># The total rate R = norm &lt;Theta(rho-rhoc)&gt;</span>
        <span class="n">total_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization_pdf_z</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">idx_detectable</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;total unlensed rate (yr^-1) (with step function): </span><span class="si">{</span><span class="n">total_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># store all detectable params in json file</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">unlensed_param</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">unlensed_param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">idx_detectable</span><span class="p">]</span>

        <span class="c1"># store all detectable params in json file</span>
        <span class="k">if</span> <span class="n">output_jsonfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_jsonfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;unlensed_param_detectable&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;unlensed_param_detectable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_jsonfile</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;storing detectable unlensed params in </span><span class="si">{</span><span class="n">output_jsonfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">append_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">unlensed_param</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># write the results</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;detectable_unlensed_rate_per_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_rate</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;detectability_condition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detectability_condition</span>
        <span class="n">append_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;ler_param&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">total_rate</span><span class="p">,</span> <span class="n">unlensed_param</span></div>

    
<div class="viewcode-block" id="LeR.lensed_cbc_statistics">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.lensed_cbc_statistics">[docs]</a>
    <span class="k">def</span> <span class="nf">lensed_cbc_statistics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_jsonfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to generate lensed GW source parameters. This function also stores the parameters in json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of samples.</span>
<span class="sd">            default size = 100000.</span>
<span class="sd">        resume : `bool`</span>
<span class="sd">            resume = False (default) or True.</span>
<span class="sd">            if True, the function will resume from the last batch.</span>
<span class="sd">        output_jsonfile : `str`</span>
<span class="sd">            json file name for storing the parameters.</span>
<span class="sd">            default output_jsonfile = &#39;./lensed_params.json&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        lensed_param : `dict`</span>
<span class="sd">            dictionary of lensed GW source parameters.</span>
<span class="sd">            lensed_param.keys() = </span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; from ler.rates import LeR</span>
<span class="sd">        &gt;&gt;&gt; ler = LeR()</span>
<span class="sd">        &gt;&gt;&gt; lensed_param = ler.lensed_cbc_statistics()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># gw parameter sampling</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># get json file name</span>
        <span class="k">if</span> <span class="n">output_jsonfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_jsonfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;lensed_param&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;lensed_param&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_jsonfile</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lensed params will be store in </span><span class="si">{</span><span class="n">output_jsonfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># sampling in batches</span>
        <span class="n">batch_handler</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">sampling_routine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lensed_sampling_routine</span><span class="p">,</span>
            <span class="n">output_jsonfile</span><span class="o">=</span><span class="n">output_jsonfile</span><span class="p">,</span>
            <span class="n">resume</span><span class="o">=</span><span class="n">resume</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">lensed_param</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lensed_param</span></div>

    
<div class="viewcode-block" id="LeR.lensed_sampling_routine">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.lensed_sampling_routine">[docs]</a>
    <span class="k">def</span> <span class="nf">lensed_sampling_routine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to generate lensed GW source parameters. This function also stores the parameters in json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of samples.</span>
<span class="sd">            default size = 100000.</span>
<span class="sd">        resume : `bool`</span>
<span class="sd">            resume = False (default) or True.</span>
<span class="sd">            if True, the function will resume from the last batch.</span>
<span class="sd">        output_jsonfile : `str`</span>
<span class="sd">            json file name for storing the parameters.</span>
<span class="sd">            default output_jsonfile = &#39;./lensed_params.json&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        lensed_param : `dict`</span>
<span class="sd">            dictionary of lensed GW source parameters.</span>
<span class="sd">            lensed_param.keys() = </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get lensed params</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sampling lensed params...&quot;</span><span class="p">)</span>
        <span class="n">lensed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_lens_parameters</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="c1"># now get (strongly lensed) image paramters along with lens parameters</span>
        <span class="n">lensed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_properties</span><span class="p">(</span><span class="n">lensed_param</span><span class="p">)</span>
        <span class="c1"># Get all of the signal to noise ratios</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculating snrs...&quot;</span><span class="p">)</span>
        <span class="n">snrs</span><span class="p">,</span> <span class="n">lensed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lensed_snrs</span><span class="p">(</span>
            <span class="n">snr_calculator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">snr</span><span class="p">,</span>
            <span class="n">list_of_detectors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">list_of_detectors</span><span class="p">,</span>
            <span class="n">lensed_param</span><span class="o">=</span><span class="n">lensed_param</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">lensed_param</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">snrs</span><span class="p">)</span>

        <span class="c1"># store all params in json file</span>
        <span class="n">append_json</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">=</span><span class="n">lensed_param</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="ow">not</span> <span class="p">(</span><span class="n">resume</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">lensed_param</span></div>


<div class="viewcode-block" id="LeR.lensed_rate">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.lensed_rate">[docs]</a>
    <span class="k">def</span> <span class="nf">lensed_rate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lensed_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">snr_threshold</span><span class="o">=</span><span class="p">[</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">],</span>
        <span class="n">num_img</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">output_jsonfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nan_to_num</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">detectability_condition</span><span class="o">=</span><span class="s2">&quot;step_function&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to calculate the lensed rate. This function also stores the parameters of the detectable events in json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lensed_param : `dict` or `str`</span>
<span class="sd">            dictionary of GW source parameters or json file name.</span>
<span class="sd">            default lensed_param = &#39;./lensed_params.json&#39;.</span>
<span class="sd">        snr_threshold : `float`</span>
<span class="sd">            threshold for detection signal to noise ratio.</span>
<span class="sd">            default snr_threshold = [8.0,8.0].</span>
<span class="sd">        num_img : `int`</span>
<span class="sd">            number of images.</span>
<span class="sd">            default num_img = [1,1].</span>
<span class="sd">        output_jsonfile : `str`</span>
<span class="sd">            json file name for storing the parameters of the detectable events.</span>
<span class="sd">            default output_jsonfile = &#39;./lensed_params_detectable.json&#39;.</span>
<span class="sd">        nan_to_num : `bool`</span>
<span class="sd">            if True, nan values will be converted to 0.</span>
<span class="sd">            default nan_to_num = True.</span>
<span class="sd">        detectability_condition : `str`</span>
<span class="sd">            detectability condition.</span>
<span class="sd">            default detectability_condition = &#39;step_function&#39;.</span>
<span class="sd">            other options are &#39;pdet&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        total_rate : `float`</span>
<span class="sd">            total lensed rate (Mpc^-3 yr^-1).</span>
<span class="sd">        lensed_param : `dict`</span>
<span class="sd">            dictionary of lensed GW source parameters of the detectable events.</span>
<span class="sd">            lensed_param.keys() =</span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; from ler.rates import LeR</span>
<span class="sd">        &gt;&gt;&gt; ler = LeR()</span>
<span class="sd">        &gt;&gt;&gt; ler.lensed_cbc_statistics();</span>
<span class="sd">        &gt;&gt;&gt; total_rate, lensed_param_detectable = ler.lensed_rate()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># call self.json_file_names[&quot;ler_param&quot;] and for adding the final results</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;ler_param&quot;</span><span class="p">])</span>

        <span class="c1"># get gw params from json file if not provided</span>
        <span class="k">if</span> <span class="n">lensed_param</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lensed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;lensed_param&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lensed_param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;lensed_param&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lensed_param</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;getting lensed_params from json file </span><span class="si">{</span><span class="n">lensed_param</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="n">lensed_param</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">lensed_param</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using provided lensed_param dict...&quot;</span><span class="p">)</span>
            <span class="n">lensed_param</span> <span class="o">=</span> <span class="n">lensed_param</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># check for images with snr above threshold</span>
        <span class="c1"># convert to array</span>
        <span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">snr_threshold</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  
        <span class="n">num_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">num_img</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># get descending sorted idx of snr_threshold</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">snr_threshold</span><span class="p">)</span>
        <span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr_threshold</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">num_img</span> <span class="o">=</span> <span class="n">num_img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="c1"># get size of the lensed_param for a parameter</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lensed_param</span><span class="p">[</span><span class="s2">&quot;zs&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">detectability_condition</span> <span class="o">==</span> <span class="s2">&quot;step_function&quot;</span><span class="p">:</span>
            <span class="n">snr_hit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># boolean array to store the result of the threshold condition</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">snr_param</span> <span class="o">=</span> <span class="n">lensed_param</span><span class="p">[</span><span class="s2">&quot;optimal_snr_net&quot;</span><span class="p">]</span>
                <span class="n">snr_param</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="o">-</span><span class="n">snr_param</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sort snr in descending order</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;snr not provided in lensed_param dict. Exiting...&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            
            <span class="c1"># for each row: choose a threshold and check if the number of images above threshold. Sum over the images. If sum is greater than num_img, then snr_hit = True </span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">idx_max</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">snr_threshold</span><span class="p">)):</span>
                <span class="n">idx_max</span> <span class="o">=</span> <span class="n">idx_max</span> <span class="o">+</span> <span class="n">num_img</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">snr_hit</span> <span class="o">=</span> <span class="n">snr_hit</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">snr_param</span><span class="p">[:,</span><span class="n">j</span><span class="p">:</span><span class="n">idx_max</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">snr_threshold</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">num_img</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">idx_max</span>

            <span class="c1"># montecarlo integration</span>
            <span class="n">total_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization_pdf_z_lensed</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">snr_hit</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;total lensed rate (yr^-1) (with step function): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_rate</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">detectability_condition</span> <span class="o">==</span> <span class="s2">&quot;pdet&quot;</span><span class="p">:</span>
            <span class="c1"># check if pdet is provided in unlensed_param dict</span>
            <span class="k">if</span> <span class="s2">&quot;pdet_net&quot;</span> <span class="ow">in</span> <span class="n">lensed_param</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">pdet</span> <span class="o">=</span> <span class="n">lensed_param</span><span class="p">[</span><span class="s2">&quot;pdet_net&quot;</span><span class="p">]</span>
                <span class="n">pdet</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="o">-</span><span class="n">pdet</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sort pdet in descending order</span>
                <span class="n">pdet</span> <span class="o">=</span> <span class="n">pdet</span><span class="p">[:,:</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">num_img</span><span class="p">)]</span>  <span class="c1"># use only num_img images</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;optimal_snr_net&quot;</span> <span class="ow">in</span> <span class="n">lensed_param</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># pdet dimension is (size, n_max_images)</span>
                    <span class="n">snr_param</span> <span class="o">=</span> <span class="n">lensed_param</span><span class="p">[</span><span class="s2">&quot;optimal_snr_net&quot;</span><span class="p">]</span>
                    <span class="n">snr_param</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="o">-</span><span class="n">snr_param</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sort snr in descending order</span>

                    <span class="n">pdet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">snr_param</span><span class="p">))</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">idx_max</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">snr_threshold</span><span class="p">)):</span>
                        <span class="n">idx_max</span> <span class="o">=</span> <span class="n">idx_max</span> <span class="o">+</span> <span class="n">num_img</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">pdet</span><span class="p">[:,</span><span class="n">j</span><span class="p">:</span><span class="n">idx_max</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">snr_threshold</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">snr_param</span><span class="p">[:,</span><span class="n">j</span><span class="p">:</span><span class="n">idx_max</span><span class="p">])</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="n">idx_max</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pdet or optimal_snr_net not provided in lensed_param dict. Exiting...&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                
            <span class="n">snr_hit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">pdet</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.5</span>
            <span class="c1"># montecarlo integration</span>
            <span class="n">total_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization_pdf_z_lensed</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">snr_hit</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;total lensed rate (yr^-1) (with pdet function): </span><span class="si">{</span><span class="n">total_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;number of simulated lensed detectable events: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">snr_hit</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;number of simulated all lensed events: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># store all detectable params in json file</span>
        <span class="k">if</span> <span class="n">nan_to_num</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">lensed_param</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">lensed_param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">snr_hit</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">lensed_param</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">lensed_param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">snr_hit</span><span class="p">]</span>
            
        <span class="c1"># store all detectable params in json file</span>
        <span class="k">if</span> <span class="n">output_jsonfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_jsonfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;lensed_param_detectable&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;lensed_param_detectable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_jsonfile</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;storing detectable lensed params in </span><span class="si">{</span><span class="n">output_jsonfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">append_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">lensed_param</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># write the results</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;detectable_lensed_rate_per_year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_rate</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;detectability_condition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detectability_condition</span>
        <span class="n">append_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;ler_param&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">total_rate</span><span class="p">,</span> <span class="n">lensed_param</span></div>

     
<div class="viewcode-block" id="LeR.rate_ratio">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.rate_ratio">[docs]</a>
    <span class="k">def</span> <span class="nf">rate_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to calculate and display unlensed and lensed merger rate ratio. </span>
<span class="sd">        It will get the unlensed_rate and lensed_rate from self.json_file_ler_param</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        rate_ratio : `float`</span>
<span class="sd">            rate ratio.</span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; from ler.rates import LeR</span>
<span class="sd">        &gt;&gt;&gt; ler = LeR()</span>
<span class="sd">        &gt;&gt;&gt; ler.unlensed_cbc_statistics();</span>
<span class="sd">        &gt;&gt;&gt; ler.lensed_cbc_statistics();</span>
<span class="sd">        &gt;&gt;&gt; ler.unlensed_rate();</span>
<span class="sd">        &gt;&gt;&gt; ler.lensed_rate();</span>
<span class="sd">        &gt;&gt;&gt; ler.rate_ratio()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># call json_file_ler_param and add the results</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;ler_param&quot;</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">unlensed_rate</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;detectable_unlensed_rate_per_year&quot;</span><span class="p">]</span>
            <span class="n">lensed_rate</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;detectable_lensed_rate_per_year&quot;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unlensed_rate_step or lensed_rate_step not found in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s1">&#39;ler_param&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> json file. Exiting...&quot;</span><span class="p">)</span>
        
        <span class="n">rate_ratio</span> <span class="o">=</span> <span class="n">unlensed_rate</span> <span class="o">/</span> <span class="n">lensed_rate</span>
        <span class="c1"># append the results</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rate_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rate_ratio</span>
        <span class="c1"># write the results</span>
        <span class="n">append_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;ler_param&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unlensed_rate: </span><span class="si">{</span><span class="n">unlensed_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lensed_rate: </span><span class="si">{</span><span class="n">lensed_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ratio: </span><span class="si">{</span><span class="n">rate_ratio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">unlensed_rate</span> <span class="o">/</span> <span class="n">lensed_rate</span></div>

    
<div class="viewcode-block" id="LeR.rate_comparision_with_rate_calculation">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.rate_comparision_with_rate_calculation">[docs]</a>
    <span class="k">def</span> <span class="nf">rate_comparision_with_rate_calculation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">unlensed_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">snr_threshold_unlensed</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
        <span class="n">output_jsonfile_unlensed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lensed_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">snr_threshold_lensed</span><span class="o">=</span><span class="p">[</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">],</span>
        <span class="n">num_img</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">output_jsonfile_lensed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nan_to_num</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">detectability_condition</span><span class="o">=</span><span class="s2">&quot;step_function&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to calculate the unlensed and lensed rate and compare by computing the ratio. This function also stores the parameters of the detectable events in json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unlensed_param : `dict` or `str`</span>
<span class="sd">            dictionary of GW source parameters or json file name.</span>
<span class="sd">            default unlensed_param = &#39;./unlensed_params.json&#39;.</span>
<span class="sd">        snr_threshold_unlensed : `float`</span>
<span class="sd">            threshold for detection signal to noise ratio.</span>
<span class="sd">            e.g. snr_threshold = 8.</span>
<span class="sd">        output_jsonfile_unlensed : `str`</span>
<span class="sd">            json file name for storing the parameters of the detectable events.</span>
<span class="sd">            default output_jsonfile = &#39;./unlensed_params_detectable.json&#39;.</span>
<span class="sd">        lensed_param : `dict` or `str`</span>
<span class="sd">            dictionary of GW source parameters or json file name.</span>
<span class="sd">            default lensed_param = &#39;./lensed_params.json&#39;.</span>
<span class="sd">        snr_threshold_lensed : `float`</span>
<span class="sd">            threshold for detection signal to noise ratio.</span>
<span class="sd">            e.g. snr_threshold = 8.</span>
<span class="sd">        output_jsonfile_lensed : `str`</span>
<span class="sd">            json file name for storing the parameters of the detectable events.</span>
<span class="sd">            default output_jsonfile = &#39;./lensed_params_detectable.json&#39;.</span>
<span class="sd">        detectability_condition : `str`</span>
<span class="sd">            detectability condition. </span>
<span class="sd">            default detectability_condition = &#39;step_function&#39;.</span>
<span class="sd">            other options are &#39;pdet&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        rate_ratio : `float`</span>
<span class="sd">            rate ratio.</span>
<span class="sd">        unlensed_param : `dict`</span>
<span class="sd">            dictionary of unlensed GW source parameters of the detectable events.</span>
<span class="sd">        lensed_param : `dict`</span>
<span class="sd">            dictionary of lensed GW source parameters of the detectable events.</span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; from ler.rates import LeR</span>
<span class="sd">        &gt;&gt;&gt; ler = LeR()</span>
<span class="sd">        &gt;&gt;&gt; ler.unlensed_cbc_statistics();</span>
<span class="sd">        &gt;&gt;&gt; ler.lensed_cbc_statistics();</span>
<span class="sd">        &gt;&gt;&gt; rate_ratio, unlensed_param, lensed_param = ler.rate_comparision_with_rate_calculation()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># call json_file_ler_param and add the results</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;ler_param&quot;</span><span class="p">])</span>

        <span class="c1"># get unlensed rate</span>
        <span class="n">unlensed_rate</span><span class="p">,</span> <span class="n">unlensed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlensed_rate</span><span class="p">(</span>
            <span class="n">unlensed_param</span><span class="o">=</span><span class="n">unlensed_param</span><span class="p">,</span>
            <span class="n">snr_threshold</span><span class="o">=</span><span class="n">snr_threshold_unlensed</span><span class="p">,</span>
            <span class="n">output_jsonfile</span><span class="o">=</span><span class="n">output_jsonfile_unlensed</span><span class="p">,</span>
            <span class="n">detectability_condition</span><span class="o">=</span><span class="n">detectability_condition</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># get lensed rate</span>
        <span class="n">lensed_rate</span><span class="p">,</span> <span class="n">lensed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lensed_rate</span><span class="p">(</span>
            <span class="n">lensed_param</span><span class="o">=</span><span class="n">lensed_param</span><span class="p">,</span>
            <span class="n">snr_threshold</span><span class="o">=</span><span class="n">snr_threshold_lensed</span><span class="p">,</span>
            <span class="n">num_img</span><span class="o">=</span><span class="n">num_img</span><span class="p">,</span>
            <span class="n">output_jsonfile</span><span class="o">=</span><span class="n">output_jsonfile_lensed</span><span class="p">,</span>
            <span class="n">nan_to_num</span><span class="o">=</span><span class="n">nan_to_num</span><span class="p">,</span>
            <span class="n">detectability_condition</span><span class="o">=</span><span class="n">detectability_condition</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># calculate rate ratio</span>
        <span class="n">rate_ratio</span> <span class="o">=</span> <span class="n">unlensed_rate</span> <span class="o">/</span> <span class="n">lensed_rate</span>
        <span class="c1"># append the results</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;detectable_unlensed_rate_per_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unlensed_rate</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;detectable_lensed_rate_per_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lensed_rate</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rate_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rate_ratio</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;detectability_condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detectability_condition</span>
        <span class="c1"># write the results</span>
        <span class="n">append_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s2">&quot;ler_param&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unlensed_rate: </span><span class="si">{</span><span class="n">unlensed_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lensed_rate: </span><span class="si">{</span><span class="n">lensed_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ratio: </span><span class="si">{</span><span class="n">rate_ratio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rate_ratio</span><span class="p">,</span> <span class="n">unlensed_param</span><span class="p">,</span> <span class="n">lensed_param</span></div>


<div class="viewcode-block" id="LeR.selecting_n_unlensed_detectable_events">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.selecting_n_unlensed_detectable_events">[docs]</a>
    <span class="k">def</span> <span class="nf">selecting_n_unlensed_detectable_events</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">snr_threshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
        <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">output_jsonfile</span><span class="o">=</span><span class="s2">&quot;./n_unlensed_param_detectable.json&quot;</span><span class="p">,</span>
        <span class="n">meta_data_file</span><span class="o">=</span><span class="s2">&quot;meta_unlensed.json&quot;</span><span class="p">,</span>
        <span class="n">event_batch_limit</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">trim_to_size</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to select n unlensed detectable events.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of samples to be selected.</span>
<span class="sd">            default size = 100.</span>
<span class="sd">        snr_threshold : `float`</span>
<span class="sd">            threshold for detection signal to noise ratio.</span>
<span class="sd">            e.g. snr_threshold = 8.</span>
<span class="sd">        resume : `bool`</span>
<span class="sd">            if True, it will resume the sampling from the last batch.</span>
<span class="sd">            default resume = False.</span>
<span class="sd">        output_jsonfile : `str`</span>
<span class="sd">            json file name for storing the parameters.</span>
<span class="sd">            default output_jsonfile = &#39;./n_unlensed_params_detectable.json&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        param_final : `dict`</span>
<span class="sd">            dictionary of unlensed GW source parameters of the detectable events.</span>
<span class="sd">            param_final.keys() = [&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;optimal_snr_net&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;]</span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; from ler.rates import LeR</span>
<span class="sd">        &gt;&gt;&gt; ler = LeR()</span>
<span class="sd">        &gt;&gt;&gt; unlensed_param_final = ler.selecting_n_unlensed_detectable_events(size=500)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">resume</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># iterator</span>
            <span class="n">events_total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># get sample size as size from json file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">param_final</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_final</span><span class="p">[</span><span class="s2">&quot;zs&quot;</span><span class="p">])</span>
                <span class="n">events_total</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="n">meta_data_file</span><span class="p">)[</span><span class="s2">&quot;events_total&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">param_final</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">events_total</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">buffer_file</span> <span class="o">=</span> <span class="s2">&quot;./unlensed_params_buffer.json&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;collected number of events = &quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        
        <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="c1"># disable print statements</span>
            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">unlensed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlensed_sampling_routine</span><span class="p">(</span>
                    <span class="n">size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">output_jsonfile</span><span class="o">=</span><span class="n">buffer_file</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>

            <span class="c1"># get snr</span>
            <span class="n">snr</span> <span class="o">=</span> <span class="n">unlensed_param</span><span class="p">[</span><span class="s2">&quot;optimal_snr_net&quot;</span><span class="p">]</span>
            <span class="c1"># snr_ = self.snr(gw_param_dict=unlensed_param)[&quot;optimal_snr_net&quot;]</span>
            <span class="c1"># test = snr == snr_</span>
            <span class="c1"># index of detectable events</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">snr</span> <span class="o">&gt;</span> <span class="n">snr_threshold</span>

            <span class="c1"># store all params in json file</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">event_batch_limit</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">unlensed_param</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">unlensed_param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">append_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">unlensed_param</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="n">n</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="n">events_total</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>                
                <span class="n">total_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization_pdf_z</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">events_total</span>

                <span class="c1"># save meta data</span>
                <span class="n">meta_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">events_total</span><span class="o">=</span><span class="n">events_total</span><span class="p">,</span> <span class="n">total_rate</span><span class="o">=</span><span class="n">total_rate</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">append_json</span><span class="p">(</span><span class="n">meta_data_file</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">append_json</span><span class="p">(</span><span class="n">meta_data_file</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="c1"># else:</span>
            <span class="c1">#     snr_param = self.snr(gw_param_dict=unlensed_param)[&#39;optimal_snr_net&#39;]</span>
            <span class="c1">#     print(snr_param)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;collected number of events = &quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;total number of events = &quot;</span><span class="p">,</span> <span class="n">events_total</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;total unlensed rate (yr^-1): </span><span class="si">{</span><span class="n">total_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;storing detectable unlensed params in </span><span class="si">{</span><span class="n">output_jsonfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trim_to_size</span><span class="p">:</span>
            <span class="c1"># trim the final param dictionary</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> trmming final result to size=</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">param_final</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">)</span>
            <span class="c1"># trim the final param dictionary, randomly, without repeating</span>
            <span class="c1"># idx_ = np.random.choice(len(param_final[&quot;zs&quot;]), size, replace=False)</span>
            <span class="c1"># for key, value in param_final.items():</span>
            <span class="c1">#     param_final[key] = param_final[key][idx_]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">param_final</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">param_final</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_final</span><span class="p">[</span><span class="n">key</span><span class="p">][:</span><span class="n">size</span><span class="p">]</span>

            <span class="c1"># save the final param dictionary</span>
            
            <span class="n">append_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">param_final</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">param_final</span></div>

    
<div class="viewcode-block" id="LeR.selecting_n_lensed_detectable_events">
<a class="viewcode-back" href="../../../autoapi/ler/rates/ler/index.html#ler.rates.LeR.selecting_n_lensed_detectable_events">[docs]</a>
    <span class="k">def</span> <span class="nf">selecting_n_lensed_detectable_events</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">snr_threshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
        <span class="n">num_img</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">detectability_condition</span><span class="o">=</span><span class="s2">&quot;step_function&quot;</span><span class="p">,</span>
        <span class="n">output_jsonfile</span><span class="o">=</span><span class="s2">&quot;./n_lensed_params_detectable.json&quot;</span><span class="p">,</span>
        <span class="n">meta_data_file</span><span class="o">=</span><span class="s2">&quot;./meta_lensed.json&quot;</span><span class="p">,</span>
        <span class="n">event_batch_limit</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">trim_to_size</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">nan_to_num</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to select n lensed detectable events.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : `int`</span>
<span class="sd">            number of samples to be selected.</span>
<span class="sd">            default size = 100.</span>
<span class="sd">        snr_threshold : `float`</span>
<span class="sd">            threshold for detection signal to noise ratio.</span>
<span class="sd">            e.g. snr_threshold = 8.</span>
<span class="sd">        num_img : `int`</span>
<span class="sd">            number of images.</span>
<span class="sd">            default num_img = 2.</span>
<span class="sd">        resume : `bool`</span>
<span class="sd">            if True, it will resume the sampling from the last batch.</span>
<span class="sd">            default resume = False.</span>
<span class="sd">        detectability_condition : `str`</span>
<span class="sd">            detectability condition.</span>
<span class="sd">            default detectability_condition = &#39;step_function&#39;.</span>
<span class="sd">            other options are &#39;pdet&#39;.</span>
<span class="sd">        output_jsonfile : `str`</span>
<span class="sd">            json file name for storing the parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        param_final : `dict`</span>
<span class="sd">            dictionary of lensed GW source parameters of the detectable events.</span>
<span class="sd">            param_final.keys() =</span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; from ler.rates import LeR</span>
<span class="sd">        &gt;&gt;&gt; ler = LeR()</span>
<span class="sd">        &gt;&gt;&gt; lensed_param_final = ler.selecting_n_lensed_detectable_events(size=500)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">resume</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># iterator</span>
            <span class="n">events_total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># get sample size as size from json file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">param_final</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_final</span><span class="p">[</span><span class="s2">&quot;zs&quot;</span><span class="p">])</span>
                <span class="n">events_total</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="n">meta_data_file</span><span class="p">)[</span><span class="s2">&quot;events_total&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">param_final</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">events_total</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># check for images with snr above threshold</span>
        <span class="c1"># convert to array</span>
        <span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">snr_threshold</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  
        <span class="n">num_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">num_img</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># get descending sorted idx of snr_threshold</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">snr_threshold</span><span class="p">)</span>
        <span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr_threshold</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">num_img</span> <span class="o">=</span> <span class="n">num_img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="n">buffer_file</span> <span class="o">=</span> <span class="s2">&quot;./lensed_params_buffer.json&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;collected number of events = &quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="c1"># disable print statements</span>
            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">lensed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lensed_sampling_routine</span><span class="p">(</span>
                    <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">output_jsonfile</span><span class="o">=</span><span class="n">buffer_file</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>  <span class="c1"># Dimensions are (size, n_max_images)</span>

            <span class="k">if</span> <span class="n">detectability_condition</span> <span class="o">==</span> <span class="s2">&quot;step_function&quot;</span><span class="p">:</span>
                <span class="n">snr_hit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lensed_param</span><span class="p">[</span><span class="s2">&quot;zs&quot;</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># boolean array to store the result of the threshold condition</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">snr_param</span> <span class="o">=</span> <span class="n">lensed_param</span><span class="p">[</span><span class="s2">&quot;optimal_snr_net&quot;</span><span class="p">]</span>
                    <span class="n">snr_param</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="o">-</span><span class="n">snr_param</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sort snr in descending order</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;snr not provided in lensed_param dict. Exiting...&quot;</span><span class="p">)</span>
                
                <span class="c1"># for each row: choose a threshold and check if the number of images above threshold. Sum over the images. If sum is greater than num_img, then snr_hit = True </span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">idx_max</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">snr_threshold</span><span class="p">)):</span>
                    <span class="n">idx_max</span> <span class="o">=</span> <span class="n">idx_max</span> <span class="o">+</span> <span class="n">num_img</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">snr_hit</span> <span class="o">=</span> <span class="n">snr_hit</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">snr_param</span><span class="p">[:,</span><span class="n">j</span><span class="p">:</span><span class="n">idx_max</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">snr_threshold</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">num_img</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">idx_max</span>

            <span class="k">elif</span> <span class="n">detectability_condition</span> <span class="o">==</span> <span class="s2">&quot;pdet&quot;</span><span class="p">:</span>
                <span class="c1"># check if pdet is provided in unlensed_param dict</span>
                <span class="k">if</span> <span class="s2">&quot;pdet_net&quot;</span> <span class="ow">in</span> <span class="n">lensed_param</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">pdet</span> <span class="o">=</span> <span class="n">lensed_param</span><span class="p">[</span><span class="s2">&quot;pdet_net&quot;</span><span class="p">]</span>
                    <span class="n">pdet</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="o">-</span><span class="n">pdet</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sort pdet in descending order</span>
                    <span class="n">pdet</span> <span class="o">=</span> <span class="n">pdet</span><span class="p">[:,:</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">num_img</span><span class="p">)]</span>  <span class="c1"># use only num_img images</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;optimal_snr_net&quot;</span> <span class="ow">in</span> <span class="n">lensed_param</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="c1"># pdet dimension is (size, n_max_images)</span>
                        <span class="n">snr_param</span> <span class="o">=</span> <span class="n">lensed_param</span><span class="p">[</span><span class="s2">&quot;optimal_snr_net&quot;</span><span class="p">]</span>
                        <span class="n">snr_param</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="o">-</span><span class="n">snr_param</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sort snr in descending order</span>

                        <span class="n">pdet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">snr_param</span><span class="p">))</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">idx_max</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">snr_threshold</span><span class="p">)):</span>
                            <span class="n">idx_max</span> <span class="o">=</span> <span class="n">idx_max</span> <span class="o">+</span> <span class="n">num_img</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">pdet</span><span class="p">[:,</span><span class="n">j</span><span class="p">:</span><span class="n">idx_max</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">snr_threshold</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">snr_param</span><span class="p">[:,</span><span class="n">j</span><span class="p">:</span><span class="n">idx_max</span><span class="p">])</span>
                            <span class="n">j</span> <span class="o">=</span> <span class="n">idx_max</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pdet or optimal_snr_net not provided in lensed_param dict. Exiting...&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>
                    
                <span class="n">snr_hit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">pdet</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.5</span>
                    
            <span class="c1"># store all params in json file</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">snr_hit</span><span class="p">)</span><span class="o">&lt;</span><span class="n">event_batch_limit</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nan_to_num</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">lensed_param</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">lensed_param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">snr_hit</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">lensed_param</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">lensed_param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">snr_hit</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">append_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">lensed_param</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">append_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">lensed_param</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">n</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">snr_hit</span><span class="p">)</span>
                <span class="n">events_total</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">snr_hit</span><span class="p">)</span>

                <span class="c1"># save meta data</span>
                <span class="n">total_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization_pdf_z_lensed</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">events_total</span>
                <span class="n">meta_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">events_total</span><span class="o">=</span><span class="n">events_total</span><span class="p">,</span> <span class="n">total_rate</span><span class="o">=</span><span class="n">total_rate</span><span class="p">)</span>
                <span class="n">append_json</span><span class="p">(</span><span class="n">meta_data_file</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;collected number of events = &quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;total number of events = &quot;</span><span class="p">,</span> <span class="n">events_total</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;total lensed rate (yr^-1): </span><span class="si">{</span><span class="n">total_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;storing detectable lensed params in </span><span class="si">{</span><span class="n">output_jsonfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trim_to_size</span><span class="p">:</span>
            <span class="c1"># trim the final param dictionary</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> trmming final result to size=</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">param_final</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">)</span>
            <span class="c1"># trim the final param dictionary</span>
            <span class="c1">#idx = np.random.choice(len(param_final[&quot;zs&quot;]), size, replace=False)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">param_final</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">param_final</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_final</span><span class="p">[</span><span class="n">key</span><span class="p">][:</span><span class="n">size</span><span class="p">]</span>

            <span class="c1"># save the final param dictionary</span>
            <span class="n">append_json</span><span class="p">(</span><span class="n">output_jsonfile</span><span class="p">,</span> <span class="n">param_final</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">param_final</span></div>
</div>




</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Phurailatpam Hemantakumar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>