

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analytical Formulation for Lensed Gravitational Wave Event Rates &mdash; ler 0.5.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/scalefix.css" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=776609e1" />
      <link rel="stylesheet" type="text/css" href="_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=2a2fe768"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "displayMath": [["$$", "$$"], ["\\[", "\\]"]], "processEnvironments": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore", "processHtmlClass": "tex2jax_process"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="_static/dark_mode_js/default_light.js?v=c2e647ce"></script>
      <script src="_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ler.rates" href="autoapi/ler/rates/index.html" />
    <link rel="prev" title="Analytical Formulation for Gravitational Wave Event Rates" href="analytical_formulation_unlensed.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980b9" >

          
          
          <a href="index.html" class="icon icon-home">
            ler
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_overview.html">Code overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="analytical_formulation_unlensed.html">Analytical Formulation for Gravitational Wave Event Rates</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Analytical Formulation for Lensed Gravitational Wave Event Rates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameter-marginalized-event-rate">Parameter-Marginalized Event Rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#decomposing-the-joint-sourcelens-parameter-distribution">Decomposing the Joint Source–Lens Parameter Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#source-redshift-distributions-of-lensed-events">Source Redshift Distributions of Lensed Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optical-depth">Optical Depth</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lens-redshift-distribution-of-lensed-events">Lens Redshift Distribution of Lensed Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multi-image-caustic-cross-section">Multi-Image Caustic Cross-Section</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lens-parameter-distributions-of-lensed-events">Lens Parameter Distributions of Lensed Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#source-position-distribution-and-image-properties">Source Position Distribution and Image Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="#detection-probability-of-lensed-events">Detection Probability of Lensed Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#complete-expression-for-lensed-event-rate">Complete Expression for Lensed Event Rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulation-results">Simulation Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulation-settings">Simulation Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lens-and-source-parameter-priors">Lens and source Parameter Priors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plot-comparison-for-lensed-detectable-lensed-and-intrinsic-populations">Plot Comparison for Lensed+Detectable, Lensed and Intrinsic Populations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#biases-in-the-inferred-gw-parameters">Biases in the inferred GW parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-delays-and-magnifications-of-detected-lensed-events">Time Delays and Magnifications of Detected Lensed Events</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rate-estimates-and-comparisons">Rate Estimates and Comparisons</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="autoapi/ler/rates/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.rates</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/ler/gw_source_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.gw_source_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/ler/lens_galaxy_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.lens_galaxy_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/ler/image_properties/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.image_properties</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/ler/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.utils</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples/LeR_short_examples.html">LeR Short Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/GWRATES_complete_examples.html">GWRATES complete example</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/LeR_custom_functions.html">LeR with Custom Functions and Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/LeR_advanced_sampling.html">LeR Advanced Sampling — Generating Detectable Events</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980b9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Analytical Formulation for Lensed Gravitational Wave Event Rates</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/analytical_formulation_lensed.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="analytical-formulation-for-lensed-gravitational-wave-event-rates">
<h1>Analytical Formulation for Lensed Gravitational Wave Event Rates<a class="headerlink" href="#analytical-formulation-for-lensed-gravitational-wave-event-rates" title="Link to this heading"></a></h1>
<p>Written by <a class="reference external" href="https://hemantaph.com">Phurailatpam Hemantakumar</a>. Last updated: 2026-02-06.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This document extends the framework in <a class="reference external" href="https://ler.hemantaph.com/analytical_formulation_unlensed.html">Analytical Formulation for Gravitational Wave Event Rates</a> to incorporate strong gravitational lensing. The goal is to compute the rate of detectable lensed gravitational-wave (GW) events from compact-binary coalescences (CBCs) by combining the intrinsic merger population with a lens population model, multi-image lensing geometry, and a detection criterion applied to the lensed images. The formulation introduces the optical depth for strong lensing, conditional distributions for source and lens properties given strong lensing, the multi-image caustic cross-section for an EPL+Shear lens model, and the probability of detecting at least two lensed images in a detector network.</p>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction"><span class="std std-ref">Introduction</span></a></p></li>
<li><p><a class="reference internal" href="#parameter-marginalized-event-rate"><span class="std std-ref">Parameter-Marginalized Event Rate</span></a></p></li>
<li><p><a class="reference internal" href="#decomposing-the-joint-sourcelens-parameter-distribution"><span class="std std-ref">Decomposing the Joint Source–Lens Parameter Distribution</span></a></p></li>
<li><p><a class="reference internal" href="#source-redshift-distributions-of-lensed-events"><span class="std std-ref">Source Redshift Distributions of Lensed Events</span></a></p></li>
<li><p><a class="reference internal" href="#optical-depth"><span class="std std-ref">Optical Depth</span></a></p></li>
<li><p><a class="reference internal" href="#lens-redshift-distribution-of-lensed-events"><span class="std std-ref">Lens Redshift Distribution of Lensed Events</span></a></p></li>
<li><p><a class="reference internal" href="#multi-image-caustic-cross-section"><span class="std std-ref">Multi-Image Caustic Cross-Section</span></a></p></li>
<li><p><a class="reference internal" href="#lens-parameter-distributions-of-lensed-events"><span class="std std-ref">Lens Parameter Distributions of Lensed Events</span></a></p></li>
<li><p><a class="reference internal" href="#source-position-distribution-and-image-properties"><span class="std std-ref">Source Position Distribution and Image Properties</span></a></p></li>
<li><p><a class="reference internal" href="#detection-probability-of-lensed-events"><span class="std std-ref">Detection Probability of Lensed Events</span></a></p></li>
<li><p><a class="reference internal" href="#complete-expression-for-lensed-event-rate"><span class="std std-ref">Complete Expression for Lensed Event Rate</span></a></p></li>
<li><p><a class="reference internal" href="#simulation-results"><span class="std std-ref">Simulation Results</span></a></p>
<ul>
<li><p><a class="reference internal" href="#simulation-settings"><span class="std std-ref">Simulation Settings</span></a></p></li>
<li><p><a class="reference internal" href="#lens-and-source-parameter-priors"><span class="std std-ref">Lens and source Parameter Priors</span></a></p></li>
<li><p>Plot Comparison for Lensed+Detectable, Lensed and Intrinsic Populations</p></li>
<li><p><a class="reference internal" href="#biases-in-the-inferred-gw-parameters"><span class="std std-ref">Biases in the inferred GW parameters</span></a></p></li>
<li><p><a class="reference internal" href="#time-delays-and-magnifications-of-detected-lensed-events"><span class="std std-ref">Time Delays and Magnifications of Detected Lensed Events</span></a></p></li>
<li><p><a class="reference internal" href="#rate-estimates-and-comparisons"><span class="std std-ref">Rate Estimates and Comparisons</span></a></p></li>
</ul>
</li>
</ul>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>The annual rate of detectable strongly lensed GW events, <span class="math notranslate nohighlight">\(\frac{\Delta N^{\rm obs}_{\rm L}}{\Delta t}\)</span>, is the expected number of observed lensed CBC mergers per year in a given detector network. It is obtained by scaling the total intrinsic (unlensed) merger rate in the detector frame, <span class="math notranslate nohighlight">\(\frac{\Delta N_{\rm U}}{\Delta t}\)</span>, by the joint probability that an intrinsic merger is strongly lensed and detected, denoted <span class="math notranslate nohighlight">\(P({\rm SL,obs})\)</span>:</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
\frac{\Delta N^{\rm obs}_{\rm L}}{\Delta t}
= \frac{\Delta N_{\rm U}}{\Delta t}\, P({\rm SL,obs}) \, .
\end{split}
\end{equation} 
\]</div>
<p>Using the product rule, <span class="math notranslate nohighlight">\(P({\rm SL,obs})=P({\rm SL})\,P({\rm obs}\mid{\rm SL})\)</span>, where <span class="math notranslate nohighlight">\(P({\rm SL})\)</span> is the probability that an intrinsic merger is strongly lensed and <span class="math notranslate nohighlight">\(P({\rm obs}\mid{\rm SL})\)</span> is the conditional probability of detection given strong lensing. This yields</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
\frac{\Delta N^{\rm obs}_{\rm L}}{\Delta t}
= \frac{\Delta N_{\rm U}}{\Delta t}\, P({\rm SL})\, P({\rm obs}\mid{\rm SL})
= {\cal N}_{\rm L}\, P({\rm obs}\mid{\rm SL}) \, ,
\end{split}
\end{equation} 
\]</div>
<p>where <span class="math notranslate nohighlight">\({\cal N}_{\rm L}\equiv \frac{\Delta N_{\rm U}}{\Delta t}\,P({\rm SL})\)</span> is the total intrinsic rate of strongly lensed mergers, irrespective of detectability.</p>
</section>
<section id="parameter-marginalized-event-rate">
<h2>Parameter-Marginalized Event Rate<a class="headerlink" href="#parameter-marginalized-event-rate" title="Link to this heading"></a></h2>
<p>The observed lensed event rate is obtained by averaging the detection probability over the unlensed GW parameters <span class="math notranslate nohighlight">\(\vec{\theta}_{\rm U}\)</span>, the lens parameters <span class="math notranslate nohighlight">\(\vec{\theta}_{\rm L}\)</span>, and the source position <span class="math notranslate nohighlight">\(\vec{\beta}\)</span> within the lens caustic, conditioned on the occurrence of strong lensing. The unlensed GW parameters follow the definitions provided in the unlensed framework, with intrinsic and extrinsic components described in <a class="reference external" href="https://ler.hemantaph.com/analytical_formulation_unlensed.html">Analytical Formulation for Gravitational Wave Event Rates</a>.</p>
<p>For the Elliptical Power Law with external shear (EPL+Shear) lens model, the lens-parameter vector is</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
\vec{\theta}_{\rm L}\in \{z_L,\sigma,q,\phi_{\rm rot},\gamma,\gamma_1,\gamma_2\} \, ,
\end{split}
\end{equation} 
\]</div>
<p>where <span class="math notranslate nohighlight">\(z_L\)</span> is the lens redshift, <span class="math notranslate nohighlight">\(\sigma\)</span> is the velocity dispersion, <span class="math notranslate nohighlight">\(q\)</span> is the projected axis ratio, <span class="math notranslate nohighlight">\(\phi_{\rm rot}\)</span> is the major-axis orientation, <span class="math notranslate nohighlight">\(\gamma\)</span> is the EPL logarithmic density slope, and <span class="math notranslate nohighlight">\((\gamma_1,\gamma_2)\)</span> are the external shear components. The source position on the source plane is <span class="math notranslate nohighlight">\(\vec{\beta}\in\{\beta_x,\beta_y\}\)</span>, defined relative to the lens center. The adopted priors are summarized in Lens Parameter Priors.</p>
<p>Given a joint prior distribution <span class="math notranslate nohighlight">\(P(\vec{\theta}_{\rm U},\vec{\theta}_{\rm L},\vec{\beta}\mid{\rm SL})\)</span> conditioned on strong lensing,  and a detection probability model <span class="math notranslate nohighlight">\(P({\rm obs}\mid \vec{\theta}_{\rm U},\vec{\theta}_{\rm L},\vec{\beta},{\rm SL})\)</span> for a specific source-lens configuration, the population-averaged detection probability becomes</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P({\rm obs}\mid{\rm SL})
= \int P({\rm obs}\mid \vec{\theta}_{\rm U},\vec{\theta}_{\rm L},\vec{\beta},{\rm SL})\,
P(\vec{\theta}_{\rm U},\vec{\theta}_{\rm L},\vec{\beta}\mid{\rm SL})\,
d\vec{\theta}_{\rm U}\,d\vec{\theta}_{\rm L}\,d\vec{\beta} \, .
\end{split}
\end{equation} 
\]</div>
<p>To evaluate this integral with <a class="reference external" href="https://en.wikipedia.org/wiki/Monte_Carlo_integration">Monte Carlo integration</a>, the unlensed GW parameters are split into the source redshift <span class="math notranslate nohighlight">\(z_s\)</span> and the remaining set <span class="math notranslate nohighlight">\(\vec{\theta}^{*}_{\rm U}\)</span>,</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
\vec{\theta}^{*}_{\rm U}\in \{m_1,m_2,a_1,a_2,\theta_1,\theta_2,\phi_{12},\phi_{\rm JL},\iota,\phi,\psi,t_c, {\rm RA},{\rm Dec}\} \, ,
\end{split}
\end{equation} 
\]</div>
<p>The lens parameters are split into the lens redshift <span class="math notranslate nohighlight">\(z_L\)</span> and the structural parameters <span class="math notranslate nohighlight">\(\vec{\theta}^{*}_{\rm L}=\{\sigma,q,\phi_{\rm rot},\gamma,\gamma_1,\gamma_2\}\)</span>. Under the assumption of isotropic sky locations for sources and lenses, the strong-lensing-conditioned distribution of <span class="math notranslate nohighlight">\((z_s,z_L,\vec{\theta}^{*}_{\rm L})\)</span> is independent of <span class="math notranslate nohighlight">\(({\rm RA},{\rm Dec})\)</span>, so that</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P(z_s,z_L,\vec{\theta}^{*}_{\rm L}\mid {\rm SL})
\equiv P(z_s,z_L,\vec{\theta}^{*}_{\rm L}\mid {\rm RA},{\rm Dec},{\rm SL}) \, .
\end{split}
\end{equation} 
\]</div>
<p>With these decompositions, the lensed detectable rate can be written as the expectation value</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{equation}
\begin{split}
\frac{\Delta N^{\rm obs}_{\rm L}}{\Delta t}
\simeq {\cal N}_{\rm L}
\bigg\langle
P({\rm obs}\mid \vec{\theta}^{*}_{\rm U},z_s,z_L,\vec{\theta}^{*}_{\rm L},\vec{\beta},{\rm SL})
\bigg\rangle_{\substack{
\vec{\theta}^{*}_{\rm U}\sim P(\vec{\theta}^{*}_{\rm U}) \\
(z_s,z_L,\vec{\theta}^{*}_{\rm L})\sim P(z_s,z_L,\vec{\theta}^{*}_{\rm L}\mid {\rm SL}) \\
\vec{\beta}\sim P(\vec{\beta}\mid z_s,z_L,\vec{\theta}^{*}_{\rm L},{\rm SL})
}} \, .
\end{split}
\end{equation} 
\end{split}\]</div>
<p>The expectation value is evaluated by hierarchical sampling from the listed distributions. The sky location <span class="math notranslate nohighlight">\(({\rm RA},{\rm Dec})\)</span> is drawn once from <span class="math notranslate nohighlight">\(P({\rm RA},{\rm Dec})\)</span> and is then held fixed while sampling <span class="math notranslate nohighlight">\((z_s,z_L,\vec{\theta}^{*}_{\rm L})\)</span> and <span class="math notranslate nohighlight">\(\vec{\beta}\)</span> for the same event.</p>
</section>
<section id="decomposing-the-joint-sourcelens-parameter-distribution">
<h2>Decomposing the Joint Source–Lens Parameter Distribution<a class="headerlink" href="#decomposing-the-joint-sourcelens-parameter-distribution" title="Link to this heading"></a></h2>
<p>Hierarchical sampling of the lensing configuration is enabled by the chain-rule decomposition, i.e.</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P(z_s,z_L,\vec{\theta}^{*}_{\rm L}\mid{\rm SL})
= P(z_s\mid{\rm SL})\,P(z_L\mid z_s,{\rm SL})\,P(\vec{\theta}^{*}_{\rm L}\mid z_L,z_s,{\rm SL}) \, .
\end{split}
\end{equation} 
\]</div>
<p>The lens-parameter factor can be expressed using Bayes’ theorem as</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{equation}
\begin{split}
P(\vec{\theta}^{*}_{\rm L}\mid z_L,z_s,{\rm SL})
&amp;= \frac{P({\rm SL}\mid z_L,z_s,\vec{\theta}^{*}_{\rm L})\,P(\vec{\theta}^{*}_{\rm L}\mid z_L,z_s)}{P({\rm SL}\mid z_L,z_s)} \,,\\ 
&amp;\propto \sigma_{\rm SL}(z_L,z_s,\vec{\theta}^{*}_{\rm L})\,P(\vec{\theta}^{*}_{\rm L}\mid z_L,z_s) \, ,
\end{split}
\end{equation} 
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma_{\rm SL}\)</span> is the strong-lensing angular cross-section (<a class="reference internal" href="#multi-image-caustic-cross-section"><span class="std std-ref">multi-image caustic cross-section</span></a> in this documentation) and <span class="math notranslate nohighlight">\(P(\vec{\theta}^{*}_{\rm L}\mid z_L,z_s)\)</span> is the prior distribution of lens parameters at fixed redshifts. This factorization motivates drawing <span class="math notranslate nohighlight">\(z_s\)</span> first, then <span class="math notranslate nohighlight">\(z_L\)</span>, followed by sampling <span class="math notranslate nohighlight">\(\vec{\theta}^{*}_{\rm L}\)</span> with importance sampling to account for the cross-section weighting.</p>
</section>
<section id="source-redshift-distributions-of-lensed-events">
<h2>Source Redshift Distributions of Lensed Events<a class="headerlink" href="#source-redshift-distributions-of-lensed-events" title="Link to this heading"></a></h2>
<p>The redshift distribution of lensed sources differs from the intrinsic distribution because the probability of strong lensing increases with source distance. By Bayes’ theorem,</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P(z_s\mid{\rm SL})
= \frac{P({\rm SL}\mid z_s)\,P(z_s)}{P({\rm SL})}
\propto P({\rm SL}\mid z_s)\,P(z_s) \, .
\end{split}
\end{equation} 
\]</div>
<p>Using the intrinsic unlensed redshift distribution,</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P(z_s)
= \frac{1}{{\cal N}_{\rm U}}\,
\frac{R_{\rm U}(z_s)}{1+z_s}\,
\frac{dV_c}{dz_s} \, ,
\end{split}
\end{equation} 
\]</div>
<p>the lensed-source redshift distribution becomes</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P(z_s\mid{\rm SL})
= \frac{1}{{\cal N}_{\rm L}}\,
P({\rm SL}\mid z_s)\,
\frac{R_{\rm U}(z_s)}{1+z_s}\,
\frac{dV_c}{dz_s} \, ,
\end{split}
\end{equation} 
\]</div>
<p>where <span class="math notranslate nohighlight">\({\cal N}_{\rm U}\)</span> is the total intrinsic merger rate per unit detector-frame time and <span class="math notranslate nohighlight">\({\cal N}_{\rm L}\)</span> is the total intrinsic strongly lensed merger rate per unit detector-frame time. The normalization satisfies</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
{\cal N}_{\rm L}
= {\cal N}_{\rm U}\,P({\rm SL})
= \int P({\rm SL}\mid z_s)\,
\frac{R_{\rm U}(z_s)}{1+z_s}\,
\frac{dV_c}{dz_s}\,dz_s \, ,
\end{split}
\end{equation} 
\]</div>
<p>so that <span class="math notranslate nohighlight">\(P({\rm SL})={\cal N}_{\rm L}/{\cal N}_{\rm U}\)</span>, which is the fraction of intrinsically occurring mergers that are strongly lensed in the population model. In this work, <span class="math notranslate nohighlight">\(P({\rm SL}\mid z_s)\)</span> is computed for the adopted EPL+Shear lens population as detailed in the subsequent section. Once this probability is determined and the conditional distribution <span class="math notranslate nohighlight">\(P(z_s\mid {\rm SL})\)</span> is established, source redshifts are generated using <a class="reference external" href="https://en.wikipedia.org/wiki/Inverse_transform_sampling">inverse transform sampling</a>.</p>
</section>
<section id="optical-depth">
<h2>Optical Depth<a class="headerlink" href="#optical-depth" title="Link to this heading"></a></h2>
<p>In general radiative-transfer language, the optical depth <span class="math notranslate nohighlight">\(\tau(z_s)\)</span> is the line-of-sight integral of an effective opacity and can be interpreted as the expected number of interactions (absorption, scattering, etc.) experienced by a signal as it propagates through a medium. By direct analogy in strong gravitational lensing, <span class="math notranslate nohighlight">\(\tau(z_s)\)</span> is the expected number of strong-lensing encounters for a source at redshift <span class="math notranslate nohighlight">\(z_s\)</span> under a randomly distributed lens population, where an encounter corresponds to a lens–source configuration in which the source lies inside the multi-image caustic and multiple images form. The optical depth is dimensionless and set by the lens number density and the strong-lensing cross-section. In the low-optical-depth regime <span class="math notranslate nohighlight">\(\tau(z_s)\ll 1\)</span> relevant for galaxy-scale lensing, the probability that the source is strongly lensed satisfies <span class="math notranslate nohighlight">\(P({\rm SL}\mid z_s)\simeq \tau(z_s)\)</span>.</p>
<p>A convenient way to derive this relationship is to treat strong-lensing encounters as a Poisson process along the line of sight. If <span class="math notranslate nohighlight">\(\lambda\)</span> denotes the expected number of encounters, the probability of observing exactly <span class="math notranslate nohighlight">\(k\)</span> encounters is given by</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P(k) = \frac{\lambda^k e^{-\lambda}}{k!} \, .
\end{split}
\end{equation}
\]</div>
<p>For strong lensing, the Poisson mean <span class="math notranslate nohighlight">\(\lambda\)</span> corresponds to the integrated encounter expectation out to <span class="math notranslate nohighlight">\(z_s\)</span>, obtained by summing the angular target size of each potential lens over the lens population along the path. This gives</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{equation}
\begin{split}
\lambda
&amp;= \int ({\rm target\ size}) \times ({\rm number\ density}) \times ({\rm path\ length}) \\
&amp;= \int_{0}^{z_s} \int_{\vec{\theta}^{*}_{\rm L}}
\frac{\sigma_{\rm SL}(z_L, z_s, \vec{\theta}^{*}_{\rm L})}{4\pi}\,
\frac{d^2N(z_L, \vec{\theta}^{*}_{\rm L})}{dV_c\,d\vec{\theta}^{*}_{\rm L}}\,
\frac{dV_c}{dz_L}\,
d\vec{\theta}^{*}_{\rm L}\,dz_L \\
&amp;\equiv \tau(z_s) \, .
\end{split}
\end{equation}
\end{split}\]</div>
<p>Geometrically, <span class="math notranslate nohighlight">\(\tau(z_s)\)</span> represents the fraction of the sky covered by the effective strong-lensing cross-sections of all lenses along the line of sight, calculated under the single-lens approximation.</p>
<p>The probability of encountering exactly one strong lens is therefore</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P({\rm SL}\mid z_s)
= P(k=1\mid \lambda=\tau(z_s))
= \tau(z_s)\,e^{-\tau(z_s)} \, .
\end{split}
\end{equation}
\]</div>
<p>Since <span class="math notranslate nohighlight">\(\tau(z_s)\ll 1\)</span> for galaxy populations on cosmological volumes, this reduces to <span class="math notranslate nohighlight">\(P({\rm SL}\mid z_s)\simeq \tau(z_s)\)</span>. A rough estimate using <code class="docutils literal notranslate"><span class="pre">ler</span></code> shows that typically <span class="math notranslate nohighlight">\(\tau(z_s) \lesssim 0.004\)</span>, with the relative difference <span class="math notranslate nohighlight">\(\frac{P({\rm SL} \mid z_s) - \tau(z_s)}{P({\rm SL} \mid z_s)} \times 100 \lesssim 0.4\%\)</span>.</p>
<p>In practice, the lens population is often specified by the velocity-dispersion function <span class="math notranslate nohighlight">\(\phi(\sigma,z_L)=\frac{d^2N(z_L,\sigma)}{dV_c\,d\sigma}\)</span>. Separating the remaining lens (caustic) shape parameters <span class="math notranslate nohighlight">\(\vec{\theta}^{**}_{\rm L}\)</span> from <span class="math notranslate nohighlight">\(\sigma\)</span>, the strong-lensing probability can be written as</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{equation}
\begin{split}
P({\rm SL}\mid z_s)
&amp;\simeq \int_{0}^{z_s}\int_{\sigma,\vec{\theta}^{**}_{\rm L}}
\frac{\sigma_{\rm SL}(z_L, z_s, \sigma, \vec{\theta}^{**}_{\rm L})}{4\pi}\,
\phi(\sigma,z_L)\\
&amp;\quad\quad\quad\quad \times P(\vec{\theta}^{**}_{\rm L}\mid\sigma)\,
\frac{dV_c}{dz_L}\,
d\sigma\,d\vec{\theta}^{**}_{\rm L}\,dz_L \, .
\end{split}
\end{equation}
\end{split}\]</div>
<p>It is convenient to introduce the differential optical depth with respect to lens redshift,</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P({\rm SL}\mid z_s)
\simeq \int_{0}^{z_s} \frac{d\tau}{dz_L}\,dz_L \, ,
\end{split}
\end{equation}
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
\frac{d\tau}{dz_L}
= \int_{\sigma,\vec{\theta}^{**}_{\rm L}}
\frac{\sigma_{\rm SL}(z_L, z_s, \sigma, \vec{\theta}^{**}_{\rm L})}{4\pi}\,
\phi(\sigma,z_L)\,
P(\vec{\theta}^{**}_{\rm L}\mid\sigma)\,
\frac{dV_c}{dz_L}\,
d\sigma\,d\vec{\theta}^{**}_{\rm L} \, .
\end{split}
\end{equation}
\]</div>
<p>The function <span class="math notranslate nohighlight">\(d\tau/dz_L\)</span> is used both to evaluate <span class="math notranslate nohighlight">\(\tau(z_s)\)</span> and to construct the lens-redshift distribution <span class="math notranslate nohighlight">\(P(z_L\mid z_s,{\rm SL})\)</span> in the next section.</p>
<p>For the EPL+Shear model, the shape-parameter set is <span class="math notranslate nohighlight">\(\vec{\theta}^{**}_{\rm L}=\{q,\phi_{\rm rot},\gamma,\gamma_1,\gamma_2\}\)</span>, and the differential optical depth becomes</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{equation}
\begin{split}
\frac{d\tau}{dz_L}
&amp;= \int_{\sigma,q,\phi_{\rm rot},\gamma,\gamma_1,\gamma_2} \frac{\sigma_{\rm SL}(z_L, \sigma, q,\phi_{\rm rot},\gamma,\gamma_1,\gamma_2)}{4\pi} \phi(\sigma,z_L) \\
&amp; \quad \times P(\gamma_1, \gamma_2) \, P(\gamma) \, P(\phi_{\rm rot}) \, P(q \mid \sigma)  \frac{dV_c}{dz_L} \, d\sigma \, dq \, d\phi_{\rm rot} \, d\gamma \, d\gamma_1 \, d\gamma_2\, .
\end{split}
\end{equation} 
\end{split}\]</div>
<p>Numerically, this integral is approximated using Monte Carlo integration. To simplify the sampling process, we employ a uniform proposal distribution for the velocity dispersion, <span class="math notranslate nohighlight">\(P_o(\sigma) = 1/\Delta\sigma\)</span>, defined over the range of interest <span class="math notranslate nohighlight">\(\Delta\sigma\)</span>. Rewriting the integral as an expectation value, the differential optical depth reads</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{equation}
\begin{split}
\frac{d\tau}{dz_L}
= \Delta\sigma
\left\langle
\frac{\sigma^{\rm EPL}_{\rm SL}}{4\pi}\,
\phi(\sigma,z_L)\,
\frac{dV_c}{dz_L}
\right\rangle_{\substack{
\sigma\sim P_o(\sigma) \\
q\sim P(q\mid\sigma) \\
\phi_{\rm rot}\sim P(\phi_{\rm rot}) \\
\gamma\sim P(\gamma) \\
\gamma_1,\gamma_2\sim P(\gamma_1,\gamma_2)
}} \, ,
\end{split}
\end{equation} 
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma^{\rm EPL}_{\rm SL}\)</span> denotes the multi-image caustic cross-section for the EPL+Shear model, and each parameter is sampled hierarchically from its respective prior.</p>
</section>
<section id="lens-redshift-distribution-of-lensed-events">
<h2>Lens Redshift Distribution of Lensed Events<a class="headerlink" href="#lens-redshift-distribution-of-lensed-events" title="Link to this heading"></a></h2>
<p>For fixed <span class="math notranslate nohighlight">\(z_s\)</span>, the lens-redshift distribution conditioned on the occurance of strong lensing is directly proportional to the differential optical depth, and is given by</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P(z_L\mid z_s,{\rm SL})
= \frac{1}{\tau(z_s)}\,\frac{d\tau}{dz_L} \, ,
\end{split}
\end{equation} 
\]</div>
<p>where the normalization factor is the total optical depth <span class="math notranslate nohighlight">\(\tau(z_s)=\int_{0}^{z_s}(d\tau/dz_L)\,dz_L\)</span>. In <code class="docutils literal notranslate"><span class="pre">ler</span></code>, the differential optical depth <span class="math notranslate nohighlight">\(d\tau/dz_L\)</span> is pre-computed on a grid spanning the relevant redshift space (<span class="math notranslate nohighlight">\(z_L, z_s\)</span>). This grid enables efficient interpolation for inverse-transform sampling of <span class="math notranslate nohighlight">\(z_L\)</span> and allows for rapid evaluation of the strong-lensing probability <span class="math notranslate nohighlight">\(P({\rm SL}\mid z_s)\)</span>.</p>
<p>For comparison, the intrinsic redshift distribution of the lens population, without conditioning on strong lensing and independent of any specific background source, is obtained by marginalizing the lens number density over the lens parameters</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P(z_L)
= \frac{1}{{\cal N}_{z_L}}
\int
\frac{d^2N(z_L,\vec{\theta}^{*}_{\rm L})}{dV_c\, d\vec{\theta}^{*}_{\rm L}}\,
\frac{dV_c}{dz_L}\,
d\vec{\theta}^{*}_{\rm L} \, ,
\end{split}
\end{equation} 
\]</div>
<p>where <span class="math notranslate nohighlight">\({\cal N}_{z_L}\)</span> is a normalization constant.</p>
<p>The impact of the optical depth on the source redshift distributions of the lensed events is illustrated in Figure 1.</p>
<div id="fig1"></div>
<div align="center">
  <img src="_static/lensed_redshifts.png" alt="Merger rate density and PDF of redshift for BBH mergers" width="600"/>
</div>
<blockquote>
<div><p><strong>Figure 1:</strong> Redshift distributions (blue, left axis) for the intrinsic source population <span class="math notranslate nohighlight">\(P(z=z_s)\)</span>, the lensed-source population <span class="math notranslate nohighlight">\(P(z=z_s\mid{\rm SL})\)</span>, and the conditional lens distribution <span class="math notranslate nohighlight">\(P(z=z_L\mid z_s,{\rm SL})\)</span>, shown together with the optical depth <span class="math notranslate nohighlight">\(\tau(z=z_s)\)</span> (orange, right axis), which quantifies the strong-lensing probability for a source at redshift <span class="math notranslate nohighlight">\(z_s\)</span> in the low-optical-depth regime. The intrinsic <span class="math notranslate nohighlight">\(P(z_s)\)</span> follows the unlensed merger-rate model, while <span class="math notranslate nohighlight">\(P(z_s\mid{\rm SL})\)</span> is obtained by reweighting the intrinsic population by the lensing probability, <span class="math notranslate nohighlight">\(P(z_s\mid{\rm SL})\propto \tau(z_s)\,P(z_s)\)</span>, implemented via rejection sampling using <span class="math notranslate nohighlight">\(\tau(z_s)\)</span>. For each lensed source, the lens redshift is drawn from <span class="math notranslate nohighlight">\(0&lt;z_L&lt;z_s\)</span> with a density proportional to <span class="math notranslate nohighlight">\(\frac{d\tau}{dz_L}\)</span>, so that <span class="math notranslate nohighlight">\(P(z_L\mid z_s,{\rm SL})\)</span> traces where along the line of sight the lenses that produce strong lensing are most likely to occur. Since <span class="math notranslate nohighlight">\(\tau(z_s)\)</span> increases with redshift, strong lensing preferentially selects more distant sources and shifts <span class="math notranslate nohighlight">\(P(z_s\mid{\rm SL})\)</span> to higher redshift relative to <span class="math notranslate nohighlight">\(P(z_s)\)</span>, while <span class="math notranslate nohighlight">\(P(z_L\mid z_s,{\rm SL})\)</span> describes the redshift distribution of the lenses responsible for that lensed-source population.</p>
</div></blockquote>
</section>
<section id="multi-image-caustic-cross-section">
<h2>Multi-Image Caustic Cross-Section<a class="headerlink" href="#multi-image-caustic-cross-section" title="Link to this heading"></a></h2>
<p>The strong-lensing condition is satisfied when a source resides within the multi-image caustic region in the source plane, which encompasses the area enclosed by both the double and diamond (quad) caustics (see Figure 2), thereby producing multiple images. The angular area of this region is defined as the multi-image caustic cross-section, <span class="math notranslate nohighlight">\(\sigma_{\rm SL}\)</span> (denoted as <span class="math notranslate nohighlight">\(\sigma^{\rm EPL}_{\rm SL}\)</span> for the EPL+Shear model). The probability of strong lensing for a specific configuration is the ratio of this cross-section to the total sky area</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
P({\rm SL}\mid z_L, z_s, \vec{\theta}^{*}_{\rm L})
= \frac{\sigma_{\rm SL}}{4\pi} \, .
\end{split}
\end{equation} 
\]</div>
<p>Direct evaluation of <span class="math notranslate nohighlight">\(\sigma_{\rm SL}\)</span> by tracing caustics with <a class="reference external" href="https://lenstronomy.readthedocs.io">lenstronomy</a> is computationally expensive. In <code class="docutils literal notranslate"><span class="pre">ler</span></code>, <span class="math notranslate nohighlight">\(\sigma^{\rm EPL}_{\rm SL}\)</span> is therefore precomputed on the grid of lens (caustic) shape parameters <span class="math notranslate nohighlight">\(\vec{\theta}^{**}_{\rm L}\in \{q,\phi_{\rm rot},\gamma,\gamma_1,\gamma_2\}\)</span> at unit Einstein radius <span class="math notranslate nohighlight">\(\theta_{\rm E}=1\)</span>, and interpolated during sampling. For arbitrary <span class="math notranslate nohighlight">\((\sigma,z_L,z_s)\)</span>, the Einstein radius is</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
\theta_{\rm E}
= 4\pi\left(\frac{\sigma}{c}\right)^2
\frac{D_{LS}(z_L,z_s)}{D_S(z_s)} \, ,
\end{split}
\end{equation} 
\]</div>
<p>where <span class="math notranslate nohighlight">\(D_{LS}\)</span> and <span class="math notranslate nohighlight">\(D_S\)</span> are angular-diameter distances.</p>
<p>The cross-section is then rescaled from the <span class="math notranslate nohighlight">\(\theta_{\rm E}=1\)</span> values using the calibrated relation</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{equation}
\begin{split}
\sigma^{\rm EPL}_{\rm SL}(\theta_{\rm E}, q, \phi_{\rm rot}, \gamma, \gamma_1, \gamma_2)
&amp;= \sigma^{\rm EPL}_{\rm SL}(1, q, \phi_{\rm rot}, \gamma, \gamma_1, \gamma_2) \\
&amp;\quad\times \left({\rm intercept} + {\rm slope}\,\pi\,\theta_{\rm E}^2\right) \, ,
\end{split}
\end{equation}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\({\rm intercept}\)</span> and <span class="math notranslate nohighlight">\({\rm slope}\)</span> are precomputed constants. This interpolation and rescaling scheme accelerates cross-section evaluation and, consequently, the computation of <span class="math notranslate nohighlight">\(\frac{d\tau}{dz_L}\)</span>.</p>
<p>Going forward, I simply use the term ‘cross-section’ to refer to <span class="math notranslate nohighlight">\(\sigma_{\rm SL}\)</span> or <span class="math notranslate nohighlight">\(\sigma^{\rm EPL}_{\rm SL}\)</span>.</p>
</section>
<section id="lens-parameter-distributions-of-lensed-events">
<h2>Lens Parameter Distributions of Lensed Events<a class="headerlink" href="#lens-parameter-distributions-of-lensed-events" title="Link to this heading"></a></h2>
<p>For a fixed redshift pair <span class="math notranslate nohighlight">\((z_L,z_s)\)</span>, the conditional distribution of lens parameters <span class="math notranslate nohighlight">\(P(\vec{\theta}^{*}_{\rm L}\mid z_L,z_s,{\rm SL})\)</span> is determined by weighting the intrinsic lens population with the strong-lensing cross-section <span class="math notranslate nohighlight">\(\sigma^{\rm EPL}_{\rm SL}(z_L,z_s,\vec{\theta}^{*}_{\rm L})\)</span>. For the EPL+Shear model, this target distribution is expressed as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
&amp;P(\sigma, q, \phi_{\rm rot}, \gamma, \gamma_1, \gamma_2 \mid z_L, z_s, {\rm SL})\\
&amp;\quad \propto P({\rm SL}\mid z_L, z_s, \sigma, q, \phi_{\rm rot}, \gamma, \gamma_1, \gamma_2) \, P(\gamma_1, \gamma_2) \, P(\gamma) \, P(\phi_{\rm rot}) \, P(q \mid \sigma) \, P(\sigma \mid z_L) \\
&amp;\quad \propto \frac{\sigma^{\rm EPL}_{\rm SL}}{4\pi} \, P(\gamma_1, \gamma_2) \, P(\gamma) \, P(\phi_{\rm rot}) \, P(q \mid \sigma) \, P(\sigma \mid z_L) \, .
\end{split}
\end{equation}
\end{split}\]</div>
<p>Direct rejection sampling from the intrinsic distribution <span class="math notranslate nohighlight">\(P(\sigma\mid z_L)\)</span> is computationally inefficient because the lensing cross-section <span class="math notranslate nohighlight">\(\sigma^{\rm EPL}_{\rm SL}\)</span> scales roughly as <span class="math notranslate nohighlight">\(\sigma^4\)</span>, heavily favoring high-mass lenses that are exponentially rare in the intrinsic population. Furthermore, the lack of a strict analytical maximum for the cross-section complicates the definition of a rejection envelope.</p>
<p>To address these challenges, <code class="docutils literal notranslate"><span class="pre">ler</span></code> employs <a class="reference external" href="https://en.wikipedia.org/wiki/Importance_sampling">importance sampling</a>. A proposal distribution <span class="math notranslate nohighlight">\(P_o(\sigma)\)</span>, typically chosen to be uniform over <span class="math notranslate nohighlight">\([\sigma_{\min},\sigma_{\max}]\)</span>, is introduced to rewrite the target density. By defining the intrinsic distribution <span class="math notranslate nohighlight">\(P(\sigma \mid z_L)\)</span> as the normalized velocity dispersion function <span class="math notranslate nohighlight">\(\phi(\sigma, z_L)/\int \phi(\sigma', z_L) d\sigma'\)</span>, the target distribution becomes</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
&amp;P(\sigma, q, \phi_{\rm rot}, \gamma, \gamma_1, \gamma_2 \mid z_L, z_s, {\rm SL})\\
&amp;\quad \propto \left[\frac{ \sigma^{\rm EPL}_{\rm SL}\, P(\sigma \mid z_L)}{4\pi\,P_o(\sigma)}\right] P(\gamma_1, \gamma_2) \, P(\gamma) \, P(\phi_{\rm rot}) \, P(q \mid \sigma) \, P_o(\sigma) \\
&amp;\quad = \frac{1}{{\cal W}(z_L)} \left[\frac{ \sigma^{\rm EPL}_{\rm SL}\, \phi(\sigma, z_L)}{P_o(\sigma)}\right] P(\gamma_1, \gamma_2) \, P(\gamma) \, P(\phi_{\rm rot}) \, P(q \mid \sigma) \, P_o(\sigma) \, .
\end{split}
\end{equation}
\end{split}\]</div>
<p>In this formulation, constant factors including <span class="math notranslate nohighlight">\(4\pi\)</span> and the normalization of the intrinsic velocity dispersion function are absorbed into the overall normalization constant <span class="math notranslate nohighlight">\({\cal W}(z_L)\)</span>. The term in the square brackets represents the unnormalized importance weight required to convert samples from the proposal distribution into samples from the cross-section-weighted target distribution.</p>
<p>Computationally, this is implemented by generating a candidate batch of size <span class="math notranslate nohighlight">\(N_{\rm prop}\)</span> (defaulting to 200 in <code class="docutils literal notranslate"><span class="pre">ler</span></code>) for each <span class="math notranslate nohighlight">\((z_L, z_s)\)</span> pair. The velocity dispersion <span class="math notranslate nohighlight">\(\sigma_i\)</span> is drawn from the proposal <span class="math notranslate nohighlight">\(P_o(\sigma)\)</span>, while the remaining shape parameters are sampled directly from their intrinsic priors. Each candidate in the batch is assigned a normalized importance weight</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
w_i(\sigma_i, q_i, \phi_{{\rm rot},i}, \gamma_i, \gamma_{1,i}, \gamma_{2,i};z_L,z_s)=\frac{1}{{\cal W}(z_L)}\,\frac{\sigma^{\rm EPL}_{{\rm SL}, i}\,\phi(\sigma_i, z_L)}{P_o(\sigma_i)} \, ,
\end{split}
\end{equation} 
\]</div>
<p>where the batch normalization constant is defined as the sum of the unnormalized weights</p>
<div class="math notranslate nohighlight">
\[ 
\begin{equation}
\begin{split}
{\cal W}(z_L)=\sum_{i=1}^{N_{\rm prop}}\frac{\sigma^{\rm EPL}_{{\rm SL}, i}\,\phi(\sigma_i, z_L)}{P_o(\sigma_i)} \, .
\end{split}
\end{equation} 
\]</div>
<p>A final lens configuration is selected from this batch by resampling with probabilities proportional to <span class="math notranslate nohighlight">\(w_i\)</span>, ensuring the final parameter set accurately reflects the properties of the strongly lensed population.</p>
</section>
<section id="source-position-distribution-and-image-properties">
<h2>Source Position Distribution and Image Properties<a class="headerlink" href="#source-position-distribution-and-image-properties" title="Link to this heading"></a></h2>
<p>Given <span class="math notranslate nohighlight">\((z_s,z_L,\vec{\theta}^{*}_{\rm L})\)</span>, the source position <span class="math notranslate nohighlight">\(\vec{\beta}\)</span> is sampled uniformly within the multi-image caustic so that each draw produces multiple images. The lens equation is solved with <a class="reference external" href="https://lenstronomy.readthedocs.io"><code class="docutils literal notranslate"><span class="pre">lenstronomy</span></code></a> to obtain the image positions <span class="math notranslate nohighlight">\(\vec{\theta}_i\in \{\theta_{x,i},\theta_{y,i}\}\)</span>, magnifications <span class="math notranslate nohighlight">\(\mu_i\)</span>, and arrival-time delays <span class="math notranslate nohighlight">\(t_i\)</span>. These quantities are initially computed at <span class="math notranslate nohighlight">\(\theta_{\rm E}=1\)</span> and then rescaled to physical units using the system’s <span class="math notranslate nohighlight">\(\theta_{\rm E}\)</span>.</p>
<p>Each image is assigned a Morse index <span class="math notranslate nohighlight">\(n_i\in\{0,1/2,1\}\)</span> corresponding to minima (Type I), saddles (Type II), and maxima (Type III), respectively. Type III images are typically highly demagnified and are neglected in the detectability criterion adopted here. Lensing modifies the observed GW parameters for each image <span class="math notranslate nohighlight">\(i\)</span> as follows</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{equation}
\begin{split}
d_L &amp;\rightarrow \frac{d_L(z_s)}{\sqrt{\lvert\mu_i\rvert}}\,, \\
\phi_c &amp;\rightarrow \phi_c - n_i\pi\,, \\
t_c &amp;\rightarrow t_c + t_i \, , \\
{\rm RA} &amp;\rightarrow {\rm RA} + \frac{\theta_{x,i}-\beta_x}{\cos({\rm Dec})}\,, \\
{\rm Dec} &amp;\rightarrow {\rm Dec} + (\theta_{y,i}-\beta_y)\,, \\
\end{split}
\end{equation} 
\end{split}\]</div>
<p>while the other extrinsic and intrinsic parameters are unchanged from the unlensed values, including the detector-frame component masses <span class="math notranslate nohighlight">\(\left(m_1 \, (1+z_s),m_2 \, (1+z_s)\right)\)</span>. The sky-location offsets associated with <span class="math notranslate nohighlight">\(\vec{\theta}_i-\vec{\beta}\)</span> are typically negligible for current GW detector networks and have no impact on SNR. Detectability is therefore evaluated by computing the SNR for each image using the modified GW pararameters <span class="math notranslate nohighlight">\(\vec{\theta}_{{\rm GW},i}\)</span>, as described in the next section.</p>
<blockquote>
<div><p><strong>Note:</strong> The lens-centre coordinates in the sky is given by <span class="math notranslate nohighlight">\(\left\{ {\rm RA} - \frac{\beta_x}{\cos({\rm Dec})}, {\rm Dec} - \beta_y \right\}\)</span>.</p>
</div></blockquote>
<p>An illustrative example of a multi-image configuration for an EPL+Shear lens is shown in Figure 2, where the source is located near a fold caustic boundary, resulting in four images with two highly magnified ones. The lens parameters are chosen to produce a typical caustic structure with an outer double-image caustic and an inner diamond-shaped quad-image caustic. The image properties (type, magnification) are determined by the source position relative to these caustics and the lens parameters that govern their shape and size.</p>
<div id="fig2"></div>
<div align="center">
  <img src="_static/lens_configuration.png" alt="Merger rate density and PDF of redshift for BBH mergers" width="600"/>
</div>
<blockquote>
<div><p><strong>Figure 2:</strong> Multi-image configuration for an EPL+Shear lens, showing the outer double-image caustic (orange dashed) and the inner quad-image (diamond) caustic (green solid) in the source plane. The Einstein ring (blue, dotted) serves as the angular scale reference, with <span class="math notranslate nohighlight">\(\theta_E(z_s=3.0, z_L=0.8, \sigma=160\,{\rm km/s}) \approx 2 \times 10^{-6}\)</span> rad. The lens geometry is defined by an axis ratio <span class="math notranslate nohighlight">\(q=0.6\)</span>, orientation angle <span class="math notranslate nohighlight">\(\phi=0.52\)</span> rad, mass density slope <span class="math notranslate nohighlight">\(\gamma=1.84\)</span>, and external shear components <span class="math notranslate nohighlight">\(\gamma_1=\gamma_2=-0.05\)</span>. A source located at <span class="math notranslate nohighlight">\((\beta_x, \beta_y) = (-0.25, 0.04)\)</span> lies inside the diamond caustic near a fold boundary, generating four lensed images (stars). These are labeled by index <span class="math notranslate nohighlight">\(i\)</span> (ordered by arrival time, where <span class="math notranslate nohighlight">\(i=1\)</span> arrives first), image type, time-delay wrt the first image <span class="math notranslate nohighlight">\(\Delta t_{1,i}\)</span> , and absolute magnification <span class="math notranslate nohighlight">\(|\mu_i|\)</span>. The caustic structure is governed by the lens (shape) parameters where <span class="math notranslate nohighlight">\(q\)</span> determines ellipticity and <span class="math notranslate nohighlight">\(\phi\)</span> controls counter-clockwise rotation relative to the x-axis. Increasing in <span class="math notranslate nohighlight">\(\gamma\)</span> cause the outer caustic to expand rapidly while the inner diamond caustic shrinks, whereas shear components induce skewness and rotation. An interactive demonstration of these dependencies is provided in the Google Colab <a class="reference external" href="https://colab.research.google.com/drive/1X1XDID3riGJhMgVBUueq-W72wOiSG3r9?usp=sharing">Example Notebook</a>. Notably, for the chosen configuration, the proximity of the source to the caustic fold results in high-magnification images which can significantly enhance the detectability of such gravitational lensing systems.</p>
</div></blockquote>
</section>
<section id="detection-probability-of-lensed-events">
<h2>Detection Probability of Lensed Events<a class="headerlink" href="#detection-probability-of-lensed-events" title="Link to this heading"></a></h2>
<p>For a specific lensed configuration, the detection probability is determined by the detectability of its images. The signal-to-noise ratio (SNR), <span class="math notranslate nohighlight">\(\rho(\vec{\theta}_{{\rm GW},i})\)</span>, is computed for each image using the modified GW parameters. An event is considered detected if at least two images meet the detection criterion. The probability is therefore a binary condition</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\begin{split}
&amp;P({\rm obs} \mid \vec{\theta}^*_{\rm U}, z_s, \vec{\theta_{\rm L}}, \vec{\beta}, {\rm SL}) = \Theta\left[\left(\sum_i P_{\rm det}(\vec{\theta}_{{\rm GW},i}, \rho_{\rm th}) \right) - 2\right] \, ,
\end{split}
\end{equation}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\Theta\)</span> is the Heaviside step function and the sum is over all images <span class="math notranslate nohighlight">\(i\)</span>. In the simplest step-function model, the individual image detection probability is defined as</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\begin{split}
P_{\rm det} (\vec{\theta}, \rho_{\rm th}) = 
\Theta[\rho(\vec{\theta}_{{\rm GW},i}) - \rho_{\rm th}] \, ,
\end{split}
\end{equation}
\]</div>
<p>and in <code class="docutils literal notranslate"><span class="pre">ler</span></code>, it is estimated using the <a class="reference external" href="https://gwsnr.hemantaph.com">gwsnr</a> package.</p>
</section>
<section id="complete-expression-for-lensed-event-rate">
<h2>Complete Expression for Lensed Event Rate<a class="headerlink" href="#complete-expression-for-lensed-event-rate" title="Link to this heading"></a></h2>
<p>Summarizing the derivation steps, the annual rate of detectable strongly lensed GW events is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\frac{\Delta N^{\rm obs}_{\rm L}}{\Delta t}
&amp;=
{\cal N}_{\rm L}
\bigg\langle
P({\rm obs}\mid \vec{\theta}^{*}_{\rm U}, z_s, \vec{\theta}_{\rm L}, \vec{\beta}, {\rm SL})
\bigg\rangle_{\substack{
\vec{\theta}^{*}_{\rm U}\sim P(\vec{\theta}^{*}_{\rm U}) \\
z_s \sim P(z_s \mid {\rm SL}) \\
z_L \sim P(z_L \mid z_s, {\rm SL}) \\
\vec{\theta}^{*}_{\rm L} \sim P(\vec{\theta}^{*}_{\rm L} \mid z_L, z_s, {\rm SL}) \\
\vec{\beta} \sim P(\vec{\beta} \mid z_s, \vec{\theta}_{\rm L}, {\rm SL})
}} \, .
\end{split}
\end{equation}
\end{split}\]</div>
<p>The computational procedure for evaluating the rate via Monte Carlo integration is summarized as follows:</p>
<ol class="arabic simple">
<li><p><strong>Intrinsic GW Parameters:</strong> Sample the unlensed GW parameters <span class="math notranslate nohighlight">\(\vec{\theta}^{*}_{\rm U}\)</span> from their intrinsic priors <span class="math notranslate nohighlight">\(P(\vec{\theta}^{*}_{\rm U})\)</span>.</p></li>
<li><p><strong>Lensed Source Redshift:</strong> Sample the source redshift <span class="math notranslate nohighlight">\(z_s\)</span> via inverse-transform sampling from the lensed distribution <span class="math notranslate nohighlight">\(P(z_s \mid {\rm SL})\)</span>, which is derived from the intrinsic redshift distribution <span class="math notranslate nohighlight">\(P(z_s)\)</span> and the precomputed optical depth <span class="math notranslate nohighlight">\(\tau(z_s)\)</span>.</p></li>
<li><p><strong>Lens Redshift:</strong> Conditioned on the sampled <span class="math notranslate nohighlight">\(z_s\)</span>, sample the lens redshift <span class="math notranslate nohighlight">\(z_L\)</span> via inverse-transform sampling from the distribution <span class="math notranslate nohighlight">\(P(z_L \mid z_s, {\rm SL})\)</span>, which is determined numerically from the differential optical depth <span class="math notranslate nohighlight">\(d\tau/dz_L\)</span>.</p></li>
<li><p><strong>Lens Properties:</strong> Conditioned on <span class="math notranslate nohighlight">\((z_s, z_L)\)</span>, generate a candidate batch of lens parameters <span class="math notranslate nohighlight">\(\{ \vec{\theta}^{*}_{{\rm L},i} \}_{i=1}^{N_{\rm prop}}\)</span>. Draw shape parameters <span class="math notranslate nohighlight">\(\vec{\theta}^{**}_{{\rm L},i}\)</span> from their intrinsic priors <span class="math notranslate nohighlight">\(P(\vec{\theta}^{**}_{\rm L} \mid z_L, z_s)\)</span> and velocity dispersions <span class="math notranslate nohighlight">\(\sigma_i\)</span> from a uniform proposal <span class="math notranslate nohighlight">\(P_o(\sigma)\)</span>. Select a single final configuration from this batch using importance sampling with normalized weights <span class="math notranslate nohighlight">\(w_i = \frac{1}{{\cal W}(z_L)}\frac{\sigma^{\rm EPL}_{{\rm SL},i}\,\phi(\sigma_i\mid z_L)}{P_o(\sigma_i)}\)</span>, where <span class="math notranslate nohighlight">\({\cal W}(z_L)\)</span> ensures <span class="math notranslate nohighlight">\(\sum_i w_i=1\)</span>.</p></li>
<li><p><strong>Source Position:</strong> Sample the source position <span class="math notranslate nohighlight">\(\vec{\beta}\)</span> uniformly within the multi-image caustic region defined by the selected lens parameters, calculated at a reference Einstein radius <span class="math notranslate nohighlight">\(\theta_{\rm E}=1\)</span>.</p></li>
<li><p><strong>Image Properties:</strong> Solve the lens equation to obtain the normalized image positions <span class="math notranslate nohighlight">\(\vec{\theta}_i\)</span>, magnifications <span class="math notranslate nohighlight">\(\mu_i\)</span>, and time delays <span class="math notranslate nohighlight">\(t_i\)</span>. Rescale the geometric parameters <span class="math notranslate nohighlight">\(\vec{\beta}\)</span>, <span class="math notranslate nohighlight">\(\vec{\theta}_i\)</span>, and <span class="math notranslate nohighlight">\(t_i\)</span> to physical units using the physical Einstein radius <span class="math notranslate nohighlight">\(\theta_{\rm E}(\sigma, z_L, z_s)\)</span>.</p></li>
<li><p><strong>Observed GW Parameters:</strong> Construct the observed parameters <span class="math notranslate nohighlight">\(\vec{\theta}_{{\rm GW},i}\)</span> for each image by applying lensing transformations (magnification, time delay, Morse phase shift and source position offsets) to the unlensed parameters <span class="math notranslate nohighlight">\(\vec{\theta}^{*}_{\rm U}\)</span>.</p></li>
<li><p><strong>Detection Criteria:</strong> Compute the SNR <span class="math notranslate nohighlight">\(\rho(\vec{\theta}_{{\rm GW},i})\)</span> for each image. An event is classified as detected if at least two images satisfy the detection threshold, i.e., <span class="math notranslate nohighlight">\(P({\rm obs}\mid \vec{\theta}^{*}_{\rm U}, z_s, \vec{\theta}_{\rm L}, \vec{\beta}, {\rm SL})=1\)</span> if <span class="math notranslate nohighlight">\(\sum_i \rho(\vec{\theta}_{{\rm GW},i})\geq 2\)</span> otherwise <span class="math notranslate nohighlight">\(0\)</span>.</p></li>
<li><p><strong>Rate Estimation:</strong> Estimate the final observable rate by averaging the detection probability <span class="math notranslate nohighlight">\(P({\rm obs}\mid \vec{\theta}^{*}_{\rm U}, z_s, \vec{\theta}_{\rm L}, \vec{\beta}, {\rm SL})\)</span> over a large ensemble (typically <span class="math notranslate nohighlight">\(\gtrsim 10^6\)</span>) of parameter sets <span class="math notranslate nohighlight">\(\{\vec{\theta}^{*}_{\rm U}, z_s, \vec{\theta}_{\rm L}, \vec{\beta} \}\)</span> and scaling the result by the total lensed rate <span class="math notranslate nohighlight">\({\cal N}_{\rm L}\)</span>.</p></li>
</ol>
<p>The specific parameter priors and their functional forms are detailed below.</p>
</section>
<section id="simulation-results">
<h2>Simulation Results<a class="headerlink" href="#simulation-results" title="Link to this heading"></a></h2>
<p>This section details the results regarding strong gravitational-wave lensing generated using the default configuration of the <code class="docutils literal notranslate"><span class="pre">ler</span></code> package. These results are compared against unlensed events. While <code class="docutils literal notranslate"><span class="pre">ler</span></code> accommodates alternative population prescriptions and user-defined models, the subsequent calculations rely on standard settings and assumptions.</p>
<section id="simulation-settings">
<h3>Simulation Settings<a class="headerlink" href="#simulation-settings" title="Link to this heading"></a></h3>
<p>The cosmological framework assumes a flat <span class="math notranslate nohighlight">\(\Lambda{\rm CDM}\)</span> model with <span class="math notranslate nohighlight">\(H_0 = 70\,{\rm km}\,{\rm s}^{-1}\,{\rm Mpc}^{-1}\)</span>, <span class="math notranslate nohighlight">\(\Omega_m = 0.3\)</span>, and <span class="math notranslate nohighlight">\(\Omega_\Lambda = 0.7\)</span>. Detection probabilities are computed via the <a class="reference external" href="https://gwsnr.hemantaph.com">gwsnr</a> backend. Waveforms are generated using the IMRPhenomXPHM approximant. Detector responses are evaluated at a sampling frequency of <span class="math notranslate nohighlight">\(2048\,{\rm Hz}\)</span> with a lower frequency cutoff of <span class="math notranslate nohighlight">\(f_{\rm low}=20\,{\rm Hz}\)</span> for the LIGO–Virgo–KAGRA network at O4 design sensitivity.  The signal-to-noise ratio detection threshold is established at <span class="math notranslate nohighlight">\(\rho_{\rm th}=10\)</span> for the network, assuming a complete 100% detector duty cycle.</p>
</section>
<section id="lens-and-source-parameter-priors">
<h3>Lens and source Parameter Priors<a class="headerlink" href="#lens-and-source-parameter-priors" title="Link to this heading"></a></h3>
<p>GW Source Parameter Priors are kept the same as in the section <a class="reference external" href="https://ler.hemantaph.com/analytical_formulation_unlensed.html#gw-source-parameter-priors">GW Source Parameter Priors</a> of <a class="reference external" href="https://ler.hemantaph.com/analytical_formulation_unlensed.html">Analytical Formulation for Gravitational Wave Event Rates</a>. The lens prior distributions and parameter ranges used in the event-rate calculations are summarized in Table 1, Table 2 and Table 3. These choices follows common conventions such as GW population forllowing GWTC-3–motivated models for source and SDSS and SLACS observations of galaxy populations.</p>
<p>Gravitational-wave source parameter priors align with those specified in the <a class="reference external" href="https://ler.hemantaph.com/analytical_formulation_unlensed.html">unlensed framework</a>. The lens prior distributions and parameter ranges employed in the event-rate calculations follow standard conventions based on GWTC-3 motivated source models alongside SDSS and SLACS galaxy observations. <a class="reference internal" href="#table1"><span class="xref myst">Table 1</span></a>, <a class="reference internal" href="#table2"><span class="xref myst">Table 2</span></a>, and <a class="reference internal" href="#table3"><span class="xref myst">Table 3</span></a> summarize these parameters. The source and lens redshifts are drawn from distributions conditioned on the occurrence of strong lensing. The optical depth <span class="math notranslate nohighlight">\(\tau(z_s)\)</span> and the differential optical depth <span class="math notranslate nohighlight">\(d\tau/dz_L\)</span> are pre-computed using the adopted EPL+Shear lens population and cosmology.</p>
<div id="table1"></div>
<p><strong>Table 1: Prior distributions for source and lens redshifts.</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Parameter</p></th>
<th class="head text-left"><p>Unit</p></th>
<th class="head text-left"><p>Prior <br>Distribution</p></th>
<th class="head text-left"><p>Range <br>[Min, Max]</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(z_s\)</span></p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(P(z_s\mid {\rm SL})\)</span> <br><span class="math notranslate nohighlight">\(\propto \tau(z_s)\,P(z_s)\)</span></p></td>
<td class="text-left"><p>[0, 10]</p></td>
<td class="text-left"><p>Source redshift <br>conditioned on <span class="math notranslate nohighlight">\({\rm SL}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><span class="math notranslate nohighlight">\(z_L\)</span></p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(P(z_L\mid z_s,{\rm SL})\)</span> <br><span class="math notranslate nohighlight">\(\propto \frac{d\tau}{dz_L}\)</span></p></td>
<td class="text-left"><p>[0, <span class="math notranslate nohighlight">\(z_s\)</span>]</p></td>
<td class="text-left"><p>Lens redshift <br>conditioned on <span class="math notranslate nohighlight">\(z_s\)</span> and <span class="math notranslate nohighlight">\({\rm SL}\)</span></p></td>
</tr>
</tbody>
</table>
<br>
<p>Lens parameter priors are listed below. Shape parameters assume a local flat coordinate system, with thin lens approximation, where the x-axis and the y-axis align with sky coordinates right ascension and declination respectively.</p>
<div id="table2"></div>
<p><strong>Table 2: Prior distributions for lens parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Parameter</p></th>
<th class="head text-left"><p>Unit</p></th>
<th class="head text-left"><p>Prior <br>Distribution</p></th>
<th class="head text-left"><p>Range <br>[Min, Max]</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(\sigma\)</span></p></td>
<td class="text-left"><p>km/s</p></td>
<td class="text-left"><p><strong>Proposed prior</strong> <br>Uniform <br><br><strong>Physical prior</strong> <br><span class="math notranslate nohighlight">\(P(\sigma\mid z_L)\propto\)</span> <br><span class="math notranslate nohighlight">\(\phi(\sigma, z_L)\)</span></p></td>
<td class="text-left"><p>[100, 400]</p></td>
<td class="text-left"><p>Velocity dispersion. <br><br><strong>Proposed prior :</strong> <br> Used for importance sampling <br>and computing <span class="math notranslate nohighlight">\(\frac{d\tau}{dz_L}\)</span>. <br><br><strong>Physical prior :</strong> <br>Based on the velocity <br>dispersion function <span class="math notranslate nohighlight">\(\phi(\sigma, z_L)\)</span> <br>(Oguri et al. 2018; SDSS+Illustris). <br><span class="math notranslate nohighlight">\(\alpha\)</span>=0.94, <span class="math notranslate nohighlight">\(\beta\)</span>=1.85, <br><span class="math notranslate nohighlight">\(\phi_*\)</span>=2.099x10<span class="math notranslate nohighlight">\(^{-2}\)</span>x(h/0.7)<span class="math notranslate nohighlight">\(^{3}\)</span> Mpc<span class="math notranslate nohighlight">\(^{-3}\)</span>, <br><span class="math notranslate nohighlight">\(\sigma_*\)</span>=113.78 km/s.<br>It is used to calculate <br>importance weights and <br><span class="math notranslate nohighlight">\(d\tau/dz_L\)</span>, rather than for <br>direct sampling.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><span class="math notranslate nohighlight">\(q\)</span></p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(P(q\mid \sigma)\)</span> <br>Rayleigh <br>distribution</p></td>
<td class="text-left"><p>[0.2, 1.0]</p></td>
<td class="text-left"><p>Projected axis ratio, <br>conditioned on <span class="math notranslate nohighlight">\(\sigma\)</span> <br>(Collett et al. 2015; SDSS).</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(\phi_{\rm rot}\)</span></p></td>
<td class="text-left"><p>rad</p></td>
<td class="text-left"><p>Uniform</p></td>
<td class="text-left"><p>[0, <span class="math notranslate nohighlight">\(\pi\)</span>]</p></td>
<td class="text-left"><p>Lens orientation angle, <br>measured counter-clockwise <br>from the x-axis.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><span class="math notranslate nohighlight">\(\gamma\)</span></p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p>Normal</p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p>Density profile slope <br>(Sonnenfeld et al. 2024; SLACS). <br>Mean: 2.0, Std: 0.1</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(\gamma_1, \gamma_2\)</span></p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p>Normal</p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p>External shear <br>(Collett et al. 2015; SDSS).<br> x and y components. <br>Mean: 0.0, Std: 0.05</p></td>
</tr>
</tbody>
</table>
<br>
<p>Source positions <span class="math notranslate nohighlight">\(\beta\)</span> are defined in a local flat coordinate system matching the orientation of the shape parameters.</p>
<div id="table3"></div>
<p><strong>Table 3: Prior distributions for source position</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Parameter</p></th>
<th class="head text-left"><p>Unit</p></th>
<th class="head text-left"><p>Prior Distribution</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(\beta_x\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\theta_{\rm E}\)</span></p></td>
<td class="text-left"><p>Uniform within<br> multi-image caustic</p></td>
<td class="text-left"><p>x-component <br>of source position from lens center</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><span class="math notranslate nohighlight">\(\beta_y\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\theta_{\rm E}\)</span></p></td>
<td class="text-left"><p>Uniform within<br> multi-image caustic</p></td>
<td class="text-left"><p>y-component <br>of source position from lens center</p></td>
</tr>
</tbody>
</table>
</section>
<section id="plot-comparison-for-lensed-detectable-lensed-and-intrinsic-populations">
<h3>Plot Comparison for Lensed+Detectable, Lensed and Intrinsic Populations<a class="headerlink" href="#plot-comparison-for-lensed-detectable-lensed-and-intrinsic-populations" title="Link to this heading"></a></h3>
<p>Selection effects inherent in lensed gravitational-wave observations become apparent when comparing the intrinsic binary black hole population to the subsets satisfying the strong-lensing condition and the detection criteria. The first subset is denoted as the strongly lensed population, and the second is referred to as the detectable strongly lensed population.</p>
<div id="fig4"></div>
<div align="center">
  <img src="_static/Lensed_Events.png" alt="Corner plot comparing intrinsic and detectable BBH populations" width="700"/>
</div>
<blockquote>
<div><p><strong>Figure 4:</strong> Kernel density estimate corner plot with 10, 40, 68, and 95 percent contour levels comparing parameter distributions for simulated intrinsic events (green), strongly lensed events (SL, blue), and strongly lensed events that also satisfy the detection criterion (SL+obs, orange), shown for the source redshift <span class="math notranslate nohighlight">\(z_s\)</span>, lens redshift <span class="math notranslate nohighlight">\(z_L\)</span>, lens velocity dispersion <span class="math notranslate nohighlight">\(\sigma\)</span>, projected axis ratio <span class="math notranslate nohighlight">\(q\)</span>, and EPL density slope <span class="math notranslate nohighlight">\(\gamma\)</span>; other lens parameters are omitted because their distributions show no significant changes under the SL and SL+obs selections. The intrinsic source population follows the unlensed merger-rate model, adopting a Madau–Dickinson–like prescription with time-delay and metallicity effects (see Figure 1) and standard GW-source priors as in the unlensed framework, while the intrinsic lens population is described by the velocity-dispersion function <span class="math notranslate nohighlight">\(\phi(\sigma,z_L)\)</span> from Oguri et al. (2018), with SDSS-based local calibration and redshift evolution informed by Illustris (Torrey et al. 2015), and with axis ratios drawn from a <span class="math notranslate nohighlight">\(\sigma\)</span>-conditioned Rayleigh model (Collett 2015), together with the remaining shape priors in Table 2. Strong lensing acts primarily through the optical depth and the lensing cross-section, set by the angular area of the multi-image caustic, so it preferentially selects higher-<span class="math notranslate nohighlight">\(z_s\)</span> sources where the optical depth is larger and favors higher-<span class="math notranslate nohighlight">\(\sigma\)</span> lenses because the cross-section scales steeply with Einstein radius, approximately as <span class="math notranslate nohighlight">\(\sigma^4\)</span>, while the conditional lens-redshift distribution peaks at intermediate redshifts <span class="math notranslate nohighlight">\(0&lt;z_L&lt;z_s\)</span> where lensing efficiency is highest. The detectability requirement introduces a secondary selection layer. Once a source lies inside the multi-image caustic, the probability of inclusion in SL+obs increases with the number of images and their magnifications, and the largest magnifications typically arise for sources near caustic boundaries, particularly within the quad caustic, which can boost the SNR and extend the detection horizon, making larger quad-caustic regions relative to the double-caustic region more favorable. Consistent with these trends, the SL population shows a preference for steeper density profiles (higher <span class="math notranslate nohighlight">\(\gamma\)</span>) and rounder lenses (higher <span class="math notranslate nohighlight">\(q\)</span>) that generally yield larger caustic areas, whereas the SL+obs subset is biased toward lower redshift by SNR limitations and shows a mild shift toward more elliptical lenses (lower <span class="math notranslate nohighlight">\(q\)</span>) and slightly shallower slopes (lower <span class="math notranslate nohighlight">\(\gamma\)</span>) relative to SL because these configurations can increase the chances of highly magnified multi-image signals (including quads). The figure therefore demonstrates that strong lensing and detectability together imprint coupled selection effects on <span class="math notranslate nohighlight">\((z_s,z_L,\sigma,q,\gamma)\)</span> that must be modeled self-consistently when simulating observed lensed events and interpreting inferred source and lens properties, and an interactive illustration of how <span class="math notranslate nohighlight">\((q,\phi,\gamma,\gamma_1,\gamma_2)\)</span> reshape caustics and image magnifications is provided in the <a class="reference external" href="https://colab.research.google.com/drive/1X1XDID3riGJhMgVBUueq-W72wOiSG3r9?usp=sharing">example notebook</a>.</p>
</div></blockquote>
</section>
<section id="biases-in-the-inferred-gw-parameters">
<h3>Biases in the inferred GW parameters<a class="headerlink" href="#biases-in-the-inferred-gw-parameters" title="Link to this heading"></a></h3>
<p>When a strongly lensed gravitational wave is detected without being identified as such, parameter estimation proceeds using standard unlensed waveform templates. Since lensing magnifies the signal, the effective luminosity distance is artificially decreased. Under the assumption of standard cosmology, this shorter distance is interpreted as a lower source redshift. The source-frame masses, obtained by de-redshifting the detector-frame masses using this underestimated redshift, are consequently biased upward. This systematic shift is referred to as magnification bias.</p>
<div id="fig5"></div>
<div align="center">
  <img src="_static/mc_vs_zs.png" alt="Corner plot comparing inferred source redshift and chirp mass for lensed and unlensed events" width="450"/>
</div>
<blockquote>
<div><p><strong>Figure 5:</strong> Joint kernel density estimate (KDE) with 10, 40, 68, and 95 percent contour levels and marginal distributions comparing the inferred source redshift <span class="math notranslate nohighlight">\(z^*_s\)</span> and inferred source-frame chirp mass <span class="math notranslate nohighlight">\({\cal M}_c^{* \, {\rm src}}\)</span> for the detectable unlensed (blue) and lensed (orange) populations. While the unlensed parameters reflect the true source properties, the inferred parameters for lensed events are systematically biased by magnification. The inferred redshift <span class="math notranslate nohighlight">\(z^*_s\)</span> is derived from the effective luminosity distance <span class="math notranslate nohighlight">\(d_{L}^{\rm eff} = d_{L} / \sqrt{|\mu|}\)</span>, which subsequently affects the source-frame mass reconstruction via <span class="math notranslate nohighlight">\({\cal M}_c^{* \, {\rm src}} = {\cal M}_c / (1+z^*_s)\)</span>, where <span class="math notranslate nohighlight">\({\cal M}_c\)</span> is the detector-frame chirp mass. Consequently, the lensed population exhibits a distinct shift toward higher inferred redshifts—though these still underestimate the true source redshifts of lensed events—and significantly higher inferred chirp masses relative to the unlensed population. This magnification bias demonstrates that unrecognized lensed events can contaminate the observed catalog by mimicking heavy binary black hole mergers and appearing as high-mass outliers; however, given the low expected rate of lensed events relative to unlensed ones (<span class="math notranslate nohighlight">\(\approx\)</span> 1:3000 at O4 design sensitivity), this contamination is unlikely to significantly skew population studies or cosmological inferences even if unaccounted for.</p>
</div></blockquote>
</section>
<section id="time-delays-and-magnifications-of-detected-lensed-events">
<h3>Time Delays and Magnifications of Detected Lensed Events<a class="headerlink" href="#time-delays-and-magnifications-of-detected-lensed-events" title="Link to this heading"></a></h3>
<p>Strong gravitational lensing produces multiple copies of the same transient signal arriving at the detector at different times and with varying amplitudes. The distinct arrival times define a time delay between images, while the relative amplitudes yield a magnification ratio. Comparing these pairwise observables provides a simple discriminative tool for distinguishing genuine lensed image pairs from random coincidences of independent unlensed events.</p>
<div id="fig6"></div>
<div align="center">
  <img src="_static/dt_vs_dmu.png" alt="Corner plot comparing time delays and magnifications for detected lensed events" width="600"/>
</div>
<blockquote>
<div><p><strong>Figure 6:</strong> Joint kernel density estimate in the plane of pairwise time-delay difference <span class="math notranslate nohighlight">\(\log_{10}(\Delta t_{ij})\)</span> and relative magnification <span class="math notranslate nohighlight">\(\log_{10}(|\mu_i/\mu_j|)\)</span>, comparing pairs of detected images from strongly lensed events (blue) to pairs of randomly chosen detected unlensed events (orange), with the corresponding marginal empirical cumulative distribution functions (CDFs) shown in the top and right panels. For lensed systems, <span class="math notranslate nohighlight">\(\Delta t_{ij}\)</span> is the arrival-time delay between the <span class="math notranslate nohighlight">\(i\)</span>th and <span class="math notranslate nohighlight">\(j\)</span>th (detected) images of the same source (in days, with <span class="math notranslate nohighlight">\(i&lt;j\)</span>), and <span class="math notranslate nohighlight">\(\mu_i\)</span> and <span class="math notranslate nohighlight">\(\mu_j\)</span> are the signed lensing magnifications; the ratio can be expressed in terms of effective luminosity distances as <span class="math notranslate nohighlight">\(|\mu_i / \mu_j|=(d^{\rm eff}_{L,i}/d^{\rm eff}_{L,j})^2\)</span> with <span class="math notranslate nohighlight">\(d^{\rm eff}_{L}=d_L/\sqrt{|\mu|}\)</span>. The unlensed comparison represents the distribution of time separations and luminosity-distance ratios for unrelated (detected) events, rather than multiple images of a single source. The lensed population is concentrated at shorter delays and closer-to-unity magnification ratios, with 90% of pairs satisfying <span class="math notranslate nohighlight">\(\Delta t{ij}&lt;15.09\)</span> days (equivalently <span class="math notranslate nohighlight">\(\log_{10}(\Delta t_{ij})&lt;1.179\)</span>) and <span class="math notranslate nohighlight">\(|\mu_i/\mu_j|&lt;2.081\)</span> (equivalently <span class="math notranslate nohighlight">\(\log_{10}(|\mu_i/\mu_j|)&lt;0.318\)</span>), whereas the unlensed pairs exhibit a much broader distributions with 90% satisfying <span class="math notranslate nohighlight">\(\Delta t_{ij}&lt;244.28\)</span> days (<span class="math notranslate nohighlight">\(\log_{10}(\Delta t_{ij})&lt;2.388\)</span>) and <span class="math notranslate nohighlight">\(|\mu_i/\mu_j|&lt;17.282\)</span> (<span class="math notranslate nohighlight">\(\log_{10}(|\mu_i/\mu_j|)&lt;1.238\)</span>), including very small ratios arising from widely different distances. This separation motivates using <span class="math notranslate nohighlight">\((\Delta t_{ij},|\mu_i/\mu_j|)\)</span> as a diagnostic for lensing candidates identification, since pairs with small <span class="math notranslate nohighlight">\(\Delta t_{ij}\)</span> and <span class="math notranslate nohighlight">\(|\mu_i/\mu_j|\simeq 1\)</span> are more consistent with being multiple images of the same lensed event than with being unrelated detections (<a class="reference external" href="https://doi.org/10.1093/mnras/stad2909">Janquart et al. 2023</a>)</p>
</div></blockquote>
</section>
</section>
<section id="rate-estimates-and-comparisons">
<h2>Rate Estimates and Comparisons<a class="headerlink" href="#rate-estimates-and-comparisons" title="Link to this heading"></a></h2>
<p>Estimated detectable annual merger rates for BBH (Pop I–II)  populations are listed below.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Detector <br>Configuration</p></th>
<th class="head text-left"><p>Unlensed <br>Merger Rate (<span class="math notranslate nohighlight">\({\rm yr}^{-1}\)</span>)</p></th>
<th class="head text-left"><p>Lensed <br>Merger Rate (<span class="math notranslate nohighlight">\({\rm yr}^{-1}\)</span>)</p></th>
<th class="head text-left"><p>Ratio <br>Unlensed:Lensed</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>[L1, H1, V1] (O4)</p></td>
<td class="text-left"><p>299.56</p></td>
<td class="text-left"><p>0.10</p></td>
<td class="text-left"><p>2996:1</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="analytical_formulation_unlensed.html" class="btn btn-neutral float-left" title="Analytical Formulation for Gravitational Wave Event Rates" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="autoapi/ler/rates/index.html" class="btn btn-neutral float-right" title="ler.rates" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Phurailatpam Hemantakumar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>