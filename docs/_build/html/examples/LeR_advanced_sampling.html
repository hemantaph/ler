

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LeR Advanced Sampling — Generating Detectable Events &mdash; ler 0.5.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/scalefix.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=776609e1" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=2a2fe768"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "displayMath": [["$$", "$$"], ["\\[", "\\]"]], "processEnvironments": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore", "processHtmlClass": "tex2jax_process"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../_static/dark_mode_js/default_light.js?v=c2e647ce"></script>
      <script src="../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="LeR with Custom Functions and Parameters" href="LeR_custom_functions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980b9" >

          
          
          <a href="../index.html" class="icon icon-home">
            ler
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_overview.html">Code overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analytical_formulation_unlensed.html">Analytical Formulation for Gravitational Wave Event Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analytical_formulation_lensed.html">Analytical Formulation for Lensed Gravitational Wave Event Rates</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/ler/rates/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.rates</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/ler/gw_source_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.gw_source_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/ler/lens_galaxy_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.lens_galaxy_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/ler/image_properties/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.image_properties</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/ler/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.utils</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="LeR_short_examples.html">LeR Short Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="GWRATES_complete_examples.html">GWRATES complete example</a></li>
<li class="toctree-l1"><a class="reference internal" href="LeR_custom_functions.html">LeR with Custom Functions and Parameters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">LeR Advanced Sampling — Generating Detectable Events</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Table-of-Contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#1.-Initialize-LeR">1. Initialize LeR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#2.-Sampling-N-Detectable-Events">2. Sampling N Detectable Events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#2.1-Unlensed-Events">2.1 Unlensed Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.2-Rate-Convergence-(Unlensed)">2.2 Rate Convergence (Unlensed)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.3-Rate-Stability-(Unlensed)">2.3 Rate Stability (Unlensed)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.4-Lensed-Events">2.4 Lensed Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.5-Rate-Convergence-(Lensed)">2.5 Rate Convergence (Lensed)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.6-Rate-Stability-(Lensed)">2.6 Rate Stability (Lensed)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.7-Rate-Comparison">2.7 Rate Comparison</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Parameter-Distributions:-All-vs-Detectable">3. Parameter Distributions: All vs Detectable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#3.1-Unlensed-Events">3.1 Unlensed Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.2-Lensed-Events">3.2 Lensed Events</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#4.-Visualizing-Lensed-Detectable-Events">4. Visualizing Lensed Detectable Events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#4.1-Redshift-Distribution">4.1 Redshift Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4.2-Magnification-Ratio-vs-Time-Delay">4.2 Magnification Ratio vs Time Delay</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4.3-Caustic-Plot">4.3 Caustic Plot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#5.-Summary">5. Summary</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980b9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">LeR Advanced Sampling — Generating Detectable Events</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/LeR_advanced_sampling.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="LeR-Advanced-Sampling-—-Generating-Detectable-Events">
<h1>LeR Advanced Sampling — Generating Detectable Events<a class="headerlink" href="#LeR-Advanced-Sampling-—-Generating-Detectable-Events" title="Link to this heading"></a></h1>
<p>This notebook is created by <a class="reference external" href="https://hemantaph.com">Phurailatpam Hemantakumar</a></p>
<p><a class="reference external" href="https://ler.hemantaph.com"><img alt="Documentation" src="https://img.shields.io/badge/ler-documentation-blue" /></a></p>
<p>This notebook demonstrates how to generate a specific number of detectable events and monitor detection rate convergence as a function of sample size using the <code class="docutils literal notranslate"><span class="pre">LeR</span></code> class.</p>
<p><strong>Key Features:</strong> - Batch sampling until N detectable events are collected - Rate convergence monitoring with stopping criteria - Resume capability for interrupted sessions - Visualization of rate convergence and parameter distributions</p>
<hr class="docutils" />
<section id="Table-of-Contents">
<h2>Table of Contents<a class="headerlink" href="#Table-of-Contents" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Initialize LeR</p></li>
<li><p>Sampling N Detectable Events</p>
<ul class="simple">
<li><p>2.1 Unlensed Events</p></li>
<li><p>2.2 Rate Convergence (Unlensed)</p></li>
<li><p>2.3 Rate Stability (Unlensed)</p></li>
<li><p>2.4 Lensed Events</p></li>
<li><p>2.5 Rate Convergence (Lensed)</p></li>
<li><p>2.6 Rate Stability (Lensed)</p></li>
<li><p>2.7 Rate Comparison</p></li>
</ul>
</li>
<li><p>Parameter Distributions: All vs Detectable</p>
<ul class="simple">
<li><p>3.1 Unlensed Events</p></li>
<li><p>3.2 Lensed Events</p></li>
</ul>
</li>
<li><p>Visualizing Lensed Detectable Events</p>
<ul class="simple">
<li><p>4.1 Redshift Distribution</p></li>
<li><p>4.2 Magnification Ratio vs Time Delay</p></li>
<li><p>4.3 Caustic Plot</p></li>
</ul>
</li>
<li><p>Summary</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="1.-Initialize-LeR">
<h2>1. Initialize LeR<a class="headerlink" href="#1.-Initialize-LeR" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">LeR</span></code> class is the main interface for simulating unlensed and lensed GW events and calculating detection rates. Default settings:</p>
<ul class="simple">
<li><p><strong>Event type:</strong> BBH (Binary Black Hole)</p></li>
<li><p><strong>Lens model:</strong> EPL+Shear (Elliptical Power Law with external shear)</p></li>
<li><p><strong>Detectors:</strong> H1, L1, V1 with O4 design sensitivity</p></li>
</ul>
<p>Outputs are saved to <code class="docutils literal notranslate"><span class="pre">./ler_data</span></code> by default.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import LeR</span>
<span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">LeR</span>

<span class="c1"># Initialize LeR with default settings</span>
<span class="c1"># npool: number of parallel processes for sampling</span>
<span class="n">ler</span> <span class="o">=</span> <span class="n">LeR</span><span class="p">(</span><span class="n">npool</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Initializing LeR class...


Initializing LensGalaxyParameterDistribution class...


Initializing OpticalDepth class

comoving_distance interpolator will be loaded from ./interpolator_json/comoving_distance/comoving_distance_0.json
angular_diameter_distance interpolator will be loaded from ./interpolator_json/angular_diameter_distance/angular_diameter_distance_0.json
angular_diameter_distance interpolator will be loaded from ./interpolator_json/angular_diameter_distance/angular_diameter_distance_0.json
differential_comoving_volume interpolator will be loaded from ./interpolator_json/differential_comoving_volume/differential_comoving_volume_0.json
using ler available velocity dispersion function : velocity_dispersion_ewoud
velocity_dispersion_ewoud interpolator will be loaded from ./interpolator_json/velocity_dispersion/velocity_dispersion_ewoud_0.json
using ler available axis_ratio function : axis_ratio_rayleigh
axis_ratio_rayleigh interpolator will be loaded from ./interpolator_json/axis_ratio/axis_ratio_rayleigh_1.json
using ler available axis_rotation_angle function : axis_rotation_angle_uniform
using ler available density_profile_slope function : density_profile_slope_normal
using ler available external_shear function : external_shear_normal
Cross section interpolation data points loaded from ./interpolator_json/cross_section_function/cross_section_function_0.json
using ler available lens_redshift function : lens_redshift_strongly_lensed_numerical
Numerically solving the lens redshift distribution...
lens_redshift_strongly_lensed_numerical_epl_shear_galaxy interpolator will be loaded from ./interpolator_json/lens_redshift/lens_redshift_strongly_lensed_numerical_epl_shear_galaxy_1.json
lens_redshift_intrinsic interpolator will be loaded from ./interpolator_json/lens_redshift_intrinsic/lens_redshift_intrinsic_1.json
using ler available density_profile_slope_sl function : density_profile_slope_normal
using ler available external_shear_sl function : external_shear_normal
using ler available optical depth function : optical_depth_numerical
optical_depth_numerical interpolator will be loaded from ./interpolator_json/optical_depth/optical_depth_numerical_1.json

Initializing CBCSourceRedshiftDistribution class...

luminosity_distance interpolator will be loaded from ./interpolator_json/luminosity_distance/luminosity_distance_0.json
differential_comoving_volume interpolator will be loaded from ./interpolator_json/differential_comoving_volume/differential_comoving_volume_0.json
using ler available merger rate density model: merger_rate_density_madau_dickinson_belczynski_ng
merger_rate_density_madau_dickinson_belczynski_ng interpolator will be loaded from ./interpolator_json/merger_rate_density/merger_rate_density_madau_dickinson_belczynski_ng_0.json
merger_rate_density_detector_frame interpolator will be loaded from ./interpolator_json/merger_rate_density/merger_rate_density_detector_frame_1.json
source_redshift interpolator will be loaded from ./interpolator_json/source_redshift/source_redshift_0.json

Initializing CBCSourceParameterDistribution class...

using ler available zs function : source_redshift
using ler available source_frame_masses function : binary_masses_BBH_powerlaw_gaussian
using ler available geocent_time function : sampler_uniform
using ler available ra function : sampler_uniform
using ler available dec function : sampler_cosine
using ler available phase function : sampler_uniform
using ler available psi function : sampler_uniform
using ler available theta_jn function : sampler_sine
using ler available a_1 function : sampler_uniform
using ler available a_2 function : sampler_uniform
Faster, njitted and importance sampling based lens parameter sampler will be used.

Initializing GWSNR class...

psds not given. Choosing bilby&#39;s default psds
Interpolator will be loaded for L1 detector from ./interpolator_json/L1/partialSNR_dict_0.json
Interpolator will be loaded for H1 detector from ./interpolator_json/H1/partialSNR_dict_0.json
Interpolator will be loaded for V1 detector from ./interpolator_json/V1/partialSNR_dict_0.json

Chosen GWSNR initialization parameters:

npool:  4
snr type:  interpolation_aligned_spins
waveform approximant:  IMRPhenomD
sampling frequency:  2048.0
minimum frequency (fmin):  20.0
reference frequency (f_ref):  20.0
mtot=mass1+mass2
min(mtot):  9.96
max(mtot) (with the given fmin=20.0): 500.0
detectors:  [&#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;]
psds:  [[array([  10.21659,   10.23975,   10.26296, ..., 4972.81   ,
       4984.081  , 4995.378  ], shape=(2736,)), array([4.43925574e-41, 4.22777986e-41, 4.02102594e-41, ...,
       6.51153524e-46, 6.43165104e-46, 6.55252996e-46],
      shape=(2736,)), &lt;scipy.interpolate._interpolate.interp1d object at 0x17d2bac50&gt;], [array([  10.21659,   10.23975,   10.26296, ..., 4972.81   ,
       4984.081  , 4995.378  ], shape=(2736,)), array([4.43925574e-41, 4.22777986e-41, 4.02102594e-41, ...,
       6.51153524e-46, 6.43165104e-46, 6.55252996e-46],
      shape=(2736,)), &lt;scipy.interpolate._interpolate.interp1d object at 0x17d25fba0&gt;], [array([   10.      ,    10.02306 ,    10.046173, ...,
        9954.0389  ,  9976.993   , 10000.      ], shape=(3000,)), array([1.22674387e-42, 1.20400299e-42, 1.18169466e-42, ...,
       1.51304203e-43, 1.52010157e-43, 1.52719372e-43],
      shape=(3000,)), &lt;scipy.interpolate._interpolate.interp1d object at 0x17cf21580&gt;]]


#-------------------------------------
# LeR initialization input arguments:
#-------------------------------------

    # LeR set up input arguments:
    npool = 4,
    z_min = 0.0,
    z_max = 10.0,
    event_type = &#39;BBH&#39;,
    lens_type = &#39;epl_shear_galaxy&#39;,
    cosmology = LambdaCDM(H0=70.0 km / (Mpc s), Om0=0.3, Ode0=0.7, Tcmb0=0.0 K, Neff=3.04, m_nu=None, Ob0=0.0),
    pdet_finder = &lt;bound method GWSNR.pdet of &lt;gwsnr.core.gwsnr.GWSNR object at 0x17b778dc0&gt;&gt;,
    json_file_names = dict(
        ler_params = &#39;ler_params.json&#39;,
        unlensed_param = &#39;unlensed_param.json&#39;,
        unlensed_param_detectable = &#39;unlensed_param_detectable.json&#39;,
        lensed_param = &#39;lensed_param.json&#39;,
        lensed_param_detectable = &#39;lensed_param_detectable.json&#39;,
    ),
    interpolator_directory = &#39;./interpolator_json&#39;,
    ler_directory = &#39;./ler_data&#39;,
    create_new_interpolator = dict(
        merger_rate_density = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        redshift_distribution = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        luminosity_distance = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        differential_comoving_volume = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        source_frame_masses = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        geocent_time = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        ra = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        dec = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        phase = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        psi = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        theta_jn = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        a_1 = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        a_2 = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        tilt_1 = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        tilt_2 = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        phi_12 = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        phi_jl = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        velocity_dispersion = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500, &#39;zl_resolution&#39;: 48},
        axis_ratio = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500, &#39;sigma_resolution&#39;: 48},
        lens_redshift = {&#39;create_new&#39;: False, &#39;resolution&#39;: 48, &#39;zl_resolution&#39;: 48},
        lens_redshift_intrinsic = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        optical_depth = {&#39;create_new&#39;: False, &#39;resolution&#39;: 48},
        comoving_distance = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        angular_diameter_distance = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        angular_diameter_distance_z1z2 = {&#39;create_new&#39;: False, &#39;resolution&#39;: 500},
        density_profile_slope = {&#39;create_new&#39;: False, &#39;resolution&#39;: 100},
        lens_parameters_kde_sl = {&#39;create_new&#39;: False, &#39;resolution&#39;: 5000},
        cross_section = {&#39;create_new&#39;: False, &#39;resolution&#39;: [25, 25, 45, 15, 15]},
    ),

    # LeR also takes other CBCSourceParameterDistribution class input arguments as kwargs, as follows:
    source_priors = dict(
        merger_rate_density = &#39;merger_rate_density_madau_dickinson_belczynski_ng&#39;,
        zs = &#39;source_redshift&#39;,
        source_frame_masses = &#39;binary_masses_BBH_powerlaw_gaussian&#39;,
        geocent_time = &#39;sampler_uniform&#39;,
        ra = &#39;sampler_uniform&#39;,
        dec = &#39;sampler_cosine&#39;,
        phase = &#39;sampler_uniform&#39;,
        psi = &#39;sampler_uniform&#39;,
        theta_jn = &#39;sampler_sine&#39;,
        a_1 = &#39;sampler_uniform&#39;,
        a_2 = &#39;sampler_uniform&#39;,
    ),
    source_priors_params = dict(
        merger_rate_density = {&#39;R0&#39;: 1.9e-08, &#39;alpha_F&#39;: 2.57, &#39;beta_F&#39;: 5.83, &#39;c_F&#39;: 3.36},
        zs = None,
        source_frame_masses = {&#39;mminbh&#39;: 4.98, &#39;mmaxbh&#39;: 112.5, &#39;alpha&#39;: 3.78, &#39;mu_g&#39;: 32.27, &#39;sigma_g&#39;: 3.88, &#39;lambda_peak&#39;: 0.03, &#39;delta_m&#39;: 4.8, &#39;beta&#39;: 0.81},
        geocent_time = {&#39;xmin&#39;: 1238166018, &#39;xmax&#39;: 1269702018},
        ra = {&#39;xmin&#39;: 0.0, &#39;xmax&#39;: 6.283185307179586},
        dec = None,
        phase = {&#39;xmin&#39;: 0.0, &#39;xmax&#39;: 6.283185307179586},
        psi = {&#39;xmin&#39;: 0.0, &#39;xmax&#39;: 3.141592653589793},
        theta_jn = None,
        a_1 = {&#39;xmin&#39;: -0.8, &#39;xmax&#39;: 0.8},
        a_2 = {&#39;xmin&#39;: -0.8, &#39;xmax&#39;: 0.8},
    ),
    spin_zero = False,
    spin_precession = False,

    # LeR also takes other LensGalaxyParameterDistribution class input arguments as kwargs, as follows:
    lens_functions = dict(
        param_sampler_type = &#39;sample_all_routine_epl_shear_sl&#39;,
        cross_section_based_sampler = &#39;importance_sampling_with_cross_section&#39;,
        optical_depth = &#39;optical_depth_numerical&#39;,
        cross_section = &#39;cross_section_epl_shear_interpolation&#39;,
    ),
    lens_functions_params = dict(
        param_sampler_type = None,
        cross_section_based_sampler = {&#39;n_prop&#39;: 200},
        optical_depth = None,
        cross_section = None,
    ),
    lens_param_samplers = dict(
        source_redshift_sl = &#39;strongly_lensed_source_redshift&#39;,
        lens_redshift = &#39;lens_redshift_strongly_lensed_numerical&#39;,
        velocity_dispersion = &#39;velocity_dispersion_ewoud&#39;,
        axis_ratio = &#39;axis_ratio_rayleigh&#39;,
        axis_rotation_angle = &#39;axis_rotation_angle_uniform&#39;,
        external_shear = &#39;external_shear_normal&#39;,
        density_profile_slope = &#39;density_profile_slope_normal&#39;,
        external_shear_sl = &#39;external_shear_normal&#39;,
        density_profile_slope_sl = &#39;density_profile_slope_normal&#39;,
    ),
    lens_param_samplers_params = dict(
        source_redshift_sl = None,
        lens_redshift = {&#39;integration_size&#39;: 25000, &#39;use_multiprocessing&#39;: False},
        velocity_dispersion = {&#39;sigma_min&#39;: 100.0, &#39;sigma_max&#39;: 400.0, &#39;alpha&#39;: 0.94, &#39;beta&#39;: 1.85, &#39;phistar&#39;: np.float64(0.02099), &#39;sigmastar&#39;: 113.78, &#39;name&#39;: &#39;velocity_dispersion_ewoud&#39;},
        axis_ratio = {&#39;q_min&#39;: 0.2, &#39;q_max&#39;: 1.0, &#39;name&#39;: &#39;axis_ratio_rayleigh&#39;},
        axis_rotation_angle = {&#39;phi_min&#39;: 0.0, &#39;phi_max&#39;: 6.283185307179586, &#39;name&#39;: &#39;axis_rotation_angle_uniform&#39;},
        external_shear = {&#39;mean&#39;: 0.0, &#39;std&#39;: 0.05, &#39;name&#39;: &#39;external_shear_normal&#39;},
        density_profile_slope = {&#39;mean&#39;: 1.99, &#39;std&#39;: 0.149, &#39;name&#39;: &#39;density_profile_slope_normal&#39;},
        external_shear_sl = {&#39;mean&#39;: 0.0, &#39;std&#39;: 0.05},
        density_profile_slope_sl = {&#39;mean&#39;: 2.078, &#39;std&#39;: 0.16},
    ),

    # LeR also takes other ImageProperties class input arguments as kwargs, as follows:
    n_min_images = 2,
    n_max_images = 4,
    time_window = 630720000,
    lens_model_list = [&#39;EPL_NUMBA&#39;, &#39;SHEAR&#39;],

    # LeR also takes other gwsnr.GWSNR input arguments as kwargs, as follows:
    npool = 4,
    snr_method = &#39;interpolation_aligned_spins&#39;,
    snr_type = &#39;optimal_snr&#39;,
    gwsnr_verbose = True,
    multiprocessing_verbose = True,
    pdet_kwargs = dict(
        snr_th = 10.0,
        snr_th_net = 10.0,
        pdet_type = &#39;boolean&#39;,
        distribution_type = &#39;noncentral_chi2&#39;,
        include_optimal_snr = False,
        include_observed_snr = False,
    ),
    mtot_min = 9.96,
    mtot_max = 500.0,
    ratio_min = 0.1,
    ratio_max = 1.0,
    spin_max = 0.99,
    mtot_resolution = 200,
    ratio_resolution = 20,
    spin_resolution = 10,
    batch_size_interpolation = 1000000,
    interpolator_dir = &#39;./interpolator_json&#39;,
    create_new_interpolator = False,
    sampling_frequency = 2048.0,
    waveform_approximant = &#39;IMRPhenomD&#39;,
    frequency_domain_source_model = &#39;lal_binary_black_hole&#39;,
    minimum_frequency = 20.0,
    reference_frequency = None,
    duration_max = None,
    duration_min = None,
    fixed_duration = None,
    mtot_cut = False,
    psds = None,
    ifos = None,
    noise_realization = None,
    ann_path_dict = None,
    snr_recalculation = False,
    snr_recalculation_range = [6, 14],
    snr_recalculation_waveform_approximant = &#39;IMRPhenomXPHM&#39;,
    psds_list = [[array([  10.21659,   10.23975,   10.26296, ..., 4972.81   ,
       4984.081  , 4995.378  ], shape=(2736,)), array([4.43925574e-41, 4.22777986e-41, 4.02102594e-41, ...,
       6.51153524e-46, 6.43165104e-46, 6.55252996e-46],
      shape=(2736,)), &lt;scipy.interpolate._interpolate.interp1d object at 0x17d2bac50&gt;], [array([  10.21659,   10.23975,   10.26296, ..., 4972.81   ,
       4984.081  , 4995.378  ], shape=(2736,)), array([4.43925574e-41, 4.22777986e-41, 4.02102594e-41, ...,
       6.51153524e-46, 6.43165104e-46, 6.55252996e-46],
      shape=(2736,)), &lt;scipy.interpolate._interpolate.interp1d object at 0x17d25fba0&gt;], [array([   10.      ,    10.02306 ,    10.046173, ...,
        9954.0389  ,  9976.993   , 10000.      ], shape=(3000,)), array([1.22674387e-42, 1.20400299e-42, 1.18169466e-42, ...,
       1.51304203e-43, 1.52010157e-43, 1.52719372e-43],
      shape=(3000,)), &lt;scipy.interpolate._interpolate.interp1d object at 0x17cf21580&gt;]],
</pre></div></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># To print all initialization input arguments, use:</span>
<span class="n">ler</span><span class="o">.</span><span class="n">_print_all_init_args</span><span class="p">()</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="2.-Sampling-N-Detectable-Events">
<h2>2. Sampling N Detectable Events<a class="headerlink" href="#2.-Sampling-N-Detectable-Events" title="Link to this heading"></a></h2>
<p>Sample GW events until a specified number of detectable events is collected and stopping criteria are met.</p>
<p><strong>Key features:</strong> - <strong>Batch processing:</strong> Events are sampled in batches for efficiency - <strong>Convergence monitoring:</strong> Rate stability is tracked via stopping criteria - <strong>Resume capability:</strong> Sampling can continue from previous sessions</p>
<section id="2.1-Unlensed-Events">
<h3>2.1 Unlensed Events<a class="headerlink" href="#2.1-Unlensed-Events" title="Link to this heading"></a></h3>
<p>Key parameters: - <code class="docutils literal notranslate"><span class="pre">size</span></code>: Target number of detectable events - <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>: Events sampled per batch - <code class="docutils literal notranslate"><span class="pre">stopping_criteria</span></code>: Convergence conditions - <code class="docutils literal notranslate"><span class="pre">pdet_threshold</span></code>: Detection probability threshold - <code class="docutils literal notranslate"><span class="pre">resume</span></code>: Resume from previous session</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample until we have at least 10,000 detectable unlensed events with converged rates</span>
<span class="c1"># use &#39;print(ler.selecting_n_unlensed_detectable_events.__doc__)&#39; to see all input args</span>
<span class="n">detectable_rate_unlensed</span><span class="p">,</span> <span class="n">unlensed_param_detectable_n</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">selecting_n_unlensed_detectable_events</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>                          <span class="c1"># Target number of detectable events</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>                   <span class="c1"># Events per batch</span>
    <span class="n">stopping_criteria</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">relative_diff_percentage</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>    <span class="c1"># Stop when rate change &lt; 0.1%</span>
        <span class="n">number_of_last_batches_to_check</span><span class="o">=</span><span class="mi">4</span>  <span class="c1"># Check last 4 batches for convergence</span>
    <span class="p">),</span>
    <span class="n">pdet_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>                  <span class="c1"># Probability threshold for detection</span>
    <span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                         <span class="c1"># Resume from previous state if available</span>
    <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;unlensed_params_n_detectable.json&#39;</span><span class="p">,</span>  <span class="c1"># Output file for detectable events</span>
    <span class="n">meta_data_file</span><span class="o">=</span><span class="s1">&#39;meta_unlensed.json&#39;</span><span class="p">,</span> <span class="c1"># Store metadata (rates per batch)</span>
    <span class="n">pdet_type</span><span class="o">=</span><span class="s1">&#39;boolean&#39;</span><span class="p">,</span>                 <span class="c1"># Detection type: &#39;boolean&#39; or &#39;float&#39;</span>
    <span class="n">trim_to_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>                  <span class="c1"># Keep all events found until convergence</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Unlensed N-Event Sampling Results ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detectable event rate: </span><span class="si">{</span><span class="n">detectable_rate_unlensed</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2"> events per year&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total detectable events collected: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unlensed_param_detectable_n</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
stopping criteria set to when relative difference of total rate for the last 4 cumulative batches is less than 0.1%.
sample collection will stop when the stopping criteria is met and number of detectable events exceeds the specified size.
Resuming from 11062.0 detectable events.
percentage difference of total rate for the last 4 cumulative batches = [0.01807991 0.00109575 0.00877408 0.        ]
stopping criteria of rate relative difference of 0.1% for the last 4 cumulative batches reached.
Given size=10000 reached

Stopping criteria met. There will be no more samples collected.
collected number of detectable events =  11062.0
stored detectable unlensed params in ./ler_data/unlensed_params_n_detectable.json
stored meta data in ./ler_data/meta_unlensed.json

=== Unlensed N-Event Sampling Results ===
Detectable event rate: 2.8946e+02 events per year
Total detectable events collected: 11062
</pre></div></div>
</div>
</section>
<section id="2.2-Rate-Convergence-(Unlensed)">
<h3>2.2 Rate Convergence (Unlensed)<a class="headerlink" href="#2.2-Rate-Convergence-(Unlensed)" title="Link to this heading"></a></h3>
<p>Visualize how detection rate evolves with sample size. A converged rate indicates stable statistics.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">get_param_from_json</span>

<span class="c1"># Load metadata containing rates for each batch</span>
<span class="n">meta_data</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">ler_directory</span> <span class="o">+</span> <span class="s1">&#39;/meta_unlensed.json&#39;</span><span class="p">)</span>

<span class="c1"># Plot rate vs sampling size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;events_total&#39;</span><span class="p">],</span>
    <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;total_rate&#39;</span><span class="p">],</span>
    <span class="s1">&#39;o-&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detectable rate&#39;</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Total Number of Events Sampled&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Detectable Event Rate (per year)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Unlensed Rate Convergence Across Batches&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_LeR_advanced_sampling_7_0.png" src="../_images/examples_LeR_advanced_sampling_7_0.png" />
</div>
</div>
</section>
<section id="2.3-Rate-Stability-(Unlensed)">
<h3>2.3 Rate Stability (Unlensed)<a class="headerlink" href="#2.3-Rate-Stability-(Unlensed)" title="Link to this heading"></a></h3>
<p>Quantify convergence using mean and standard deviation from the last few batches.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Select rates from the last 4 batches</span>
<span class="n">idx_converged</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">rates_converged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;total_rate&#39;</span><span class="p">])[</span><span class="n">idx_converged</span><span class="p">]</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rates_converged</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">mean_rate</span> <span class="o">=</span> <span class="n">rates_converged</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">std_rate</span> <span class="o">=</span> <span class="n">rates_converged</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Unlensed Rate Stability Analysis ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of batches analyzed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rates_converged</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean rate: </span><span class="si">{</span><span class="n">mean_rate</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2"> events/year&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard deviation: </span><span class="si">{</span><span class="n">std_rate</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2"> events/year&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Relative uncertainty: </span><span class="si">{</span><span class="p">(</span><span class="n">std_rate</span><span class="o">/</span><span class="n">mean_rate</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not enough batches to assess convergence.&quot;</span><span class="p">)</span>

<span class="c1"># Update the rate with the converged mean</span>
<span class="n">detectable_rate_unlensed</span> <span class="o">=</span> <span class="n">mean_rate</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
=== Unlensed Rate Stability Analysis ===
Number of batches analyzed: 4
Mean rate: 2.8944e+02 events/year
Standard deviation: 2.2384e-02 events/year
Relative uncertainty: 0.008%
</pre></div></div>
</div>
</section>
<section id="2.4-Lensed-Events">
<h3>2.4 Lensed Events<a class="headerlink" href="#2.4-Lensed-Events" title="Link to this heading"></a></h3>
<p>Generate lensed detectable events. For lensed events, we can specify: - <code class="docutils literal notranslate"><span class="pre">pdet_threshold</span></code>: List of detection thresholds for each image - <code class="docutils literal notranslate"><span class="pre">num_img</span></code>: Number of images that must meet each corresponding threshold</p>
<p>Here, <code class="docutils literal notranslate"><span class="pre">stopping_criteria=None</span></code> with <code class="docutils literal notranslate"><span class="pre">size=1000</span></code> means sampling continues until at least 1000 detectable lensed events are collected.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample until we have at least 1,000 detectable lensed events</span>
<span class="c1"># use &#39;print(ler.selecting_n_lensed_detectable_events.__doc__)&#39; to see all input args</span>
<span class="n">detectable_rate_lensed</span><span class="p">,</span> <span class="n">lensed_param_detectable_n</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">selecting_n_lensed_detectable_events</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>                           <span class="c1"># Target number of detectable events</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>                    <span class="c1"># Events per batch</span>
    <span class="n">stopping_criteria</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>              <span class="c1"># No stopping criteria (sample until size is reached)</span>
    <span class="n">pdet_threshold</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>           <span class="c1"># Detection thresholds for images</span>
    <span class="n">num_img</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>                      <span class="c1"># Number of images required per threshold</span>
    <span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                        <span class="c1"># Resume from previous state if available</span>
    <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;lensed_params_n_detectable.json&#39;</span><span class="p">,</span>
    <span class="n">meta_data_file</span><span class="o">=</span><span class="s1">&#39;meta_lensed.json&#39;</span><span class="p">,</span>
    <span class="n">pdet_type</span><span class="o">=</span><span class="s1">&#39;boolean&#39;</span><span class="p">,</span>
    <span class="n">trim_to_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Lensed N-Event Sampling Results ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detectable event rate: </span><span class="si">{</span><span class="n">detectable_rate_lensed</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2"> events per year&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total detectable events collected: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lensed_param_detectable_n</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
stopping criteria not set. sample collection will stop when number of detectable events exceeds the specified size.
Resuming from 1014.0 detectable events.
Given size=1000 reached

Stopping criteria met. There will be no more samples collected.
collected number of detectable events =  1014.0
storing detectable lensed params in ./ler_data/lensed_params_n_detectable.json
storing meta data in ./ler_data/meta_lensed.json

=== Lensed N-Event Sampling Results ===
Detectable event rate: 9.5750e-02 events per year
Total detectable events collected: 1014
</pre></div></div>
</div>
</section>
<section id="2.5-Rate-Convergence-(Lensed)">
<h3>2.5 Rate Convergence (Lensed)<a class="headerlink" href="#2.5-Rate-Convergence-(Lensed)" title="Link to this heading"></a></h3>
<p>Visualize the lensed detection rate evolution across batches.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">get_param_from_json</span>

<span class="c1"># Load metadata containing rates for each batch</span>
<span class="n">meta_data</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">ler_directory</span> <span class="o">+</span> <span class="s1">&#39;/meta_lensed.json&#39;</span><span class="p">)</span>

<span class="c1"># Plot rate vs sampling size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;events_total&#39;</span><span class="p">],</span>
    <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;total_rate&#39;</span><span class="p">],</span>
    <span class="s1">&#39;o-&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detectable rate&#39;</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Total Number of Events Sampled&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Detectable Event Rate (per year)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Lensed Rate Convergence Across Batches&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_LeR_advanced_sampling_13_0.png" src="../_images/examples_LeR_advanced_sampling_13_0.png" />
</div>
</div>
</section>
<section id="2.6-Rate-Stability-(Lensed)">
<h3>2.6 Rate Stability (Lensed)<a class="headerlink" href="#2.6-Rate-Stability-(Lensed)" title="Link to this heading"></a></h3>
<p>Quantify convergence using mean and standard deviation from the last few batches.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Select rates from the last 4 batches</span>
<span class="n">idx_converged</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">rates_converged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;total_rate&#39;</span><span class="p">])[</span><span class="n">idx_converged</span><span class="p">]</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rates_converged</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">mean_rate</span> <span class="o">=</span> <span class="n">rates_converged</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">std_rate</span> <span class="o">=</span> <span class="n">rates_converged</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Lensed Rate Stability Analysis ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of batches analyzed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rates_converged</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean rate: </span><span class="si">{</span><span class="n">mean_rate</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2"> events/year&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard deviation: </span><span class="si">{</span><span class="n">std_rate</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2"> events/year&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Relative uncertainty: </span><span class="si">{</span><span class="p">(</span><span class="n">std_rate</span><span class="o">/</span><span class="n">mean_rate</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not enough batches to assess convergence.&quot;</span><span class="p">)</span>

<span class="c1"># Update the rate with the converged mean</span>
<span class="n">detectable_rate_lensed</span> <span class="o">=</span> <span class="n">mean_rate</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
=== Lensed Rate Stability Analysis ===
Number of batches analyzed: 4
Mean rate: 9.6567e-02 events/year
Standard deviation: 5.2511e-04 events/year
Relative uncertainty: 0.544%
</pre></div></div>
</div>
</section>
<section id="2.7-Rate-Comparison">
<h3>2.7 Rate Comparison<a class="headerlink" href="#2.7-Rate-Comparison" title="Link to this heading"></a></h3>
<p>Compare detection rates between lensed and unlensed events.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare lensed vs unlensed rates</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Detection Rate Comparison ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unlensed detectable rate: </span><span class="si">{</span><span class="n">detectable_rate_unlensed</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2"> events/year&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lensed detectable rate:   </span><span class="si">{</span><span class="n">detectable_rate_lensed</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2"> events/year&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ratio (Unlensed/Lensed):  </span><span class="si">{</span><span class="p">(</span><span class="n">detectable_rate_unlensed</span><span class="o">/</span><span class="n">detectable_rate_lensed</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
=== Detection Rate Comparison ===
Unlensed detectable rate: 2.8944e+02 events/year
Lensed detectable rate:   9.6567e-02 events/year
Ratio (Unlensed/Lensed):  2997.28
</pre></div></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="3.-Parameter-Distributions:-All-vs-Detectable">
<h2>3. Parameter Distributions: All vs Detectable<a class="headerlink" href="#3.-Parameter-Distributions:-All-vs-Detectable" title="Link to this heading"></a></h2>
<p>Compare parameter distributions between all sampled events and detectable events. Corner plots reveal <strong>selection effects</strong> introduced by detector sensitivity.</p>
<section id="3.1-Unlensed-Events">
<h3>3.1 Unlensed Events<a class="headerlink" href="#3.1-Unlensed-Events" title="Link to this heading"></a></h3>
<p>Generate a large sample of all unlensed events (both detectable and non-detectable) for comparison.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a large sample of all unlensed events for comparison</span>
<span class="n">unlensed_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">unlensed_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;unlensed_params_all.json&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total unlensed events sampled: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unlensed_param</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
unlensed params will be stored in ./ler_data/unlensed_params_all.json
removing ./ler_data/unlensed_params_all.json if it exists
resuming from ./ler_data/unlensed_params_all.json
Batch no. 1
sampling gw source params...
calculating pdet...
unlensed parameters already sampled.
saving all unlensed parameters in ./ler_data/unlensed_params_all.json
Total unlensed events sampled: 50000
</pre></div></div>
</div>
<p>Corner plot comparing all sampled events vs detectable events:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">corner</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">get_param_from_json</span>

<span class="c1"># Load data</span>
<span class="n">param</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s1">&#39;./ler_data/unlensed_params_all.json&#39;</span><span class="p">)</span>
<span class="n">param_detectable</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s1">&#39;./ler_data/unlensed_params_n_detectable.json&#39;</span><span class="p">)</span>

<span class="c1"># Parameters to compare</span>
<span class="n">param_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">,</span> <span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="s1">&#39;theta_jn&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_1_source&#39;</span><span class="p">,</span> <span class="s1">&#39;mass_2_source&#39;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$z_s$&#39;</span><span class="p">,</span> <span class="s1">&#39;RA&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\theta_</span><span class="si">{JN}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$m_1$ [$M_\odot$]&#39;</span><span class="p">,</span> <span class="s1">&#39;$m_2$ [$M_\odot$]&#39;</span><span class="p">]</span>

<span class="c1"># Prepare data for corner plot</span>
<span class="n">samples_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">param</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">samples_detectable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">param_detectable</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Create corner plot for all events</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span>
    <span class="n">samples_all</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">plot_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">smooth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">hist_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Overlay detectable events</span>
<span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span>
    <span class="n">samples_detectable</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">plot_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">smooth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">hist_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Add legend</span>
<span class="n">blue_line</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;All events&#39;</span><span class="p">)</span>
<span class="n">orange_line</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detectable only&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">blue_line</span><span class="p">,</span> <span class="n">orange_line</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
           <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Unlensed Events: All vs Detectable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:root:Too few points to create valid contours
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_LeR_advanced_sampling_21_1.png" src="../_images/examples_LeR_advanced_sampling_21_1.png" />
</div>
</div>
</section>
<section id="3.2-Lensed-Events">
<h3>3.2 Lensed Events<a class="headerlink" href="#3.2-Lensed-Events" title="Link to this heading"></a></h3>
<p>Compare intrinsic, strongly lensed, and detectable lensed event distributions. First, generate strongly lensed events:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a large sample of all lensed events for comparison</span>
<span class="n">lensed_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">lensed_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;lensed_params_all.json&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total lensed events sampled: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lensed_param</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
lensed params will be stored in ./ler_data/lensed_params_all.json
removing ./ler_data/lensed_params_all.json if it exists
resuming from ./ler_data/lensed_params_all.json
Batch no. 1
sampling lensed params...
sampling lens parameters with sample_all_routine_epl_shear_sl...
solving lens equations...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:11&lt;00:00, 4235.41it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calculating pdet...
lensed parameters already sampled.
saving all lensed parameters in ./ler_data/lensed_params_all.json
Total lensed events sampled: 50000
</pre></div></div>
</div>
<p>Generate intrinsic parameters (without strong lensing selection):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a large sample of all lensed events for comparison</span>
<span class="n">lensed_param_intrinsic</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">sample_all_routine_epl_shear_intrinsic</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total lensed events sampled: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lensed_param_intrinsic</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># save to file</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">append_json</span>
<span class="n">append_json</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">ler_directory</span><span class="o">+</span><span class="s1">&#39;/lensed_param_intrinsic.json&#39;</span><span class="p">,</span> <span class="n">lensed_param_intrinsic</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Total lensed events sampled: 50000
</pre></div></div>
</div>
<p>Corner plot comparing intrinsic, strongly lensed, and detectable events:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">corner</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">get_param_from_json</span>

<span class="c1"># Load data</span>
<span class="n">param</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s1">&#39;./ler_data/lensed_params_all.json&#39;</span><span class="p">)</span>
<span class="n">param_detectable</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s1">&#39;./ler_data/lensed_params_n_detectable.json&#39;</span><span class="p">)</span>
<span class="n">param_intrinsic</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s1">&#39;./ler_data/lensed_param_intrinsic.json&#39;</span><span class="p">)</span>
<span class="c1"># lensed_param_intrinsic is already in memory from cell 24</span>

<span class="c1"># Lensing-specific parameters to compare</span>
<span class="n">param_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">,</span> <span class="s1">&#39;zl&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma1&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma2&#39;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$z_s$&#39;</span><span class="p">,</span> <span class="s1">&#39;$z_l$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\sigma$ [km/s]&#39;</span><span class="p">,</span> <span class="s1">&#39;$q$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\gamma$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\gamma_1$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\gamma_2$&#39;</span><span class="p">]</span>

<span class="c1"># Prepare data for corner plot</span>
<span class="n">samples_intrinsic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">param_intrinsic</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">samples_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">param</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">samples_detectable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">param_detectable</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Create corner plot for intrinsic events</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span>
    <span class="n">samples_intrinsic</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">plot_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">smooth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">hist_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Overlay strongly lensed events</span>
<span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span>
    <span class="n">samples_all</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">plot_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">smooth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">hist_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Overlay detectable events</span>
<span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span>
    <span class="n">samples_detectable</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
    <span class="n">plot_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">smooth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">hist_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Add legend</span>
<span class="n">green_line</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Intrinsic&#39;</span><span class="p">)</span>
<span class="n">blue_line</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Strongly lensed&#39;</span><span class="p">)</span>
<span class="n">orange_line</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detectable only&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">green_line</span><span class="p">,</span> <span class="n">blue_line</span><span class="p">,</span> <span class="n">orange_line</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
           <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Lensed Events: Intrinsic vs. Strongly Lensed vs. Detectable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_LeR_advanced_sampling_27_0.png" src="../_images/examples_LeR_advanced_sampling_27_0.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="4.-Visualizing-Lensed-Detectable-Events">
<h2>4. Visualizing Lensed Detectable Events<a class="headerlink" href="#4.-Visualizing-Lensed-Detectable-Events" title="Link to this heading"></a></h2>
<p>Visualize properties of detectable lensed events. An example event is highlighted in each plot to show individual characteristics within the population.</p>
<section id="4.1-Redshift-Distribution">
<h3>4.1 Redshift Distribution<a class="headerlink" href="#4.1-Redshift-Distribution" title="Link to this heading"></a></h3>
<p>Compare redshift distributions of intrinsic and detected populations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">get_param_from_json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">AutoMinorLocator</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Load data</span>
<span class="n">unlensed_params_det</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s1">&#39;./ler_data/unlensed_params_n_detectable.json&#39;</span><span class="p">)</span>
<span class="n">lensed_params_det</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s1">&#39;./ler_data/lensed_params_n_detectable.json&#39;</span><span class="p">)</span>
<span class="n">unlensed_params</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s1">&#39;./ler_data/unlensed_param.json&#39;</span><span class="p">)</span>
<span class="n">lensed_params</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s1">&#39;./ler_data/lensed_param.json&#39;</span><span class="p">)</span>
<span class="n">lensed_params_intrinsic</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s1">&#39;./ler_data/lensed_param_intrinsic.json&#39;</span><span class="p">)</span>

<span class="n">bbh_pop_intrinsic</span> <span class="o">=</span> <span class="n">unlensed_params</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">]</span>
<span class="n">unlensed_bbh_pop_detected</span> <span class="o">=</span> <span class="n">unlensed_params_det</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">]</span>
<span class="n">lensed_bbh_pop_detected</span> <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">]</span>
<span class="n">lens_detected</span> <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;zl&#39;</span><span class="p">]</span>
<span class="n">lens_dist_intrinsic</span> <span class="o">=</span> <span class="n">lensed_params_intrinsic</span><span class="p">[</span><span class="s1">&#39;zl&#39;</span><span class="p">]</span>

<span class="c1"># create gaussian kde</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>
<span class="n">bandwidth</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">kde_bbh_pop_intrinsic</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">bbh_pop_intrinsic</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
<span class="n">kde_unlensed_bbh_pop_detected</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">unlensed_bbh_pop_detected</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
<span class="n">kde_lensed_bbh_pop_detected</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">lensed_bbh_pop_detected</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
<span class="n">kde_lens_dist_intrinsic</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">lens_dist_intrinsic</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
<span class="n">kde_lens_detected</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">lens_detected</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>

<span class="c1"># Choose a random detected lensed event to highlight</span>
<span class="n">pdet</span> <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;pdet_net&#39;</span><span class="p">]</span>
<span class="n">idx_4img</span> <span class="o">=</span> <span class="n">pdet</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
<span class="n">idx_4img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">idx_4img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span><span class="mi">2</span> <span class="c1"># 2 images detected</span>
<span class="n">chosen_idx_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">idx_4img</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">chosen_idx</span> <span class="o">=</span> <span class="n">chosen_idx_list</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>  <span class="c1"># pick the 10th one for consistency</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chosen detected lensed event index: </span><span class="si">{</span><span class="n">chosen_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ---------- Data ----------</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># ---------- Plot ----------</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;black&quot;</span><span class="p">:</span> <span class="s2">&quot;#000000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;violet&quot;</span><span class="p">:</span> <span class="s2">&quot;#7E57C2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;brown&quot;</span><span class="p">:</span> <span class="s2">&quot;#8D6E63&quot;</span><span class="p">,</span>
    <span class="s2">&quot;grey&quot;</span><span class="p">:</span> <span class="s2">&quot;#616161&quot;</span><span class="p">,</span>
    <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;#E53935&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;#1E88E5&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># intrinsic distributions</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">kde_bbh_pop_intrinsic</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Intrinsic BBH population&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s2">&quot;grey&quot;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">kde_lens_dist_intrinsic</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Intrinsic Lens population&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s2">&quot;brown&quot;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>

<span class="c1"># detected distributions</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">kde_unlensed_bbh_pop_detected</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detected Unlensed BBH population&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">kde_lensed_bbh_pop_detected</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detected Lensed BBH population&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">kde_lens_detected</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lenses associated with detectable events&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s2">&quot;violet&quot;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>

<span class="c1"># Example detected lensed event redshifts</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">],</span>
           <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Example detected lensed event source redshift&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;zl&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">],</span>
           <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s2">&quot;brown&quot;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Example detected lensed event lens redshift&#39;</span><span class="p">)</span>

<span class="c1"># ---------- Legend ----------</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handlelength</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span>
<span class="p">)</span>
<span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_boxstyle</span><span class="p">(</span><span class="s1">&#39;Round&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">rounding_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">legend</span><span class="o">.</span><span class="n">get_lines</span><span class="p">():</span>
    <span class="n">handle</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">handle</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># ---------- Axes labels, limits, and grid ----------</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Redshift $z$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Probability Density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>

<span class="c1"># add title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Redshift Distributions of BBH and Lens Populations&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># plt.savefig(&#39;lens_paramters_baseline_redshift_distributions.svg&#39;,</span>
<span class="c1">#             dpi=300, bbox_inches=&#39;tight&#39;, transparent=True)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Chosen detected lensed event index: 10
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_LeR_advanced_sampling_29_1.png" src="../_images/examples_LeR_advanced_sampling_29_1.png" />
</div>
</div>
</section>
<section id="4.2-Magnification-Ratio-vs-Time-Delay">
<h3>4.2 Magnification Ratio vs Time Delay<a class="headerlink" href="#4.2-Magnification-Ratio-vs-Time-Delay" title="Link to this heading"></a></h3>
<p>Relative magnification vs time delay distinguishes lensed from unlensed events.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">relative_mu_dt_unlensed</span><span class="p">,</span> <span class="n">relative_mu_dt_lensed</span><span class="p">,</span> <span class="n">mu_vs_dt_plot</span>

<span class="c1"># for unlensed detectable events</span>
<span class="n">dmu_unlensed</span><span class="p">,</span> <span class="n">dt_unlensed</span> <span class="o">=</span> <span class="n">relative_mu_dt_unlensed</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="n">unlensed_params_det</span><span class="p">)</span>

<span class="c1"># for lensed detectable events</span>
<span class="n">lensed_dict</span> <span class="o">=</span> <span class="n">relative_mu_dt_lensed</span><span class="p">(</span><span class="n">lensed_param</span><span class="o">=</span><span class="n">lensed_params_det</span><span class="p">)</span>
<span class="n">dt_lensed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">lensed_dict</span><span class="p">[</span><span class="s1">&#39;dt_rel0&#39;</span><span class="p">],</span> <span class="n">lensed_dict</span><span class="p">[</span><span class="s1">&#39;dt_rel90&#39;</span><span class="p">]))</span>
<span class="n">dmu_lensed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">lensed_dict</span><span class="p">[</span><span class="s1">&#39;mu_rel0&#39;</span><span class="p">],</span> <span class="n">lensed_dict</span><span class="p">[</span><span class="s1">&#39;mu_rel90&#39;</span><span class="p">]))</span>

<span class="c1"># chosen example index for 4 images, find time delays and magnifications</span>
<span class="n">chosen_lens_dt</span> <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;time_delays&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">]</span>
<span class="n">chosen_lens_mu</span> <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;magnifications&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">]</span>
<span class="n">pdet</span> <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;pdet_net&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">]</span>

<span class="n">dt_lensed_chosen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">chosen_lens_dt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">chosen_lens_dt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">))</span>
<span class="n">dmu_lensed_chosen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">chosen_lens_mu</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">chosen_lens_mu</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1"># ---------------------------------------</span>
<span class="c1"># Plot Magnification ratio Vs Time Delay</span>
<span class="c1"># ---------------------------------------</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;black&quot;</span><span class="p">:</span> <span class="s2">&quot;#000000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;violet&quot;</span><span class="p">:</span> <span class="s2">&quot;#7E57C2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;brown&quot;</span><span class="p">:</span> <span class="s2">&quot;#8D6E63&quot;</span><span class="p">,</span>
    <span class="s2">&quot;grey&quot;</span><span class="p">:</span> <span class="s2">&quot;#616161&quot;</span><span class="p">,</span>
    <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;#E53935&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;#1E88E5&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Use your existing helper without modification</span>
<span class="n">mu_vs_dt_plot</span><span class="p">(</span><span class="n">dt_unlensed</span><span class="p">,</span> <span class="n">dmu_unlensed</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
<span class="n">mu_vs_dt_plot</span><span class="p">(</span><span class="n">dt_lensed</span><span class="p">,</span>   <span class="n">dmu_lensed</span><span class="p">,</span>   <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;violet&#39;</span><span class="p">]]</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Proxy artists for legend</span>
<span class="c1"># Proxy artists for legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">],</span>  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unlensed detectable events&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;violet&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lensed detectable events&#39;</span><span class="p">,</span>   <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>


<span class="c1"># Chosen example point</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">dt_lensed_chosen</span><span class="p">,</span> <span class="n">dmu_lensed_chosen</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Example detected lensed event&#39;</span>
<span class="p">)</span>

<span class="c1"># ---------- Legend ----------</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span>
<span class="p">)</span>
<span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_boxstyle</span><span class="p">(</span><span class="s1">&#39;Round&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">rounding_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">legend</span><span class="o">.</span><span class="n">get_lines</span><span class="p">():</span>
    <span class="n">handle</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.6</span><span class="p">)</span>
    <span class="n">handle</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.85</span><span class="p">)</span>

<span class="c1"># add title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnification ratio Vs Time Delay distribution </span><span class="se">\n</span><span class="s1">of Lensed and Unlensed events&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># ---------- Axes, ticks, grid ----------</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(\Delta t_</span><span class="si">{ij}</span><span class="s1"> \,/\, \mathrm</span><span class="si">{days}</span><span class="s1">)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(|\mu_i / \mu_j|)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.38</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># plt.savefig(&#39;mu_vs_dt_science_ieee.svg&#39;, dpi=600, bbox_inches=&#39;tight&#39;, transparent=True)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># time: 32s</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_LeR_advanced_sampling_31_0.png" src="../_images/examples_LeR_advanced_sampling_31_0.png" />
</div>
</div>
</section>
<section id="4.3-Caustic-Plot">
<h3>4.3 Caustic Plot<a class="headerlink" href="#4.3-Caustic-Plot" title="Link to this heading"></a></h3>
<p>Lens configuration for an example event, showing caustics, critical curves, and image positions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lenstronomy.LensModel.lens_model</span> <span class="kn">import</span> <span class="n">LensModel</span>
<span class="kn">from</span> <span class="nn">lenstronomy.LensModel.Solver.lens_equation_solver</span> <span class="kn">import</span> <span class="n">LensEquationSolver</span>
<span class="kn">from</span> <span class="nn">lenstronomy.LensModel.Solver.epl_shear_solver</span> <span class="kn">import</span> <span class="n">caustics_epl_shear</span>
<span class="c1"># import phi_q2_ellipticity</span>
<span class="kn">from</span> <span class="nn">lenstronomy.Util.param_util</span> <span class="kn">import</span> <span class="n">phi_q2_ellipticity</span>

<span class="c1"># ---------- Custom color palette ----------</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;black&quot;</span><span class="p">:</span> <span class="s2">&quot;#000000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;violet&quot;</span><span class="p">:</span> <span class="s2">&quot;#7E57C2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;brown&quot;</span><span class="p">:</span>  <span class="s2">&quot;#8D6E63&quot;</span><span class="p">,</span>
    <span class="s2">&quot;grey&quot;</span><span class="p">:</span>   <span class="s2">&quot;#616161&quot;</span><span class="p">,</span>
    <span class="s2">&quot;red&quot;</span><span class="p">:</span>    <span class="s2">&quot;#E53935&quot;</span><span class="p">,</span>
    <span class="s2">&quot;blue&quot;</span><span class="p">:</span>   <span class="s2">&quot;#1E88E5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;green&quot;</span><span class="p">:</span>  <span class="s2">&quot;#43A047&quot;</span><span class="p">,</span>
    <span class="s2">&quot;orange&quot;</span><span class="p">:</span> <span class="s2">&quot;#FB8C00&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># ----- Lens setup -----</span>
<span class="n">lens_model_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;EPL&quot;</span><span class="p">,</span> <span class="s2">&quot;SHEAR&quot;</span><span class="p">]</span>
<span class="n">lensModel</span> <span class="o">=</span> <span class="n">LensModel</span><span class="p">(</span><span class="n">lens_model_list</span><span class="o">=</span><span class="n">lens_model_list</span><span class="p">)</span>
<span class="n">lens_eq_solver</span> <span class="o">=</span> <span class="n">LensEquationSolver</span><span class="p">(</span><span class="n">lensModel</span><span class="p">)</span>

<span class="n">q</span>   <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">]</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">]</span>
<span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">phi_q2_ellipticity</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<span class="n">kwargs_spep</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;theta_E&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="n">e1</span><span class="p">,</span>
    <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="n">e2</span><span class="p">,</span>
    <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">],</span>
    <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">kwargs_shear</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gamma1&#39;</span><span class="p">:</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;gamma1&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">],</span>
    <span class="s1">&#39;gamma2&#39;</span><span class="p">:</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;gamma2&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">kwargs_lens</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs_spep</span><span class="p">,</span> <span class="n">kwargs_shear</span><span class="p">]</span>

<span class="c1"># ----- Solve image configuration -----</span>
<span class="n">theta_E</span> <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;theta_E&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">]</span>
<span class="c1"># unscaled source position</span>
<span class="n">beta_ra</span>  <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;x_source&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">]</span><span class="o">/</span><span class="n">theta_E</span>
<span class="n">beta_dec</span> <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;y_source&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">]</span><span class="o">/</span><span class="n">theta_E</span>
<span class="n">theta_ra</span><span class="p">,</span> <span class="n">theta_dec</span> <span class="o">=</span> <span class="n">lens_eq_solver</span><span class="o">.</span><span class="n">image_position_from_source</span><span class="p">(</span>
    <span class="n">sourcePos_x</span><span class="o">=</span><span class="n">beta_ra</span><span class="p">,</span> <span class="n">sourcePos_y</span><span class="o">=</span><span class="n">beta_dec</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="o">=</span><span class="n">kwargs_lens</span><span class="p">,</span>
    <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;analytical&quot;</span><span class="p">,</span> <span class="n">magnification_limit</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">arrival_time_sort</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">magnifications</span> <span class="o">=</span> <span class="n">lensModel</span><span class="o">.</span><span class="n">magnification</span><span class="p">(</span><span class="n">theta_ra</span><span class="p">,</span> <span class="n">theta_dec</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="p">)</span>
<span class="n">magnifications</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">magnifications</span><span class="p">))</span>
<span class="c1"># print(f&quot;Magnifications calculated: {magnifications}&quot;)</span>

<span class="c1"># ----- Figure -----</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># wider figure</span>

<span class="c1"># Caustics</span>
<span class="n">cp</span> <span class="o">=</span> <span class="n">caustics_epl_shear</span><span class="p">(</span><span class="n">kwargs_lens</span><span class="p">,</span> <span class="n">return_which</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="n">maginf</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;brown&#39;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Double Caustic&#39;</span><span class="p">)</span>
<span class="n">cp</span> <span class="o">=</span> <span class="n">caustics_epl_shear</span><span class="p">(</span><span class="n">kwargs_lens</span><span class="p">,</span> <span class="n">return_which</span><span class="o">=</span><span class="s2">&quot;quad&quot;</span><span class="p">,</span> <span class="n">maginf</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;violet&#39;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Quad Caustic&#39;</span><span class="p">)</span>

<span class="c1"># Einstein ring</span>
<span class="n">theta_E</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">theta_E</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;grey&#39;</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Einstein Ring&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>

<span class="c1"># Source position</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">beta_ra</span><span class="p">,</span> <span class="n">beta_dec</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Image positions</span>
<span class="n">img_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;violet&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;brown&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">]]</span>
<span class="n">pdet_image</span> <span class="o">=</span> <span class="n">lensed_params_det</span><span class="p">[</span><span class="s1">&#39;pdet_net&#39;</span><span class="p">][</span><span class="n">chosen_idx</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theta_ra</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">pdet_image</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_ra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">theta_dec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">img_colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_colors</span><span class="p">)],</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Image </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> (detected)</span><span class="se">\n</span><span class="s1">Magnification: </span><span class="si">{</span><span class="n">magnifications</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theta_ra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">theta_dec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">img_colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_colors</span><span class="p">)],</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Image </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> (not detected)</span><span class="se">\n</span><span class="s1">Magnification: </span><span class="si">{</span><span class="n">magnifications</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Axes &amp; Grid</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RA [arcsec]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dec [arcsec]&#39;</span><span class="p">)</span>
<span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_y</span> <span class="o">=</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.5</span>  <span class="c1"># rectangular window</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">dim_y</span><span class="p">,</span> <span class="n">dim_y</span><span class="p">)</span>

<span class="c1"># Relax the aspect ratio → visually rectangular (with adjustable=&#39;box&#39; to respect figure size)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="c1"># Legend on the side</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handlelength</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.03</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span>
    <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Show only one marker per legend entry</span>
    <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_boxstyle</span><span class="p">(</span><span class="s1">&#39;Round&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">rounding_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">legend</span><span class="o">.</span><span class="n">get_lines</span><span class="p">():</span>
    <span class="n">handle</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">handle</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.85</span><span class="p">)</span>
<span class="c1"># add title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Lens Configuration for Example Detected Lensed Event&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># plt.savefig(&#39;lens_configuration_rectangular.svg&#39;, dpi=600, bbox_inches=&#39;tight&#39;, transparent=True)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_LeR_advanced_sampling_33_0.png" src="../_images/examples_LeR_advanced_sampling_33_0.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="5.-Summary">
<h2>5. Summary<a class="headerlink" href="#5.-Summary" title="Link to this heading"></a></h2>
<p>This notebook demonstrated advanced sampling capabilities of <strong>LeR</strong> for generating detectable GW events.</p>
<p><strong>Key Takeaways:</strong></p>
<ol class="arabic simple">
<li><p><strong>N-Event Sampling:</strong> <code class="docutils literal notranslate"><span class="pre">selecting_n_unlensed_detectable_events</span></code> and <code class="docutils literal notranslate"><span class="pre">selecting_n_lensed_detectable_events</span></code> collect a target number of detectable events with convergence monitoring.</p></li>
<li><p><strong>Rate Convergence:</strong> Tracking rates across batches verifies statistical stability.</p></li>
<li><p><strong>Resume Capability:</strong> Sampling can be interrupted and resumed without losing progress.</p></li>
<li><p><strong>Selection Effects</strong>: The corner plots reveal how detector sensitivity and strong lensing selection bias the observed populations:</p>
<ul class="simple">
<li><p><strong>Detector sensitivity effects:</strong></p>
<ul>
<li><p>Lower redshift events are preferentially detected</p></li>
<li><p>Higher mass events have higher detection probability</p></li>
<li><p>Sky location and orientation effects are visible</p></li>
</ul>
</li>
<li><p><strong>Strong lensing selection effects:</strong></p>
<ul>
<li><p>Higher magnification events are more likely to be detected</p></li>
<li><p>Lensed events tend to occur at higher redshifts</p></li>
<li><p>Lens velocity dispersion influences strong lensing due to increased lensing cross-section</p></li>
<li><p>Lens galaxy density profile slope affects detectability</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Lensing Visualization</strong>: The redshift distributions, magnification-time delay plots, and caustic diagrams provide insight into the properties of detectable lensed events.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="LeR_custom_functions.html" class="btn btn-neutral float-left" title="LeR with Custom Functions and Parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Phurailatpam Hemantakumar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>