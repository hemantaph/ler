

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LeR complete examples &mdash; ler 0.3.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=776609e1" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=4621528c"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="GWRATES complete exmaples" href="GWRATES%20complete%20exmaples.html" />
    <link rel="prev" title="ler.utils.utils" href="../../autoapi/ler/utils/utils/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ler
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Installation2.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_overview.html">Code overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GW_events.html">Gravitational wave event rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GW_equations.html">Gravitational wave events sampling (Analytical formulation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Lensed_events.html">Lensed event rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Lensed_equations.html">Lensed event sampling (Analytical formulation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/ler/rates/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.rates</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/ler/gw_source_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.gw_source_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/ler/lens_galaxy_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.lens_galaxy_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/ler/image_properties/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.image_properties</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/ler/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.utils</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">LeR complete examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#TOC:">TOC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Short-lensed-or-unlensed-BBH-example-with-three-detectors.">Short lensed or unlensed BBH example with three detectors.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Simulation-of-the-GW-CBC-population-(unlensed).">Simulation of the GW CBC population (unlensed).</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculation-of-unlensed-rates.">Calculation of unlensed rates.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Simulation-of-the-GW-CBC-population-(lensed).">Simulation of the GW CBC population (lensed).</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculation-of-lensed-rates.">Calculation of lensed rates.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Comparison-of-the-rates.">Comparison of the rates.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Getting-generated-parameters.">Getting generated parameters.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plot-the-generated-parameters">Plot the generated parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Using-custom-functions-and-parameters.">Using custom functions and parameters.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Defining-custom-functions-and-parameters.">Defining custom functions and parameters.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#LeR-initialization-with-custom-functions-and-parameters">LeR initialization with custom functions and parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Sampling-(Unlensed).">Sampling (Unlensed).</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Sampling-(Lensed).">Sampling (Lensed).</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Rate-calculation-and-comparison.">Rate calculation and comparison.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Uning-available-model-functions">Uning available model functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Comparison-of-mass-distribution-model-(BBH,-mass-1,-larger-mass-only).">Comparison of mass distribution model (BBH, mass-1, larger mass only).</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Comparison-of-Axis-ratio-model-of-the-lensing-galaxy.">Comparison of Axis-ratio model of the lensing galaxy.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Generating-particular-number-of-detectable-events.">Generating particular number of detectable events.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Unlensed-case.">Unlensed case.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Lensed-case.">Lensed case.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Using-custom-detection-criteria.">Using custom detection criteria.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Defining-custom-detection-criteria-(using-gwsnr-package).">Defining custom detection criteria (using <code class="docutils literal notranslate"><span class="pre">gwsnr</span></code> package).</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Testing-the-custom-detection-criteria.">Testing the custom detection criteria.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Using-custom-detection-criteria-with-LeR.">Using custom detection criteria with LeR.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Analysis:-SNR-(with-ANN)-+-SNR-recalculation-(inner-product).">Analysis: SNR (with ANN) + SNR recalculation (inner product).</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="GWRATES%20complete%20exmaples.html">GWRATES complete exmaples</a></li>
<li class="toctree-l1"><a class="reference internal" href="grb%20detection%20rate.html">Calculation of detectable Gamma ray burst (GRB) event rate associated with Binary Neutron Star (BNS) mergers.</a></li>
<li class="toctree-l1"><a class="reference internal" href="ler%20bns%20example.html">LeR complete examples of BNS events (O4 design sensitivity)</a></li>
<li class="toctree-l1"><a class="reference internal" href="rates_with_3G_detectors.html">Event Rates with 3G detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/merger%20rate%20density%20evolution%20with%20redshift.html">Merger rate density evolution with redshift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/merger%20rate%20density%20model%20comparision.html">Merger rate density model comparision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/merger%20rate%20density%20model%20comparision.html#Primordial-BBH-model,-Ng-et-al.-2022">Primordial BBH model, Ng et al. 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/sample%20compact%20binary%20parameters.html">Sampling parameters for a compact binary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/statistical%20study%20of%20changing%20mass%20model%20params.html">Statistical study of changing Mass model paramter(s)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/statistical%20study%20of%20cosmological%20friction.html">Statistical study of cosmological friction and its effect on the redshift vs inferred chirp-mass relation of gravitational waves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lens_parameters/sample%20lens%20parameters.html">Lens parameter distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optical_depth/validation_SIE.html">Optical depth SIE model validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optical_depth/validation_SIS.html">Validation of SIS model (Numerical vs Analytical)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../image_properties/dt_vs_dmu.html">Study of Time delays and magnification of lensed gravitational waves.</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">LeR complete examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/rates/LeR complete examples.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="LeR-complete-examples">
<h1>LeR complete examples<a class="headerlink" href="#LeR-complete-examples" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p>Please refer to the <a class="reference external" href="https://ler.readthedocs.io/en/latest/">documentation</a> for more details.</p></li>
</ul>
<section id="TOC:">
<h2>TOC:<a class="headerlink" href="#TOC:" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://ler.readthedocs.io/en/latest/examples/rates/LeR%20complete%20examples.html#Short-lensed-or-unlensed-BBH-example-with-three-detectors">Short lensed or unlensed BBH example with three detectors</a></p>
<ul>
<li><p>Simulation of the GW CBC population (unlensed)</p></li>
<li><p>Calculation of unlensed rates</p></li>
<li><p>Simulation of the GW CBC population (lensed)</p></li>
<li><p>Calculation of lensed rates</p></li>
<li><p>Comparison of the rates</p></li>
<li><p>Getting generated parameters</p></li>
<li><p>Manually changing paramters and recompute the rates</p></li>
<li><p>Plot the generated parameters</p></li>
</ul>
</li>
<li><p>Using custom functions and parameters</p>
<ul>
<li><p>Defining custom functions and parameters</p></li>
<li><p>LeR initialization with custom functions and parameters</p></li>
<li><p>Sampling (Unlensed)</p></li>
<li><p>Sampling (Lensed)</p></li>
<li><p>Rate calculation and comparison</p></li>
</ul>
</li>
<li><p>Uning available model functions</p>
<ul>
<li><p>Comparison of mass distribution model</p></li>
<li><p>Comparison of Axis-ratio model of the lensing galaxy</p></li>
</ul>
</li>
<li><p>Generating particular number of detectable events</p>
<ul>
<li><p>Unlensed case</p></li>
<li><p>Lensed case</p></li>
</ul>
</li>
<li><p>Using custom detection criteria</p>
<ul>
<li><p>Defining custom detection criteria</p></li>
<li><p>Testing the custom detection criteria</p></li>
<li><p>Using custom detection criteria with LeR</p></li>
<li><p>Analysis: SNR (with ANN) + SNR recalculation (inner product)</p></li>
</ul>
</li>
</ul>
</section>
<section id="Short-lensed-or-unlensed-BBH-example-with-three-detectors.">
<h2>Short lensed or unlensed BBH example with three detectors.<a class="headerlink" href="#Short-lensed-or-unlensed-BBH-example-with-three-detectors." title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>This part of the notebook is a short example to simulate lensed and unlensed binary black hole mergers and calculate their rates (<span class="math notranslate nohighlight">\(yr^{-1}\)</span>) and finally compare the results.</p></li>
<li><p>All the outputs are saved in the <code class="docutils literal notranslate"><span class="pre">ler_data</span></code> directory by default.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ler</span></code> package heavily relies on multiprocessing capability of python, and some of the multiprocessing settings are set by <a class="reference external" href="https://github.com/hemantaph/ler/blob/b2f75e7e4fe24f87cfdbf3dd65465252c15ac2bc/ler/__init__.py#L13">default</a> when calling the package. If issue arises, please raise issue in <a class="reference external" href="https://github.com/hemantaph/ler/issues">github.ler.issue</a>.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># call the LeR class</span>
<span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">LeR</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Setting multiprocessing start method to &#39;fork&#39;
</pre></div></div>
</div>
<ul>
<li><p>You can check for more details on <code class="docutils literal notranslate"><span class="pre">LeR</span></code> class from either the <a class="reference external" href="https://ler.readthedocs.io/en/latest/">documentation</a> or by calling <code class="docutils literal notranslate"><span class="pre">help(LeR)</span></code> or <code class="docutils literal notranslate"><span class="pre">LeR?</span></code> (in the Jupyter Notebook).</p></li>
<li><p>Depending on the number of CPU cores used and microprocessor architecture, <code class="docutils literal notranslate"><span class="pre">LeR</span></code> class initialization will take some time to generate interpolation data for the models. Please be patient. e.g. it takes 1m 56s for 4 cores in M2 pro Aplle intel chip 16GB RAM.</p></li>
<li><p>The generated interpolation data is saved and will be call automatically when the same model is used again. If user wants to regenerate the interpolation data, please set <code class="docutils literal notranslate"><span class="pre">create_new_interpolator=True</span></code> in the <code class="docutils literal notranslate"><span class="pre">LeR</span></code> class initialization. Or you can simply delete the <code class="docutils literal notranslate"><span class="pre">interpolator_pickle</span></code> directory or specific path in the <code class="docutils literal notranslate"><span class="pre">interpolator_pickle</span></code> directory.</p></li>
<li><p>if you don’t want the models and its parameters to print. Default is True.</p>
<p><code class="docutils literal notranslate"><span class="pre">ler</span> <span class="pre">=</span> <span class="pre">LeR(verbose=False)</span></code></p>
</li>
<li><p>set ‘npool’ according to your machine’s available CPU cores. Default is 4.</p></li>
<li><p>to check no. of cores,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import multiprocessing as mp
print(mp.cpu_count())
</pre></div>
</div>
</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># LeR initialization with default arguments</span>
<span class="n">ler</span> <span class="o">=</span> <span class="n">LeR</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
z_to_luminosity_distance interpolator will be loaded from ./interpolator_pickle/z_to_luminosity_distance/z_to_luminosity_distance_0.pickle
differential_comoving_volume interpolator will be loaded from ./interpolator_pickle/differential_comoving_volume/differential_comoving_volume_0.pickle
merger_rate_density interpolator will be loaded from ./interpolator_pickle/merger_rate_density/merger_rate_density_0.pickle
z_to_Dc interpolator will be loaded from ./interpolator_pickle/z_to_Dc/z_to_Dc_0.pickle
Dc_to_z interpolator will be loaded from ./interpolator_pickle/Dc_to_z/Dc_to_z_0.pickle
angular_diameter_distance interpolator will be loaded from ./interpolator_pickle/angular_diameter_distance/angular_diameter_distance_0.pickle
differential_comoving_volume interpolator will be loaded from ./interpolator_pickle/differential_comoving_volume/differential_comoving_volume_2.pickle
velocity_dispersion_ewoud interpolator will be loaded from ./interpolator_pickle/velocity_dispersion_ewoud/velocity_dispersion_ewoud_0.pickle
optical_depth_SIE_hemanta interpolator will be loaded from ./interpolator_pickle/optical_depth_SIE_hemanta/optical_depth_SIE_hemanta_0.pickle
input_params_image {&#39;n_min_images&#39;: 2, &#39;n_max_images&#39;: 4, &#39;geocent_time_min&#39;: 1126259462.4, &#39;geocent_time_max&#39;: 1756979462.4, &#39;lens_model_list&#39;: [&#39;EPL_NUMBA&#39;, &#39;SHEAR&#39;], &#39;source_priors&#39;: None, &#39;source_priors_params&#39;: None, &#39;spin_zero&#39;: True, &#39;spin_precession&#39;: False}
luminosity_distance_to_z interpolator will be loaded from ./interpolator_pickle/luminosity_distance_to_z/luminosity_distance_to_z_0.pickle
psds not given. Choosing bilby&#39;s default psds
Interpolator will be loaded for L1 detector from ./interpolator_pickle/L1/partialSNR_dict_0.pickle
Interpolator will be loaded for H1 detector from ./interpolator_pickle/H1/partialSNR_dict_0.pickle
Interpolator will be loaded for V1 detector from ./interpolator_pickle/V1/partialSNR_dict_0.pickle

 # LeR set up params:
npool = 4,
z_min = 0.0,
z_max = 10.0,
event_type = &#39;BBH&#39;,
size = 100000,
batch_size = 50000,
cosmology = LambdaCDM(H0=70.0 km / (Mpc s), Om0=0.3, Ode0=0.7, Tcmb0=0.0 K, Neff=3.04, m_nu=None, Ob0=None),
snr_finder = &lt;bound method GWSNR.snr of &lt;gwsnr.gwsnr.GWSNR object at 0x11251f9d0&gt;&gt;,
json_file_names = {&#39;ler_params&#39;: &#39;ler_params.json&#39;, &#39;unlensed_param&#39;: &#39;unlensed_param.json&#39;, &#39;unlensed_param_detectable&#39;: &#39;unlensed_param_detectable.json&#39;, &#39;lensed_param&#39;: &#39;lensed_param.json&#39;, &#39;lensed_param_detectable&#39;: &#39;lensed_param_detectable.json&#39;},
interpolator_directory = &#39;./interpolator_pickle&#39;,
ler_directory = &#39;./ler_data&#39;,

 # LeR also takes CBCSourceParameterDistribution class params as kwargs, as follows:
source_priors = {&#39;merger_rate_density&#39;: &#39;merger_rate_density_bbh_popI_II_oguri2018&#39;, &#39;source_frame_masses&#39;: &#39;binary_masses_BBH_popI_II_powerlaw_gaussian&#39;, &#39;zs&#39;: &#39;sample_source_redshift&#39;, &#39;geocent_time&#39;: &#39;sampler_uniform&#39;, &#39;ra&#39;: &#39;sampler_uniform&#39;, &#39;dec&#39;: &#39;sampler_cosine&#39;, &#39;phase&#39;: &#39;sampler_uniform&#39;, &#39;psi&#39;: &#39;sampler_uniform&#39;, &#39;theta_jn&#39;: &#39;sampler_sine&#39;},
source_priors_params = {&#39;merger_rate_density&#39;: {&#39;R0&#39;: 2.39e-08, &#39;b2&#39;: 1.6, &#39;b3&#39;: 2.0, &#39;b4&#39;: 30}, &#39;source_frame_masses&#39;: {&#39;mminbh&#39;: 4.98, &#39;mmaxbh&#39;: 112.5, &#39;alpha&#39;: 3.78, &#39;mu_g&#39;: 32.27, &#39;sigma_g&#39;: 3.88, &#39;lambda_peak&#39;: 0.03, &#39;delta_m&#39;: 4.8, &#39;beta&#39;: 0.81}, &#39;zs&#39;: None, &#39;geocent_time&#39;: {&#39;min_&#39;: 1238166018, &#39;max_&#39;: 1269702018}, &#39;ra&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;dec&#39;: None, &#39;phase&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;psi&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 3.141592653589793}, &#39;theta_jn&#39;: None},
spin_zero = True,
spin_precession = False,
create_new_interpolator = False,

 # LeR also takes LensGalaxyParameterDistribution class params as kwargs, as follows:
lens_type = &#39;epl_shear_galaxy&#39;,
lens_functions = {&#39;strong_lensing_condition&#39;: &#39;rjs_with_cross_section_SIE&#39;, &#39;optical_depth&#39;: &#39;optical_depth_SIE_hemanta&#39;, &#39;param_sampler_type&#39;: &#39;sample_all_routine&#39;},
lens_priors = {&#39;source_redshift_sl&#39;: &#39;strongly_lensed_source_redshifts&#39;, &#39;lens_redshift&#39;: &#39;lens_redshift_SDSS_catalogue&#39;, &#39;velocity_dispersion&#39;: &#39;velocity_dispersion_ewoud&#39;, &#39;axis_ratio&#39;: &#39;axis_ratio_rayleigh&#39;, &#39;axis_rotation_angle&#39;: &#39;axis_rotation_angle_uniform&#39;, &#39;external_shear&#39;: &#39;shear_norm&#39;, &#39;density_profile_slope&#39;: &#39;density_profile_slope_normal&#39;, &#39;source_parameters&#39;: &#39;sample_gw_parameters&#39;},
lens_priors_params = {&#39;source_redshift_sl&#39;: None, &#39;lens_redshift&#39;: None, &#39;velocity_dispersion&#39;: None, &#39;axis_ratio&#39;: {&#39;q_min&#39;: 0.2, &#39;q_max&#39;: 1.0}, &#39;axis_rotation_angle&#39;: {&#39;phi_min&#39;: 0.0, &#39;phi_max&#39;: 6.283185307179586}, &#39;external_shear&#39;: {&#39;scale&#39;: 0.05}, &#39;density_profile_slope&#39;: {&#39;mean&#39;: 2.0, &#39;std&#39;: 0.2}, &#39;source_parameters&#39;: None},

 # LeR also takes ImageProperties class params as kwargs, as follows:
n_min_images = 2,
n_max_images = 4,
geocent_time_min = 1126259462.4,
geocent_time_max = 1756979462.4,
lens_model_list = [&#39;EPL_NUMBA&#39;, &#39;SHEAR&#39;],

 # LeR also takes gwsnr.GWSNR params as kwargs, as follows:
mtot_min = 2.0,
mtot_max = 184.98599853446768,
ratio_min = 0.1,
ratio_max = 1.0,
mtot_resolution = 500,
ratio_resolution = 50,
sampling_frequency = 2048.0,
waveform_approximant = &#39;IMRPhenomD&#39;,
minimum_frequency = 20.0,
snr_type = &#39;interpolation&#39;,
psds = [PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/aLIGO_O4_high_asd.txt&#39;), PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/aLIGO_O4_high_asd.txt&#39;), PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/AdV_asd.txt&#39;)],
ifos = None,
interpolator_dir = &#39;./interpolator_pickle&#39;,
gwsnr_verbose = False,
multiprocessing_verbose = True,
mtot_cut = True,

 For reference, the chosen source parameters are listed below:
merger_rate_density = &#39;merger_rate_density_bbh_popI_II_oguri2018&#39;
merger_rate_density_params =  {&#39;R0&#39;: 2.39e-08, &#39;b2&#39;: 1.6, &#39;b3&#39;: 2.0, &#39;b4&#39;: 30}
source_frame_masses = &#39;binary_masses_BBH_popI_II_powerlaw_gaussian&#39;
source_frame_masses_params =  {&#39;mminbh&#39;: 4.98, &#39;mmaxbh&#39;: 112.5, &#39;alpha&#39;: 3.78, &#39;mu_g&#39;: 32.27, &#39;sigma_g&#39;: 3.88, &#39;lambda_peak&#39;: 0.03, &#39;delta_m&#39;: 4.8, &#39;beta&#39;: 0.81}
geocent_time = &#39;sampler_uniform&#39;
geocent_time_params =  {&#39;min_&#39;: 1238166018, &#39;max_&#39;: 1269702018}
ra = &#39;sampler_uniform&#39;
ra_params =  {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}
dec = &#39;sampler_cosine&#39;
dec_params =  None
phase = &#39;sampler_uniform&#39;
phase_params =  {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}
psi = &#39;sampler_uniform&#39;
psi_params =  {&#39;min_&#39;: 0.0, &#39;max_&#39;: 3.141592653589793}
theta_jn = &#39;sampler_sine&#39;
theta_jn_params =  None

 For reference, the chosen lens related parameters and functions are listed below:
lens_redshift = &#39;lens_redshift_SDSS_catalogue&#39;
lens_redshift_params =  None
velocity_dispersion = &#39;velocity_dispersion_ewoud&#39;
velocity_dispersion_params =  None
axis_ratio = &#39;axis_ratio_rayleigh&#39;
axis_ratio_params =  {&#39;q_min&#39;: 0.2, &#39;q_max&#39;: 1.0}
axis_rotation_angle = &#39;axis_rotation_angle_uniform&#39;
axis_rotation_angle_params =  {&#39;phi_min&#39;: 0.0, &#39;phi_max&#39;: 6.283185307179586}
shear = &#39;shear_norm&#39;
shear_params =  {&#39;scale&#39;: 0.05}
density_profile_slope = &#39;density_profile_slope_normal&#39;
density_profile_slope_params =  {&#39;mean&#39;: 2.0, &#39;std&#39;: 0.2}
Lens functions:
strong_lensing_condition = &#39;rjs_with_cross_section_SIE&#39;
optical_depth = &#39;optical_depth_SIE_hemanta&#39;
</pre></div></div>
</div>
<section id="Simulation-of-the-GW-CBC-population-(unlensed).">
<h3>Simulation of the GW CBC population (unlensed).<a class="headerlink" href="#Simulation-of-the-GW-CBC-population-(unlensed)." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>this will generate a json file with the simulated population parameters.</p></li>
<li><p>by default 100,000 events will be sampled with batches of 50,000. For more realistic results, keep batch_size=50000 and size&gt;=1000000.</p></li>
<li><p>results will be saved in the same directory as json file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resume=True</span></code> will resume the simulation from the last saved batch.</p></li>
<li><p>if you dont’t need to save the file at the end of each batch sampling, set <code class="docutils literal notranslate"><span class="pre">save_batch=False</span></code> (default).</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ler.batch_size = 100000 # for faster computation</span>
<span class="n">unlensed_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">unlensed_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_batch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
unlensed params will be store in ./ler_data/unlensed_param.json
chosen batch size = 50000 with total size = 100000
There will be 2 batche(s)
Batch no. 1
sampling gw source params...
calculating snrs...
Batch no. 2
sampling gw source params...
calculating snrs...
saving all unlensed parameters in ./ler_data/unlensed_param.json
</pre></div></div>
</div>
</section>
<section id="Calculation-of-unlensed-rates.">
<h3>Calculation of unlensed rates.<a class="headerlink" href="#Calculation-of-unlensed-rates." title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rate_unlensed</span><span class="p">,</span> <span class="n">unlensed_param_detectable</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">unlensed_rate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Getting unlensed_param from json file ./ler_data/unlensed_param.json...
given detectability_condition == &#39;step_function&#39;
total unlensed rate (yr^-1): 432.7257078089194
number of simulated unlensed detectable events: 418
number of simulated all unlensed events: 100000
storing detectable params in ./ler_data/unlensed_param_detectable.json
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># look for parameters names included in the generated data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unlensed_param_detectable</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;, &#39;optimal_snr_net&#39;])
</pre></div></div>
</div>
</section>
<section id="Simulation-of-the-GW-CBC-population-(lensed).">
<h3>Simulation of the GW CBC population (lensed).<a class="headerlink" href="#Simulation-of-the-GW-CBC-population-(lensed)." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>this will generate a json file with the simulated source parameters, lensed parameters and image parameters.</p></li>
<li><p>if the program hangs dues to memory issues,</p>
<ul>
<li><p>try reducing the batch size.</p></li>
<li><p>and you can resume from the last saved batch. But you need to set save_batch=True.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save_batch=False</span></code> (default) will make the code run faster but you will not have the results saved in the end of each batch.</p></li>
</ul>
</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ler.batch_size = 50000</span>
<span class="n">lensed_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">lensed_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_batch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
lensed params will be store in ./ler_data/lensed_param.json
chosen batch size = 50000 with total size = 100000
There will be 2 batche(s)
Batch no. 1
sampling lensed params...
solving lens equations...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:11&lt;00:00, 4376.58it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calculating snrs...
Batch no. 2
sampling lensed params...
solving lens equations...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:11&lt;00:00, 4262.07it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Invalid sample found. Resampling 1 lensed events...
solving lens equations...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00, 11.91it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calculating snrs...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
saving all lensed parameters in ./ler_data/lensed_param.json
</pre></div></div>
</div>
</section>
<section id="Calculation-of-lensed-rates.">
<h3>Calculation of lensed rates.<a class="headerlink" href="#Calculation-of-lensed-rates." title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span><span class="o">.</span><span class="n">lensed_rate</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Getting lensed_param from json file ./ler_data/lensed_param.json...
given detectability_condition == step_function
total lensed rate (yr^-1): 1.1690813631723105
number of simulated lensed detectable events: 515
number of simulated all lensed events: 100000
storing detectable params in ./ler_data/lensed_param_detectable.json
</pre></div></div>
</div>
</section>
<section id="Comparison-of-the-rates.">
<h3>Comparison of the rates.<a class="headerlink" href="#Comparison-of-the-rates." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ler.rate_ratio</span></code> function by default assumes data generated and stored in previous steps. Otherwise you have to provide the data or the file path.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span><span class="o">.</span><span class="n">rate_ratio</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
unlensed_rate: 432.7257078089194
lensed_rate: 1.1690813631723105
ratio: 370.1416526175006
</pre></div></div>
</div>
<ul>
<li><p>if you want to calculate the rates, and compare it at the same time, run the following command.</p>
<p><code class="docutils literal notranslate"><span class="pre">rate_ratio,</span> <span class="pre">unlensed_param_detectable,</span> <span class="pre">lensed_param_detectable</span> <span class="pre">=ler.rate_comparison_with_rate_calculation()</span></code></p>
</li>
</ul>
<ul>
<li><p>Note: The above example is for spin-less systems. IMRPhenomD (spin-less) is the default waveform approximant. To see LeR configuration, run</p>
<p><code class="docutils literal notranslate"><span class="pre">ler.print_all_params()</span></code></p>
</li>
</ul>
</section>
<section id="Getting-generated-parameters.">
<h3>Getting generated parameters.<a class="headerlink" href="#Getting-generated-parameters." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>what are the saved files?</p></li>
<li><p>all saved files are in the <code class="docutils literal notranslate"><span class="pre">ler_data</span></code> directory by default.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#ler.json_file_names, ler.ler_directory</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ler directory: </span><span class="si">{</span><span class="n">ler</span><span class="o">.</span><span class="n">ler_directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ler json file names: </span><span class="si">{</span><span class="n">ler</span><span class="o">.</span><span class="n">json_file_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ler directory: ./ler_data
ler json file names: {&#39;ler_params&#39;: &#39;ler_params.json&#39;, &#39;unlensed_param&#39;: &#39;unlensed_param.json&#39;, &#39;unlensed_param_detectable&#39;: &#39;unlensed_param_detectable.json&#39;, &#39;lensed_param&#39;: &#39;lensed_param.json&#39;, &#39;lensed_param_detectable&#39;: &#39;lensed_param_detectable.json&#39;}
</pre></div></div>
</div>
<ul class="simple">
<li><p>you can use ler attributes or call the relevant json file</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the generated parameters are not store in the ler instance, but in the json files</span>
<span class="c1"># you can access the generated parameters from the json files as shown below</span>
<span class="n">unlensed_param_detectable</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">unlensed_param_detectable</span>
<span class="n">lensed_param_detectable</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">lensed_param_detectable</span>
<span class="c1"># unlensed_param = ler.unlensed_param</span>
<span class="c1"># lensed_param = ler.lensed_param</span>

<span class="c1"># print keys of the generated parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unlensed_param_detectable keys: </span><span class="si">{</span><span class="n">unlensed_param_detectable</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lensed_param_detectable keys: </span><span class="si">{</span><span class="n">lensed_param_detectable</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
unlensed_param_detectable keys: dict_keys([&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;, &#39;optimal_snr_net&#39;])
lensed_param_detectable keys: dict_keys([&#39;zl&#39;, &#39;zs&#39;, &#39;sigma&#39;, &#39;q&#39;, &#39;theta_E&#39;, &#39;phi&#39;, &#39;e1&#39;, &#39;e2&#39;, &#39;gamma1&#39;, &#39;gamma2&#39;, &#39;gamma&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;x0_image_positions&#39;, &#39;x1_image_positions&#39;, &#39;magnifications&#39;, &#39;time_delays&#39;, &#39;image_type&#39;, &#39;n_images&#39;, &#39;effective_luminosity_distance&#39;, &#39;effective_geocent_time&#39;, &#39;optimal_snr_net&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;])
</pre></div></div>
</div>
<ul class="simple">
<li><p>here is another way to access the generated parameters from the json files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_param_from_json</span></code> and <code class="docutils literal notranslate"><span class="pre">load_json</span></code> functions from <code class="docutils literal notranslate"><span class="pre">ler.utils</span></code> sub-module will be use in the following examples. <code class="docutils literal notranslate"><span class="pre">get_param_from_json</span></code> will automatically assume the dictionary value is a list and will be converted to a numpy array, while <code class="docutils literal notranslate"><span class="pre">load_json</span></code> will return the json file’s dictionary as it is.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_param_from_json</span></code> will recognize numpy specific data types (e.g. nan and inf) and convert them to numpy arrays.</p></li>
<li><p>to save data as dictionary, use <code class="docutils literal notranslate"><span class="pre">save_json</span></code> or <code class="docutils literal notranslate"><span class="pre">append_json</span></code> function from <code class="docutils literal notranslate"><span class="pre">ler.utils</span></code> sub-module.</p></li>
<li><p>all function usage of <code class="docutils literal notranslate"><span class="pre">ler.utils</span></code> sub-module can be found in the <a class="reference external" href="https://github.com/hemantaph/ler/blob/main/examples/utils/utils_functions.ipynb">ler.git</a> example.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">get_param_from_json</span>

<span class="n">unlensed_param_detectable</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">ler_directory</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">ler</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s1">&#39;unlensed_param_detectable&#39;</span><span class="p">])</span>
<span class="n">lensed_param_detectable</span> <span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">ler_directory</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">ler</span><span class="o">.</span><span class="n">json_file_names</span><span class="p">[</span><span class="s1">&#39;lensed_param_detectable&#39;</span><span class="p">])</span>
<span class="c1"># unlensed_param = get_param_from_json(ler.ler_directory+&#39;/&#39;+ler.json_file_names[&#39;unlensed_param&#39;])</span>
<span class="c1"># lensed_param = get_param_from_json(ler.ler_directory+&#39;/&#39;+ler.json_file_names[&#39;lensed_param&#39;])</span>

<span class="c1"># print keys of the generated parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unlensed_param_detectable keys: </span><span class="si">{</span><span class="n">unlensed_param_detectable</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lensed_param_detectable keys: </span><span class="si">{</span><span class="n">lensed_param_detectable</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
unlensed_param_detectable keys: dict_keys([&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;, &#39;optimal_snr_net&#39;])
lensed_param_detectable keys: dict_keys([&#39;zl&#39;, &#39;zs&#39;, &#39;sigma&#39;, &#39;q&#39;, &#39;theta_E&#39;, &#39;phi&#39;, &#39;e1&#39;, &#39;e2&#39;, &#39;gamma1&#39;, &#39;gamma2&#39;, &#39;gamma&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;x0_image_positions&#39;, &#39;x1_image_positions&#39;, &#39;magnifications&#39;, &#39;time_delays&#39;, &#39;image_type&#39;, &#39;n_images&#39;, &#39;effective_luminosity_distance&#39;, &#39;effective_geocent_time&#39;, &#39;optimal_snr_net&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;])
</pre></div></div>
</div>
<ul class="simple">
<li><p>Note: all LeR initialization parameters and some important results are saved in a json file.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">load_json</span>
<span class="c1"># ler_params = load_json(ler.ler_directory+&quot;/&quot;+ler.json_file_names[&quot;ler_params&quot;])</span>
<span class="n">ler_params</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="s1">&#39;ler_data/ler_params.json&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ler_params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;detectable_unlensed_rate_per_year: &quot;</span><span class="p">,</span> <span class="n">ler_params</span><span class="p">[</span><span class="s1">&#39;detectable_unlensed_rate_per_year&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;detectable_lensed_rate_per_year; &quot;</span><span class="p">,</span><span class="n">ler_params</span><span class="p">[</span><span class="s1">&#39;detectable_lensed_rate_per_year&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rate_ratio: &quot;</span><span class="p">,</span><span class="n">ler_params</span><span class="p">[</span><span class="s1">&#39;rate_ratio&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;npool&#39;, &#39;z_min&#39;, &#39;z_max&#39;, &#39;size&#39;, &#39;batch_size&#39;, &#39;cosmology&#39;, &#39;snr_finder&#39;, &#39;json_file_names&#39;, &#39;interpolator_directory&#39;, &#39;gw_param_sampler_dict&#39;, &#39;snr_calculator_dict&#39;, &#39;detectable_unlensed_rate_per_year&#39;, &#39;detectability_condition&#39;, &#39;detectable_lensed_rate_per_year&#39;, &#39;rate_ratio&#39;])
detectable_unlensed_rate_per_year:  420.30296021631887
detectable_lensed_rate_per_year;  1.094440169697147
rate_ratio:  384.0346616047772
</pre></div></div>
</div>
</section>
<section id="Plot-the-generated-parameters">
<h3>Plot the generated parameters<a class="headerlink" href="#Plot-the-generated-parameters" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Below I plot the generated redshift distributions of the lensed and unlensed populations and comapre them.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># quick plot</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">plots</span> <span class="k">as</span> <span class="n">lerplt</span>

<span class="c1"># plotting the distribution of event parameters</span>
<span class="c1"># comparision of redshift distribution for lensed and unlensed events</span>
<span class="c1"># param_dict can be either a dictionary or a json file name that contains the parameters</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># for unlensed case</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s1">&#39;zs&#39;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="s1">&#39;ler_data/unlensed_param_detectable.json&#39;</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;zs (bbh-detectable)&#39;</span><span class="p">,</span>
    <span class="n">histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">kde_bandwidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s1">&#39;zs&#39;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="s1">&#39;ler_data/unlensed_param.json&#39;</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;zs (bbh-all)&#39;</span><span class="p">,</span>
    <span class="n">histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># for lensed case</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s1">&#39;zs&#39;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="s1">&#39;ler_data/lensed_param_detectable.json&#39;</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;zs (bbh-lensed-detectable)&#39;</span><span class="p">,</span>
    <span class="n">histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">kde_bandwidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s1">&#39;zs&#39;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="s1">&#39;ler_data/lensed_param.json&#39;</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;zs (bbh-lensed-all)&#39;</span><span class="p">,</span>
    <span class="n">histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Source redshift (zs)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability Density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
getting gw_params from json file ler_data/unlensed_param_detectable.json...
getting gw_params from json file ler_data/unlensed_param.json...
getting gw_params from json file ler_data/lensed_param_detectable.json...
getting gw_params from json file ler_data/lensed_param.json...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_rates_LeR_complete_examples_27_1.png" src="../../_images/examples_rates_LeR_complete_examples_27_1.png" />
</div>
</div>
</section>
</section>
<section id="Using-custom-functions-and-parameters.">
<h2>Using custom functions and parameters.<a class="headerlink" href="#Using-custom-functions-and-parameters." title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ler</span></code> allows internal model functions to be change with custom functions.</p></li>
<li><p>It also allows to change the default parameters of the existing model functions.</p></li>
</ul>
<p>First let’s look at what are the input parameters available for <code class="docutils literal notranslate"><span class="pre">LeR</span></code> class. The input paramters can divided into five categories</p>
<ol class="arabic simple">
<li><p>ler.LeR set up params</p></li>
<li><p>ler.CBCSourceParameterDistribution set up params (as kwargs)</p></li>
<li><p>ler.LensGalaxyParameterDistribution set up params (as kwargs)</p></li>
<li><p>ler.ImageProperties set up params (as kwargs)</p></li>
<li><p>gwsnr.GWSNR set up params (as kwargs)</p></li>
</ol>
<p>Complete LeR initialization is shown below,</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # below is the example of LeR initialization with all the arguments.</span>
<span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">LeR</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">LambdaCDM</span>

<span class="c1"># # Uncomment the below code if you need to change the default arguments.</span>
<span class="c1"># ler = LeR(</span>
<span class="c1">#     # LeR setup arguments</span>
<span class="c1">#     npool=4, # number of processors to use</span>
<span class="c1">#     z_min=0.0, # minimum redshift</span>
<span class="c1">#     z_max=10.0, # maximum redshift</span>
<span class="c1">#     event_type=&#39;BBH&#39;, # event type</span>
<span class="c1">#     size=100000, # number of events to simulate</span>
<span class="c1">#     batch_size=50000, # batch size</span>
<span class="c1">#     cosmology=LambdaCDM(H0=70, Om0=0.3, Ode0=0.7), # cosmology</span>
<span class="c1">#     snr_finder=None, # snr calculator from &#39;gwsnr&#39; package will be used</span>
<span class="c1">#     pdet_finder=None,  # will not be consider unless specified</span>
<span class="c1">#     list_of_detectors=None, # list of detectors that will be considered when calculating snr or pdet for lensed events. if None, all the detectors from &#39;gwsnr&#39; will be considered</span>
<span class="c1">#     json_file_names=dict(</span>
<span class="c1">#         ler_params=&quot;ler_params.json&quot;, # to store initialization parameters and important results</span>
<span class="c1">#         unlensed_param=&quot;unlensed_param.json&quot;, # to store all unlensed events</span>
<span class="c1">#         unlensed_param_detectable=&quot;unlensed_param_detectable.json&quot;, # to store only detectable unlensed events</span>
<span class="c1">#         lensed_param=&quot;lensed_param.json&quot;, # to store all lensed events</span>
<span class="c1">#         lensed_param_detectable=&quot;lensed_param_detectable.json&quot;), # to store only detectable lensed events</span>
<span class="c1">#     interpolator_directory=&#39;./interpolator_pickle&#39;, # directory to store the interpolator pickle files. &#39;ler&#39; uses interpolation to get values of various functions to speed up the calculations (relying on numba njit).</span>
<span class="c1">#     ler_directory=&#39;./ler_data&#39;, # directory to store all the outputs</span>
<span class="c1">#     verbose=False, # if True, will print all information at initialization</span>

<span class="c1">#     # CBCSourceParameterDistribution class arguments</span>
<span class="c1">#     source_priors= {&#39;merger_rate_density&#39;: &#39;merger_rate_density_bbh_popI_II_oguri2018&#39;, &#39;source_frame_masses&#39;: &#39;binary_masses_BBH_popI_II_powerlaw_gaussian&#39;, &#39;zs&#39;: &#39;sample_source_redshift&#39;, &#39;geocent_time&#39;: &#39;sampler_uniform&#39;, &#39;ra&#39;: &#39;sampler_uniform&#39;, &#39;dec&#39;: &#39;sampler_cosine&#39;, &#39;phase&#39;: &#39;sampler_uniform&#39;, &#39;psi&#39;: &#39;sampler_uniform&#39;, &#39;theta_jn&#39;: &#39;sampler_sine&#39;},</span>
<span class="c1">#     source_priors_params= {&#39;merger_rate_density&#39;: {&#39;R0&#39;: 2.39e-08, &#39;b2&#39;: 1.6, &#39;b3&#39;: 2.0, &#39;b4&#39;: 30}, &#39;source_frame_masses&#39;: {&#39;mminbh&#39;: 4.98, &#39;mmaxbh&#39;: 112.5, &#39;alpha&#39;: 3.78, &#39;mu_g&#39;: 32.27, &#39;sigma_g&#39;: 3.88, &#39;lambda_peak&#39;: 0.03, &#39;delta_m&#39;: 4.8, &#39;beta&#39;: 0.81}, &#39;zs&#39;: None, &#39;geocent_time&#39;: {&#39;min_&#39;: 1238166018, &#39;max_&#39;: 1269702018}, &#39;ra&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;dec&#39;: None, &#39;phase&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;psi&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 3.141592653589793}, &#39;theta_jn&#39;: None},</span>
<span class="c1">#     spin_zero= True, # if True, spins will be set to zero</span>
<span class="c1">#     spin_precession= False, # if True, spins will be precessing</span>

<span class="c1">#     # LensGalaxyParameterDistribution class arguments</span>
<span class="c1">#     lens_type = &#39;epl_shear_galaxy&#39;,</span>
<span class="c1">#     lens_functions =  {&#39;strong_lensing_condition&#39;: &#39;rjs_with_cross_section_SIE&#39;, &#39;optical_depth&#39;: &#39;optical_depth_SIE_hemanta&#39;, &#39;param_sampler_type&#39;: &#39;sample_all_routine&#39;},</span>
<span class="c1">#     lens_priors =  {&#39;source_redshift_sl&#39;: &#39;strongly_lensed_source_redshifts&#39;, &#39;lens_redshift&#39;: &#39;lens_redshift_SDSS_catalogue&#39;, &#39;velocity_dispersion&#39;: &#39;velocity_dispersion_ewoud&#39;, &#39;axis_ratio&#39;: &#39;axis_ratio_rayleigh&#39;, &#39;axis_rotation_angle&#39;: &#39;axis_rotation_angle_uniform&#39;, &#39;external_shear&#39;: &#39;shear_norm&#39;, &#39;density_profile_slope&#39;: &#39;density_profile_slope_normal&#39;, &#39;source_parameters&#39;: &#39;sample_gw_parameters&#39;},</span>
<span class="c1">#     lens_priors_params =  {&#39;source_redshift_sl&#39;: None, &#39;lens_redshift&#39;: None, &#39;velocity_dispersion&#39;: None, &#39;axis_ratio&#39;: {&#39;q_min&#39;: 0.2, &#39;q_max&#39;: 1.0}, &#39;axis_rotation_angle&#39;: {&#39;phi_min&#39;: 0.0, &#39;phi_max&#39;: 6.283185307179586}, &#39;external_shear&#39;: {&#39;scale&#39;: 0.05}, &#39;density_profile_slope&#39;: {&#39;mean&#39;: 2.0, &#39;std&#39;: 0.2}, &#39;source_parameters&#39;: None},</span>

<span class="c1">#     # ImageProperties class arguments</span>
<span class="c1">#     n_min_images = 2,</span>
<span class="c1">#     n_max_images = 4,</span>
<span class="c1">#     geocent_time_min = 1126259462.4,</span>
<span class="c1">#     geocent_time_max = 1756979462.4,</span>
<span class="c1">#     lens_model_list = [&#39;EPL_NUMBA&#39;, &#39;SHEAR&#39;],</span>

<span class="c1">#     # gwsnr package arguments</span>
<span class="c1">#     mtot_min = 2.0,</span>
<span class="c1">#     mtot_max = 184.98599853446768,</span>
<span class="c1">#     ratio_min = 0.1,</span>
<span class="c1">#     ratio_max = 1.0,</span>
<span class="c1">#     mtot_resolution = 500,</span>
<span class="c1">#     ratio_resolution = 50,</span>
<span class="c1">#     sampling_frequency = 2048.0,</span>
<span class="c1">#     waveform_approximant = &#39;IMRPhenomD&#39;,</span>
<span class="c1">#     minimum_frequency = 20.0,</span>
<span class="c1">#     snr_type = &#39;interpolation&#39;,</span>
<span class="c1">#     psds = {&#39;L1&#39;:&#39;aLIGO_O4_high_asd.txt&#39;,&#39;H1&#39;:&#39;aLIGO_O4_high_asd.txt&#39;, &#39;V1&#39;:&#39;AdV_asd.txt&#39;, &#39;K1&#39;:&#39;KAGRA_design_asd.txt&#39;},</span>
<span class="c1">#     ifos = [&#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;],</span>
<span class="c1">#     interpolator_dir = &#39;./interpolator_pickle&#39;,</span>
<span class="c1">#     gwsnr_verbose = False,</span>
<span class="c1">#     multiprocessing_verbose = True,</span>
<span class="c1">#     mtot_cut = True,</span>

<span class="c1">#     # common arguments, to generate interpolator</span>
<span class="c1">#     create_new_interpolator = dict(</span>
<span class="c1">#         redshift_distribution=dict(create_new=False, resolution=1000),</span>
<span class="c1">#         z_to_luminosity_distance=dict(create_new=False, resolution=1000),</span>
<span class="c1">#         velocity_dispersion=dict(create_new=False, resolution=1000),</span>
<span class="c1">#         axis_ratio=dict(create_new=False, resolution=1000),</span>
<span class="c1">#         optical_depth=dict(create_new=False, resolution=200),</span>
<span class="c1">#         z_to_Dc=dict(create_new=False, resolution=1000),</span>
<span class="c1">#         Dc_to_z=dict(create_new=False, resolution=1000),</span>
<span class="c1">#         angular_diameter_distance=dict(create_new=False, resolution=1000),</span>
<span class="c1">#         differential_comoving_volume=dict(create_new=False, resolution=1000),</span>
<span class="c1">#         Dl_to_z=dict(create_new=False, resolution=1000),</span>
<span class="c1">#     )</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
<section id="Defining-custom-functions-and-parameters.">
<h3>Defining custom functions and parameters.<a class="headerlink" href="#Defining-custom-functions-and-parameters." title="Link to this heading"></a></h3>
<p>As an example, I will change,</p>
<ul class="simple">
<li><p><strong>merger_rate_density_params</strong>’s default value of <strong>local merger rate density</strong> (<span class="math notranslate nohighlight">\(R_0\)</span>) to <span class="math notranslate nohighlight">\(38.8\times 10^{-9} Mpc^{-3} yr^{-1}\)</span> (upper limit of GWTC-3). But, I am still using the default merger_rate_density function, which is <code class="docutils literal notranslate"><span class="pre">'merger_rate_density_bbh_popI_II_oguri2018'</span></code>. Note that the accepted <span class="math notranslate nohighlight">\(R_0\)</span> value in <a class="reference external" href="https://journals.aps.org/prx/pdf/10.1103/PhysRevX.13.011048">GWTC-3</a> is <span class="math notranslate nohighlight">\(23.9_{-8.6}^{+14.9}\times 10^{-9} \; Mpc^{-3} yr^{-1}\)</span>.</p></li>
<li><p><strong>source_frame_masses</strong> to a custom function. This is similar to the internal default function, i.e. <code class="docutils literal notranslate"><span class="pre">PowerLaw+Peak</span> <span class="pre">model</span></code>. I am using <code class="docutils literal notranslate"><span class="pre">gwcosmo</span></code>’s <code class="docutils literal notranslate"><span class="pre">powerlaw_gaussian</span></code> prior for this example.</p></li>
<li><p><strong>optical depth</strong> for strong lensing condition and <strong>velocity dispersion</strong> of the lensing galaxy to SIS model and gamma function respectively. The default optical depth is that of the SIE model and default velocity dispersion has additional redshift dependence. Note the minimum and maximum values of the velocity dispersion. Default is <span class="math notranslate nohighlight">\([10, 350] \; km/s\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gwsnr</span></code> parameters: By default, it uses <strong>IMRPhenomD</strong> <strong>waveform model</strong> with no spin. It uses interpolation method to find the ‘snr’ and it is super fast. But for the example below, I am using <strong>IMRPhenomXPHM</strong> with precessing spins. This is without interpolation but through inner product method, like that of <code class="docutils literal notranslate"><span class="pre">bilby</span></code> but with njit functions and multiprocessing. It will be slower as compare to interpolation method but faster than that of bilby.</p></li>
</ul>
<p><strong>Note:</strong> All custom functions sampler should have ‘size’ as the only input.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gwcosmo</span> <span class="kn">import</span> <span class="n">priors</span> <span class="k">as</span> <span class="n">p</span>

<span class="c1"># define your custom function of mass_1_source and mass_2_source calculation</span>
<span class="c1"># it should have &#39;size&#39; as the only argument</span>
<span class="k">def</span> <span class="nf">powerlaw_peak</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to sample mass1 and mass2 from a powerlaw with a gaussian peak</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : `int`</span>
<span class="sd">        Number of samples to draw</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mass_1_source : `numpy.ndarray`</span>
<span class="sd">        Array of mass1 samples</span>
<span class="sd">    mass_2_source : `numpy.ndarray`</span>
<span class="sd">        Array of mass2 samples</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c1"># below is the gwcosmo default values</span>
    <span class="n">mminbh</span><span class="o">=</span><span class="mf">4.98</span>  <span class="c1"># Minimum mass of the black hole (Msun)</span>
    <span class="n">mmaxbh</span><span class="o">=</span><span class="mf">86.22</span>  <span class="c1"># Maximum mass of the black hole (Msun)</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">2.63</span>  <span class="c1"># Spectral index for the powerlaw of the primary mass distribution</span>
    <span class="n">mu_g</span><span class="o">=</span><span class="mf">33.07</span>  <span class="c1"># Mean of the Gaussian component in the primary mass distribution</span>
    <span class="n">sigma_g</span><span class="o">=</span><span class="mf">5.69</span>  <span class="c1"># Width of the Gaussian component in the primary mass distribution</span>
    <span class="n">lambda_peak</span><span class="o">=</span><span class="mf">0.10</span>  <span class="c1"># Fraction of the model in the Gaussian component</span>
    <span class="n">delta_m</span><span class="o">=</span><span class="mf">4.82</span>  <span class="c1"># Range of mass tapering on the lower end of the mass distribution</span>
    <span class="n">beta</span><span class="o">=</span><span class="mf">1.26</span>  <span class="c1"># Spectral index for the powerlaw of the mass ratio distribution</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">BBH_powerlaw_gaussian</span><span class="p">(</span>
        <span class="n">mminbh</span><span class="o">=</span><span class="n">mminbh</span><span class="p">,</span>
        <span class="n">mmaxbh</span><span class="o">=</span><span class="n">mmaxbh</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">mu_g</span><span class="o">=</span><span class="n">mu_g</span><span class="p">,</span>
        <span class="n">sigma_g</span><span class="o">=</span><span class="n">sigma_g</span><span class="p">,</span>
        <span class="n">lambda_peak</span><span class="o">=</span><span class="n">lambda_peak</span><span class="p">,</span>
        <span class="n">delta_m</span><span class="o">=</span><span class="n">delta_m</span><span class="p">,</span>
        <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># sample mass1 and mass2</span>
    <span class="n">mass_1_source</span><span class="p">,</span> <span class="n">mass_2_source</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">Nsample</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">mass_1_source</span><span class="p">,</span> <span class="n">mass_2_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="LeR-initialization-with-custom-functions-and-parameters">
<h3>LeR initialization with custom functions and parameters<a class="headerlink" href="#LeR-initialization-with-custom-functions-and-parameters" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Initialize the class with the custom function</p></li>
<li><p>changing ler input params</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">LeR</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">ler</span> <span class="o">=</span> <span class="n">LeR</span><span class="p">(</span><span class="n">npool</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="c1"># for source parameters</span>
    <span class="n">source_priors</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">merger_rate_density</span><span class="o">=</span><span class="s1">&#39;merger_rate_density_bbh_popI_II_oguri2018&#39;</span><span class="p">,</span>
        <span class="n">source_frame_masses</span><span class="o">=</span><span class="n">powerlaw_peak</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">source_priors_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">merger_rate_density</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">R0</span><span class="o">=</span><span class="mf">38.8e-09</span><span class="p">,</span>
            <span class="n">b2</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span>
            <span class="n">b3</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
            <span class="n">b4</span><span class="o">=</span><span class="mi">30</span>
        <span class="p">),</span>
        <span class="n">source_frame_masses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="c1"># for lens parameters</span>
    <span class="n">lens_functions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">strong_lensing_condition</span><span class="o">=</span><span class="s2">&quot;rjs_with_cross_section_SIS&quot;</span><span class="p">,</span>
        <span class="n">optical_depth</span><span class="o">=</span><span class="s2">&quot;optical_depth_SIS_haris&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">lens_priors</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">velocity_dispersion</span><span class="o">=</span><span class="s2">&quot;velocity_dispersion_gengamma&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">lens_priors_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">velocity_dispersion</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">2.32</span> <span class="o">/</span> <span class="mf">2.67</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">2.67</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="c1"># for snr generation</span>
    <span class="n">waveform_approximant</span> <span class="o">=</span> <span class="s1">&#39;IMRPhenomXPHM&#39;</span><span class="p">,</span>
    <span class="n">snr_type</span><span class="o">=</span><span class="s1">&#39;inner_product&#39;</span><span class="p">,</span>
    <span class="n">spin_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">spin_precession</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>since I am using inner product to calculate snr, it will take longer time to simulate the events.</p></li>
<li><p>You can increase the speed by allocating more CPU cores to the code. For example, if you have 8 logical cores, set npool&gt;4</p></li>
</ul>
</section>
<section id="Sampling-(Unlensed).">
<h3>Sampling (Unlensed).<a class="headerlink" href="#Sampling-(Unlensed)." title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">25000</span>
<span class="c1"># increase size for accurate rate calculation</span>
<span class="c1"># for Apple silicon M2 pro 16GB RAM, npool=4, time taken is 1m 44.8s</span>
<span class="n">ler</span><span class="o">.</span><span class="n">unlensed_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_jsonfile</span> <span class="o">=</span> <span class="s1">&#39;new_unlensed_params.json&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
unlensed params will be store in ./ler_data/new_unlensed_params.json
chosen batch size = 25000 with total size = 50000
There will be 2 batche(s)
Batch no. 1
sampling gw source params...
calculating snrs...
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|████████████████████████████████████████████████████████| 20250/20250 [00:51&lt;00:00, 396.70it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch no. 2
sampling gw source params...
calculating snrs...
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|████████████████████████████████████████████████████████| 20344/20344 [00:51&lt;00:00, 391.53it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
saving all unlensed parameters in ./ler_data/new_unlensed_params.json
</pre></div></div>
</div>
</section>
<section id="Sampling-(Lensed).">
<h3>Sampling (Lensed).<a class="headerlink" href="#Sampling-(Lensed)." title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># increase the size if you need accurate rate calculation</span>
<span class="c1"># for Apple silicon M2 pro 16GB RAM, npool=4, time taken is</span>
<span class="n">ler</span><span class="o">.</span><span class="n">lensed_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_jsonfile</span> <span class="o">=</span> <span class="s1">&#39;new_lensed_params.json&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
lensed params will be store in ./ler_data/new_lensed_params.json
chosen batch size = 25000 with total size = 50000
There will be 2 batche(s)
Batch no. 1
sampling lensed params...
solving lens equations...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 25000/25000 [00:06&lt;00:00, 3965.92it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Invalid sample found. Resampling 1 lensed events...
solving lens equations...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00, 11.49it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calculating snrs...
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|████████████████████████████████████████████████████████| 18026/18026 [00:46&lt;00:00, 391.77it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|████████████████████████████████████████████████████████| 18026/18026 [00:43&lt;00:00, 410.05it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████████████████████████| 2600/2600 [00:06&lt;00:00, 410.74it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|██████████████████████████████████████████████████████████| 2201/2201 [00:05&lt;00:00, 405.64it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch no. 2
sampling lensed params...
solving lens equations...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 25000/25000 [00:05&lt;00:00, 4262.94it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Invalid sample found. Resampling 2 lensed events...
solving lens equations...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████| 2/2 [00:00&lt;00:00, 24.85it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calculating snrs...
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|████████████████████████████████████████████████████████| 18070/18070 [00:43&lt;00:00, 412.07it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|████████████████████████████████████████████████████████| 18070/18070 [00:44&lt;00:00, 409.45it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████████████████████████| 2566/2566 [00:06&lt;00:00, 414.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|██████████████████████████████████████████████████████████| 2184/2184 [00:05&lt;00:00, 413.02it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
saving all lensed parameters in ./ler_data/new_lensed_params.json
</pre></div></div>
</div>
<ul class="simple">
<li><p>generate detectable events and compute the rate ratio</p></li>
<li><p>note: here no input params are provided, so it will track the json files generated above</p></li>
<li><p>For individual rate computation, use <code class="docutils literal notranslate"><span class="pre">ler.unlensed_rate();</span></code> <code class="docutils literal notranslate"><span class="pre">ler.lensed_rate();</span></code></p></li>
</ul>
</section>
<section id="Rate-calculation-and-comparison.">
<h3>Rate calculation and comparison.<a class="headerlink" href="#Rate-calculation-and-comparison." title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># you might not need to provide the json file names</span>
<span class="c1"># at the end of each sampling, the json file names will be updated in the ler_params.json file. The default json file names are call from the ler_params.json file.</span>
<span class="n">rate_ratio</span><span class="p">,</span> <span class="n">unlensed_param_detectable</span><span class="p">,</span> <span class="n">lensed_param_detectable</span> <span class="o">=</span><span class="n">ler</span><span class="o">.</span><span class="n">rate_comparison_with_rate_calculation</span><span class="p">(</span>
    <span class="n">unlensed_param</span><span class="o">=</span><span class="s1">&#39;new_unlensed_params.json&#39;</span><span class="p">,</span>
    <span class="n">snr_threshold_unlensed</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
    <span class="n">lensed_param</span><span class="o">=</span><span class="s1">&#39;new_lensed_params.json&#39;</span><span class="p">,</span>
    <span class="n">output_jsonfile_unlensed</span><span class="o">=</span><span class="s1">&#39;new_unlensed_params_detectable.json&#39;</span><span class="p">,</span>
    <span class="n">output_jsonfile_lensed</span><span class="o">=</span><span class="s1">&#39;new_lensed_params_detectable.json&#39;</span><span class="p">,</span>
    <span class="n">snr_threshold_lensed</span><span class="o">=</span><span class="p">[</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">],</span>
    <span class="n">num_img</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Getting unlensed_param from json file ./ler_data/new_unlensed_params.json...
given detectability_condition == &#39;step_function&#39;
total unlensed rate (yr^-1): 1522.6442174796687
number of simulated unlensed detectable events: 453
number of simulated all unlensed events: 50000
storing detectable params in ./ler_data/new_unlensed_params_detectable.json
Getting lensed_param from json file ./ler_data/new_lensed_params.json...
given detectability_condition == step_function
total lensed rate (yr^-1): 1.1059902347300807
number of simulated lensed detectable events: 337
number of simulated all lensed events: 50000
storing detectable params in ./ler_data/new_lensed_params_detectable.json
unlensed_rate: 1522.6442174796687
lensed_rate: 1.1059902347300807
ratio: 1376.7248296286027
</pre></div></div>
</div>
<p><strong>Important Note:</strong> * input parameters, snr_threshold_lensed=[8.0,8.0], num_img=[1,1], means that two of the images should have snr&gt;8.0. You can also set: snr_threshold_lensed=8, num_img=2</p>
<ul class="simple">
<li><p>Similarly, if snr_threshold_lensed=[8.0,6.0], num_img=[2,2], it means that two of the images should have snr&gt;8.0 and other two images should have snr&gt;6.0. But in this case, even though the simulated lensed (detectable) events are correct, the rate calculation will not be right as the strong lensing condition was set for 2 image case.</p></li>
</ul>
</section>
</section>
<section id="Uning-available-model-functions">
<h2>Uning available model functions<a class="headerlink" href="#Uning-available-model-functions" title="Link to this heading"></a></h2>
<p>How to look for available model functions?</p>
<ul class="simple">
<li><p>All available names are stored as a dict in <code class="docutils literal notranslate"><span class="pre">ler</span></code> instance</p></li>
<li><p>the keys of this dict shows the parameter type</p></li>
<li><p>the values are also dict, where the keys are the model function names and the values are their input parameters</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for unlensed case</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">available_gw_prior_list_and_its_params</span><span class="p">[</span><span class="s1">&#39;source_frame_masses&#39;</span><span class="p">])</span>
<span class="c1"># for lensed case</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">available_lens_prior_list_and_its_params</span><span class="p">[</span><span class="s1">&#39;velocity_dispersion&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;binary_masses_BBH_popI_II_powerlaw_gaussian&#39;: {&#39;mminbh&#39;: 4.98, &#39;mmaxbh&#39;: 112.5, &#39;alpha&#39;: 3.78, &#39;mu_g&#39;: 32.27, &#39;sigma_g&#39;: 3.88, &#39;lambda_peak&#39;: 0.03, &#39;delta_m&#39;: 4.8, &#39;beta&#39;: 0.81}, &#39;binary_masses_BBH_popIII_lognormal&#39;: {&#39;Mc&#39;: 30.0, &#39;sigma&#39;: 0.3, &#39;beta&#39;: 1.1}, &#39;binary_masses_BBH_primordial_lognormal&#39;: {&#39;Mc&#39;: 30.0, &#39;sigma&#39;: 0.3, &#39;beta&#39;: 1.1}, &#39;binary_masses_BNS_gwcosmo&#39;: {&#39;mminns&#39;: 1.0, &#39;mmaxns&#39;: 3.0, &#39;alphans&#39;: 0.0}, &#39;binary_masses_BNS_bimodal&#39;: {&#39;w&#39;: 0.643, &#39;muL&#39;: 1.352, &#39;sigmaL&#39;: 0.08, &#39;muR&#39;: 1.88, &#39;sigmaR&#39;: 0.3, &#39;mmin&#39;: 1.0, &#39;mmax&#39;: 2.3}}
{&#39;velocity_dispersion_haris&#39;: {&#39;a&#39;: 0.8689138576779026, &#39;c&#39;: 2.67}, &#39;velocity_dispersion_gengamma&#39;: {&#39;a&#39;: 0.8689138576779026, &#39;c&#39;: 2.67}, &#39;velocity_dispersion_bernardi&#39;: None, &#39;velocity_dispersion_ewoud&#39;: None}
</pre></div></div>
</div>
<ul class="simple">
<li><p>for looking at the choosen models and its input parameters</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for unlensed case</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">)</span>
<span class="c1"># for lensed case</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">lens_param_samplers</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">lens_param_samplers_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;merger_rate_density&#39;: &#39;merger_rate_density_bbh_popI_II_oguri2018&#39;, &#39;source_frame_masses&#39;: &lt;function powerlaw_peak at 0x32f3ffd90&gt;, &#39;zs&#39;: &#39;sample_source_redshift&#39;, &#39;geocent_time&#39;: &#39;sampler_uniform&#39;, &#39;ra&#39;: &#39;sampler_uniform&#39;, &#39;dec&#39;: &#39;sampler_cosine&#39;, &#39;phase&#39;: &#39;sampler_uniform&#39;, &#39;psi&#39;: &#39;sampler_uniform&#39;, &#39;theta_jn&#39;: &#39;sampler_sine&#39;, &#39;a_1&#39;: &#39;sampler_uniform&#39;, &#39;a_2&#39;: &#39;sampler_uniform&#39;, &#39;tilt_1&#39;: &#39;sampler_sine&#39;, &#39;tilt_2&#39;: &#39;sampler_sine&#39;, &#39;phi_12&#39;: &#39;sampler_uniform&#39;, &#39;phi_jl&#39;: &#39;sampler_uniform&#39;}
{&#39;merger_rate_density&#39;: {&#39;R0&#39;: 3.88e-08, &#39;b2&#39;: 1.6, &#39;b3&#39;: 2.0, &#39;b4&#39;: 30}, &#39;source_frame_masses&#39;: None, &#39;zs&#39;: None, &#39;geocent_time&#39;: {&#39;min_&#39;: 1238166018, &#39;max_&#39;: 1269702018}, &#39;ra&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;dec&#39;: None, &#39;phase&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;psi&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 3.141592653589793}, &#39;theta_jn&#39;: None, &#39;a_1&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 0.8}, &#39;a_2&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 0.8}, &#39;tilt_1&#39;: None, &#39;tilt_2&#39;: None, &#39;phi_12&#39;: {&#39;min_&#39;: 0, &#39;max_&#39;: 6.283185307179586}, &#39;phi_jl&#39;: {&#39;min_&#39;: 0, &#39;max_&#39;: 6.283185307179586}}
{&#39;source_redshift_sl&#39;: &#39;strongly_lensed_source_redshifts&#39;, &#39;lens_redshift&#39;: &#39;lens_redshift_SDSS_catalogue&#39;, &#39;velocity_dispersion&#39;: &#39;velocity_dispersion_gengamma&#39;, &#39;axis_ratio&#39;: &#39;axis_ratio_rayleigh&#39;, &#39;axis_rotation_angle&#39;: &#39;axis_rotation_angle_uniform&#39;, &#39;external_shear&#39;: &#39;shear_norm&#39;, &#39;density_profile_slope&#39;: &#39;density_profile_slope_normal&#39;, &#39;source_parameters&#39;: &#39;sample_gw_parameters&#39;}
{&#39;source_redshift_sl&#39;: None, &#39;lens_redshift&#39;: None, &#39;velocity_dispersion&#39;: {&#39;a&#39;: 0.8689138576779026, &#39;c&#39;: 2.67}, &#39;axis_ratio&#39;: {&#39;q_min&#39;: 0.2, &#39;q_max&#39;: 1.0}, &#39;axis_rotation_angle&#39;: {&#39;phi_min&#39;: 0.0, &#39;phi_max&#39;: 6.283185307179586}, &#39;external_shear&#39;: {&#39;scale&#39;: 0.05}, &#39;density_profile_slope&#39;: {&#39;mean&#39;: 2.0, &#39;std&#39;: 0.2}, &#39;source_parameters&#39;: None}
</pre></div></div>
</div>
<section id="Comparison-of-mass-distribution-model-(BBH,-mass-1,-larger-mass-only).">
<h3>Comparison of mass distribution model (BBH, mass-1, larger mass only).<a class="headerlink" href="#Comparison-of-mass-distribution-model-(BBH,-mass-1,-larger-mass-only)." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>compare the default mass distribution with the custom mass distribution function defined on the previous example link.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calling the default mass distribution model</span>
<span class="n">mass_1_source</span><span class="p">,</span> <span class="n">mass_2_source</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">binary_masses_BBH_popI_II_powerlaw_gaussian</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">default_model_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mass_1_source</span><span class="o">=</span><span class="n">mass_1_source</span><span class="p">)</span>

<span class="c1"># calling the custom mass distribution model</span>
<span class="n">mass_1_source</span><span class="p">,</span> <span class="n">mass_2_source</span> <span class="o">=</span> <span class="n">powerlaw_peak</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">custom_model_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mass_1_source</span><span class="o">=</span><span class="n">mass_1_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">plots</span> <span class="k">as</span> <span class="n">lerplt</span>

<span class="c1"># let&#39;s do a comparision plot between you custom model and the default model</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;mass_1_source&quot;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="n">custom_model_dict</span><span class="p">,</span> <span class="c1"># or the json file name</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;custom model&#39;</span><span class="p">,</span>
<span class="p">);</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;mass_1_source&quot;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="n">default_model_dict</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;default model&#39;</span><span class="p">,</span>
<span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;source $m_1$ ($M_{\odot}$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p(source mass_1)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_rates_LeR_complete_examples_49_0.png" src="../../_images/examples_rates_LeR_complete_examples_49_0.png" />
</div>
</div>
</section>
<section id="Comparison-of-Axis-ratio-model-of-the-lensing-galaxy.">
<h3>Comparison of Axis-ratio model of the lensing galaxy.<a class="headerlink" href="#Comparison-of-Axis-ratio-model-of-the-lensing-galaxy." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>compare the default axis-ratio distribution (gengamma, from SDSS galaxy catalogue, Haris et al. 2018) with axis-ratio distribution from Padilla and Strauss 2008</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">padilla_strauss</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">axis_ratio_padilla_strauss</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

<span class="c1"># axis_ratio_rayleigh depends on the velocity dispersion</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">velocity_dispersion_gengamma</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">rayleigh</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">axis_ratio_rayleigh</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>

<span class="c1"># make a dict</span>
<span class="n">axis_ratio_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">padilla_strauss</span><span class="o">=</span><span class="n">padilla_strauss</span><span class="p">,</span>
    <span class="n">rayleigh</span><span class="o">=</span><span class="n">rayleigh</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
axis_ratio_spline_coeff interpolator will be generated at ./interpolator_pickle/axis_ratio/axis_ratio_spline_coeff_0.pickle
axis_ratio interpolator will be generated at ./interpolator_pickle/axis_ratio/axis_ratio_1.pickle
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the distribution of axis-ratio</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;padilla_strauss&quot;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="n">axis_ratio_dict</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;padilla_strauss&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;rayleigh&quot;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="n">axis_ratio_dict</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;rayleigh&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;axis ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p(axis ratio)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_rates_LeR_complete_examples_52_0.png" src="../../_images/examples_rates_LeR_complete_examples_52_0.png" />
</div>
</div>
</section>
</section>
<section id="Generating-particular-number-of-detectable-events.">
<h2>Generating particular number of detectable events.<a class="headerlink" href="#Generating-particular-number-of-detectable-events." title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>this is particularly useful when you want only the detectable events to be saved in the json file</p></li>
<li><p>detectable event rates will be calculated at each batches. Subsequent batch will consider the previous batch’s detectable events. So, the rates will become more accurate as the batch number increases and will converge to a stable value at higher samples.</p></li>
<li><p>you can resume the rate calculation from the last saved batch.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">LeR</span>

<span class="c1"># class initialization</span>
<span class="n">ler</span> <span class="o">=</span> <span class="n">LeR</span><span class="p">(</span><span class="n">npool</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Unlensed-case.">
<h3>Unlensed case.<a class="headerlink" href="#Unlensed-case." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>SNR&gt;8</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_size_unlensed_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">selecting_n_unlensed_detectable_events</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
    <span class="n">snr_threshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
    <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;unlensed_params_n_detectable.json&#39;</span><span class="p">,</span>
    <span class="n">meta_data_file</span><span class="o">=</span><span class="s2">&quot;meta_unlensed.json&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
removing ./ler_data/unlensed_params_n_detectable.json and ./ler_data/meta_unlensed.json if they exist
collected number of detectable events =  0
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  422
total number of events =  100000
total rate (yr^-1): 436.86662367311965
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  841
total number of events =  200000
total rate (yr^-1): 435.31378022404454
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  1255
total number of events =  300000
total rate (yr^-1): 433.0707841309361
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  1705
total number of events =  400000
total rate (yr^-1): 441.2663467788323
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  2094
total number of events =  500000
total rate (yr^-1): 433.5538909817594
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  2503
total number of events =  600000
total rate (yr^-1): 431.8630170038777
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  2916
total number of events =  700000
total rate (yr^-1): 431.24680928599076
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  3325
total number of events =  800000
total rate (yr^-1): 430.2670390145505
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  3740
total number of events =  900000
total rate (yr^-1): 430.1951481141304
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  4138
total number of events =  1000000
total rate (yr^-1): 428.3777461515092
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  4561
total number of events =  1100000
total rate (yr^-1): 429.2435740140238
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  4979
total number of events =  1200000
total rate (yr^-1): 429.53375183026515
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  5385
total number of events =  1300000
total rate (yr^-1): 428.8236909368846
stored detectable unlensed params in ./ler_data/unlensed_params_n_detectable.json
stored meta data in ./ler_data/meta_unlensed.json

 trmming final result to size=5000
collected number of detectable events =  5000
total number of events =  1207057.0
total unlensed event rate (yr^-1): 428.8235626196801
</pre></div></div>
</div>
<p><strong>Important Note</strong>: At each iteration, rate is calculated using the cummulatively increasing number of events. It will become stable at around 2 million events. This is the number of events that is required to get a stable rate. Below, I am showing visualization of how rate changes with increasing number of events.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">get_param_from_json</span>
<span class="c1"># getting data from json</span>
<span class="n">meta_data</span><span class="o">=</span> <span class="n">get_param_from_json</span><span class="p">(</span><span class="s2">&quot;./ler_data/meta_unlensed.json&quot;</span><span class="p">)</span>

<span class="c1"># plot the rate vs sampling size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;events_total&#39;</span><span class="p">],</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;total_rate&#39;</span><span class="p">],</span> <span class="s1">&#39;o-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sampling size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Rate (per year)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Rate vs Sampling size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_rates_LeR_complete_examples_58_0.png" src="../../_images/examples_rates_LeR_complete_examples_58_0.png" />
</div>
</div>
</section>
<section id="Lensed-case.">
<h3>Lensed case.<a class="headerlink" href="#Lensed-case." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>2 images, snr&gt;8 (super-threshold)</p></li>
<li><p>1 image, snr&gt;6 (sub+super-threshold)</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_size_lensed_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">selecting_n_lensed_detectable_events</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">snr_threshold</span><span class="o">=</span><span class="p">[</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">],</span>
    <span class="n">num_img</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
    <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;lensed_params_n_detectable.json&#39;</span><span class="p">,</span>
    <span class="n">meta_data_file</span><span class="o">=</span><span class="s2">&quot;meta_lensed.json&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
removing ./ler_data/lensed_params_n_detectable.json and ./ler_data/meta_lensed.json if they exist
collected number of detectable events =  0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:11&lt;00:00, 4299.84it/s]
100%|█████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00, 12.57it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == step_function
collected number of detectable events =  112
total number of events =  50000
total rate (yr^-1): 0.508493641457471
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:11&lt;00:00, 4296.83it/s]
100%|█████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00, 11.66it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == step_function
collected number of detectable events =  212
total number of events =  100000
total rate (yr^-1): 0.48125291066510645
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:12&lt;00:00, 4094.12it/s]
100%|█████████████████████████████████████████████████████████████████| 3/3 [00:00&lt;00:00, 38.02it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == step_function
collected number of detectable events =  317
total number of events =  150000
total rate (yr^-1): 0.4797395367321973
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:11&lt;00:00, 4289.40it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == step_function
collected number of detectable events =  433
total number of events =  200000
total rate (yr^-1): 0.4914681847122432
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:11&lt;00:00, 4318.64it/s]
100%|█████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00, 12.09it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == step_function
collected number of detectable events =  531
total number of events =  250000
total rate (yr^-1): 0.48216093502485197
storing detectable lensed params in ./ler_data/lensed_params_n_detectable.json
storing meta data in ./ler_data/meta_lensed.json

 trmming final result to size=500
collected number of detectable events =  500
total number of events =  235405.0
total lensed event rate (yr^-1): 0.4821607228741339
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">n_size_lensed_param</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size of each parameters=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n_size_lensed_param</span><span class="p">[</span><span class="s1">&#39;zl&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;zl&#39;, &#39;zs&#39;, &#39;sigma&#39;, &#39;q&#39;, &#39;theta_E&#39;, &#39;phi&#39;, &#39;e1&#39;, &#39;e2&#39;, &#39;gamma1&#39;, &#39;gamma2&#39;, &#39;gamma&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;x0_image_positions&#39;, &#39;x1_image_positions&#39;, &#39;magnifications&#39;, &#39;time_delays&#39;, &#39;image_type&#39;, &#39;n_images&#39;, &#39;effective_luminosity_distance&#39;, &#39;effective_geocent_time&#39;, &#39;optimal_snr_net&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;])
size of each parameters=500
</pre></div></div>
</div>
</section>
</section>
<section id="Using-custom-detection-criteria.">
<h2>Using custom detection criteria.<a class="headerlink" href="#Using-custom-detection-criteria." title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>I leverage the ANN (Artificial Neural Network) based SNR calculator from gwsnr. It can predict SNR&gt;8 with 99.9% accuracy for the astrophysical parameters. But to make it 100% accurate, I will recalculate SNR some of the events using inner product method. LeR can do this automatically.</p></li>
<li><p>I will test two cases using:</p>
<ul>
<li><p>pdet (probability of detection) with ANN</p></li>
<li><p>SNR with ANN.</p></li>
</ul>
</li>
<li><p><strong>Note:</strong> Check out <a class="reference external" href="https://ler.readthedocs.io/en/latest/examples/rates/grb%20detection%20rate.html">GRB rate calculation example</a> for more details on how to use custom detection criteria.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">LeR</span>
<span class="kn">from</span> <span class="nn">gwsnr</span> <span class="kn">import</span> <span class="n">GWSNR</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<section id="Defining-custom-detection-criteria-(using-gwsnr-package).">
<h3>Defining custom detection criteria (using <code class="docutils literal notranslate"><span class="pre">gwsnr</span></code> package).<a class="headerlink" href="#Defining-custom-detection-criteria-(using-gwsnr-package)." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>pdet only calculation</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snr_</span> <span class="o">=</span> <span class="n">GWSNR</span><span class="p">(</span><span class="n">gwsnr_verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pdet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">snr_type</span><span class="o">=</span><span class="s1">&#39;ann&#39;</span><span class="p">,</span> <span class="n">waveform_approximant</span><span class="o">=</span><span class="s1">&#39;IMRPhenomXPHM&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
psds not given. Choosing bilby&#39;s default psds
Intel processor has trouble allocating memory when the data is huge. So, by default for IMRPhenomXPHM, duration_max = 64.0. Otherwise, set to some max value like duration_max = 600.0 (10 mins)
Interpolator will be loaded for L1 detector from ./interpolator_pickle/L1/partialSNR_dict_1.pickle
Interpolator will be loaded for H1 detector from ./interpolator_pickle/H1/partialSNR_dict_1.pickle
Interpolator will be loaded for V1 detector from ./interpolator_pickle/V1/partialSNR_dict_1.pickle

Chosen GWSNR initialization parameters:

npool:  4
snr type:  ann
waveform approximant:  IMRPhenomXPHM
sampling frequency:  2048.0
minimum frequency (fmin):  20.0
mtot=mass1+mass2
min(mtot):  2.0
max(mtot) (with the given fmin=20.0): 184.98599853446768
detectors:  [&#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;]
psds:  [PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/aLIGO_O4_high_asd.txt&#39;), PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/aLIGO_O4_high_asd.txt&#39;), PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/AdV_asd.txt&#39;)]
</pre></div></div>
</div>
</section>
<section id="Testing-the-custom-detection-criteria.">
<h3>Testing the custom detection criteria.<a class="headerlink" href="#Testing-the-custom-detection-criteria." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Pdet calculator test</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialization pdet calculator</span>
<span class="n">pdet_calculator</span> <span class="o">=</span> <span class="n">snr_</span><span class="o">.</span><span class="n">snr</span>
<span class="n">mass_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span><span class="mf">50.</span><span class="p">,</span><span class="mf">200.</span><span class="p">])</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span>
<span class="n">luminosity_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">])</span>
<span class="c1"># test</span>
<span class="n">pdet</span> <span class="o">=</span> <span class="n">pdet_calculator</span><span class="p">(</span>
    <span class="n">gw_param_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">mass_1</span><span class="o">=</span><span class="n">mass_1</span><span class="p">,</span>
        <span class="n">mass_2</span><span class="o">=</span><span class="n">mass_1</span><span class="o">*</span><span class="n">ratio</span><span class="p">,</span>
        <span class="n">luminosity_distance</span><span class="o">=</span><span class="n">luminosity_distance</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">inner_product_snr</span> <span class="o">=</span> <span class="n">snr_</span><span class="o">.</span><span class="n">compute_bilby_snr</span><span class="p">(</span>
    <span class="n">mass_1</span><span class="o">=</span><span class="n">mass_1</span><span class="p">,</span>
    <span class="n">mass_2</span><span class="o">=</span><span class="n">mass_1</span><span class="o">*</span><span class="n">ratio</span><span class="p">,</span>
    <span class="n">luminosity_distance</span><span class="o">=</span><span class="n">luminosity_distance</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pdet: </span><span class="si">{</span><span class="n">pdet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;inner_product_snr: </span><span class="si">{</span><span class="n">inner_product_snr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████| 3/3 [00:00&lt;00:00, 16.74it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
pdet: {&#39;L1&#39;: array([0, 0, 1, 0]), &#39;H1&#39;: array([0, 0, 0, 0]), &#39;V1&#39;: array([0, 0, 0, 0]), &#39;pdet_net&#39;: array([1, 0, 1, 0])}
inner_product_snr: {&#39;L1&#39;: array([ 7.4441411 ,  5.85368864, 10.6450267 ,  0.        ]), &#39;H1&#39;: array([4.73471203, 3.72313335, 6.77057773, 0.        ]), &#39;V1&#39;: array([2.23257635, 1.73563894, 3.21070705, 0.        ]), &#39;optimal_snr_net&#39;: array([ 9.10039185,  7.15121214, 13.01790904,  0.        ])}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
</section>
<section id="Using-custom-detection-criteria-with-LeR.">
<h3>Using custom detection criteria with LeR.<a class="headerlink" href="#Using-custom-detection-criteria-with-LeR." title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Below is an example of general case of initialising with any type of pdet calculator.</p></li>
<li><p>Refer to the <a class="reference external" href="https://ler.readthedocs.io/en/latest/examples/rates/grb%20detection%20rate.html">documentation</a> example for extra details, where I have used pdet for GRB (gamma-ray-burst) detection.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">LeR</span>

<span class="n">ler</span> <span class="o">=</span> <span class="n">LeR</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pdet_finder</span><span class="o">=</span><span class="n">pdet_calculator</span><span class="p">,</span> <span class="n">spin_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">spin_precession</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unlensed_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">unlensed_cbc_statistics</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
unlensed params will be store in ./ler_data/unlensed_param.json
chosen batch size = 50000 with total size = 100000
There will be 2 batche(s)
Batch no. 1
sampling gw source params...
calculating pdet...
Batch no. 2
sampling gw source params...
calculating pdet...
saving all unlensed parameters in ./ler_data/unlensed_param.json
</pre></div></div>
</div>
<ul class="simple">
<li><p>now calculate rate using the custom ‘pdet’ calculator</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <span class="n">unlensed_param_detectable</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">unlensed_rate</span><span class="p">(</span><span class="n">detectability_condition</span><span class="o">=</span><span class="s1">&#39;pdet&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Getting unlensed_param from json file ./ler_data/unlensed_param.json...
given detectability_condition == &#39;pdet&#39;
total unlensed rate (yr^-1): 502.08604853427255
number of simulated unlensed detectable events: 485
number of simulated all unlensed events: 100000
storing detectable params in ./ler_data/unlensed_param_detectable.json
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # for lensed case</span>
<span class="c1"># lensed_param = ler.lensed_cbc_statistics()</span>
<span class="c1"># _, lensed_param_detectable = ler.lensed_rate(detectability_condition=&#39;pdet&#39;)</span>
</pre></div>
</div>
</div>
</section>
<section id="Analysis:-SNR-(with-ANN)-+-SNR-recalculation-(inner-product).">
<h3>Analysis: SNR (with ANN) + SNR recalculation (inner product).<a class="headerlink" href="#Analysis:-SNR-(with-ANN)-+-SNR-recalculation-(inner-product)." title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">LeR</span>

<span class="c1"># ler initialization with gwsnr arguments</span>
<span class="n">ler</span> <span class="o">=</span> <span class="n">LeR</span><span class="p">(</span><span class="n">npool</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">snr_type</span><span class="o">=</span><span class="s1">&#39;ann&#39;</span><span class="p">,</span>
    <span class="n">waveform_approximant</span><span class="o">=</span><span class="s1">&#39;IMRPhenomXPHM&#39;</span><span class="p">,</span>
    <span class="n">spin_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">spin_precession</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unlensed_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">selecting_n_unlensed_detectable_events</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">snr_threshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
    <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">trim_to_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;unlensed_params_n_detectable_ann.json&#39;</span><span class="p">,</span>
    <span class="n">meta_data_file</span><span class="o">=</span><span class="s2">&quot;meta_unlensed_ann.json&quot;</span><span class="p">,</span>
    <span class="n">snr_recalculation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">snr_threshold_recalculation</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="c1"># it will recalculate SNR for events with (SNR_ANN &gt; 4) and (SNR_ANN &lt; 20)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
removing ./ler_data/unlensed_params_n_detectable_ann.json and ./ler_data/meta_unlensed_ann.json if they exist
collected number of detectable events =  0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████████████████████████| 1598/1598 [00:04&lt;00:00, 351.02it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  204
total number of events =  50000
total rate (yr^-1): 422.373418148419
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████████████████████████| 1557/1557 [00:04&lt;00:00, 344.99it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  425
total number of events =  100000
total rate (yr^-1): 439.97231057126976
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████████████████████████| 1503/1503 [00:04&lt;00:00, 345.51it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == &#39;step_function&#39;
collected number of detectable events =  604
total number of events =  150000
total rate (yr^-1): 416.85219699615203
stored detectable unlensed params in ./ler_data/unlensed_params_n_detectable_ann.json
stored meta data in ./ler_data/meta_unlensed_ann.json
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Uncomment the below code if you need to compare with the rate calculation using inner product snr</span>

<span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">LeR</span>

<span class="c1"># # ler initialization with gwsnr arguments</span>
<span class="c1"># ler = LeR(npool=6, verbose=False, snr_type=&#39;inner_product&#39;, waveform_approximant=&#39;IMRPhenomXPHM&#39;, spin_zero=False,</span>
<span class="c1">#     spin_precession=True)</span>

<span class="c1"># unlensed_param = ler.selecting_n_unlensed_detectable_events(</span>
<span class="c1">#     size=1000,</span>
<span class="c1">#     snr_threshold=10.0,</span>
<span class="c1">#     batch_size=50000,</span>
<span class="c1">#     resume=False,</span>
<span class="c1">#     output_jsonfile=&#39;unlensed_params_n_detectable.json&#39;,</span>
<span class="c1">#     meta_data_file=&quot;meta_unlensed.json&quot;,</span>
<span class="c1">#     )</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lensed_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">selecting_n_lensed_detectable_events</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">snr_threshold</span><span class="o">=</span><span class="p">[</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">],</span>
    <span class="n">num_img</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
    <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;lensed_params_n_detectable_ann.json&#39;</span><span class="p">,</span>
    <span class="n">meta_data_file</span><span class="o">=</span><span class="s2">&quot;meta_lensed_ann.json&quot;</span><span class="p">,</span>
    <span class="n">snr_recalculation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">snr_threshold_recalculation</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">]],</span> <span class="c1"># it will recalculate SNR for events with (SNR_ANN &gt; 4) and (SNR_ANN &lt; 20)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
removing ./ler_data/lensed_params_n_detectable_ann.json and ./ler_data/meta_lensed_ann.json if they exist
collected number of detectable events =  0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:11&lt;00:00, 4310.16it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calculating snrs...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████████████████████████| 1538/1538 [00:04&lt;00:00, 382.74it/s]
100%|██████████████████████████████████████████████████████████| 1538/1538 [00:03&lt;00:00, 389.81it/s]
100%|██████████████████████████████████████████████████████████| 1084/1084 [00:02&lt;00:00, 363.55it/s]
100%|████████████████████████████████████████████████████████████| 964/964 [00:02&lt;00:00, 377.48it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == step_function
collected number of detectable events =  220
total number of events =  50000
total rate (yr^-1): 0.9988267957200324
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:11&lt;00:00, 4299.16it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calculating snrs...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████████████████████████| 1436/1436 [00:03&lt;00:00, 387.69it/s]
100%|██████████████████████████████████████████████████████████| 1436/1436 [00:03&lt;00:00, 389.49it/s]
100%|██████████████████████████████████████████████████████████| 1011/1011 [00:02&lt;00:00, 375.16it/s]
100%|████████████████████████████████████████████████████████████| 884/884 [00:02&lt;00:00, 375.81it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == step_function
collected number of detectable events =  430
total number of events =  100000
total rate (yr^-1): 0.9761261867263953
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████| 50000/50000 [00:11&lt;00:00, 4311.48it/s]
100%|█████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00, 11.26it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calculating snrs...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████████████████████████| 1525/1525 [00:03&lt;00:00, 381.67it/s]
100%|██████████████████████████████████████████████████████████| 1525/1525 [00:03&lt;00:00, 390.52it/s]
100%|██████████████████████████████████████████████████████████| 1066/1066 [00:02&lt;00:00, 375.39it/s]
100%|████████████████████████████████████████████████████████████| 919/919 [00:02&lt;00:00, 379.79it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
given detectability_condition == step_function
collected number of detectable events =  662
total number of events =  150000
total rate (yr^-1): 1.0018535435858507
storing detectable lensed params in ./ler_data/lensed_params_n_detectable_ann.json
storing meta data in ./ler_data/meta_lensed_ann.json

 trmming final result to size=500
collected number of detectable events =  500
total number of events =  113293.0
total lensed event rate (yr^-1): 1.001853997759663
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span><span class="o">.</span><span class="n">rate_ratio</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
unlensed_rate: 416.85219699615203
lensed_rate: 1.001853997759663
ratio: 416.0807841544908
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../autoapi/ler/utils/utils/index.html" class="btn btn-neutral float-left" title="ler.utils.utils" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="GWRATES%20complete%20exmaples.html" class="btn btn-neutral float-right" title="GWRATES complete exmaples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Phurailatpam Hemantakumar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>