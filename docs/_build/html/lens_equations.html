

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lensed event sampling (Analytical formulation) &mdash; ler 0.5.9 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="_static/scalefix.css?v=11132fbc" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=88a06014" />
      <link rel="stylesheet" type="text/css" href="_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="_static/dark_mode_css/dark.css?v=70edf1c7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=9a3cda14"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script src="_static/design-tabs.js?v=f930bc37"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "displayMath": [["$$", "$$"], ["\\[", "\\]"]], "processEnvironments": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore", "processHtmlClass": "tex2jax_process"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="_static/dark_mode_js/default_light.js?v=c2e647ce"></script>
      <script src="_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980b9" >

          
          
          <a href="index.html" class="icon icon-home">
            ler
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_overview.html">Code overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="analytical_formulation_unlensed.html">Analytical Formulation for Gravitational Wave Event Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="analytical_formulation_lensed.html">Analytical Formulation for Lensed Gravitational Wave Event Rates</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="autoapi/ler/rates/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.rates</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/ler/gw_source_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.gw_source_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/ler/lens_galaxy_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.lens_galaxy_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/ler/image_properties/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.image_properties</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/ler/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.utils</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples/LeR_short_examples.html">LeR Short Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/GWRATES_complete_examples.html">GWRATES complete example</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/LeR_custom_functions.html">LeR with Custom Functions and Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/LeR_advanced_sampling.html">LeR Advanced Sampling — Generating Detectable Events</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980b9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Lensed event sampling (Analytical formulation)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/lens_equations.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lensed-event-sampling-analytical-formulation">
<h1>Lensed event sampling (Analytical formulation)<a class="headerlink" href="#lensed-event-sampling-analytical-formulation" title="Link to this heading"></a></h1>
<section id="initial-setup">
<h2>Initial setup<a class="headerlink" href="#initial-setup" title="Link to this heading"></a></h2>
<p>Note: I will interchangeably use terms like observable events and detectable events.</p>
<p>Define all the parameters involved.</p>
<ul class="simple">
<li><p>Source parameters: <span class="math notranslate nohighlight">\(\theta \in \{\)</span> <span class="math notranslate nohighlight">\(m_1\)</span> (mass of the heavier one), <span class="math notranslate nohighlight">\(m_2\)</span> (mass of the lighter one), <span class="math notranslate nohighlight">\(\iota\)</span> (inclination-angle), <span class="math notranslate nohighlight">\(\phi\)</span> (phase-of-coalescence), <span class="math notranslate nohighlight">\(\psi\)</span> (polarization-angle), <span class="math notranslate nohighlight">\(ra\)</span> (right-ascension), <span class="math notranslate nohighlight">\(dec\)</span> (declination) <span class="math notranslate nohighlight">\(\}\)</span> and <span class="math notranslate nohighlight">\(z_s\)</span> : red-shift of the source.</p></li>
<li><p>Lens parameters: <span class="math notranslate nohighlight">\(\theta_L \in \{\)</span> <span class="math notranslate nohighlight">\(\sigma\)</span> (velocity-dispersion), <span class="math notranslate nohighlight">\(q\)</span> (axis-ratio), <span class="math notranslate nohighlight">\(\psi\)</span> (axis-rotation), <span class="math notranslate nohighlight">\(\gamma\)</span> (spectral-index), <span class="math notranslate nohighlight">\([\gamma_1,\gamma_2]\)</span> (external-shear), <span class="math notranslate nohighlight">\([e_1,e_2]\)</span> (ellipticity), <span class="math notranslate nohighlight">\(\beta\)</span> (source position) <span class="math notranslate nohighlight">\(\}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(z_L\)</span> : red-shift of the galaxy lens</p></li>
<li><p>image properties: <span class="math notranslate nohighlight">\(\{\)</span> <span class="math notranslate nohighlight">\(\mu_i\)</span> (magnification), <span class="math notranslate nohighlight">\(dt_i\)</span> (time-delay), <span class="math notranslate nohighlight">\(n_i\)</span> (morse-phase) <span class="math notranslate nohighlight">\(\}\)</span>. There is subscript <span class="math notranslate nohighlight">\(i\)</span> because there can be multiple images.</p></li>
<li><p><span class="math notranslate nohighlight">\(SL\)</span>: Strong lensing condition. It means the original gravitational wave signal is lensed and split into multiple images <span class="math notranslate nohighlight">\((\geq 2)\)</span>.</p></li>
<li><p>Distance representation of lens object and source object will be in terms of redshifts (<span class="math notranslate nohighlight">\(z_l\)</span> and <span class="math notranslate nohighlight">\(z_s\)</span>).</p></li>
</ul>
<p>Montecarlo integration: Given a function <span class="math notranslate nohighlight">\(f(\theta)\)</span> and normalized probability distribution function PDF <span class="math notranslate nohighlight">\(P(\theta)\)</span>, then,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\int f(\theta) P(\theta) d\theta &amp;\approx \frac{1}{N} \sum_{i=1}^{N} f(\theta_i) \nonumber \\
&amp;\approx \left&lt; f(\theta) \right&gt;_{\theta \in P(\theta)}
\end{split}
\end{equation}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\theta_i\)</span> are samples drawn from <span class="math notranslate nohighlight">\(P(\theta)\)</span>.</p>
</section>
<section id="general-formulation-of-rate-equation">
<h2>General formulation of rate equation.<a class="headerlink" href="#general-formulation-of-rate-equation" title="Link to this heading"></a></h2>
<p>What we need to find is the number of lensed gravitational events that are detectable by the detector in a given time interval (1 year). Forget about lensing and detection for a moment. If we want to know the total number of compact binary coalescence (CBC) events then we can write it as,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\text{Rate of CBC events at redshift }z_s &amp;= \frac{\text{Number CBC events at redshift }z_s}{\text{Time}} \nonumber \\
&amp;= \text{Merger rate density at }z_s\times \text{Volume at }z_s \\
\end{split}
\end{equation}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
&amp;\text{Rate of CBC events in the entire observable universe} \nonumber \\
&amp;\;\;\;= \sum_{z_{min}}^{z_{max}} \text{Rate of CBC events at redshift }z_s \nonumber \\
\end{split}
\end{equation}
\end{split}\]</div>
<p>Similarly, we can write the rate of lensed detectable events as,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
&amp;\text{Rate of detectable lensed events} \nonumber \\
&amp;\;\;\;= \sum_{z_{min}}^{z_{max}} \text{observable rate density at }z_s\text{ which are also lensed}\times \text{Volume at }z_s
\end{split}
\end{equation}
\end{split}\]</div>
<p>Merger rate density at <span class="math notranslate nohighlight">\(z_s\)</span> is known.</p>
<p>Let’s try to formulate it with proper mathematics.</p>
<p>Given <span class="math notranslate nohighlight">\(d N^L_{obs}(z_s)\)</span> is the number of lensed GW detectable events from sources at red-shift <span class="math notranslate nohighlight">\(z_s\)</span> in a spherical shell of thickness <span class="math notranslate nohighlight">\(d z_s\)</span>, then, the rate observing lensed GW events is given by,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\mathcal{R}_L &amp;= \int_{z_{min}}^{z_{max}} \frac{d N^L_{obs}(z_s)}{d t} \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d t \;d\mathcal{V}_c}  \frac{d\mathcal{V}_c}{d\Omega dz_s} d\Omega dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{\left(d t/(1+z_s)\right) \;d\mathcal{V}_c}\frac{1}{(1+z_s)}\frac{d\mathcal{V}_c}{d\Omega dz_s} d\Omega dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d\tau \;d\mathcal{V}_c}\frac{1}{(1+z_s)} \frac{d\mathcal{V}_c}{d\Omega dz_s} d\Omega dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d\tau \;d\mathcal{V}_c}\frac{1}{(1+z_s)} \frac{d\mathcal{V}_c}{d\Omega dz_s} \Bigg\{ \int_{all\; sky} d\Omega \Bigg\}dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d\tau \;d\mathcal{V}_c}\frac{1}{(1+z_s)} \Bigg(\frac{d\mathcal{V}_c}{d\Omega dz_s} 4\pi \Bigg)dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d\tau \;d\mathcal{V}_c}\frac{1}{(1+z_s)} \frac{dV_c}{dz_s} dz_s \\
\end{split} \tag{1}
\end{equation}
\end{split}\]</div>
<p>Note: Reader should not confuse between lensed events and lensed images. Each lensed event can have multiple lensed images. These images can be detected as seperate GW signals. In case of un-lensed events, there is only one GW signal for each event.</p>
<p>Given <span class="math notranslate nohighlight">\(d N^L_{obs}(z_s)\)</span> is the number of lensed GW detectable events from sources at red-shift <span class="math notranslate nohighlight">\(z_s\)</span> in a spherical shell of thickness <span class="math notranslate nohighlight">\(d z_s\)</span>, then, the rate observing lensed GW events is given by,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\mathcal{R}_L &amp;= \int_{z_{min}}^{z_{max}} \frac{d N^L_{obs}(z_s)}{d t} \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d t \;d\mathcal{V}_c}  \frac{d\mathcal{V}_c}{d\Omega dz_s} d\Omega dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{\left(d t/(1+z_s)\right) \;d\mathcal{V}_c}\frac{1}{(1+z_s)}\frac{d\mathcal{V}_c}{d\Omega dz_s} d\Omega dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d\tau \;d\mathcal{V}_c}\frac{1}{(1+z_s)} \frac{d\mathcal{V}_c}{d\Omega dz_s} d\Omega dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d\tau \;d\mathcal{V}_c}\frac{1}{(1+z_s)} \frac{d\mathcal{V}_c}{d\Omega dz_s} \Bigg\{ \int_{all\; sky} d\Omega \Bigg\}dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d\tau \;d\mathcal{V}_c}\frac{1}{(1+z_s)} \Bigg(\frac{d\mathcal{V}_c}{d\Omega dz_s} 4\pi \Bigg)dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d\tau \;d\mathcal{V}_c}\frac{1}{(1+z_s)} \frac{dV_c}{dz_s} dz_s \\
\end{split} \tag{1}
\end{equation}
\end{split}\]</div>
<p>Note: Reader should not confuse between lensed events and lensed images. Each lensed event can have multiple lensed images. These images can be detected as seperate GW signals. In case of un-lensed events, there is only one GW signal for each event.</p>
<p>Note that if <span class="math notranslate nohighlight">\(d\tau=dt/(1+z_s)\)</span> is considered the proper time and it can be converted from the time at detector frame <span class="math notranslate nohighlight">\(dt\)</span> using the time-dilation factor <span class="math notranslate nohighlight">\((1+z_s)\)</span>. Consequently, <span class="math notranslate nohighlight">\(\frac{d^2 N^L_{obs}(z_s)}{d t \;d\mathcal{V}_c}\)</span> and <span class="math notranslate nohighlight">\(\frac{d^2 N^L_{obs}(z_s)}{d \tau \;d\mathcal{V}_c}\)</span> are the observed merger rate density at detector-frame and source-frame respectively. We want to use the <span class="math notranslate nohighlight">\(R^L_{obs}(z_s)=\frac{d^2 N^L_{obs}(z_s)}{d \tau \;d\mathcal{V}_c}\)</span> for our analysis as most observational papers and the output of theoretical predictions are in the source-frame. <span class="math notranslate nohighlight">\(\frac{dV_c}{dz_s}dz_s\)</span> is considered a spherical-shell volume element in co-moving coordinates at red-shift <span class="math notranslate nohighlight">\(z_s\)</span>. So, the rate expression simplifies to integrating (density) <span class="math notranslate nohighlight">\(\times\)</span> (time dilation effect) over the shell volume element. For more information on the volume element refer to this <a class="reference internal" href="#"><span class="xref myst">page</span></a> of the documentation.</p>
<p>Note: <span class="math notranslate nohighlight">\(\frac{dV_c}{dz_s}\)</span> is the differential co-moving volume at red-shift <span class="math notranslate nohighlight">\(z_s\)</span> and you can get the value by using <code class="docutils literal notranslate"><span class="pre">astropy</span></code> cosmology package for a given cosmology.</p>
<p>Now we have,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\mathcal{R}_L &amp;= \int_{z_{min}}^{z_{max}} \frac{d^2 N^L_{obs}(z_s)}{d \tau\;d\mathcal{V}_c} \frac{1}{(1+z_s)} \frac{dV_c}{dz_s} dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} R^L_{obs}(z_s) \frac{1}{(1+z_s)} \frac{dV_c}{dz_s} dz_s
\end{split} \tag{2}
\end{equation}
\end{split}\]</div>
<p>We want to re-write it in terms intrinsic merger rate distribution <span class="math notranslate nohighlight">\(R(z_s)\)</span>. <span class="math notranslate nohighlight">\(R(z_s)\)</span> is the merger rate density distribution regardless of whether the source is detectable or not.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\mathcal{R}_L &amp;= \int_{z_{min}}^{z_{max}} R^L_{obs}(z_s) \frac{1}{(1+z_s)} \frac{dV_c}{dz_s} dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} R(z_s) P(obs, SL|z_s) \frac{1}{(1+z_s)} \frac{dV_c}{dz_s} dz_s \\
&amp;= \int_{z_{min}}^{z_{max}} R(z_s) P(obs|z_s, SL) P(SL|z_s) \frac{1}{(1+z_s)} \frac{dV_c}{dz_s} dz_s \\
\end{split} \tag{3}
\end{equation}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\mathcal{R}_L &amp;= \mathcal{N}^L \int_{z_{min}}^{z_{max}} P(z_s| SL) P(obs|z_s, SL) dz_s \\
\end{split} \tag{4}
\end{equation}
\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(P(obs|z_s, SL)\)</span> is the probability of observing a lensed GW event given that the source is at red-shift <span class="math notranslate nohighlight">\(z_s\)</span> and the signal is strongly lensed. Here, it is considered marginalized over all the gravitational wave parameters <span class="math notranslate nohighlight">\(\theta\)</span> (without <span class="math notranslate nohighlight">\(z_s\)</span>), lens related parameters <span class="math notranslate nohighlight">\(\theta_L\)</span>, lens redshifts <span class="math notranslate nohighlight">\(z_L\)</span> and possible source positions <span class="math notranslate nohighlight">\(\beta\)</span>, i.e., <span class="math notranslate nohighlight">\(P(obs|z_s,SL) = \int_{\theta, \theta_L, z_l, \beta} d\theta\, d\theta_L\, dz_l\, d\beta\, P(obs|z_s, \theta, \theta_L, z_l, \beta, SL)\)</span>.</p>
<p><span class="math notranslate nohighlight">\(P(SL|z_s)\)</span> is the probability of strong lensing given that the source is at red-shift <span class="math notranslate nohighlight">\(z_s\)</span>. It is also called the optical depth of strong lensing. It is discussed in detail in the next section.</p>
<p>In Eqn(4) the merger rate density becomes the prior distribution <span class="math notranslate nohighlight">\(P(z_s|SL)\)</span> for the lensed source redshift, and it is normalized over the red-shift range. So the normalizing factor is given by,</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\begin{split}
\mathcal{N}^L = \int_{z_{min}}^{z_{max}} R(z_s) P(SL|z_s) \frac{1}{(1+z_s)} \frac{dV_c}{dz_s} dz_s 
\end{split} \tag{5}
\end{equation}
\]</div>
<p>Therefore,</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\begin{split}
P(z_s|SL) = \frac{R(z_s)}{\mathcal{N}^L} P(SL|z_s) \frac{1}{(1+z_s)} \frac{dV_c}{dz_s}
\end{split} \tag{6}
\end{equation}
\]</div>
<p>This is done because we want to sample the red-shift values from this prior distribution, which later will be used in the monte-carlo integration to estimate the rate.</p>
<p>Below I have included the Bayesian way of arriving at <span class="math notranslate nohighlight">\(P(z_s|SL)\)</span> expression.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(z_s|SL) &amp;= \frac{P(SL|z_s) P(z_s)}{P(SL)} \\
&amp;= \frac{P(SL|z_s) P(z_s)}{\int_{z_{min}}^{z_{max}} P(SL|z_s) P(z_s) dz_s} \\
&amp;= \frac{P(SL|z_s) P(z_s)}{\mathcal{N}^L/\mathcal{N}^U} \\
&amp;= \frac{R(z_s)}{\mathcal{N}^L} P(SL|z_s) \frac{1}{(1+z_s)} \frac{dV_c}{dz_s}
\end{split} \tag{7}
\end{equation}
\end{split}\]</div>
<p>In the above expression, I have used the redshift prior <span class="math notranslate nohighlight">\(P(z_s)\)</span> of unlensed events as given in Eqn(6) of <a class="reference external" href="https://ler.hemantaph.comGW_equations.html#Gravitational-wave-events-sampling-(Analytical-formulation)">Analytical formulation of the un-lensed event sampling</a>.</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\begin{split}
P(z_s) = \frac{R(z_s)}{\mathcal{N}^U} \frac{1}{(1+z_s)} \frac{dV_c}{dz_s}
\end{split} \tag{8.1}
\end{equation}
\]</div>
<p>Let’s re-write the integrand in rate expression in Eqn(4) so that it also become dependent on  lens parameter <span class="math notranslate nohighlight">\(\theta_L\)</span>, lens redshift <span class="math notranslate nohighlight">\(z_l\)</span>, source position <span class="math notranslate nohighlight">\(\beta\)</span>, and othet GW parameters <span class="math notranslate nohighlight">\(\theta\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\mathcal{R}_L &amp;= \mathcal{N}^L \int_{z_{min}}^{z_{max}} P(z_s| SL)\, P(obs|z_s, SL)\, dz_s \\ \nonumber
\text{where,}&amp; \\
P(obs|z_s, SL) &amp;= \int_{\theta, \theta_L, z_l, \beta} P(obs|z_s, \theta, \theta_L, z_l, \beta, SL) \\
&amp;\;\; P(\theta, \theta_L, z_l, \beta|z_s, SL) d\theta\, d\theta_L\, dz_l\, d\beta \\
\end{split}
\end{equation}
\end{split}\]</div>
<p>Let’s break down the integrand and reassemble it, so that it is easier from the sampling perspective.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(\theta, \theta_L, z_l, \beta|z_s, SL) P(z_s| SL) &amp;= P(\theta) P(\theta_L, z_l, \beta|z_s, SL) P(z_s| SL) \\
&amp;= P(\theta) P(\beta|\theta_L, z_l, z_s, SL) P(\theta_L, z_l|z_s, SL)P(z_s| SL) \\
&amp;= P(\theta) P(\beta|\theta_L, z_l, z_s, SL) P(\theta_L, z_l, z_s|SL) \\
\end{split} \tag{8.2}
\end{equation}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(\theta_L, z_l, z_s|SL) &amp;= P(SL|\theta_L, z_l, z_s) P(\theta_L, z_l, z_s) \\
\end{split} \tag{8.3}
\end{equation}
\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(P(SL|\theta_L, z_l, z_s)\)</span> is the cross-section of the lensing event. In <code class="docutils literal notranslate"><span class="pre">ler</span></code>, it is assumed to the double-caustic area and solving it with <code class="docutils literal notranslate"><span class="pre">lenstronomy</span></code> is expensive. The parameters can be sample from intrinsic distribution <span class="math notranslate nohighlight">\(P(\theta_L, z_l, z_s)\)</span> and reject or select it based on the lensing cross-section. This is ineffecient and slow as most of the samples will be rejected due to small lensing cross-section. Thus, we re-strucutre the mathematics to have a more efficient sampling.</p>
<p>Consider lens parameters <span class="math notranslate nohighlight">\(\theta_L\in \{\sigma, q, \psi, \gamma, [\gamma_1,\gamma_2]\}\)</span> and the lensing cross-section, <span class="math notranslate nohighlight">\(\phi_{\text{SIE}} = P(SL|q,\sigma,z_l,z_s)\)</span>. Let’s first seperate the co-related parameters from the uncorrelated one from Eqn(8.2).</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(\sigma, q, \psi, \gamma, \gamma_1, \gamma_2, z_l, z_s|SL) &amp;= P(\psi|SL) P(\gamma|SL) P(\gamma_1, \gamma_2|SL) P(\sigma, q, z_l, z_s|SL) \\
P(\sigma, q, z_l, z_s|SL) &amp;=  P(\sigma, q | z_l, z_s, SL) P( z_l| z_s, SL) P( z_s| SL)\\
P(\sigma, q | z_l, z_s, SL) &amp;\propto P(SL| \sigma, q, z_l, z_s) P(\sigma, q | z_l, z_s) = \phi_{\text{SIE}} P(q| \sigma, z_l, z_s) P(\sigma | z_l, z_s) \\
P( z_s| SL) &amp;\propto P(SL| z_s) P(z_s)\\
\end{split} \tag{8.3}
\end{equation}
\end{split}\]</div>
<p>The sampling is done in the following order,</p>
<ul class="simple">
<li><p>sample <span class="math notranslate nohighlight">\(z_s\)</span> from astrophysical prior <span class="math notranslate nohighlight">\(P(z_s)\)</span> and reject or select it based on the optical-depth <span class="math notranslate nohighlight">\(P(SL|z_s)\)</span>.</p></li>
<li><p>given <span class="math notranslate nohighlight">\(z_s\)</span>, sample <span class="math notranslate nohighlight">\(z_l\)</span> from <span class="math notranslate nohighlight">\(P(z_l|z_s, SL)\)</span>. <span class="math notranslate nohighlight">\(P(z_l|z_s, SL)\)</span> derivation is discussed in the next section.</p></li>
<li><p>given <span class="math notranslate nohighlight">\(z_s\)</span> and <span class="math notranslate nohighlight">\(z_l\)</span>, sample <span class="math notranslate nohighlight">\(\sigma\)</span> from an astrophysical distribution <span class="math notranslate nohighlight">\(P(\sigma|z_l, z_s)\)</span> and then sample <span class="math notranslate nohighlight">\(q\)</span> from <span class="math notranslate nohighlight">\(P(q| \sigma, z_l, z_s)\)</span> Collett et al. 2015. The sampled <span class="math notranslate nohighlight">\(\sigma\)</span> <span class="math notranslate nohighlight">\(q\)</span> pair is then accepted or rejected based on the lensing cross-section <span class="math notranslate nohighlight">\(\phi_{\text{SIE}}\)</span>.</p></li>
<li><p>Other lensing paramter distributions are pre-computed using equation (8.3), under strong lensing condition. So the sampling of <span class="math notranslate nohighlight">\(\psi\)</span>, <span class="math notranslate nohighlight">\(\gamma\)</span>, <span class="math notranslate nohighlight">\([\gamma_1,\gamma_2]\)</span> is done directly from the pre-computed distribution. This is possible because they are not correlated with the <span class="math notranslate nohighlight">\(\sigma\)</span>, <span class="math notranslate nohighlight">\(q\)</span>, <span class="math notranslate nohighlight">\(z_l\)</span> and <span class="math notranslate nohighlight">\(z_s\)</span>.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\mathcal{R}_L &amp;= \mathcal{N}^L \int P(z_s| SL)\, P(obs|z_s, \theta, \theta_L, z_l, \beta, SL) \\
&amp;\;\; P(\theta)\, P(\theta_L|z_l, z_s, SL)\, P(z_l|z_s)\, P(\beta|z_s,z_l, \theta_L, SL) dz_s d\theta d\theta_L dz_l d\beta \\
\end{split} \tag{9}
\end{equation}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
\mathcal{R}_L &amp;=  \mathcal{N}^L \int \frac{R(z_s)}{\mathcal{N}^L} P(SL|z_s) \frac{1}{(1+z_s)} \frac{dV_c}{dz_s}\, P(obs|z_s, \theta, \theta_L, z_l, \beta, SL)  \\
&amp;\;\; P(\theta)\, P(\theta_L|z_l, z_s, SL)\, P(z_l|z_s, SL)\, P(\beta|z_s,z_l, \theta_L, SL) dz_s d\theta d\theta_L dz_l d\beta \\
\end{split} \tag{10}
\end{equation}
\end{split}\]</div>
<p>Eqn(10) is the complete expression for the rate of lensed detectable events.</p>
<p>In arriving at Eqn(9) I have used the following relations,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(z_s|SL)\, P(obs|z_s, SL) &amp;= \int_{z_l}\int_{\beta}\int_{\theta}\int_{\theta_L} P(z_s, z_l, \beta, \theta, \theta_L|SL)\, P(obs|z_s, \theta, \theta_L, z_l, \beta, SL) d\theta d\theta_L dz_l d\beta \nonumber \\
P(z_s, z_l, \beta, \theta, \theta_L|SL) &amp;= P(\theta) P(z_s, z_l, \beta, \theta_L|SL) \\
P(z_s, z_l, \beta, \theta_L|SL) &amp;= P(\beta|z_s,z_l, \theta_L, SL) P(z_s, z_l, \theta_L|SL) \\
P(z_s, z_l, \theta_L|SL) &amp;= P(z_l, \theta_L|z_s, SL) P(z_s|SL) \\
P(z_l, \theta_L|z_s, SL) &amp;= P(\theta_L|z_s, z_l, SL) P(z_l|z_s, SL) \\
&amp;= P(\theta_L|z_l, z_s, SL) P(z_l|z_s, SL) \\
\end{split}
\end{equation}
\end{split}\]</div>
<p>Therefore,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
&amp;P(z_s|SL)\, P(obs|z_s, SL) = \nonumber \\
&amp;\;\;\; \int_{z_l}\int_{\beta}\int_{\theta}\int_{\theta_L} P(obs|z_s, \theta, \theta_L, z_l, \beta, SL) \nonumber \\
&amp;\;\;\; P(z_s|SL) P(\theta) P(\theta_L|z_l, z_s, SL)\, P(z_l|z_s, SL)\, P(\beta|z_s,z_l, \theta_L, SL) d\theta d\theta_L dz_l d\beta 
\end{split}
\end{equation}
\end{split}\]</div>
</section>
<section id="optical-depth">
<h2>Optical depth<a class="headerlink" href="#optical-depth" title="Link to this heading"></a></h2>
<p><strong>Strong lensing probability (where does it come from?)</strong></p>
<section id="general-formulation">
<h3>General formulation<a class="headerlink" href="#general-formulation" title="Link to this heading"></a></h3>
<p>Optical depth <span class="math notranslate nohighlight">\(P(SL|z_s)\)</span> is defined as the probability of a source being strongly lensed. One can also think of it as cross-section of the lensing, i.e…</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
&amp;\text{Optical-depth of a source at redshift }z_s\\ 
&amp;\;\;=\frac{\text{Sum of small portions of the sky where lensing can happen}}{\text{Entire sky}}
\end{split} \tag{9}
\end{equation}
\end{split}\]</div>
<p>The numerator corresponds to relevant lensing area of all possible lensing galaxies present in the universe between the observer and the source. For a given source at red-shift <span class="math notranslate nohighlight">\(z_s\)</span>, the probability of strong lensing is given by <span class="math notranslate nohighlight">\(P(SL|z_s)\)</span>. And let there be a distribution of lenses <span class="math notranslate nohighlight">\(dN(z_l)\)</span> at red-shift <span class="math notranslate nohighlight">\(z_l\)</span> in a spherical shell of thickness <span class="math notranslate nohighlight">\(d z_l\)</span>. Then the probability of strong lensing is given by,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(SL|z_s) &amp;=  \frac{1}{4\pi} \int^{z_s}_{z_l=0} P(SL|z_s, z_l) dN(z_l) \\
\end{split} \tag{10}
\end{equation}
\end{split}\]</div>
<p>Let’s try to write the integrand in terms of number density. Consequently, we need to consider the integrand’s dependence on lens parameters <span class="math notranslate nohighlight">\(\theta_L\)</span> and lens redshift <span class="math notranslate nohighlight">\(z_l\)</span>. Now the Eqn(10) becomes,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(SL|z_s) &amp;=  \frac{1}{4\pi} \int^{z_s}_{z_l=0} \int_{\theta_L} P(SL|z_s, z_l, \theta_L) \frac{d^2N(z_l, \theta_L)}{dV_c d\theta_L} \frac{dV_c}{dz_l} dz_l d\theta_L \\
\end{split} \tag{11}
\end{equation}
\end{split}\]</div>
<p>The number density of lenses <span class="math notranslate nohighlight">\(d^3N(z_l)/dV_c dz_ld\theta_L\)</span> is the number of lenses per unit volume per unit red-shift per unit lens parameter. The lensing probability <span class="math notranslate nohighlight">\(P(SL|z_s, z_l, \theta_L)\)</span> is the probability of strong lensing given that the source is at red-shift <span class="math notranslate nohighlight">\(z_s\)</span>, the lens is at red-shift <span class="math notranslate nohighlight">\(z_l\)</span> and the lens parameters are <span class="math notranslate nohighlight">\(\theta_L\)</span>. The integral is over all possible lens red-shifts and lens parameters. The factor <span class="math notranslate nohighlight">\(1/4\pi\)</span> is the solid angle of the entire sky.</p>
</section>
<section id="optical-depth-for-singular-isothermal-sphere-sis-lens">
<h3>Optical depth for Singular isothermal sphere SIS lens<a class="headerlink" href="#optical-depth-for-singular-isothermal-sphere-sis-lens" title="Link to this heading"></a></h3>
<p>This is in reference to <a class="reference external" href="https://arxiv.org/abs/1807.07062">Haris et al. 2018</a>.</p>
<p>Take <span class="math notranslate nohighlight">\(P(SL|z_s, z_l, \theta_L)\)</span> as <span class="math notranslate nohighlight">\(\phi_{\text{SIS}}=\pi \theta_E^2\)</span> (<span class="math notranslate nohighlight">\(\theta_E\)</span>: Einstein radius) and <span class="math notranslate nohighlight">\(\theta_L\in \{\sigma\}\)</span>, where <span class="math notranslate nohighlight">\(\sigma\)</span> is the velocity dispersion of the lens. The probability of strong lensing for a SIS lens is given by,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(SL|z_s) &amp;=  \frac{1}{4\pi} \int^{z_s}_{z_l=0} \int_{\sigma} P(SL|z_s, z_l, \sigma) \frac{d^2N(z_l, \sigma)}{dV_c d\sigma} \frac{dV_c}{dz_l} dz_l d\sigma \\
&amp;=  \frac{1}{4\pi} \int^{z_s}_{z_l=0} \int_{\sigma} \phi_{\text{SIS}} \frac{d^2N(z_l, \sigma)}{dV_c d\sigma} \frac{dV_c}{dz_l} dz_l d\sigma \\
\end{split} \tag{12a}
\end{equation}
\end{split}\]</div>
<p>Haris, following Choi et al. 2008 for early type galaxy, has considered the number density of the lens, <span class="math notranslate nohighlight">\(\frac{d^2N(z_l, \sigma)}{dV_c d\sigma}=\,&lt;n&gt;_{\sigma\in P(\sigma)} P(\sigma)\)</span> where <span class="math notranslate nohighlight">\(P(\sigma)\)</span> is the PDF of velocity dispersion and <span class="math notranslate nohighlight">\(&lt;n&gt;_{\sigma\in P(\sigma)}=n_o=8\times 10^{-3} h^3 Mpc^{-3}\)</span> is the average number density of the lens which constant over the red-shift range of local universe. But I will consider a general case, like in Oguri et al. 2018 for all-type galaxy, where <span class="math notranslate nohighlight">\(\frac{d^2N(z_l, \sigma)}{dV_c d\sigma}=\phi(\sigma,z_l)=\phi_\text{loc}(\sigma)\frac{\phi_\text{hyd}(\sigma,z_l)}{\phi_\text{hyd}(\sigma,0)}\)</span>, and has both function dependence on both red-shift and velocity dispersion. The optical depth becomes,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(SL|z_s) &amp;=  \int \frac{\pi \theta_E^2}{4 \pi} \phi(\sigma,z_l) \frac{dV_c}{dz_l} dz_l d\sigma = \int_0^{z_s} \Phi_{SIS}(z_l| z_s) dz_l \\
\end{split} \tag{12b}
\end{equation}
\end{split}\]</div>
<p>Considering <span class="math notranslate nohighlight">\(P_o(z_l)\)</span> and <span class="math notranslate nohighlight">\(P_o(\sigma)\)</span> are the uniform distribution over the respective parameters, the integral can be numerically calculated as calculated as,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(SL|z_s) &amp;=  \int \frac{\theta_E^2}{4} \phi(\sigma,z_l) \frac{dV_c}{dz_l} \frac{P_o(z_l)}{P_o(z_l)} \frac{P_o(\sigma)}{P_o(\sigma)} dz_l d\sigma  \\ \nonumber
&amp;=  (z_{l,max}-z_{l,min})(\sigma_{max}-\sigma_{min})\left&lt; \frac{\theta_E^2}{4} \phi(\sigma,z_l) \frac{dV_c}{dz_l}\right&gt;_{\sigma\in P_o(\sigma)\, z_l\in P_o(z_l)} \\ \nonumber
&amp;=  \Delta z_l \Delta \sigma \left&lt; \frac{\theta_E^2}{4} \phi(\sigma,z_l) \frac{dV_c}{dz_l}\right&gt;_{\sigma\in P_o(\sigma)\, z_l\in P_o(z_l)}
\end{split} \tag{12c}
\end{equation}
\end{split}\]</div>
<p>Or we can first compute <span class="math notranslate nohighlight">\(\Phi_{SIS}(z_l| z_s)\)</span> and then integrate over <span class="math notranslate nohighlight">\(z_l\)</span> to get <span class="math notranslate nohighlight">\(P(\text{SL}|z_s)\)</span>. <code class="docutils literal notranslate"><span class="pre">ler</span></code> prefer the second approach, as it allows us to compute <span class="math notranslate nohighlight">\(P(z_l|z_s, \text{SL})\)</span> as follows,</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\begin{split}
P(z_l|z_s, SL) &amp;= \frac{\Phi_{SIS}(z_l| z_s)}{\kappa(z_s)}= \frac{\Delta \sigma}{\kappa(z_s)} \left&lt; \frac{\theta_E^2}{4} \phi(\sigma,z_l) \frac{dV_c}{dz_l}\right&gt;_{\sigma\in P_o(\sigma)}
\end{split} \tag{12d}
\end{equation}
\]</div>
<p>Where <span class="math notranslate nohighlight">\(\kappa(z_s)\)</span> is the normalization factor given the source redshift <span class="math notranslate nohighlight">\(z_s\)</span>.</p>
</section>
<section id="optical-depth-for-sie-lens">
<h3>Optical depth for SIE lens<a class="headerlink" href="#optical-depth-for-sie-lens" title="Link to this heading"></a></h3>
<p>Take <span class="math notranslate nohighlight">\(P(SL|z_s, z_l, \theta_L)\)</span> as <span class="math notranslate nohighlight">\(\phi_{\text{SIE}}=\phi_{\text{SIS}} \phi_{\text{CUT}}^{\text{SIE}}(q)\)</span> and <span class="math notranslate nohighlight">\(\theta_L\in \{\sigma, q\}\)</span>, where <span class="math notranslate nohighlight">\(\sigma\)</span> is the velocity dispersion and <span class="math notranslate nohighlight">\(q\)</span> is the axis-ratio. <span class="math notranslate nohighlight">\(\phi^{SIE}_{CUT}(q)\)</span> is derive from the expression given in <a class="reference external" href="https://iopscience.iop.org/article/10.3847/1538-4357/ac58f8">Fei Xu et al. 2022</a>. Let’s start with Eqn(12a).</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
\begin{split}
P(SL|z_s) &amp;=  \frac{1}{4\pi} \int^{z_s}_{z_l=0} \int_{\sigma} P(SL|z_s, z_l, \sigma) \frac{d^2N(z_l, \sigma)}{dV_c d\sigma} \frac{dV_c}{dz_l} dz_l d\sigma \\
&amp;=  \frac{1}{4\pi} \int^{z_s}_{z_l=0} \int_{\sigma} \int_{q} P(SL|z_s, z_l, \sigma, q) P(q) \frac{d^2N(z_l, \sigma)}{dV_c d\sigma} \frac{dV_c}{dz_l} dz_l d\sigma dq \\
&amp;=  \frac{1}{4\pi} \int^{z_s}_{z_l=0} \int_{\sigma} \int_{q} \phi_{\text{SIE}} P(q) \phi_(\sigma, z_l) \frac{dV_c}{dz_l} dz_l d\sigma dq \\
&amp;= \frac{\Delta z_l \Delta \sigma}{4\pi} \left&lt; \phi_{\text{SIE}}\; \phi_(\sigma, z_l)\; \frac{dV_c}{dz_l}\right&gt;_{\sigma\in P_o(\sigma)\, z_l\in P_o(z_l)\, q\in P(q)}
\end{split} \tag{12a}
\end{equation}
\end{split}\]</div>
</section>
<section id="optical-depth-for-epl-shear-lens">
<h3>Optical depth for EPL+Shear lens<a class="headerlink" href="#optical-depth-for-epl-shear-lens" title="Link to this heading"></a></h3>
<p>Take <span class="math notranslate nohighlight">\(P(SL|z_s, z_l, \theta_L)\)</span> as <span class="math notranslate nohighlight">\(\phi_{\text{EPL}}\)</span> and <span class="math notranslate nohighlight">\(\theta_L \in\)</span> {<span class="math notranslate nohighlight">\(\sigma\)</span> (velocity-dispersion), <span class="math notranslate nohighlight">\(q\)</span> (axis-ratio), <span class="math notranslate nohighlight">\(\psi\)</span> (axis-rotation), <span class="math notranslate nohighlight">\(\gamma\)</span> (mass density spectral-index), <span class="math notranslate nohighlight">\([\gamma_1,\gamma_2]\)</span> (external-shear), <span class="math notranslate nohighlight">\([e_1,e_2]\)</span> (ellipticity)}.</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
\begin{split}
P(SL|z_s) &amp;= \frac{\Delta z_l \Delta \sigma}{4\pi} \left&lt; \phi_{\text{EPL}}\; \phi_(\sigma, z_l)\; \frac{dV_c}{dz_l}\right&gt;_{\sigma\in P_o(\sigma)\, z_l\in P_o(z_l)\, q\in P(q) \, \psi\in P(\psi) \, \gamma\in P(\gamma) \, \gamma_1,\gamma_2\in P(\gamma_1,\gamma_2) \, e_1,e_2\in P(e_1,e_2)}
\end{split} \tag{12a}
\end{equation}
\]</div>
<p>where P_o(\sigma) and P_o(z_l) are the uniform distribution, and <span class="math notranslate nohighlight">\(P(q)\)</span>, <span class="math notranslate nohighlight">\(P(\psi)\)</span>, <span class="math notranslate nohighlight">\(P(\gamma)\)</span>, <span class="math notranslate nohighlight">\(P(\gamma_1,\gamma_2)\)</span>, <span class="math notranslate nohighlight">\(P(e_1,e_2)\)</span> are the astrophysical PDF of the respective lens parameters.</p>
</section>
</section>
<section id="the-order-of-sampling-and-rate-calculation-steps-in-ler-are-listed-below">
<h2>The order of sampling and rate calculation steps in LeR are listed below.<a class="headerlink" href="#the-order-of-sampling-and-rate-calculation-steps-in-ler-are-listed-below" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Sample <span class="math notranslate nohighlight">\(z_s\)</span> from <span class="math notranslate nohighlight">\(P(z_s)\)</span>. And apply rejection sampling with optical depth, <span class="math notranslate nohighlight">\(P(SL|z_s)\)</span>. Other GW parameters are sampled separately, <span class="math notranslate nohighlight">\(P(\theta)\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(z_l\)</span> from <span class="math notranslate nohighlight">\(P(z_l|z_s)\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma\)</span> from <span class="math notranslate nohighlight">\(P(\sigma|z_l)\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(q\)</span> from <span class="math notranslate nohighlight">\(P(q|\sigma)\)</span>.</p></li>
<li><p>Calculation of Einstein radius and application of lensing condition to the sampled lens parameters, <span class="math notranslate nohighlight">\(P(SL|z_s, z_l, \sigma, q) \propto \theta_E^2\,\phi^{SIE}_{CUT}\)</span>.</p></li>
<li><p>Other lens parameters (<span class="math notranslate nohighlight">\(e_1\)</span>, <span class="math notranslate nohighlight">\(e_2\)</span>, <span class="math notranslate nohighlight">\(\gamma_1\)</span>, <span class="math notranslate nohighlight">\(\gamma_2\)</span>, <span class="math notranslate nohighlight">\(\gamma\)</span>) are sampled independent of the SL condition, <span class="math notranslate nohighlight">\(P(e_1,e_2,\gamma_1,\gamma_2,\gamma)\)</span>. But, this will be rejection sampled later along with the image position.</p></li>
<li><p>Draw image position, <span class="math notranslate nohighlight">\(\beta\)</span>, from within the caustic boundary and solve the lens equation to get image positions. Accept it if it results in 2 or more images, otherwise resample <span class="math notranslate nohighlight">\(\beta\)</span>. Note that the source postion and image positions are wrt to the center of the lens galaxy (thin lens approximation). But in the sky map the source position will be sampled ra and dec.</p></li>
<li><p>Sometimes (once in 100-200 thousand), the strong lensing condition cannot be satisfied. For these particular events, resample lens parameters and draw image positions, i.e. repeat steps 2-7.</p></li>
<li><p>Calculate the magnification, <span class="math notranslate nohighlight">\(\mu_i\)</span>, time-delay, <span class="math notranslate nohighlight">\(dt_i\)</span> and morse phase, <span class="math notranslate nohighlight">\(n_i\)</span> for each of the lensed event.</p></li>
<li><p>Modify the luminosity distance, <span class="math notranslate nohighlight">\(D_l\)</span> to <span class="math notranslate nohighlight">\(D_l^{eff}=D_l/\sqrt{|\mu_i|}\)</span>, and geocent_time to <span class="math notranslate nohighlight">\(t_{eff}=t_{geocent}+dt_i\)</span>.</p></li>
<li><p>Calculate SNR with <a class="reference external" href="https://gwsnr.readthedocs.io/en/latest/">gwsnr</a></p></li>
<li><p>Apply the SNR threshold and check whether the event is detectable or not.</p></li>
<li><p>Calculate rate of lensed events, <span class="math notranslate nohighlight">\(\mathcal{R}_L\)</span> using equation 13.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Phurailatpam Hemantakumar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>